<html><!-- Created using the cpp_pretty_printer from the dlib C++ library.  See http://dclib.sf.net for updates. --><head><title>dlib C++ Library - compress_stream_ex.cpp</title></head><body bgcolor='white'><pre>
<font color='#009900'>/*

    This is an example illustrating the use of the compress_stream and
    cmd_line_parser components from the dlib C++ Library.  

    This example implements a simple command line compression utility.


    The output from the program when the -h option is given is:

        Usage: dclib_example (-c|-d) --in input_file --out output_file
        Options:
        -c                       Indicates that we want to compress a file.
        -d                       Indicates that we want to decompress a file.
        -h                       Display this help message.
        --in &lt;arg&gt;               This option takes one argument which specifies the
                                 name of the file we want to compress/decompress.
        --out &lt;arg&gt;              This option takes one argument which specifies the
                                 name of the output file.

*/</font>




<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='dlib/compress_stream.h.html'>dlib/compress_stream.h</a>"
<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='dlib/cmd_line_parser.h.html'>dlib/cmd_line_parser.h</a>"
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>iostream<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>fstream<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>string<font color='#5555FF'>&gt;</font>

<font color='#009900'>// I am making a typedef for the version of compress_stream I want to use.
</font><font color='#009900'>// I have selected kernel_1ec.
</font><font color='#0000FF'>typedef</font> dlib::compress_stream::kernel_1ec cs;

<font color='#009900'>// Here I am making another typedef, this time for the version of
</font><font color='#009900'>// cmd_line_parser I want to use.  This version gives me a
</font><font color='#009900'>// command line parser object that has all the available extensions
</font><font color='#009900'>// for command line parsers applied to it.  So I will be able to use
</font><font color='#009900'>// its command line validation utilities as well as option printing.
</font><font color='#0000FF'>typedef</font> dlib::cmd_line_parser<font color='#5555FF'>&lt;</font><font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font>::check_1a_c clp;


<font color='#0000FF'>using</font> <font color='#0000FF'>namespace</font> std;
<font color='#0000FF'>using</font> <font color='#0000FF'>namespace</font> dlib;


<font color='#0000FF'><u>int</u></font> <b><a name='main'></a>main</b><font face='Lucida Console'>(</font><font color='#0000FF'><u>int</u></font> argc, <font color='#0000FF'><u>char</u></font><font color='#5555FF'>*</font><font color='#5555FF'>*</font> argv<font face='Lucida Console'>)</font>
<b>{</b>  
    <font color='#0000FF'>try</font>
    <b>{</b>
        clp parser;
        cs compressor;

        <font color='#009900'>// first I will define the command line options I want.  
</font>        <font color='#009900'>// Add a -c option and tell the parser what the option is for.
</font>        parser.<font color='#BB00BB'>add_option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>c</font>","<font color='#CC0000'>Indicates that we want to compress a file.</font>"<font face='Lucida Console'>)</font>;
        parser.<font color='#BB00BB'>add_option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>d</font>","<font color='#CC0000'>Indicates that we want to decompress a file.</font>"<font face='Lucida Console'>)</font>;
        <font color='#009900'>// add a --in option that takes 1 argument
</font>        parser.<font color='#BB00BB'>add_option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>in</font>","<font color='#CC0000'>This option takes one argument which specifies the name of the file we want to compress/decompress.</font>",<font color='#979000'>1</font><font face='Lucida Console'>)</font>;
        <font color='#009900'>// add a --out option that takes 1 argument
</font>        parser.<font color='#BB00BB'>add_option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>out</font>","<font color='#CC0000'>This option takes one argument which specifies the name of the output file.</font>",<font color='#979000'>1</font><font face='Lucida Console'>)</font>;
        parser.<font color='#BB00BB'>add_option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>h</font>","<font color='#CC0000'>Display this help message.</font>"<font face='Lucida Console'>)</font>;


        <font color='#009900'>// now I will parse the command line
</font>        parser.<font color='#BB00BB'>parse</font><font face='Lucida Console'>(</font>argc,argv<font face='Lucida Console'>)</font>;


        <font color='#009900'>// Now I will use the parser to validate some things about the command line.
</font>        <font color='#009900'>// If any of the following checks fail then an exception will be thrown and it will
</font>        <font color='#009900'>// contain a message that tells the user the problem was.
</font>
        <font color='#009900'>// First I want to check that none of the options were given on the command line
</font>        <font color='#009900'>// more than once.  To do this I define an array that contains the options
</font>        <font color='#009900'>// that shouldn't appear more than once and then I just call check_one_time_options()
</font>        <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font><font color='#5555FF'>*</font> one_time_opts[] <font color='#5555FF'>=</font> <b>{</b>"<font color='#CC0000'>c</font>", "<font color='#CC0000'>d</font>", "<font color='#CC0000'>in</font>", "<font color='#CC0000'>out</font>", "<font color='#CC0000'>h</font>"<b>}</b>;
        parser.<font color='#BB00BB'>check_one_time_options</font><font face='Lucida Console'>(</font>one_time_opts<font face='Lucida Console'>)</font>;
        <font color='#009900'>// Here I'm checking that the user didn't pick both the c and d options at the
</font>        <font color='#009900'>// same time. 
</font>        parser.<font color='#BB00BB'>check_incompatible_options</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>c</font>", "<font color='#CC0000'>d</font>"<font face='Lucida Console'>)</font>;


        <font color='#009900'>// check if the -h option was given on the command line
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>parser.<font color='#BB00BB'>option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>h</font>"<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>
        <b>{</b>
            <font color='#009900'>// display all the command line options
</font>            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Usage: dclib_example (-c|-d) --in input_file --out output_file\n</font>";
            <font color='#009900'>// This function prints out a nicely formatted list of
</font>            <font color='#009900'>// all the options the parser has
</font>            parser.<font color='#BB00BB'>print_options</font><font face='Lucida Console'>(</font>cout<font face='Lucida Console'>)</font>; 
                                       
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> endl;
            <font color='#0000FF'>return</font> <font color='#979000'>0</font>;
        <b>}</b>

        <font color='#009900'>// Make some references to the options inside the parser.  This is just
</font>        <font color='#009900'>// for convenience so we don't have to type out he longer form below.  
</font>        <font color='#0000FF'>const</font> clp::option_type<font color='#5555FF'>&amp;</font> option_c <font color='#5555FF'>=</font> parser.<font color='#BB00BB'>option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>c</font>"<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>const</font> clp::option_type<font color='#5555FF'>&amp;</font> option_d <font color='#5555FF'>=</font> parser.<font color='#BB00BB'>option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>d</font>"<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>const</font> clp::option_type<font color='#5555FF'>&amp;</font> option_in <font color='#5555FF'>=</font> parser.<font color='#BB00BB'>option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>in</font>"<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>const</font> clp::option_type<font color='#5555FF'>&amp;</font> option_out <font color='#5555FF'>=</font> parser.<font color='#BB00BB'>option</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>out</font>"<font face='Lucida Console'>)</font>;

        <font color='#009900'>// make sure one of the c or d options was given
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>option_c <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font>option_d<font face='Lucida Console'>)</font>
        <b>{</b>
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Error in command line:\n   You must specify either the c option or the d option.\n</font>";
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>\nTry the -h option for more information.</font>" <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> endl;
            <font color='#0000FF'>return</font> <font color='#979000'>0</font>;
        <b>}</b>


        string in_file;
        string out_file;

        <font color='#009900'>// check if the user told us the input file and if they did then 
</font>        <font color='#009900'>// get the file name
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>option_in<font face='Lucida Console'>)</font>
        <b>{</b>
            in_file <font color='#5555FF'>=</font> option_in.<font color='#BB00BB'>argument</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>else</font>
        <b>{</b>
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Error in command line:\n   You must specify an input file.\n</font>";
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>\nTry the -h option for more information.</font>" <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> endl;
            <font color='#0000FF'>return</font> <font color='#979000'>0</font>;
        <b>}</b>


        <font color='#009900'>// check if the user told us the output file and if they did then 
</font>        <font color='#009900'>// get the file name
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>option_out<font face='Lucida Console'>)</font>
        <b>{</b>
            out_file <font color='#5555FF'>=</font> option_out.<font color='#BB00BB'>argument</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>else</font>
        <b>{</b>
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Error in command line:\n   You must specify an output file.\n</font>";
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>\nTry the -h option for more information.</font>" <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> endl;
            <font color='#0000FF'>return</font> <font color='#979000'>0</font>;
        <b>}</b>


        <font color='#009900'>// open the files we will be reading from and writing to
</font>        ifstream <font color='#BB00BB'>fin</font><font face='Lucida Console'>(</font>in_file.<font color='#BB00BB'>c_str</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>,ios::binary<font face='Lucida Console'>)</font>;
        ofstream <font color='#BB00BB'>fout</font><font face='Lucida Console'>(</font>out_file.<font color='#BB00BB'>c_str</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>,ios::binary<font face='Lucida Console'>)</font>;

        <font color='#009900'>// make sure the files opened correctly
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>fin<font face='Lucida Console'>)</font>
        <b>{</b>
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Error opening file </font>" <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> in_file <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>.\n</font>";
            <font color='#0000FF'>return</font> <font color='#979000'>0</font>;
        <b>}</b>

        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>fout<font face='Lucida Console'>)</font>
        <b>{</b>
            cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Error creating file </font>" <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> out_file <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>.\n</font>";
            <font color='#0000FF'>return</font> <font color='#979000'>0</font>;
        <b>}</b>



        <font color='#009900'>// now perform the actual compression or decompression.
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>option_c<font face='Lucida Console'>)</font>
        <b>{</b>
            compressor.<font color='#BB00BB'>compress</font><font face='Lucida Console'>(</font>fin,fout<font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>else</font>
        <b>{</b>
            compressor.<font color='#BB00BB'>decompress</font><font face='Lucida Console'>(</font>fin,fout<font face='Lucida Console'>)</font>;
        <b>}</b>


        

    <b>}</b>
    <font color='#0000FF'>catch</font> <font face='Lucida Console'>(</font>exception<font color='#5555FF'>&amp;</font> e<font face='Lucida Console'>)</font>
    <b>{</b>
        <font color='#009900'>// Note that this will catch any cmd_line_parse_error exceptions and print
</font>        <font color='#009900'>// the default message.   
</font>        cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> e.<font color='#BB00BB'>what</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> endl;
    <b>}</b>
    <font color='#0000FF'>catch</font> <font face='Lucida Console'>(</font>...<font face='Lucida Console'>)</font>
    <b>{</b>
        cout <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> "<font color='#CC0000'>Some error occurred</font>" <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> endl;
    <b>}</b>
<b>}</b>






</pre></body></html>