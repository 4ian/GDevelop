!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TileMapHelper={})}(this,(function(e){"use strict";var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},t(e,i)};function i(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}function r(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var l=function(){function e(e,t,i,r,l){console.log("tile dimension: "+e+" "+t),this.tileWidth=e,this.tileHeight=t,this.dimX=i,this.dimY=r,this._tileSet=l,this._layers=[]}return e.prototype.getWidth=function(){return this.tileWidth*this.dimX},e.prototype.getHeight=function(){return this.tileHeight*this.dimY},e.prototype.getTileHeight=function(){return this.tileWidth},e.prototype.getTileWidth=function(){return this.tileHeight},e.prototype.getDimensionX=function(){return this.dimX},e.prototype.getDimensionY=function(){return this.dimY},e.prototype.getTileDefinition=function(e){return this._tileSet.get(e)},e.prototype.getTileDefinitions=function(){return this._tileSet.values()},e.prototype.addTileLayer=function(e){var t=new p(this,e);return this._layers.push(t),t},e.prototype.addObjectLayer=function(e){var t=new o(this,e);return this._layers.push(t),t},e.prototype.getLayers=function(){return this._layers},e.prototype.pointIsInsideTile=function(e,t,i){var l,n,o=Math.floor(e/this.tileWidth),a=Math.floor(t/this.tileHeight);try{for(var s=r(this._layers),p=s.next();!p.done;p=s.next()){var u=p.value;if(u){var f=u.get(o,a);if(!f)return!1;if(this._tileSet.get(f).getTag()===i)return!0}}}catch(e){l={error:e}}finally{try{p&&!p.done&&(n=s.return)&&n.call(s)}finally{if(l)throw l.error}}return!1},e}(),n=function(){function e(e,t){this.visible=!0,this.tileMap=e,this.id=t}return e.prototype.setVisible=function(e){this.visible=e},e.prototype.isVisible=function(){return this.visible},e}(),o=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.objects=[],r}return i(t,e),t.prototype.add=function(e){this.objects.push(e)},t}(n),a=function(){function e(e,t,i){this.tileId=i,this.x=e,this.y=t}return e.prototype.getTileId=function(){return s.getTileId(this.tileId)},e.prototype.setFlippedHorizontally=function(e){this.tileId=s.setFlippedHorizontally(this.tileId,e)},e.prototype.setFlippedVertically=function(e){this.tileId=s.setFlippedVertically(this.tileId,e)},e.prototype.setFlippedDiagonally=function(e){this.tileId=s.setFlippedDiagonally(this.tileId,e)},e.prototype.isFlippedHorizontally=function(){return s.isFlippedHorizontally(this.tileId)},e.prototype.isFlippedVertically=function(){return s.isFlippedVertically(this.tileId)},e.prototype.isFlippedDiagonally=function(){return s.isFlippedDiagonally(this.tileId)},e}(),s=function(){function e(){}return e.getTileId=function(t){return t&e.tileIdMask},e.setFlippedHorizontally=function(t,i){return t&=~e.flippedHorizontallyFlag,i&&(t|=e.flippedHorizontallyFlag),t},e.setFlippedVertically=function(t,i){return t&=~e.flippedVerticallyFlag,i&&(t|=e.flippedVerticallyFlag),t},e.setFlippedDiagonally=function(t,i){return t&=~e.flippedDiagonallyFlag,i&&(t|=e.flippedDiagonallyFlag),t},e.isFlippedHorizontally=function(t){return 0!=(t&e.flippedHorizontallyFlag)},e.isFlippedVertically=function(t){return 0!=(t&e.flippedVerticallyFlag)},e.isFlippedDiagonally=function(t){return 0!=(t&e.flippedDiagonallyFlag)},e.flippedHorizontallyFlag=2147483648,e.flippedVerticallyFlag=1073741824,e.flippedDiagonallyFlag=536870912,e.tileIdMask=~(e.flippedHorizontallyFlag|e.flippedVerticallyFlag|e.flippedDiagonallyFlag),e}(),p=function(e){function t(t,i){var r=e.call(this,t,i)||this;r._tiles=[],r._tiles.length=r.tileMap.getDimensionY();for(var l=0;l<r._tiles.length;l++)r._tiles[l]=new Int32Array(r.tileMap.getDimensionX());return r}return i(t,e),t.prototype.setTile=function(e,t,i){if(!this.tileMap.getTileDefinition(i))throw new Error("Invalid tile definition index: ".concat(i));this._tiles[t][e]=i+1},t.prototype.removeTile=function(e,t){this._tiles[t][e]=0},t.prototype.setFlippedHorizontally=function(e,t,i){var r=this._tiles[t][e];0!==r&&(this._tiles[t][e]=s.setFlippedHorizontally(r,i))},t.prototype.setFlippedVertically=function(e,t,i){var r=this._tiles[t][e];0!==r&&(this._tiles[t][e]=s.setFlippedVertically(r,i))},t.prototype.setFlippedDiagonally=function(e,t,i){var r=this._tiles[t][e];0!==r&&(this._tiles[t][e]=s.setFlippedDiagonally(r,i))},t.prototype.isFlippedHorizontally=function(e,t){return s.isFlippedHorizontally(this._tiles[t][e])},t.prototype.isFlippedVertically=function(e,t){return s.isFlippedVertically(this._tiles[t][e])},t.prototype.isFlippedDiagonally=function(e,t){return s.isFlippedDiagonally(this._tiles[t][e])},t.prototype.get=function(e,t){var i=this._tiles[t];if(i&&0!==i[e])return s.getTileId(i[e]-1)},t.prototype.getDimensionX=function(){return 0===this._tiles.length?0:this._tiles[0].length},t.prototype.getDimensionY=function(){return this._tiles.length},t.prototype.getWidth=function(){return this.tileMap.getWidth()},t.prototype.getHeight=function(){return this.tileMap.getHeight()},t}(n),u=function(){function e(e,t,i){this.hitBoxes=e,this.tag=t,this.animationLength=i}return e.prototype.getTag=function(){return this.tag},e.prototype.getHiBoxes=function(){return this.hitBoxes},e.prototype.getAnimationLength=function(){return this.animationLength},e}(),f=function(){function e(){this._cachedValues=new Map,this._callbacks=new Map}return e.prototype.getOrLoad=function(e,t,i){var l=this,n=this._cachedValues.get(e);if(n)i(n);else{var o=this._callbacks.get(e);o?o.push(i):(this._callbacks.set(e,[i]),t((function(t){var i,n;t&&l._cachedValues.set(e,t);var o=l._callbacks.get(e);l._callbacks.delete(e);try{for(var a=r(o),s=a.next();!s.done;s=a.next()){(0,s.value)(t)}}catch(e){i={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}})))}},e}(),d=function(e,t){var i=t.data,r=t.compression;if(!i)return i;var l=4,n=[],o=atob(i).split("").map((function(e){return e.charCodeAt(0)}));try{var a=function(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)>>>0};if("zlib"===r)for(var s=new Uint8Array(o),p=e.inflate(s);l<=p.length;)n.push(a(p,l-4)),l+=4;else{if("zstd"===r)return console.error("Zstandard compression is not supported for layers in a Tilemap. Use instead zlib compression or no compression."),null;for(;l<=o.length;)n.push(a(o,l-4)),l+=4}return n}catch(e){return console.error("Failed to decompress and unzip base64 layer.data string",e),null}},c=function(e){var t=2147483648,i=1073741824,r=536870912;return{id:536870911&e,flippedHorizontally:!!(e&t),flippedVertically:!!(e&i),flippedDiagonally:!!(e&r)}},h=function(){function e(){}return e.load=function(e,t){var i,n,o,s,p,f,h,y;if(!t.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;var g=new Map;try{for(var v=r(t.tilesets[0].tiles),F=v.next();!F.done;F=v.next()){var x=F.value,T=[];if(x.objectgroup)try{for(var b=(o=void 0,r(x.objectgroup.objects)),_=b.next();!_.done;_=b.next()){var m=_.value,w=null;w=m.polygon?m.polygon.map((function(e){return[e.x,e.y]})):[[m.x,m.y],[m.x,m.y+m.height],[m.x+m.width,m.y+m.height],[m.x+m.width,m.y]],T.push(w)}}catch(e){o={error:e}}finally{try{_&&!_.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}g.set(x.id,new u(T,x.type?x.type:"",x.animation?x.animation.length:0))}}catch(e){i={error:e}}finally{try{F&&!F.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}for(var M=0;M<t.tilesets[0].tilecount;M++)g.has(M)||g.set(M,new u([],"",0));var D=new l(t.tilewidth,t.tileheight,t.width,t.height,g);try{for(var H=r(t.layers),I=H.next();!I.done;I=H.next()){var V=I.value;if("objectgroup"===V.type){var z=D.addObjectLayer(V.id);z.setVisible(V.visible);try{for(var L=(h=void 0,r(V.objects)),j=L.next();!j.done;j=L.next()){var k=j.value;if(k.visible){var C=c(k.gid);m=new a(k.x,k.y,C.id);z.add(m),m.setFlippedHorizontally(C.flippedHorizontally),m.setFlippedVertically(C.flippedVertically),m.setFlippedDiagonally(C.flippedDiagonally)}}}catch(e){h={error:e}}finally{try{j&&!j.done&&(y=L.return)&&y.call(L)}finally{if(h)throw h.error}}}else if("tilelayer"===V.type){var O=0,X=null;if("base64"===V.encoding?(X=d(e,V))||console.warn("Failed to uncompress layer.data"):X=V.data,X){var A=D.addTileLayer(V.id);A.setVisible(V.visible);for(var P=0;P<V.height;P++)for(var W=0;W<V.width;W++){var S=X[O],Y=c(S);Y.id>0&&(A.setTile(W,P,Y.id-1),A.setFlippedHorizontally(W,P,Y.flippedHorizontally),A.setFlippedVertically(W,P,Y.flippedVertically),A.setFlippedDiagonally(W,P,Y.flippedDiagonally)),O+=1}}}}}catch(e){p={error:e}}finally{try{I&&!I.done&&(f=H.return)&&f.call(H)}finally{if(p)throw p.error}}return D},e}(),y=GlobalPIXIModule.PIXI,g=function(){function e(){this._textures=new Map}return e.prototype.setTexture=function(e,t,i,r,l){var n=this._getGlobalId(e,t,i,r);this._textures.set(n,l)},e.prototype.findTileTexture=function(e,t,i,r){var l=this._getGlobalId(e,t,i,r);if(0!==l){if(this._textures.has(l))return this._textures.get(l);var n=this._textures.get(e);if(n){var o=n.frame.clone(),a=n.orig.clone();if(r){var s=a.width;a.width=a.height,a.height=s}var p=a.clone(),u=0;r?(u=10,!t&&i?u=2:t&&!i?u=6:t&&i&&(u=14)):(u=0,!t&&i?u=8:t&&!i?u=12:t&&i&&(u=4));var f=new y.Texture(n.baseTexture,o,a,p,u);return this._textures.set(l,f),f}}},e.prototype._getGlobalId=function(t,i,r,l){var n=t;return i&&(n|=e.flippedHorizontallyFlag),r&&(n|=e.flippedVerticallyFlag),l&&(n|=e.flippedDiagonallyFlag),n},e.flippedHorizontallyFlag=2147483648,e.flippedVerticallyFlag=1073741824,e.flippedDiagonallyFlag=536870912,e}(),v=GlobalPIXIModule.PIXI,F=function(){function e(){}return e.parseAtlas=function(e,t,i){if(!e.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;if(!e.tilesets.length||"source"in e.tilesets[0])return console.warn("The loaded Tiled map seems not to contain any tileset data (nothing in 'tilesets' key)."),null;var r=e.tilesets[0],l=r.tilewidth,n=r.tileheight,o=r.tilecount;r.tiles;var a=r.image,s=r.columns,p=r.spacing,u=r.margin;t||(t=i(a));var f=o/s,d=l*s+p*(s-1)+2*u,c=n*f+p*(f-1)+2*u;if(1!==t.width&&d!==t.width||1!==t.height&&c!==t.height){var h=d+"x"+c,y=t.width+"x"+t.height;return console.warn("It seems the atlas file was resized, which is not supported. It should be "+h+"px, but it's "+y+" px."),null}for(var F=new g,x=0;x<o;x++){var T=u+Math.floor(x%s)*(l+p),b=u+Math.floor(x/s)*(n+p);try{var _=new v.Rectangle(T,b,l,n),m=new v.Texture(t,_);F.setTexture(x,!1,!1,!1,m)}catch(e){console.error("An error occurred while creating a PIXI.Texture to be used in a TileMap:",e)}}return F},e.updatePixiTileMap=function(e,t,i,l,n){var a,s,u,f;if(e){e.clear();try{for(var d=r(t.getLayers()),c=d.next();!c.done;c=d.next()){var h=c.value;if("index"===l&&n!==h.id||"visible"===l&&!h.isVisible())return;if(h instanceof o){var y=h;try{for(var g=(u=void 0,r(y.objects)),v=g.next();!v.done;v=g.next()){var F=v.value,x=i.findTileTexture(F.getTileId(),F.isFlippedHorizontally(),F.isFlippedVertically(),F.isFlippedDiagonally());x&&e.addFrame(x,F.x,F.y-y.tileMap.getTileHeight())}}catch(e){u={error:e}}finally{try{v&&!v.done&&(f=g.return)&&f.call(g)}finally{if(u)throw u.error}}}else if(h instanceof p)for(var T=h,b=0;b<T.tileMap.getDimensionY();b++)for(var _=0;_<T.tileMap.getDimensionX();_++){var m=T.tileMap.getTileWidth(),w=m*_,M=T.tileMap.getTileHeight()*b,D=T.get(_,b),H=i.findTileTexture(D,T.isFlippedHorizontally(_,b),T.isFlippedVertically(_,b),T.isFlippedDiagonally(_,b));if(H){var I=e.addFrame(H,w,M),V=T.tileMap.getTileDefinition(D);V&&V.getAnimationLength()>0&&I.tileAnimX(m,V.getAnimationLength())}}}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=d.return)&&s.call(d)}finally{if(a)throw a.error}}}},e.updatePixiCollisionMask=function(e,t,i,l,n,o,a,s,u,f){var d,c,h,y;if(e){e.clear();try{for(var g=r(t.getLayers()),v=g.next();!v.done;v=g.next()){var F=v.value;if("index"===i&&l!==F.id)return;var x=t.getTileWidth(),T=t.getTileHeight();if(F instanceof p)for(var b=F,_=0;_<b.tileMap.getDimensionY();_++)for(var m=0;m<b.tileMap.getDimensionX();m++){var w=x*m,M=T*_,D=b.get(m,_),H=b.isFlippedHorizontally(m,_),I=b.isFlippedVertically(m,_),V=b.isFlippedDiagonally(m,_),z=b.tileMap.getTileDefinition(D);if(z&&z.getTag()===n){e.lineStyle(o,a,s);try{for(var L=(h=void 0,r(z.getHiBoxes())),j=L.next();!j.done;j=L.next()){var k=j.value;if(0!==k.length){e.beginFill(u,f);for(var C=0;C<k.length;C++){var O=k[C][0],X=k[C][1];if(H&&(O=x-O),I&&(X=T-X),V){var A=O;O=X,X=A}0===C?e.moveTo(w+O,M+X):e.lineTo(w+O,M+X)}e.closePath(),e.endFill()}}}catch(e){h={error:e}}finally{try{j&&!j.done&&(y=L.return)&&y.call(L)}finally{if(h)throw h.error}}}}}}catch(e){d={error:e}}finally{try{v&&!v.done&&(c=g.return)&&c.call(g)}finally{if(d)throw d.error}}}},e}(),x=function(){function e(){this._tileMapCache=new f,this._textureCacheCaches=new f}return e.getManager=function(t){return t.tileMapCollisionMaskManager||(t.tileMapCollisionMaskManager=new e),t.tileMapCollisionMaskManager},e.prototype.getOrLoadTileMap=function(e,t,i,r,l){var n=t+"|"+i;this._tileMapCache.getOrLoad(n,(function(l){e(t,i,(function(e){if(e){var t=h.load(r,e);l(t)}else l(null)}))}),l)},e.prototype.getOrLoadTextureCache=function(e,t,i,r,l,n){var o=r+"|"+l+"|"+i;this._textureCacheCaches.getOrLoad(o,(function(n){e(r,l,(function(e){if(e){var r=i?t(i):null,l=F.parseAtlas(e,r,t);n(l)}else n(null)}))}),n)},e}();e.EditableTileMap=l,e.EditableTileMapLayer=p,e.PixiTileMapHelper=F,e.TileDefinition=u,e.TileMapManager=x,e.TileTextureCache=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=TileMapHelper.js.map
