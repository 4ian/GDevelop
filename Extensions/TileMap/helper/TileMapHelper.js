!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TileMapHelper=t():e.TileMapHelper=t()}("undefined"!=typeof self?self:this,(function(){return(()=>{"use strict";var e={359:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},271:function(e,t,i){var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.PixiTileMapHelper=void 0;var n=i(470),l=i(595),o=GlobalPIXIModule.PIXI,a=function(){function e(){}return e.parseAtlas=function(e,t,i){if(!e.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;if(!e.tilesets.length||"source"in e.tilesets[0])return console.warn("The loaded Tiled map seems not to contain any tileset data (nothing in 'tilesets' key)."),null;var r=e.tilesets[0],n=r.tilewidth,a=r.tileheight,p=r.tilecount,s=(r.tiles,r.image),u=r.columns,d=r.spacing,c=r.margin;t||(t=i(s));var f=p/u,y=n*u+d*(u-1)+2*c,h=a*f+d*(f-1)+2*c;if(1!==t.width&&y!==t.width||1!==t.height&&h!==t.height){var g=y+"x"+h,v=t.width+"x"+t.height;return console.warn("It seems the atlas file was resized, which is not supported. It should be "+g+"px, but it's "+v+" px."),null}for(var b=new l.TileTextureCache,T=0;T<p;T++){var x=c+Math.floor(T%u)*(n+d),_=c+Math.floor(T/u)*(a+d);try{var M=new o.Rectangle(x,_,n,a),m=new o.Texture(t,M);b.setTexture(T,!1,!1,!1,m)}catch(e){console.error("An error occurred while creating a PIXI.Texture to be used in a TileMap:",e)}}return b},e.updatePixiTileMap=function(e,t,i,l,o){var a,p,s,u;if(e){e.clear();try{for(var d=r(t.getLayers()),c=d.next();!c.done;c=d.next()){var f=c.value;if("index"===l&&o!==f.id||"visible"===l&&!f.isVisible())return;if(f instanceof n.EditableObjectLayer){var y=f;try{for(var h=(s=void 0,r(y.objects)),g=h.next();!g.done;g=h.next()){var v=g.value,b=i.findTileTexture(v.getTileId(),v.isFlippedHorizontally(),v.isFlippedVertically(),v.isFlippedDiagonally());b&&e.addFrame(b,v.x,v.y-y.tileMap.getTileHeight())}}catch(e){s={error:e}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}}else if(f instanceof n.EditableTileMapLayer)for(var T=f,x=0;x<T.tileMap.getDimensionY();x++)for(var _=0;_<T.tileMap.getDimensionX();_++){var M=T.tileMap.getTileWidth(),m=M*_,F=T.tileMap.getTileHeight()*x,w=T.get(_,x),D=i.findTileTexture(w,T.isFlippedHorizontally(_,x),T.isFlippedVertically(_,x),T.isFlippedDiagonally(_,x));if(D){var H=e.addFrame(D,m,F),j=T.tileMap.getTileDefinition(w);j&&j.getAnimationLength()>0&&H.tileAnimX(M,j.getAnimationLength())}}}}catch(e){a={error:e}}finally{try{c&&!c.done&&(p=d.return)&&p.call(d)}finally{if(a)throw a.error}}}},e.updatePixiCollisionMask=function(e,t,i,l,o,a,p,s,u,d){var c,f,y,h;if(e){e.clear();try{for(var g=r(t.getLayers()),v=g.next();!v.done;v=g.next()){var b=v.value;if("index"===i&&l!==b.id)return;var T=t.getTileWidth(),x=t.getTileHeight();if(b instanceof n.EditableTileMapLayer)for(var _=b,M=0;M<_.tileMap.getDimensionY();M++)for(var m=0;m<_.tileMap.getDimensionX();m++){var F=T*m,w=x*M,D=_.get(m,M),H=_.isFlippedHorizontally(m,M),j=_.isFlippedVertically(m,M),O=_.isFlippedDiagonally(m,M),I=_.tileMap.getTileDefinition(D);if(I&&I.getTag()===o){e.lineStyle(a,p,s);try{for(var L=(y=void 0,r(I.getHiBoxes())),P=L.next();!P.done;P=L.next()){var V=P.value;if(0!==V.length){e.beginFill(u,d);for(var z=0;z<V.length;z++){var C=V[z][0],S=V[z][1];if(H&&(C=T-C),j&&(S=x-S),O){var E=C;C=S,S=E}0===z?e.moveTo(F+C,w+S):e.lineTo(F+C,w+S)}e.closePath(),e.endFill()}}}catch(e){y={error:e}}finally{try{P&&!P.done&&(h=L.return)&&h.call(L)}finally{if(y)throw y.error}}}}}}catch(e){c={error:e}}finally{try{v&&!v.done&&(f=g.return)&&f.call(g)}finally{if(c)throw c.error}}}},e}();t.PixiTileMapHelper=a},44:function(e,t){var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceCache=void 0;var r=function(){function e(){this._cachedValues=new Map,this._callbacks=new Map}return e.prototype.getOrLoad=function(e,t,r){var n=this,l=this._cachedValues.get(e);if(l)r(l);else{var o=this._callbacks.get(e);o?o.push(r):(this._callbacks.set(e,[r]),t((function(t){var r,l;t&&n._cachedValues.set(e,t);var o=n._callbacks.get(e);n._callbacks.delete(e);try{for(var a=i(o),p=a.next();!p.done;p=a.next())(0,p.value)(t)}catch(e){r={error:e}}finally{try{p&&!p.done&&(l=a.return)&&l.call(a)}finally{if(r)throw r.error}}})))}},e}();t.ResourceCache=r},315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TileMapManager=void 0;var r=i(303),n=i(44),l=i(780),o=function(){function e(){this._tileMapCache=new n.ResourceCache,this._textureCacheCaches=new n.ResourceCache}return e.getManager=function(t){return t.tileMapCollisionMaskManager||(t.tileMapCollisionMaskManager=new e),t.tileMapCollisionMaskManager},e.prototype.getOrLoadTileMap=function(e,t,i,r,n){var o=t+"|"+i;this._tileMapCache.getOrLoad(o,(function(n){e(t,i,(function(e){if(e){var t=l.TiledTileMapLoader.load(r,e);n(t)}else n(null)}))}),n)},e.prototype.getOrLoadTextureCache=function(e,t,i,n,l,o){var a=n+"|"+l+"|"+i;this._textureCacheCaches.getOrLoad(a,(function(o){e(n,l,(function(e){if(e){var n=i?t(i):null,l=r.PixiTileMapHelper.parseAtlas(e,n,t);o(l)}else o(null)}))}),o)},e}();t.TileMapManager=o},470:function(e,t){var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.TileDefinition=t.EditableTileMapLayer=t.TileObject=t.EditableObjectLayer=t.EditableTileMap=void 0;var l=function(){function e(e,t,i,r,n){console.log("tile dimension: "+e+" "+t),this.tileWidth=e,this.tileHeight=t,this.dimX=i,this.dimY=r,this._tileSet=n,this._layers=[]}return e.prototype.getWidth=function(){return this.tileWidth*this.dimX},e.prototype.getHeight=function(){return this.tileHeight*this.dimY},e.prototype.getTileHeight=function(){return this.tileWidth},e.prototype.getTileWidth=function(){return this.tileHeight},e.prototype.getDimensionX=function(){return this.dimX},e.prototype.getDimensionY=function(){return this.dimY},e.prototype.getTileDefinition=function(e){return this._tileSet.get(e)},e.prototype.getTileDefinitions=function(){return this._tileSet.values()},e.prototype.addTileLayer=function(e){var t=new u(this,e);return this._layers.push(t),t},e.prototype.addObjectLayer=function(e){var t=new a(this,e);return this._layers.push(t),t},e.prototype.getLayers=function(){return this._layers},e.prototype.pointIsInsideTile=function(e,t,i){var r,l,o=Math.floor(e/this.tileWidth),a=Math.floor(t/this.tileHeight);try{for(var p=n(this._layers),s=p.next();!s.done;s=p.next()){var u=s.value;if(u){var d=u.get(o,a);if(!d)return!1;if(this._tileSet.get(d).getTag()===i)return!0}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(l=p.return)&&l.call(p)}finally{if(r)throw r.error}}return!1},e}();t.EditableTileMap=l;var o=function(){function e(e,t){this.visible=!0,this.tileMap=e,this.id=t}return e.prototype.setVisible=function(e){this.visible=e},e.prototype.isVisible=function(){return this.visible},e}(),a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.objects=[],r}return r(t,e),t.prototype.add=function(e){this.objects.push(e)},t}(o);t.EditableObjectLayer=a;var p=function(){function e(e,t,i){this.tileId=i,this.x=e,this.y=t}return e.prototype.getTileId=function(){return s.getTileId(this.tileId)},e.prototype.setFlippedHorizontally=function(e){this.tileId=s.setFlippedHorizontally(this.tileId,e)},e.prototype.setFlippedVertically=function(e){this.tileId=s.setFlippedVertically(this.tileId,e)},e.prototype.setFlippedDiagonally=function(e){this.tileId=s.setFlippedDiagonally(this.tileId,e)},e.prototype.isFlippedHorizontally=function(){return s.isFlippedHorizontally(this.tileId)},e.prototype.isFlippedVertically=function(){return s.isFlippedVertically(this.tileId)},e.prototype.isFlippedDiagonally=function(){return s.isFlippedDiagonally(this.tileId)},e}();t.TileObject=p;var s=function(){function e(){}return e.getTileId=function(t){return t&e.tileIdMask},e.setFlippedHorizontally=function(t,i){return t&=~e.flippedHorizontallyFlag,i&&(t|=e.flippedHorizontallyFlag),t},e.setFlippedVertically=function(t,i){return t&=~e.flippedVerticallyFlag,i&&(t|=e.flippedVerticallyFlag),t},e.setFlippedDiagonally=function(t,i){return t&=~e.flippedDiagonallyFlag,i&&(t|=e.flippedDiagonallyFlag),t},e.isFlippedHorizontally=function(t){return 0!=(t&e.flippedHorizontallyFlag)},e.isFlippedVertically=function(t){return 0!=(t&e.flippedVerticallyFlag)},e.isFlippedDiagonally=function(t){return 0!=(t&e.flippedDiagonallyFlag)},e.flippedHorizontallyFlag=2147483648,e.flippedVerticallyFlag=1073741824,e.flippedDiagonallyFlag=536870912,e.tileIdMask=~(e.flippedHorizontallyFlag|e.flippedVerticallyFlag|e.flippedDiagonallyFlag),e}(),u=function(e){function t(t,i){var r=e.call(this,t,i)||this;r._tiles=[],r._tiles.length=r.tileMap.getDimensionY();for(var n=0;n<r._tiles.length;n++)r._tiles[n]=new Int32Array(r.tileMap.getDimensionX());return r}return r(t,e),t.prototype.setTile=function(e,t,i){if(!this.tileMap.getTileDefinition(i))throw new Error("Invalid tile definition index: "+i);this._tiles[t][e]=i+1},t.prototype.removeTile=function(e,t){this._tiles[t][e]=0},t.prototype.setFlippedHorizontally=function(e,t,i){var r=this._tiles[t][e];0!==r&&(this._tiles[t][e]=s.setFlippedHorizontally(r,i))},t.prototype.setFlippedVertically=function(e,t,i){var r=this._tiles[t][e];0!==r&&(this._tiles[t][e]=s.setFlippedVertically(r,i))},t.prototype.setFlippedDiagonally=function(e,t,i){var r=this._tiles[t][e];0!==r&&(this._tiles[t][e]=s.setFlippedDiagonally(r,i))},t.prototype.isFlippedHorizontally=function(e,t){return s.isFlippedHorizontally(this._tiles[t][e])},t.prototype.isFlippedVertically=function(e,t){return s.isFlippedVertically(this._tiles[t][e])},t.prototype.isFlippedDiagonally=function(e,t){return s.isFlippedDiagonally(this._tiles[t][e])},t.prototype.get=function(e,t){var i=this._tiles[t];if(i&&0!==i[e])return s.getTileId(i[e]-1)},t.prototype.getDimensionX=function(){return 0===this._tiles.length?0:this._tiles[0].length},t.prototype.getDimensionY=function(){return this._tiles.length},t.prototype.getWidth=function(){return this.tileMap.getWidth()},t.prototype.getHeight=function(){return this.tileMap.getHeight()},t}(o);t.EditableTileMapLayer=u;var d=function(){function e(e,t,i){this.hitBoxes=e,this.tag=t,this.animationLength=i}return e.prototype.getTag=function(){return this.tag},e.prototype.getHiBoxes=function(){return this.hitBoxes},e.prototype.getAnimationLength=function(){return this.animationLength},e}();t.TileDefinition=d},595:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TileTextureCache=void 0;var i=GlobalPIXIModule.PIXI,r=function(){function e(){this._textures=new Map}return e.prototype.setTexture=function(e,t,i,r,n){var l=this._getGlobalId(e,t,i,r);this._textures.set(l,n)},e.prototype.findTileTexture=function(e,t,r,n){var l=this._getGlobalId(e,t,r,n);if(0!==l){if(this._textures.has(l))return this._textures.get(l);var o=this._textures.get(e);if(o){var a=o.frame.clone(),p=o.orig.clone();if(n){var s=p.width;p.width=p.height,p.height=s}var u=p.clone(),d=0;n?(d=10,!t&&r?d=2:t&&!r?d=6:t&&r&&(d=14)):(d=0,!t&&r?d=8:t&&!r?d=12:t&&r&&(d=4));var c=new i.Texture(o.baseTexture,a,p,u,d);return this._textures.set(l,c),c}}},e.prototype._getGlobalId=function(t,i,r,n){var l=t;return i&&(l|=e.flippedHorizontallyFlag),r&&(l|=e.flippedVerticallyFlag),n&&(l|=e.flippedDiagonallyFlag),l},e.flippedHorizontallyFlag=2147483648,e.flippedVerticallyFlag=1073741824,e.flippedDiagonallyFlag=536870912,e}();t.TileTextureCache=r},303:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.TileDefinition=t.EditableTileMapLayer=t.EditableTileMap=t.TileTextureCache=t.PixiTileMapHelper=t.TileMapManager=void 0;var l=i(315);Object.defineProperty(t,"TileMapManager",{enumerable:!0,get:function(){return l.TileMapManager}});var o=i(271);Object.defineProperty(t,"PixiTileMapHelper",{enumerable:!0,get:function(){return o.PixiTileMapHelper}});var a=i(470);Object.defineProperty(t,"EditableTileMap",{enumerable:!0,get:function(){return a.EditableTileMap}}),Object.defineProperty(t,"EditableTileMapLayer",{enumerable:!0,get:function(){return a.EditableTileMapLayer}}),Object.defineProperty(t,"TileDefinition",{enumerable:!0,get:function(){return a.TileDefinition}});var p=i(595);Object.defineProperty(t,"TileTextureCache",{enumerable:!0,get:function(){return p.TileTextureCache}}),n(i(359),t)},57:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractTileUidFlippedStates=t.decodeBase64LayerData=void 0,t.decodeBase64LayerData=function(e,t){var i=t.data,r=t.compression;if(!i)return i;var n=4,l=[],o=atob(i).split("").map((function(e){return e.charCodeAt(0)}));try{var a=function(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)>>>0};if("zlib"===r)for(var p=new Uint8Array(o),s=e.inflate(p);n<=s.length;)l.push(a(s,n-4)),n+=4;else{if("zstd"===r)return console.error("Zstandard compression is not supported for layers in a Tilemap. Use instead zlib compression or no compression."),null;for(;n<=o.length;)l.push(a(o,n-4)),n+=4}return l}catch(e){return console.error("Failed to decompress and unzip base64 layer.data string",e),null}},t.extractTileUidFlippedStates=function(e){return{id:536870911&e,flippedHorizontally:!!(2147483648&e),flippedVertically:!!(1073741824&e),flippedDiagonally:!!(536870912&e)}}},780:function(e,t,i){var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.TiledTileMapLoader=void 0;var n=i(470),l=i(57),o=function(){function e(){}return e.load=function(e,t){var i,o,a,p,s,u,d,c;if(!t.tiledversion)return console.warn("The loaded Tiled map does not contain a 'tiledversion' key. Are you sure this file has been exported from Tiled (mapeditor.org)?"),null;var f=new Map;try{for(var y=r(t.tilesets[0].tiles),h=y.next();!h.done;h=y.next()){var g=h.value,v=[];if(g.objectgroup)try{for(var b=(a=void 0,r(g.objectgroup.objects)),T=b.next();!T.done;T=b.next()){var x,_=T.value;x=_.polygon?_.polygon.map((function(e){return[e.x,e.y]})):[[_.x,_.y],[_.x,_.y+_.height],[_.x+_.width,_.y+_.height],[_.x+_.width,_.y]],v.push(x)}}catch(e){a={error:e}}finally{try{T&&!T.done&&(p=b.return)&&p.call(b)}finally{if(a)throw a.error}}f.set(g.id,new n.TileDefinition(v,g.type?g.type:"",g.animation?g.animation.length:0))}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}for(var M=0;M<t.tilesets[0].tilecount;M++)f.has(M)||f.set(M,new n.TileDefinition([],"",0));var m=new n.EditableTileMap(t.tilewidth,t.tileheight,t.width,t.height,f);try{for(var F=r(t.layers),w=F.next();!w.done;w=F.next()){var D=w.value;if("objectgroup"===D.type){var H=m.addObjectLayer(D.id);H.setVisible(D.visible);try{for(var j=(d=void 0,r(D.objects)),O=j.next();!O.done;O=j.next()){var I=O.value;if(I.visible){var L=l.extractTileUidFlippedStates(I.gid);_=new n.TileObject(I.x,I.y,L.id),H.add(_),_.setFlippedHorizontally(L.flippedHorizontally),_.setFlippedVertically(L.flippedVertically),_.setFlippedDiagonally(L.flippedDiagonally)}}}catch(e){d={error:e}}finally{try{O&&!O.done&&(c=j.return)&&c.call(j)}finally{if(d)throw d.error}}}else if("tilelayer"===D.type){var P=0,V=null;if("base64"===D.encoding?(V=l.decodeBase64LayerData(e,D))||console.warn("Failed to uncompress layer.data"):V=D.data,V){var z=m.addTileLayer(D.id);z.setVisible(D.visible);for(var C=0;C<D.height;C++)for(var S=0;S<D.width;S++){var E=V[P],k=l.extractTileUidFlippedStates(E);k.id>0&&(z.setTile(S,C,k.id-1),z.setFlippedHorizontally(S,C,k.flippedHorizontally),z.setFlippedVertically(S,C,k.flippedVertically),z.setFlippedDiagonally(S,C,k.flippedDiagonally)),P+=1}}}}}catch(e){s={error:e}}finally{try{w&&!w.done&&(u=F.return)&&u.call(F)}finally{if(s)throw s.error}}return m},e}();t.TiledTileMapLoader=o}},t={};return function i(r){var n=t[r];if(void 0!==n)return n.exports;var l=t[r]={exports:{}};return e[r].call(l.exports,l,l.exports,i),l.exports}(303)})()}));
//# sourceMappingURL=TileMapHelper.js.map