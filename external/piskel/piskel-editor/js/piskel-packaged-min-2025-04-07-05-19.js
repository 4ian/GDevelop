((y,_)=>{function N(e,t){return(t+"").toUpperCase()}function M(){v.addEventListener?(v.removeEventListener("DOMContentLoaded",M,!1),b.ready()):"complete"===v.readyState&&(v.detachEvent("onreadystatechange",M),b.ready())}var U,z,v=y.document,B=y.location,H=y.navigator,W=y.jQuery,$=y.$,G=Array.prototype.push,p=Array.prototype.slice,j=Array.prototype.indexOf,q=Object.prototype.toString,K=Object.prototype.hasOwnProperty,V=String.prototype.trim,b=function(e,t){return new b.fn.init(e,t,U)},Z=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,Y=/\S/,E=/\s+/,X=Y.test("Â ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,Q=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,J=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ee=/^[\],:{}\s]*$/,te=/(?:^|:|,)(?:\s*\[)+/g,re=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ie=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ne=/^-ms-/,oe=/-([\da-z])/gi,se={},ae=(b.fn=b.prototype={constructor:b,init:function(e,t,r){var i,n;if(e)if(e.nodeType)this.context=this[0]=e,this.length=1;else{if("string"!=typeof e)return b.isFunction(e)?r.ready(e):(e.selector!==_&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this));if(!(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:Q.exec(e))||!i[1]&&t)return(!t||t.jquery?t||r:this.constructor(t)).find(e);if(i[1])return n=(t=t instanceof b?t[0]:t)&&t.nodeType?t.ownerDocument||t:v,e=b.parseHTML(i[1],n,!0),J.test(i[1])&&b.isPlainObject(t)&&this.attr.call(e,t,!0),b.merge(this,e);if((n=v.getElementById(i[2]))&&n.parentNode){if(n.id!==i[2])return r.find(e);this.length=1,this[0]=n}this.context=v,this.selector=e}return this},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return p.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,r){e=b.merge(this.constructor(),e);return e.prevObject=this,e.context=this.context,"find"===t?e.selector=this.selector+(this.selector?" ":"")+r:t&&(e.selector=this.selector+"."+t+"("+r+")"),e},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},eq:function(e){return-1===(e=+e)?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(p.apply(this,arguments),"slice",p.call(arguments).join(","))},map:function(r){return this.pushStack(b.map(this,function(e,t){return r.call(e,t,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:G,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,t,r,i,n,o=arguments[0]||{},s=1,a=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[1]||{},s=2),"object"==typeof o||b.isFunction(o)||(o={}),a===s&&(o=this,--s);s<a;s++)if(null!=(e=arguments[s]))for(t in e)n=o[t],o!==(r=e[t])&&(l&&r&&(b.isPlainObject(r)||(i=b.isArray(r)))?(n=i?(i=!1,n&&b.isArray(n)?n:[]):n&&b.isPlainObject(n)?n:{},o[t]=b.extend(l,n,r)):r!==_&&(o[t]=r));return o},b.extend({noConflict:function(e){return y.$===b&&(y.$=$),e&&y.jQuery===b&&(y.jQuery=W),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(!0===e?!--b.readyWait:!b.isReady){if(!v.body)return setTimeout(b.ready,1);(b.isReady=!0)!==e&&0<--b.readyWait||(z.resolveWith(v,[b]),b.fn.trigger&&b(v).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):se[q.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!K.call(e,"constructor")&&!K.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var t in e);return t===_||K.call(e,t)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,r){var i;return e&&"string"==typeof e?("boolean"==typeof t&&(r=t,t=0),t=t||v,(i=J.exec(e))?[t.createElement(i[1])]:(i=b.buildFragment([e],t,r?null:[]),b.merge([],(i.cacheable?b.clone(i.fragment):i.fragment).childNodes))):null},parseJSON:function(e){return e&&"string"==typeof e?(e=b.trim(e),y.JSON&&y.JSON.parse?y.JSON.parse(e):ee.test(e.replace(re,"@").replace(ie,"]").replace(te,""))?new Function("return "+e)():void b.error("Invalid JSON: "+e)):null},parseXML:function(e){var t;if(!e||"string"!=typeof e)return null;try{y.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e))}catch(e){t=_}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){e&&Y.test(e)&&(y.execScript||function(e){y.eval.call(y,e)})(e)},camelCase:function(e){return e.replace(ne,"ms-").replace(oe,N)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,t,r){var i,n=0,o=e.length,s=o===_||b.isFunction(e);if(r)if(s){for(i in e)if(!1===t.apply(e[i],r))break}else for(;n<o&&!1!==t.apply(e[n++],r););else if(s){for(i in e)if(!1===t.call(e[i],i,e[i]))break}else for(;n<o&&!1!==t.call(e[n],n,e[n++]););return e},trim:V?function(e){return null==e?"":V.call(e)}:function(e){return null==e?"":e.toString().replace(X,"")},makeArray:function(e,t){var r,t=t||[];return null!=e&&(r=b.type(e),null==e.length||"string"===r||"function"===r||"regexp"===r||b.isWindow(e)?G.call(t,e):b.merge(t,e)),t},inArray:function(e,t,r){var i;if(t){if(j)return j.call(t,e,r);for(i=t.length,r=r?r<0?Math.max(0,i+r):r:0;r<i;r++)if(r in t&&t[r]===e)return r}return-1},merge:function(e,t){var r=t.length,i=e.length,n=0;if("number"==typeof r)for(;n<r;n++)e[i++]=t[n];else for(;t[n]!==_;)e[i++]=t[n++];return e.length=i,e},grep:function(e,t,r){var i=[],n=0,o=e.length;for(r=!!r;n<o;n++)r!==!!t(e[n],n)&&i.push(e[n]);return i},map:function(e,t,r){var i,n,o=[],s=0,a=e.length;if(e instanceof b||a!==_&&"number"==typeof a&&(0<a&&e[0]&&e[a-1]||0===a||b.isArray(e)))for(;s<a;s++)null!=(i=t(e[s],s,r))&&(o[o.length]=i);else for(n in e)null!=(i=t(e[n],n,r))&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,t){var r,i;return"string"==typeof t&&(i=e[t],t=e,e=i),b.isFunction(e)?(r=p.call(arguments,2),(i=function(){return e.apply(t,r.concat(p.call(arguments)))}).guid=e.guid=e.guid||i.guid||b.guid++,i):_},access:function(e,t,r,i,n,o,s){var a,l=null==r,c=0,p=e.length;if(r&&"object"==typeof r){for(c in r)b.access(e,t,c,r[c],1,o,i);n=1}else if(i!==_){if(a=s===_&&b.isFunction(i),t=l?a?(a=t,function(e,t,r){return a.call(b(e),r)}):(t.call(e,i),null):t)for(;c<p;c++)t(e[c],r,a?i.call(e[c],c,t(e[c],r)):i,s);n=1}return n?e:l?t.call(e):p?t(e[0],r):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(e){if(!z)if(z=b.Deferred(),"complete"===v.readyState||"loading"!==v.readyState&&v.addEventListener)setTimeout(b.ready,1);else if(v.addEventListener)v.addEventListener("DOMContentLoaded",M,!1),y.addEventListener("load",b.ready,!1);else{v.attachEvent("onreadystatechange",M),y.attachEvent("onload",b.ready);var r=!1;try{r=null==y.frameElement&&v.documentElement}catch(e){}r&&r.doScroll&&!function t(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(t,50)}b.ready()}}()}return z.promise(e)},b.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){se["[object "+t+"]"]=t.toLowerCase()}),U=b(v),{}),le=(b.Callbacks=function(i){var e,r;i="string"==typeof i?ae[i]||(r=ae[e=i]={},b.each(e.split(E),function(e,t){r[t]=!0}),r):b.extend({},i);function n(e){for(t=i.memory&&e,o=!0,c=a||0,a=0,l=p.length,s=!0;p&&c<l;c++)if(!1===p[c].apply(e[0],e[1])&&i.stopOnFalse){t=!1;break}s=!1,p&&(h?h.length&&n(h.shift()):t?p=[]:u.disable())}var t,o,s,a,l,c,p=[],h=!i.once&&[],u={add:function(){var e;return p&&(e=p.length,function r(e){b.each(e,function(e,t){!b.isFunction(t)||i.unique&&u.has(t)?t&&t.length&&r(t):p.push(t)})}(arguments),s?l=p.length:t&&(a=e,n(t))),this},remove:function(){return p&&b.each(arguments,function(e,t){for(var r;-1<(r=b.inArray(t,p,r));)p.splice(r,1),s&&(r<=l&&l--,r<=c)&&c--}),this},has:function(e){return-1<b.inArray(e,p)},empty:function(){return p=[],this},disable:function(){return p=h=t=_,this},disabled:function(){return!p},lock:function(){return h=_,t||u.disable(),this},locked:function(){return!h},fireWith:function(e,t){return t=[e,(t=t||[]).slice?t.slice():t],!p||o&&!h||(s?h.push(t):n(t)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!o}};return u},b.extend({Deferred:function(e){var s=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",o={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var o=arguments;return b.Deferred(function(n){b.each(s,function(e,t){var r=t[0],i=o[e];a[t[1]](b.isFunction(i)?function(){var e=i.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r+"With"](this===a?n:this,[e])}:n[r])}),o=null}).promise()},promise:function(e){return"object"==typeof e?b.extend(e,o):o}},a={};return o.pipe=o.then,b.each(s,function(e,t){var r=t[2],i=t[3];o[t[1]]=r.add,i&&r.add(function(){n=i},s[1^e][2].disable,s[2][2].lock),a[t[0]]=r.fire,a[t[0]+"With"]=r.fireWith}),o.promise(a),e&&e.call(a,a),a},when:function(e){function t(t,r,i){return function(e){r[t]=this,i[t]=1<arguments.length?p.call(arguments):e,i===n?c.notifyWith(r,i):--l||c.resolveWith(r,i)}}var n,r,i,o=0,s=p.call(arguments),a=s.length,l=1!==a||e&&b.isFunction(e.promise)?a:0,c=1===l?e:b.Deferred();if(1<a)for(n=new Array(a),r=new Array(a),i=new Array(a);o<a;o++)s[o]&&b.isFunction(s[o].promise)?s[o].promise().done(t(o,i,s)).fail(c.reject).progress(t(o,r,n)):--l;return l||c.resolveWith(i,s),c.promise()}}),b.support=(()=>{var o,e,t,r,i,n,s,a,l=v.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=l.getElementsByTagName("*"),(e=l.getElementsByTagName("a")[0]).style.cssText="top:1px;float:left;opacity:.5",!t||!t.length||!e)return{};a=(t=v.createElement("select")).appendChild(v.createElement("option")),r=l.getElementsByTagName("input")[0],o={leadingWhitespace:3===l.firstChild.nodeType,tbody:!l.getElementsByTagName("tbody").length,htmlSerialize:!!l.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:"/a"===e.getAttribute("href"),opacity:/^0.5/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:"on"===r.value,optSelected:a.selected,getSetAttribute:"t"!==l.className,enctype:!!v.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==v.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===v.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,o.noCloneChecked=r.cloneNode(!0).checked,t.disabled=!0,o.optDisabled=!a.disabled;try{delete l.test}catch(e){o.deleteExpando=!1}if(!l.addEventListener&&l.attachEvent&&l.fireEvent&&(l.attachEvent("onclick",a=function(){o.noCloneEvent=!1}),l.cloneNode(!0).fireEvent("onclick"),l.detachEvent("onclick",a)),(r=v.createElement("input")).value="t",r.setAttribute("type","radio"),o.radioValue="t"===r.value,r.setAttribute("checked","checked"),r.setAttribute("name","t"),l.appendChild(r),(a=v.createDocumentFragment()).appendChild(l.lastChild),o.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,o.appendChecked=r.checked,a.removeChild(r),a.appendChild(l),l.attachEvent)for(n in{submit:!0,change:!0,focusin:!0})(s=(i="on"+n)in l)||(l.setAttribute(i,"return;"),s="function"==typeof l[i]),o[n+"Bubbles"]=s;return b(function(){var e,t,r,i="padding:0;margin:0;border:0;display:block;overflow:hidden;",n=v.getElementsByTagName("body")[0];n&&((e=v.createElement("div")).style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",n.insertBefore(e,n.firstChild),t=v.createElement("div"),e.appendChild(t),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(r=t.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",s=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",o.reliableHiddenOffsets=s&&0===r[0].offsetHeight,t.innerHTML="",t.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",o.boxSizing=4===t.offsetWidth,o.doesNotIncludeMarginInBodyOffset=1!==n.offsetTop,y.getComputedStyle&&(o.pixelPosition="1%"!==(y.getComputedStyle(t,null)||{}).top,o.boxSizingReliable="4px"===(y.getComputedStyle(t,null)||{width:"4px"}).width,(r=v.createElement("div")).style.cssText=t.style.cssText=i,r.style.marginRight=r.style.width="0",t.style.width="1px",t.appendChild(r),o.reliableMarginRight=!parseFloat((y.getComputedStyle(r,null)||{}).marginRight)),void 0!==t.style.zoom&&(t.innerHTML="",t.style.cssText=i+"width:1px;padding:1px;display:inline;zoom:1",o.inlineBlockNeedsLayout=3===t.offsetWidth,t.style.display="block",t.style.overflow="visible",t.innerHTML="<div></div>",t.firstChild.style.width="5px",o.shrinkWrapBlocks=3!==t.offsetWidth,e.style.zoom=1),n.removeChild(e))}),a.removeChild(l),e=t=r=a=l=null,o})(),/^(?:\{.*\}|\[.*\])$/),ce=/([A-Z])/g;function pe(e,t,r){if(r===_&&1===e.nodeType){var i="data-"+t.replace(ce,"-$1").toLowerCase();if("string"==typeof(r=e.getAttribute(i))){try{r="true"===r||"false"!==r&&("null"===r?null:+r+""===r?+r:le.test(r)?b.parseJSON(r):r)}catch(e){}b.data(e,t,r)}else r=_}return r}function he(e){for(var t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return;return 1}function ue(e){return b.event.special.hover?e:e.replace(Ee,"mouseenter$1 mouseleave$1")}b.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(b.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?b.cache[e[b.expando]]:e[b.expando])&&!he(e)},data:function(e,t,r,i){if(b.acceptData(e)){var n,o=b.expando,s="string"==typeof t,a=e.nodeType,l=a?b.cache:e,c=a?e[o]:e[o]&&o;if(c&&l[c]&&(i||l[c].data)||!s||r!==_)return c||(a?e[o]=c=b.deletedIds.pop()||++b.uuid:c=o),l[c]||(l[c]={},a)||(l[c].toJSON=b.noop),"object"!=typeof t&&"function"!=typeof t||(i?l[c]=b.extend(l[c],t):l[c].data=b.extend(l[c].data,t)),e=l[c],i||(e.data||(e.data={}),e=e.data),r!==_&&(e[b.camelCase(t)]=r),s?null==(n=e[t])&&(n=e[b.camelCase(t)]):n=e,n}},removeData:function(e,t,r){if(b.acceptData(e)){var i,n,o,s=e.nodeType,a=s?b.cache:e,l=s?e[b.expando]:b.expando;if(a[l]){if(t&&(i=r?a[l]:a[l].data)){for((n=0,o=(t=b.isArray(t)?t:t in i||(t=b.camelCase(t))in i?[t]:t.split(" ")).length);n<o;n++)delete i[t[n]];if(!(r?he:b.isEmptyObject)(i))return}(r||(delete a[l].data,he(a[l])))&&(s?b.cleanData([e],!0):b.support.deleteExpando||a!=a.window?delete a[l]:a[l]=null)}}},_data:function(e,t,r){return b.data(e,t,r,!0)},acceptData:function(e){var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(r,e){var i,n,t,o,s,a=this[0],l=0,c=null;if(r!==_)return"object"==typeof r?this.each(function(){b.data(this,r)}):((i=r.split(".",2))[1]=i[1]?"."+i[1]:"",n=i[1]+"!",b.access(this,function(t){if(t===_)return(c=this.triggerHandler("getData"+n,[i[0]]))===_&&a&&(c=b.data(a,r),c=pe(a,r,c)),c===_&&i[1]?this.data(i[0]):c;i[1]=t,this.each(function(){var e=b(this);e.triggerHandler("setData"+n,i),b.data(this,r,t),e.triggerHandler("changeData"+n,i)})},null,e,1<arguments.length,null,!1));if(this.length&&(c=b.data(a),1===a.nodeType)&&!b._data(a,"parsedAttrs")){for(s=(t=a.attributes).length;l<s;l++)0===(o=t[l].name).indexOf("data-")&&(o=b.camelCase(o.substring(5)),pe(a,o,c[o]));b._data(a,"parsedAttrs",!0)}return c},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,t,r){var i;if(e)return i=b._data(e,t=(t||"fx")+"queue"),r&&(!i||b.isArray(r)?i=b._data(e,t,b.makeArray(r)):i.push(r)),i||[]},dequeue:function(e,t){t=t||"fx";var r=b.queue(e,t),i=r.shift(),n=b._queueHooks(e,t);(i="inprogress"===i?r.shift():i)&&("fx"===t&&r.unshift("inprogress"),delete n.stop,i.call(e,function(){b.dequeue(e,t)},n)),!r.length&&n&&n.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return b._data(e,r)||b._data(e,r,{empty:b.Callbacks("once memory").add(function(){b.removeData(e,t+"queue",!0),b.removeData(e,r,!0)})})}}),b.fn.extend({queue:function(t,r){var e=2;return"string"!=typeof t&&(r=t,t="fx",e--),arguments.length<e?b.queue(this[0],t):r===_?this:this.each(function(){var e=b.queue(this,t,r);b._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&b.dequeue(this,t)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(i,e){return i=b.fx&&b.fx.speeds[i]||i,this.queue(e=e||"fx",function(e,t){var r=setTimeout(e,i);t.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function r(){--n||o.resolveWith(s,[s])}var i,n=1,o=b.Deferred(),s=this,a=this.length;for("string"!=typeof e&&(t=e,e=_),e=e||"fx";a--;)(i=b._data(s[a],e+"queueHooks"))&&i.empty&&(n++,i.empty.add(r));return r(),o.promise(t)}});var a,de,fe,ge=/[\t\r\n]/g,me=/\r/g,ye=/^(?:button|input)$/i,ve=/^(?:button|input|object|select|textarea)$/i,Ce=/^a(?:rea|)$/i,Se=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,ke=b.support.getSetAttribute,_e=(b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,1<arguments.length)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=_,delete this[e]}catch(e){}})},addClass:function(t){var e,r,i,n,o,s,a;if(b.isFunction(t))return this.each(function(e){b(this).addClass(t.call(this,e,this.className))});if(t&&"string"==typeof t)for(e=t.split(E),r=0,i=this.length;r<i;r++)if(1===(n=this[r]).nodeType)if(n.className||1!==e.length){for(o=" "+n.className+" ",s=0,a=e.length;s<a;s++)~o.indexOf(" "+e[s]+" ")||(o+=e[s]+" ");n.className=b.trim(o)}else n.className=t;return this},removeClass:function(t){var e,r,i,n,o,s,a;if(b.isFunction(t))return this.each(function(e){b(this).removeClass(t.call(this,e,this.className))});if(t&&"string"==typeof t||t===_)for(e=(t||"").split(E),s=0,a=this.length;s<a;s++)if(1===(i=this[s]).nodeType&&i.className){for(r=(" "+i.className+" ").replace(ge," "),n=0,o=e.length;n<o;n++)for(;-1<r.indexOf(" "+e[n]+" ");)r=r.replace(" "+e[n]+" "," ");i.className=t?b.trim(r):""}return this},toggleClass:function(o,s){var a=typeof o,l="boolean"==typeof s;return b.isFunction(o)?this.each(function(e){b(this).toggleClass(o.call(this,e,this.className,s),s)}):this.each(function(){if("string"==a)for(var e,t=0,r=b(this),i=s,n=o.split(E);e=n[t++];)i=l?i:!r.hasClass(e),r[i?"addClass":"removeClass"](e);else"undefined"!=a&&"boolean"!=a||(this.className&&b._data(this,"__className__",this.className),this.className=!this.className&&!1!==o&&b._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",r=0,i=this.length;r<i;r++)if(1===this[r].nodeType&&-1<(" "+this[r].className+" ").replace(ge," ").indexOf(t))return!0;return!1},val:function(r){var i,e,n,t=this[0];return arguments.length?(n=b.isFunction(r),this.each(function(e){var t=b(this);1!==this.nodeType||(null==(e=n?r.call(this,e,t.val()):r)?e="":"number"==typeof e?e+="":b.isArray(e)&&(e=b.map(e,function(e){return null==e?"":e+""})),(i=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&i.set(this,e,"value")!==_)||(this.value=e)})):t?(i=b.valHooks[t.type]||b.valHooks[t.nodeName.toLowerCase()])&&"get"in i&&(e=i.get(t,"value"))!==_?e:"string"==typeof(e=t.value)?e.replace(me,""):null==e?"":e:void 0}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,r,i,n=e.selectedIndex,o=[],s=e.options,a="select-one"===e.type;if(n<0)return null;for(t=a?n:0,r=a?n+1:s.length;t<r;t++)if((i=s[t]).selected&&(b.support.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!b.nodeName(i.parentNode,"optgroup"))){if(i=b(i).val(),a)return i;o.push(i)}return a&&!o.length&&s.length?b(s[n]).val():o},set:function(e,t){var r=b.makeArray(t);return b(e).find("option").each(function(){this.selected=0<=b.inArray(b(this).val(),r)}),r.length||(e.selectedIndex=-1),r}}},attrFn:{},attr:function(e,t,r,i){var n,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return i&&b.isFunction(b.fn[t])?b(e)[t](r):void 0===e.getAttribute?b.prop(e,t,r):((i=1!==s||!b.isXMLDoc(e))&&(t=t.toLowerCase(),o=b.attrHooks[t]||(Se.test(t)?de:a)),r===_?!(o&&"get"in o&&i&&null!==(n=o.get(e,t)))&&null===(n=e.getAttribute(t))?_:n:null!==r?o&&"set"in o&&i&&(n=o.set(e,r,t))!==_?n:(e.setAttribute(t,""+r),r):void b.removeAttr(e,t))},removeAttr:function(e,t){var r,i,n,o,s=0;if(t&&1===e.nodeType)for(i=t.split(E);s<i.length;s++)(n=i[s])&&(r=b.propFix[n]||n,(o=Se.test(n))||b.attr(e,n,""),e.removeAttribute(ke?n:r),o)&&r in e&&(e[r]=!1)},attrHooks:{type:{set:function(e,t){var r;if(ye.test(e.nodeName)&&e.parentNode)b.error("type property can't be changed");else if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input"))return r=e.value,e.setAttribute("type",t),r&&(e.value=r),t}},value:{get:function(e,t){return a&&b.nodeName(e,"button")?a.get(e,t):t in e?e.value:null},set:function(e,t,r){if(a&&b.nodeName(e,"button"))return a.set(e,t,r);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,t,r){var i,n,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return(1!==o||!b.isXMLDoc(e))&&(t=b.propFix[t]||t,n=b.propHooks[t]),r!==_?n&&"set"in n&&(i=n.set(e,r,t))!==_?i:e[t]=r:n&&"get"in n&&null!==(i=n.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):ve.test(e.nodeName)||Ce.test(e.nodeName)&&e.href?0:_}}}}),de={get:function(e,t){var r=b.prop(e,t);return!0===r||"boolean"!=typeof r&&(r=e.getAttributeNode(t))&&!1!==r.nodeValue?t.toLowerCase():_},set:function(e,t,r){return!1===t?b.removeAttr(e,r):((t=b.propFix[r]||r)in e&&(e[t]=!0),e.setAttribute(r,r.toLowerCase())),r}},ke||(fe={name:!0,id:!0,coords:!0},a=b.valHooks.button={get:function(e,t){e=e.getAttributeNode(t);return e&&(fe[t]?""!==e.value:e.specified)?e.value:_},set:function(e,t,r){var i=e.getAttributeNode(r);return i||(i=v.createAttribute(r),e.setAttributeNode(i)),i.value=t+""}},b.each(["width","height"],function(e,r){b.attrHooks[r]=b.extend(b.attrHooks[r],{set:function(e,t){if(""===t)return e.setAttribute(r,"auto"),t}})}),b.attrHooks.contenteditable={get:a.get,set:function(e,t,r){a.set(e,t=""===t?"false":t,r)}}),b.support.hrefNormalized||b.each(["href","src","width","height"],function(e,t){b.attrHooks[t]=b.extend(b.attrHooks[t],{get:function(e){e=e.getAttribute(t,2);return null===e?_:e}})}),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||_},set:function(e,t){return e.style.cssText=""+t}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){e=e.parentNode;return e&&(e.selectedIndex,e.parentNode)&&e.parentNode.selectedIndex,null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,t){if(b.isArray(t))return e.checked=0<=b.inArray(b(e).val(),t)}})}),/^(?:textarea|input|select)$/i),be=/^([^\.]*|)(?:\.(.+)|)$/,Ee=/(?:^|\s)hover(\.\S+|)\b/,we=/^key/,Te=/^(?:mouse|contextmenu)|click/,Pe=/^(?:focusinfocus|focusoutblur)$/;function l(){return!1}function Ie(){return!0}b.event={add:function(e,t,r,i,n){var o,s,a,l,c,p,h,u,d,f;if(3!==e.nodeType&&8!==e.nodeType&&t&&r&&(o=b._data(e)))for(r.handler&&(r=(u=r).handler,n=u.selector),r.guid||(r.guid=b.guid++),(a=o.events)||(o.events=a={}),(s=o.handle)||(o.handle=s=function(e){return void 0===b||e&&b.event.triggered===e.type?_:b.event.dispatch.apply(s.elem,arguments)},s.elem=e),t=b.trim(ue(t)).split(" "),l=0;l<t.length;l++)c=(h=be.exec(t[l])||[])[1],p=(h[2]||"").split(".").sort(),f=b.event.special[c]||{},c=(n?f.delegateType:f.bindType)||c,f=b.event.special[c]||{},h=b.extend({type:c,origType:h[1],data:i,handler:r,guid:r.guid,selector:n,namespace:p.join(".")},u),(d=a[c])||((d=a[c]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,i,p,s))||(e.addEventListener?e.addEventListener(c,s,!1):e.attachEvent&&e.attachEvent("on"+c,s)),f.add&&(f.add.call(e,h),h.handler.guid||(h.handler.guid=r.guid)),n?d.splice(d.delegateCount++,0,h):d.push(h),b.event.global[c]=!0},global:{},remove:function(e,t,r,i,n){var o,s,a,l,c,p,h,u,d,f,g=b.hasData(e)&&b._data(e);if(g&&(h=g.events)){for(t=b.trim(ue(t||"")).split(" "),o=0;o<t.length;o++)if(s=a=(c=be.exec(t[o])||[])[1],l=c[2],s){for(u=b.event.special[s]||{},c=(d=h[s=(i?u.delegateType:u.bindType)||s]||[]).length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,p=0;p<d.length;p++)f=d[p],!n&&a!==f.origType||r&&r.guid!==f.guid||l&&!l.test(f.namespace)||i&&i!==f.selector&&("**"!==i||!f.selector)||(d.splice(p--,1),f.selector&&d.delegateCount--,u.remove&&u.remove.call(e,f));0===d.length&&c!==d.length&&(u.teardown&&!1!==u.teardown.call(e,l,g.handle)||b.removeEvent(e,s,g.handle),delete h[s])}else for(s in h)b.event.remove(e,s+t[o],r,i,!0);b.isEmptyObject(h)&&(delete g.handle,b.removeData(e,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(e,t,r,i){if(!r||3!==r.nodeType&&8!==r.nodeType){var n,o,s,a,l,c,p,h,u,d=e.type||e,f=[];if(!Pe.test(d+b.event.triggered)&&(0<=d.indexOf("!")&&(d=d.slice(0,-1),c=!0),0<=d.indexOf(".")&&(d=(f=d.split(".")).shift(),f.sort()),r&&!b.event.customEvent[d]||b.event.global[d]))if((e="object"==typeof e?e[b.expando]?e:new b.Event(d,e):new b.Event(d)).type=d,e.isTrigger=!0,e.exclusive=c,e.namespace=f.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=d.indexOf(":")<0?"on"+d:"",r){if(e.result=_,e.target||(e.target=r),(t=null!=t?b.makeArray(t):[]).unshift(e),!(c=b.event.special[d]||{}).trigger||!1!==c.trigger.apply(r,t)){if(h=[[r,c.bindType||d]],!i&&!c.noBubble&&!b.isWindow(r)){for(u=c.delegateType||d,s=Pe.test(u+d)?r:r.parentNode,a=r;s;s=s.parentNode)h.push([s,u]),a=s;a===(r.ownerDocument||v)&&h.push([a.defaultView||a.parentWindow||y,u])}for(o=0;o<h.length&&!e.isPropagationStopped();o++)s=h[o][0],e.type=h[o][1],(p=(b._data(s,"events")||{})[e.type]&&b._data(s,"handle"))&&p.apply(s,t),(p=l&&s[l])&&b.acceptData(s)&&!1===p.apply(s,t)&&e.preventDefault();return e.type=d,i||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(r.ownerDocument,t)||"click"===d&&b.nodeName(r,"a")||!b.acceptData(r)||l&&r[d]&&("focus"!==d&&"blur"!==d||0!==e.target.offsetWidth)&&!b.isWindow(r)&&((a=r[l])&&(r[l]=null),r[b.event.triggered=d](),b.event.triggered=_,a)&&(r[l]=a),e.result}}else for(o in n=b.cache)n[o].events&&n[o].events[d]&&b.event.trigger(e,t,n[o].handle.elem,!0)}},dispatch:function(e){e=b.event.fix(e||y.event);var t,r,i,n,o,s,a,l,c,p,h=(b._data(this,"events")||{})[e.type]||[],u=h.delegateCount,d=[].slice.call(arguments),f=!e.exclusive&&!e.namespace,g=b.event.special[e.type]||{},m=[];if((d[0]=e).delegateTarget=this,!g.preDispatch||!1!==g.preDispatch.call(this,e)){if(u&&(!e.button||"click"!==e.type))for((n=b(this)).context=this,i=e.target;i!=this;i=i.parentNode||this)if(!0!==i.disabled||"click"!==e.type){for(s={},l=[],n[0]=i,t=0;t<u;t++)s[p=(c=h[t]).selector]===_&&(s[p]=n.is(p)),s[p]&&l.push(c);l.length&&m.push({elem:i,matches:l})}for(h.length>u&&m.push({elem:this,matches:h.slice(u)}),t=0;t<m.length&&!e.isPropagationStopped();t++)for(e.currentTarget=(a=m[t]).elem,r=0;r<a.matches.length&&!e.isImmediatePropagationStopped();r++)c=a.matches[r],(f||!e.namespace&&!c.namespace||e.namespace_re&&e.namespace_re.test(c.namespace))&&(e.data=c.data,e.handleObj=c,(o=((b.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,d))!==_)&&!1===(e.result=o)&&(e.preventDefault(),e.stopPropagation());return g.postDispatch&&g.postDispatch.call(this,e),e.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var r,i,n=t.button,o=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=(i=e.target.ownerDocument||v).documentElement,i=i.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),e.which||n===_||(e.which=1&n?1:2&n?3:4&n?2:0),e}},fix:function(e){if(e[b.expando])return e;var t,r,i=e,n=b.event.fixHooks[e.type]||{},o=n.props?this.props.concat(n.props):this.props;for(e=b.Event(i),t=o.length;t;)e[r=o[--t]]=i[r];return e.target||(e.target=i.srcElement||v),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,n.filter?n.filter(e,i):e},special:{ready:{setup:b.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,r){b.isWindow(this)&&(this.onbeforeunload=r)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,r,i){e=b.extend(new b.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?b.event.trigger(e,null,t):b.event.dispatch.call(t,e),e.isDefaultPrevented()&&r.preventDefault()}},b.event.handle=b.event.dispatch,b.removeEvent=v.removeEventListener?function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r,!1)}:function(e,t,r){t="on"+t;e.detachEvent&&(void 0===e[t]&&(e[t]=null),e.detachEvent(t,r))},b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?Ie:l):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0},b.Event.prototype={preventDefault:function(){this.isDefaultPrevented=Ie;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=Ie;var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Ie,this.stopPropagation()},isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,n){b.event.special[e]={delegateType:n,bindType:n,handle:function(e){var t,r=e.relatedTarget,i=e.handleObj;i.selector;return r&&(r===this||b.contains(this,r))||(e.type=i.origType,t=i.handler.apply(this,arguments),e.type=n),t}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){if(b.nodeName(this,"form"))return!1;b.event.add(this,"click._submit keypress._submit",function(e){e=e.target,e=b.nodeName(e,"input")||b.nodeName(e,"button")?e.form:_;e&&!b._data(e,"_submit_attached")&&(b.event.add(e,"submit._submit",function(e){e._submit_bubble=!0}),b._data(e,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode)&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0)},teardown:function(){if(b.nodeName(this,"form"))return!1;b.event.remove(this,"._submit")}}),b.support.changeBubbles||(b.event.special.change={setup:function(){if(_e.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1;b.event.add(this,"beforeactivate._change",function(e){e=e.target;_e.test(e.nodeName)&&!b._data(e,"_change_attached")&&(b.event.add(e,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(e,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return b.event.remove(this,"._change"),_e.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){function r(e){b.event.simulate(t,e.target,b.event.fix(e),!0)}var i=0;b.event.special[t]={setup:function(){0==i++&&v.addEventListener(e,r,!0)},teardown:function(){0==--i&&v.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,t,r,i,n){var o,s;if("object"==typeof e){for(s in"string"!=typeof t&&(r=r||t,t=_),e)this.on(s,t,r,e[s],n);return this}if(null==r&&null==i?(i=t,r=t=_):null==i&&("string"==typeof t?(i=r,r=_):(i=r,r=t,t=_)),!1===i)i=l;else if(!i)return this;return 1===n&&(o=i,(i=function(e){return b().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,t)})},one:function(e,t,r,i){return this.on(e,t,r,i,1)},off:function(e,t,r){var i,n;if(e&&e.preventDefault&&e.handleObj)i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);else{if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(r=t,t=_),!1===r&&(r=l),this.each(function(){b.event.remove(this,e,r,t)});for(n in e)this.off(n,t,e[n])}return this},bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,r){return b(this.context).on(e,this.selector,t,r),this},die:function(e,t){return b(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,r,i){return this.on(t,e,r,i)},undelegate:function(e,t,r){return 1==arguments.length?this.off(e,"**"):this.off(t,e||"**",r)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return b.event.trigger(e,t,this[0],!0)},toggle:function(r){function e(e){var t=(b._data(this,"lastToggle"+r.guid)||0)%n;return b._data(this,"lastToggle"+r.guid,1+t),e.preventDefault(),i[t].apply(this,arguments)||!1}var i=arguments,t=r.guid||b.guid++,n=0;for(e.guid=t;n<i.length;)i[n++].guid=t;return this.click(e)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,r){b.fn[r]=function(e,t){return null==t&&(t=e,e=null),0<arguments.length?this.on(r,null,e,t):this.trigger(r)},we.test(r)&&(b.event.fixHooks[r]=b.event.keyHooks),Te.test(r)&&(b.event.fixHooks[r]=b.event.mouseHooks)});var Le=void 0;function Ae(e){return e.sizzleFilter=!0,e}function e(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function xe(r){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===r}}function t(e){var t=!1,r=f.createElement("div");try{t=e(r)}catch(e){}return t}var Re,De,Oe,h,Fe,f=y.document,r=f.documentElement,i="undefined",Ne=!1,Me=!0,Ue=0,C=[].slice,w=[].push,c=("sizcache"+Math.random()).replace(".",""),T="[\\x20\\t\\r\\n\\f]",n=(u="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+").replace("w","w#"),o=":("+u+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)",s=":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",ze=T+"*([\\x20\\t\\r\\n\\f>+~])"+T+"*",Be="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+(n="\\["+T+"*("+u+")"+T+"*(?:([*^$|!~]?=)"+T+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+n+")|)|)"+T+"*\\]")+"|"+o.replace(2,7)+"|[^\\\\(),])+",He=new RegExp("^"+T+"+|((?:^|[^\\\\])(?:\\\\.)*)"+T+"+$","g"),We=new RegExp("^"+ze),$e=new RegExp(Be+"?(?="+T+"*,|$)","g"),Ge=new RegExp("^(?:(?!,)(?:(?:^|,)"+T+"*"+Be+")*?|"+T+"*(.*?))(\\)|$)"),je=new RegExp(Be.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+ze,"g"),qe=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Ke=/[\x20\t\r\n\f]*[+~]/,Ve=/:not\($/,Ze=/h\d/i,Ye=/input|select|textarea|button/i,S=/\\(?!\\)/g,P={ID:new RegExp("^#("+u+")"),CLASS:new RegExp("^\\.("+u+")"),NAME:new RegExp("^\\[name=['\"]?("+u+")['\"]?\\]"),TAG:new RegExp("^("+u.replace("[-","[-\\*")+")"),ATTR:new RegExp("^"+n),PSEUDO:new RegExp("^"+o),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+T+"*(even|odd|(([+-]|)(\\d*)n|)"+T+"*(?:([+-]|)"+T+"*(\\d+)|))"+T+"*\\)|)","i"),POS:new RegExp(s,"ig"),needsContext:new RegExp("^"+T+"*[>+~]|"+s,"i")},Xe={},Qe=[],Je={},et=[],tt=t(function(e){e.innerHTML="<select></select>";e=typeof e.lastChild.getAttribute("multiple");return"boolean"!=e&&"string"!=e}),Be=t(function(e){e.id=c+0,e.innerHTML="<a name='"+c+"'></a><div name='"+c+"'></div>",r.insertBefore(e,r.firstChild);var t=f.getElementsByName&&f.getElementsByName(c).length===2+f.getElementsByName(c+0).length;return Fe=!f.getElementById(c),r.removeChild(e),t}),ze=t(function(e){return e.appendChild(f.createComment("")),0===e.getElementsByTagName("*").length}),u=t(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!=i&&"#"===e.firstChild.getAttribute("href")}),rt=t(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||0===e.getElementsByClassName("e").length)&&(e.lastChild.className="e",1!==e.getElementsByClassName("e").length)}),I=function(e,t,r,i){r=r||[];var n,o,s,a,l=(t=t||f).nodeType;if(1!==l&&9!==l)return[];if(!e||"string"!=typeof e)return r;if(!(s=it(t))&&!i&&(n=qe.exec(e)))if(a=n[1]){if(9===l){if(!(o=t.getElementById(a))||!o.parentNode)return r;if(o.id===a)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&nt(t,o)&&o.id===a)return r.push(o),r}else{if(n[2])return w.apply(r,C.call(t.getElementsByTagName(e),0)),r;if((a=n[3])&&rt&&t.getElementsByClassName)return w.apply(r,C.call(t.getElementsByClassName(a),0)),r}return gt(e,t,r,i,s)},L=I.selectors={cacheLength:50,match:P,order:["ID","TAG"],attrHandle:{},createPseudo:Ae,find:{ID:Fe?function(e,t,r){if(typeof t.getElementById!=i&&!r)return(r=t.getElementById(e))&&r.parentNode?[r]:[]}:function(e,t,r){if(typeof t.getElementById!=i&&!r)return(r=t.getElementById(e))?r.id===e||typeof r.getAttributeNode!=i&&r.getAttributeNode("id").value===e?[r]:Le:[]},TAG:ze?function(e,t){if(typeof t.getElementsByTagName!=i)return t.getElementsByTagName(e)}:function(e,t){var r=t.getElementsByTagName(e);if("*"!==e)return r;for(var i,n=[],o=0;i=r[o];o++)1===i.nodeType&&n.push(i);return n}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(S,""),e[3]=(e[4]||e[5]||"").replace(S,""),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1]?(e[2]||I.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*("even"===e[2]||"odd"===e[2])),e[4]=+(e[6]+e[7]||"odd"===e[2])):e[2]&&I.error(e[0]),e},PSEUDO:function(e){var t,r=e[4];return P.CHILD.test(e[0])?null:(r&&(t=Ge.exec(r))&&t.pop()&&(e[0]=e[0].slice(0,t[0].length-r.length-1),r=t[0].slice(0,-1)),e.splice(2,3,r||e[3]),e)}},filter:{ID:Fe?function(t){return t=t.replace(S,""),function(e){return e.getAttribute("id")===t}}:function(t){return t=t.replace(S,""),function(e){e=typeof e.getAttributeNode!=i&&e.getAttributeNode("id");return e&&e.value===t}},TAG:function(t){return"*"===t?function(){return!0}:(t=t.replace(S,"").toLowerCase(),function(e){return e.nodeName&&e.nodeName.toLowerCase()===t})},CLASS:function(e){var t=Xe[e];return t||(t=Xe[e]=new RegExp("(^|"+T+")"+e+"("+T+"|$)"),Qe.push(e),Qe.length>L.cacheLength&&delete Xe[Qe.shift()]),function(e){return t.test(e.className||typeof e.getAttribute!=i&&e.getAttribute("class")||"")}},ATTR:function(r,i,n){return i?function(e){var e=I.attr(e,r),t=e+"";if(null==e)return"!="===i;switch(i){case"=":return t===n;case"!=":return t!==n;case"^=":return n&&0===t.indexOf(n);case"*=":return n&&-1<t.indexOf(n);case"$=":return n&&t.substr(t.length-n.length)===n;case"~=":return-1<(" "+t+" ").indexOf(n);case"|=":return t===n||t.substr(0,n.length+1)===n+"-"}}:function(e){return null!=I.attr(e,r)}},CHILD:function(r,e,n,o){var s;return"nth"===r?(s=Ue++,function(e){var t,r=0,i=e;if(1===n&&0===o)return!0;if((t=e.parentNode)&&(t[c]!==s||!e.sizset)){for(i=t.firstChild;i&&(1!==i.nodeType||(i.sizset=++r,i!==e));i=i.nextSibling);t[c]=s}return t=e.sizset-o,0===n?0==t:t%n==0&&0<=t/n}):function(e){var t=e;switch(r){case"only":case"first":for(;t=t.previousSibling;)if(1===t.nodeType)return!1;if("first"===r)return!0;t=e;case"last":for(;t=t.nextSibling;)if(1===t.nodeType)return!1;return!0}}},PSEUDO:function(e,t,r,i){var n=L.pseudos[e]||L.pseudos[e.toLowerCase()];return n||I.error("unsupported pseudo: "+e),n.sizzleFilter?n(t,r,i):n}},pseudos:{not:Ae(function(e,t,r){var i=ft(e.replace(He,"$1"),t,r);return function(e){return!i(e)}}),enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!L.pseudos.empty(e)},empty:function(e){var t;for(e=e.firstChild;e;){if("@"<e.nodeName||3===(t=e.nodeType)||4===t)return!1;e=e.nextSibling}return!0},contains:Ae(function(t){return function(e){return-1<(e.textContent||e.innerText||ot(e)).indexOf(t)}}),has:Ae(function(t){return function(e){return 0<I(t,e).length}}),header:function(e){return Ze.test(e.nodeName)},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===(t=e.type)&&(null==(e=e.getAttribute("type"))||e.toLowerCase()===t)},radio:e("radio"),checkbox:e("checkbox"),file:e("file"),password:e("password"),image:e("image"),submit:xe("submit"),reset:xe("reset"),button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return Ye.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!(!e.type&&!e.href)},active:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t,r){return r?e.slice(1):[e[0]]},last:function(e,t,r){var i=e.pop();return r?e:[i]},even:function(e,t,r){for(var i=[],n=r?1:0,o=e.length;n<o;n+=2)i.push(e[n]);return i},odd:function(e,t,r){for(var i=[],n=r?0:1,o=e.length;n<o;n+=2)i.push(e[n]);return i},lt:function(e,t,r){return r?e.slice(+t):e.slice(0,+t)},gt:function(e,t,r){return r?e.slice(0,+t+1):e.slice(+t+1)},eq:function(e,t,r){t=e.splice(+t,1);return r?e:t}}};L.setFilters.nth=L.setFilters.eq,L.filters=L.pseudos,u||(L.attrHandle={href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}}),Be&&(L.order.push("NAME"),L.find.NAME=function(e,t){if(typeof t.getElementsByName!=i)return t.getElementsByName(e)}),rt&&(L.order.splice(1,0,"CLASS"),L.find.CLASS=function(e,t,r){if(typeof t.getElementsByClassName!=i&&!r)return t.getElementsByClassName(e)});try{C.call(r.childNodes,0)[0].nodeType}catch(e){C=function(e){for(var t,r=[];t=this[e];e++)r.push(t);return r}}var it=I.isXML=function(e){e=e&&(e.ownerDocument||e).documentElement;return!!e&&"HTML"!==e.nodeName},nt=I.contains=r.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:r.contains?function(e,t){var r=9===e.nodeType?e.documentElement:e,t=t.parentNode;return e===t||!!(t&&1===t.nodeType&&r.contains&&r.contains(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},ot=I.getText=function(e){var t,r="",i=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=ot(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[i];i++)r+=ot(t);return r};function st(e,t,r,i){for(var n=0,o=t.length;n<o;n++)I(e,t[n],r,i)}function at(e,t,r,i,n){for(var o,s,a,l,c,p,h,u,d,f,g,m,y,v=0,C=n.length,S=P.POS,k=new RegExp("^"+S.source+"(?!"+T+")","i"),_=function(){for(var e=1,t=arguments.length-2;e<t;e++)arguments[e]===Le&&(o[e]=Le)};v<C;v++){for(S.exec(""),e=n[v],a=[],s=0,l=i;o=S.exec(e);)s<(d=S.lastIndex=o.index+o[0].length)&&(c=e.slice(s,o.index),s=d,d=[t],We.test(c)&&(l&&(d=l),l=i),(g=Ve.test(c))&&(c=c.slice(0,-5).replace(We,"$&*")),1<o.length&&o[0].replace(k,_),p=c,h=o[1],u=o[2],d=d,f=l,g=g,y=m=void 0,(y=L.setFilters[h.toLowerCase()])||I.error(h),!p&&(m=f)||st(p||"*",d,m=[],f),l=0<m.length?y(m,u,g):[]);l?(a=a.concat(l),(c=e.slice(s))&&")"!==c?We.test(c)?st(c,a,r,i):I(c,t,r,i?i.concat(l):l):w.apply(r,a)):I(e,t,r,i)}return 1===C?r:I.uniqueSort(r)}function lt(e,t,r){for(var i,n,o=0;i=e[o];o++)n=L.relative[i.part]?((o,e,t)=>{var s=e.dir,a=Ue++;return o=o||function(e){return e===t},e.first?function(e,t){for(;e=e[s];)if(1===e.nodeType)return o(e,t)&&e}:function(e,t){for(var r,i=a+"."+De,n=i+"."+Re;e=e[s];)if(1===e.nodeType){if((r=e[c])===n)return e.sizset;if("string"==typeof r&&0===r.indexOf(i)){if(e.sizset)return e}else{if(e[c]=n,o(e,t))return e.sizset=!0,e;e.sizset=!1}}}})(n,L.relative[i.part],t):(i.captures.push(t,r),((i,n)=>i?function(e,t){var r=n(e,t);return r&&i(!0===r?e:r,t)}:n)(n,L.filter[i.part].apply(null,i.captures)));return n}I.attr=function(e,t){var r=it(e);return r||(t=t.toLowerCase()),L.attrHandle[t]?L.attrHandle[t](e):tt||r?e.getAttribute(t):(r=e.getAttributeNode(t))?"boolean"==typeof e[t]?e[t]?t:null:r.specified?r.value:null:null},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},[0,0].sort(function(){return Me=0}),r.compareDocumentPosition?Oe=function(e,t){return e===t?(Ne=!0,0):(e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t):e.compareDocumentPosition)?-1:1}:(Oe=function(e,t){if(e===t)return Ne=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var r=[],i=[],n=e.parentNode,o=t.parentNode,s=n;if(n===o)return h(e,t);if(!n)return-1;if(!o)return 1;for(;s;)r.unshift(s),s=s.parentNode;for(s=o;s;)i.unshift(s),s=s.parentNode;for(var a=r.length,l=i.length,c=0;c<a&&c<l;c++)if(r[c]!==i[c])return h(r[c],i[c]);return c===a?h(e,i[c],-1):h(r[c],t,1)},h=function(e,t,r){if(e===t)return r;for(var i=e.nextSibling;i;){if(i===t)return-1;i=i.nextSibling}return 1}),I.uniqueSort=function(e){var t,r=1;if(Oe&&(Ne=Me,e.sort(Oe),Ne))for(;t=e[r];r++)t===e[r-1]&&e.splice(r--,1);return e};var ct,pt,ht,ut,d,g,dt,ft=I.compile=function(e,t,r){var i,n,o,s,a=Je[e];if(!a||a.context!==t){for(n=((e,t,r)=>{for(var i,n,o,s=[],a=0,l=Ge.exec(e),c=!l.pop()&&!l.pop(),p=c&&e.match($e)||[""],h=L.preFilter,u=L.filter,d=!r&&t!==f;null!=(n=p[a])&&c;a++)for(s.push(i=[]),d&&(n=" "+n);n;){for(o in c=!1,(l=We.exec(n))&&(n=n.slice(l[0].length),c=i.push({part:l.pop().replace(He," "),captures:l})),u)!(l=P[o].exec(n))||h[o]&&!(l=h[o](l,t,r))||(n=n.slice(l.shift().length),c=i.push({part:o,captures:l}));if(!c)break}return c||I.error(e),s})(e,t,r),o=0;i=n[o];o++)n[o]=lt(i,t,r);(a=Je[e]=(s=n,function(e,t){for(var r,i=0;r=s[i];i++)if(r(e,t))return!0;return!1})).context=t,a.runs=a.dirruns=0,et.push(e),et.length>L.cacheLength&&delete Je[et.shift()]}return a},gt=(I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){return 0<I(t,null,null,[e]).length},function(e,t,r,i,n){var o,s,a,l,c,p,h,u,d,f=(e=e.replace(He,"$1")).match($e),g=e.match(je),m=t.nodeType;if(P.POS.test(e))return at(e,t,r,i,f);if(i)o=C.call(i,0);else if(f&&1===f.length){if(1<g.length&&9===m&&!n&&(f=P.ID.exec(g[0]))){if(!(t=L.find.ID(f[1],t,n)[0]))return r;e=e.slice(g.shift().length)}for(u=(f=Ke.exec(g[0]))&&!f.index&&t.parentNode||t,p=(d=g.pop()).split(":not")[0],a=0,l=L.order.length;a<l;a++)if(h=L.order[a],(f=P[h].exec(p))&&null!=(o=L.find[h]((f[1]||"").replace(S,""),u,n))){p!==d||(e=e.slice(0,e.length-d.length)+p.replace(P[h],""))||w.apply(r,C.call(o,0));break}}if(e)for(s=ft(e,t,n),De=s.dirruns++,null==o&&(o=L.find.TAG("*",Ke.test(e)&&t.parentNode||t)),a=0;c=o[a];a++)Re=s.runs++,s(c,t)&&r.push(c);return r}),mt=(f.querySelectorAll&&(pt=gt,ht=/'|\\/g,ut=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,d=[],g=[":active"],dt=r.matchesSelector||r.mozMatchesSelector||r.webkitMatchesSelector||r.oMatchesSelector||r.msMatchesSelector,t(function(e){e.innerHTML="<select><option selected></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+T+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),t(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&d.push("[*^$]="+T+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'>",e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled")}),d=d.length&&new RegExp(d.join("|")),gt=function(e,t,r,i,n){if(!(i||n||d&&d.test(e)))if(9===t.nodeType)try{return w.apply(r,C.call(t.querySelectorAll(e),0)),r}catch(e){}else if(1===t.nodeType&&"object"!==t.nodeName.toLowerCase()){var o=t.getAttribute("id"),s=o||c,a=Ke.test(e)&&t.parentNode||t;o?s=s.replace(ht,"\\$&"):t.setAttribute("id",s);try{return w.apply(r,C.call(a.querySelectorAll(e.replace($e,"[id='"+s+"'] $&")),0)),r}catch(e){}finally{o||t.removeAttribute("id")}}return pt(e,t,r,i,n)},dt)&&(t(function(e){ct=dt.call(e,"div");try{dt.call(e,"[test!='']:sizzle"),g.push(L.match.PSEUDO)}catch(e){}}),g=new RegExp(g.join("|")),I.matchesSelector=function(e,t){if(t=t.replace(ut,"='$1']"),!(it(e)||g.test(t)||d&&d.test(t)))try{var r=dt.call(e,t);if(r||ct||e.document&&11!==e.document.nodeType)return r}catch(e){}return 0<I(t,null,null,[e]).length}),I.attr=b.attr,b.find=I,b.expr=I.selectors,b.expr[":"]=b.expr.pseudos,b.unique=I.uniqueSort,b.text=I.getText,b.isXMLDoc=I.isXML,b.contains=I.contains,/Until$/),yt=/^(?:parents|prev(?:Until|All))/,vt=/^.[^:#\[\.,]*$/,Ct=b.expr.match.needsContext,St={children:!0,contents:!0,next:!0,prev:!0};function kt(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function _t(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function bt(e,r,i){if(r=r||0,b.isFunction(r))return b.grep(e,function(e,t){return!!r.call(e,t,e)===i});if(r.nodeType)return b.grep(e,function(e,t){return e===r===i});if("string"==typeof r){var t=b.grep(e,function(e){return 1===e.nodeType});if(vt.test(r))return b.filter(r,t,!i);r=b.filter(r,t)}return b.grep(e,function(e,t){return 0<=b.inArray(e,r)===i})}function Et(e){var t=wt.split("|"),r=e.createDocumentFragment();if(r.createElement)for(;t.length;)r.createElement(t.pop());return r}b.fn.extend({find:function(e){var t,r,i,n,o,s,a=this;if("string"!=typeof e)return b(e).filter(function(){for(t=0,r=a.length;t<r;t++)if(b.contains(a[t],this))return!0});for(s=this.pushStack("","find",e),t=0,r=this.length;t<r;t++)if(i=s.length,b.find(e,this[t],s),0<t)for(n=i;n<s.length;n++)for(o=0;o<i;o++)if(s[o]===s[n]){s.splice(n--,1);break}return s},has:function(e){var t,r=b(e,this),i=r.length;return this.filter(function(){for(t=0;t<i;t++)if(b.contains(this,r[t]))return!0})},not:function(e){return this.pushStack(bt(this,e,!1),"not",e)},filter:function(e){return this.pushStack(bt(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?Ct.test(e)?0<=b(e,this.context).index(this[0]):0<b.filter(e,this).length:0<this.filter(e).length)},closest:function(e,t){for(var r,i=0,n=this.length,o=[],s=Ct.test(e)||"string"!=typeof e?b(e,t||this.context):0;i<n;i++)for(r=this[i];r&&r.ownerDocument&&r!==t&&11!==r.nodeType;){if(s?-1<s.index(r):b.find.matchesSelector(r,e)){o.push(r);break}r=r.parentNode}return o=1<o.length?b.unique(o):o,this.pushStack(o,"closest",e)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){t="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),e=b.merge(this.get(),t);return this.pushStack(kt(t[0])||kt(e[0])?e:b.unique(e))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){e=e.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,r){return b.dir(e,"parentNode",r)},next:function(e){return _t(e,"nextSibling")},prev:function(e){return _t(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,r){return b.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return b.dir(e,"previousSibling",r)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(i,n){b.fn[i]=function(e,t){var r=b.map(this,n,e);return(t=mt.test(i)?t:e)&&"string"==typeof t&&(r=b.filter(t,r)),r=1<this.length&&!St[i]?b.unique(r):r,1<this.length&&yt.test(i)&&(r=r.reverse()),this.pushStack(r,i,p.call(arguments).join(","))}}),b.extend({filter:function(e,t,r){return r&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,t,r){for(var i=[],n=e[t];n&&9!==n.nodeType&&(r===_||1!==n.nodeType||!b(n).is(r));)1===n.nodeType&&i.push(n),n=n[t];return i},sibling:function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}});var wt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Tt=/ jQuery\d+="(?:null|\d+)"/g,Pt=/^\s+/,It=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Lt=/<([\w:]+)/,At=/<tbody/i,xt=/<|&#?\w+;/,Rt=/<(?:script|style|link)/i,Dt=/<(?:script|object|embed|option|style)/i,Ot=new RegExp("<(?:"+wt+")[\\s/>]","i"),Ft=/^(?:checkbox|radio)$/,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,Mt=/\/(java|ecma)script/i,Ut=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,k={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},zt=Et(v),Bt=zt.appendChild(v.createElement("div"));function Ht(e,t){if(1===t.nodeType&&b.hasData(e)){var r,i,n,e=b._data(e),o=b._data(t,e),s=e.events;if(s)for(r in delete o.handle,o.events={},s)for(i=0,n=s[r].length;i<n;i++)b.event.add(t,r,s[r][i]);o.data&&(o.data=b.extend({},o.data))}}function Wt(e,t){var r;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),"object"===(r=t.nodeName.toLowerCase())?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===r&&Ft.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===r?t.selected=e.defaultSelected:"input"===r||"textarea"===r?t.defaultValue=e.defaultValue:"script"===r&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(b.expando))}function $t(e){return void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):void 0!==e.querySelectorAll?e.querySelectorAll("*"):[]}function Gt(e){Ft.test(e.type)&&(e.defaultChecked=e.checked)}k.optgroup=k.option,k.tbody=k.tfoot=k.colgroup=k.caption=k.thead,k.th=k.td,b.support.htmlSerialize||(k._default=[1,"X<div>","</div>"]),b.fn.extend({text:function(e){return b.access(this,function(e){return e===_?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||v).createTextNode(e))},null,e,arguments.length)},wrapAll:function(t){var e;return b.isFunction(t)?this.each(function(e){b(this).wrapAll(t.call(this,e))}):(this[0]&&(e=b(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)),this)},wrapInner:function(r){return b.isFunction(r)?this.each(function(e){b(this).wrapInner(r.call(this,e))}):this.each(function(){var e=b(this),t=e.contents();t.length?t.wrapAll(r):e.append(r)})},wrap:function(t){var r=b.isFunction(t);return this.each(function(e){b(this).wrapAll(r?t.call(this,e):t)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType||this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(e,this.firstChild)})},before:function(){var e;return kt(this[0])?arguments.length?(e=b.clean(arguments),this.pushStack(b.merge(e,this),"before",this.selector)):void 0:this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)})},after:function(){var e;return kt(this[0])?arguments.length?(e=b.clean(arguments),this.pushStack(b.merge(this,e),"after",this.selector)):void 0:this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=0;null!=(r=this[i]);i++)e&&!b.filter(e,[r]).length||(t||1!==r.nodeType||(b.cleanData(r.getElementsByTagName("*")),b.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&b.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var t=this[0]||{},r=0,i=this.length;if(e===_)return 1===t.nodeType?t.innerHTML.replace(Tt,""):_;if("string"==typeof e&&!Rt.test(e)&&(b.support.htmlSerialize||!Ot.test(e))&&(b.support.leadingWhitespace||!Pt.test(e))&&!k[(Lt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(It,"<$1></$2>");try{for(;r<i;r++)1===(t=this[r]||{}).nodeType&&(b.cleanData(t.getElementsByTagName("*")),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(i){return kt(this[0])?this.length?this.pushStack(b(b.isFunction(i)?i():i),"replaceWith",i):this:b.isFunction(i)?this.each(function(e){var t=b(this),r=t.html();t.replaceWith(i.call(this,e,r))}):("string"!=typeof i&&(i=b(i).detach()),this.each(function(){var e=this.nextSibling,t=this.parentNode;b(this).remove(),e?b(e).before(i):b(t).append(i)}))},detach:function(e){return this.remove(e,!0)},domManip:function(r,i,n){var e,t,o,s,a,l,c=0,p=(r=[].concat.apply([],r))[0],h=[],u=this.length;if(!b.support.checkClone&&1<u&&"string"==typeof p&&Nt.test(p))return this.each(function(){b(this).domManip(r,i,n)});if(b.isFunction(p))return this.each(function(e){var t=b(this);r[0]=p.call(this,e,i?t.html():_),t.domManip(r,i,n)});if(this[0]){if(t=(o=(e=b.buildFragment(r,this,h)).fragment).firstChild,1===o.childNodes.length&&(o=t),t)for(i=i&&b.nodeName(t,"tr"),s=e.cacheable||u-1;c<u;c++)n.call(i&&b.nodeName(this[c],"table")?(a=this[c],l="tbody",a.getElementsByTagName(l)[0]||a.appendChild(a.ownerDocument.createElement(l))):this[c],c===s?o:b.clone(o,!0,!0));o=null,h.length&&b.each(h,function(e,t){t.src?b.ajax?b.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):b.error("no ajax"):b.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Ut,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),b.buildFragment=function(e,t,r){var i,n,o,s=e[0];return void 0===(t=((t=t||v)[0]||t).ownerDocument||t[0]||t).createDocumentFragment&&(t=v),!(1===e.length&&"string"==typeof s&&s.length<512&&t===v&&"<"===s.charAt(0))||Dt.test(s)||!b.support.checkClone&&Nt.test(s)||!b.support.html5Clone&&Ot.test(s)||(n=!0,o=(i=b.fragments[s])!==_),i||(i=t.createDocumentFragment(),b.clean(e,t,i,r),n&&(b.fragments[s]=o&&i)),{fragment:i,cacheable:n}},b.fragments={},b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(s,a){b.fn[s]=function(e){var t,r=0,i=[],n=b(e),o=n.length,e=1===this.length&&this[0].parentNode;if((null==e||e&&11===e.nodeType&&1===e.childNodes.length)&&1===o)return n[a](this[0]),this;for(;r<o;r++)t=(0<r?this.clone(!0):this).get(),b(n[r])[a](t),i=i.concat(t);return this.pushStack(i,s,n.selector)}}),b.extend({clone:function(e,t,r){var i,n,o,s;if(b.support.html5Clone||b.isXMLDoc(e)||!Ot.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Bt.innerHTML=e.outerHTML,Bt.removeChild(s=Bt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(Wt(e,s),i=$t(e),n=$t(s),o=0;i[o];++o)n[o]&&Wt(i[o],n[o]);if(t&&(Ht(e,s),r))for(i=$t(e),n=$t(s),o=0;i[o];++o)Ht(i[o],n[o]);return i=n=null,s},clean:function(e,t,r,i){for(var n,o,s,a,l,c,p,h,u,d,f=0,g=[],m=(t=t&&void 0!==t.createDocumentFragment?t:v)===v&&zt;null!=(o=e[f]);f++)if("number"==typeof o&&(o+=""),o){if("string"==typeof o)if(xt.test(o)){for(m=m||Et(t),c=c||m.appendChild(t.createElement("div")),o=o.replace(It,"<$1></$2>"),s=(Lt.exec(o)||["",""])[1].toLowerCase(),l=(a=k[s]||k._default)[0],c.innerHTML=a[1]+o+a[2];l--;)c=c.lastChild;if(!b.support.tbody)for(p=At.test(o),n=(h="table"!==s||p?"<table>"!==a[1]||p?[]:c.childNodes:c.firstChild&&c.firstChild.childNodes).length-1;0<=n;--n)b.nodeName(h[n],"tbody")&&!h[n].childNodes.length&&h[n].parentNode.removeChild(h[n]);!b.support.leadingWhitespace&&Pt.test(o)&&c.insertBefore(t.createTextNode(Pt.exec(o)[0]),c.firstChild),o=c.childNodes,c=m.lastChild}else o=t.createTextNode(o);o.nodeType?g.push(o):g=b.merge(g,o)}if(c&&(m.removeChild(c),o=c=m=null),!b.support.appendChecked)for(f=0;null!=(o=g[f]);f++)b.nodeName(o,"input")?Gt(o):void 0!==o.getElementsByTagName&&b.grep(o.getElementsByTagName("input"),Gt);if(r)for(u=function(e){if(!e.type||Mt.test(e.type))return i?i.push(e.parentNode?e.parentNode.removeChild(e):e):r.appendChild(e)},f=0;null!=(o=g[f]);f++)b.nodeName(o,"script")&&u(o)||(r.appendChild(o),void 0!==o.getElementsByTagName&&(d=b.grep(b.merge([],o.getElementsByTagName("script")),u),g.splice.apply(g,[f+1,0].concat(d)),f+=d.length));return g},cleanData:function(e,t){for(var r,i,n,o,s=0,a=b.expando,l=b.cache,c=b.support.deleteExpando,p=b.event.special;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(r=(i=n[a])&&l[i])){if(r.events)for(o in r.events)p[o]?b.event.remove(n,o):b.removeEvent(n,o,r.handle);l[i]&&(delete l[i],c?delete n[a]:n.removeAttribute?n.removeAttribute(a):n[a]=null,b.deletedIds.push(i))}}}),b.uaMatch=function(e){e=e.toLowerCase();e=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}},n={},(o=b.uaMatch(H.userAgent)).browser&&(n[o.browser]=!0,n.version=o.version),n.webkit&&(n.safari=!0),b.browser=n,b.sub=function(){function r(e,t){return new r.fn.init(e,t)}b.extend(!0,r,this),r.superclass=this,((r.fn=r.prototype=this()).constructor=r).sub=this.sub,r.fn.init=function(e,t){return t&&t instanceof b&&!(t instanceof r)&&(t=r(t)),b.fn.init.call(this,e,t,i)},r.fn.init.prototype=r.fn;var i=r(v);return r};var m,A,jt,qt=/alpha\([^)]*\)/i,Kt=/opacity=([^)]*)/,Vt=/^(top|right|bottom|left)$/,Zt=/^margin/,Yt=new RegExp("^("+Z+")(.*)$","i"),Xt=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),Qt=new RegExp("^([-+])=("+Z+")","i"),Jt={},er={position:"absolute",visibility:"hidden",display:"block"},tr={letterSpacing:0,fontWeight:400,lineHeight:1},x=["Top","Right","Bottom","Left"],rr=["Webkit","O","Moz","ms"],ir=b.fn.toggle;function nr(e,t){if(t in e)return t;for(var r=t.charAt(0).toUpperCase()+t.slice(1),i=t,n=rr.length;n--;)if((t=rr[n]+r)in e)return t;return i}function or(e,t){return"none"===b.css(e=t||e,"display")||!b.contains(e.ownerDocument,e)}function sr(e,t){for(var r,i,n=[],o=0,s=e.length;o<s;o++)(r=e[o]).style&&(n[o]=b._data(r,"olddisplay"),t?(n[o]||"none"!==r.style.display||(r.style.display=""),""===r.style.display&&or(r)&&(n[o]=b._data(r,"olddisplay",pr(r.nodeName)))):(i=m(r,"display"),n[o]||"none"===i||b._data(r,"olddisplay",i)));for(o=0;o<s;o++)!(r=e[o]).style||t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?n[o]||"":"none");return e}function ar(e,t,r){var i=Yt.exec(t);return i?Math.max(0,i[1]-(r||0))+(i[2]||"px"):t}function lr(e,t,r,i){for(var n=r===(i?"border":"content")?4:"width"===t?1:0,o=0;n<4;n+=2)"margin"===r&&(o+=b.css(e,r+x[n],!0)),i?("content"===r&&(o-=parseFloat(m(e,"padding"+x[n]))||0),"margin"!==r&&(o-=parseFloat(m(e,"border"+x[n]+"Width"))||0)):(o+=parseFloat(m(e,"padding"+x[n]))||0,"padding"!==r&&(o+=parseFloat(m(e,"border"+x[n]+"Width"))||0));return o}function cr(e,t,r){var i="width"===t?e.offsetWidth:e.offsetHeight,n=!0,o=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing");if(i<=0){if(((i=m(e,t))<0||null==i)&&(i=e.style[t]),Xt.test(i))return i;n=o&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+lr(e,t,r||(o?"border":"content"),n)+"px"}function pr(e){var t,r;return Jt[e]||(r=(t=b("<"+e+">").appendTo(v.body)).css("display"),t.remove(),"none"!==r&&""!==r||(A=v.body.appendChild(A||b.extend(v.createElement("iframe"),{frameBorder:0,width:0,height:0})),jt&&A.createElement||((jt=(A.contentWindow||A.contentDocument).document).write("<!doctype html><html><body>"),jt.close()),t=jt.body.appendChild(jt.createElement(e)),r=m(t,"display"),v.body.removeChild(A)),Jt[e]=r)}b.fn.extend({css:function(e,t){return b.access(this,function(e,t,r){return r!==_?b.style(e,t,r):b.css(e,t)},e,t,1<arguments.length)},show:function(){return sr(this,!0)},hide:function(){return sr(this)},toggle:function(e,t){var r="boolean"==typeof e;return b.isFunction(e)&&b.isFunction(t)?ir.apply(this,arguments):this.each(function(){(r?e:or(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t)return""===(t=m(e,"opacity"))?"1":t}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,s,a=b.camelCase(t),l=e.style;if(t=b.cssProps[a]||(b.cssProps[a]=nr(l,a)),s=b.cssHooks[t]||b.cssHooks[a],r===_)return s&&"get"in s&&(n=s.get(e,!1,i))!==_?n:l[t];if("string"===(o=typeof r)&&(n=Qt.exec(r))&&(r=(n[1]+1)*n[2]+parseFloat(b.css(e,t)),o="number"),!(null==r||"number"===o&&isNaN(r)||("number"!==o||b.cssNumber[a]||(r+="px"),s&&"set"in s&&(r=s.set(e,r,i))===_)))try{l[t]=r}catch(e){}}},css:function(e,t,r,i){var n,o=b.camelCase(t);return t=b.cssProps[o]||(b.cssProps[o]=nr(e.style,o)),"normal"===(n=(n=(o=b.cssHooks[t]||b.cssHooks[o])&&"get"in o?o.get(e,!0,i):n)===_?m(e,t):n)&&t in tr&&(n=tr[t]),(r||i!==_)&&(o=parseFloat(n),r||b.isNumeric(o))?o||0:n},swap:function(e,t,r){var i,n={};for(i in t)n[i]=e.style[i],e.style[i]=t[i];for(i in r=r.call(e),t)e.style[i]=n[i];return r}}),y.getComputedStyle?m=function(e,t){var r,i,n=getComputedStyle(e,null),o=e.style;return n&&(""!==(r=n[t])||b.contains(e.ownerDocument.documentElement,e)||(r=b.style(e,t)),Xt.test(r))&&Zt.test(t)&&(e=o.width,t=o.minWidth,i=o.maxWidth,o.minWidth=o.maxWidth=o.width=r,r=n.width,o.width=e,o.minWidth=t,o.maxWidth=i),r}:v.documentElement.currentStyle&&(m=function(e,t){var r,i,n=e.currentStyle&&e.currentStyle[t],o=e.style;return null==n&&o&&o[t]&&(n=o[t]),Xt.test(n)&&!Vt.test(t)&&(r=o.left,(i=e.runtimeStyle&&e.runtimeStyle.left)&&(e.runtimeStyle.left=e.currentStyle.left),o.left="fontSize"===t?"1em":n,n=o.pixelLeft+"px",o.left=r,i)&&(e.runtimeStyle.left=i),""===n?"auto":n}),b.each(["height","width"],function(e,i){b.cssHooks[i]={get:function(e,t,r){if(t)return 0!==e.offsetWidth||"none"!==m(e,"display")?cr(e,i,r):b.swap(e,er,function(){return cr(e,i,r)})},set:function(e,t,r){return ar(0,t,r?lr(e,i,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing")):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return Kt.test((t&&e.currentStyle?e.currentStyle:e.style).filter||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var r=e.style,e=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",n=e&&e.filter||r.filter||"";(r.zoom=1)<=t&&""===b.trim(n.replace(qt,""))&&r.removeAttribute&&(r.removeAttribute("filter"),e)&&!e.filter||(r.filter=qt.test(n)?n.replace(qt,i):n+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,t){return b.swap(e,{display:"inline-block"},function(){if(t)return m(e,"marginRight")})}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,r){b.cssHooks[r]={get:function(e,t){if(t)return t=m(e,r),Xt.test(t)?b(e).position()[r]+"px":t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0===e.offsetWidth&&0===e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||m(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(n,o){b.cssHooks[n+o]={expand:function(e){for(var t="string"==typeof e?e.split(" "):[e],r={},i=0;i<4;i++)r[n+x[i]+o]=t[i]||t[i-2]||t[0];return r}},Zt.test(n)||(b.cssHooks[n+o].set=ar)});var hr=/%20/g,ur=/\[\]$/,dr=/\r?\n/g,fr=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,gr=/^(?:select|textarea)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?b.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||gr.test(this.nodeName)||fr.test(this.type))}).map(function(e,r){var t=b(this).val();return null==t?null:b.isArray(t)?b.map(t,function(e,t){return{name:r.name,value:e.replace(dr,"\r\n")}}):{name:r.name,value:t.replace(dr,"\r\n")}}).get()}}),b.param=function(e,t){function r(e,t){t=b.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)}var i,n=[];if(t===_&&(t=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){r(this.name,this.value)});else for(i in e)!function r(i,e,n,o){if(b.isArray(e))b.each(e,function(e,t){n||ur.test(i)?o(i,t):r(i+"["+("object"==typeof t?e:"")+"]",t,n,o)});else if(n||"object"!==b.type(e))o(i,e);else for(var t in e)r(i+"["+t+"]",e[t],n,o)}(i,e[i],t,r);return n.join("&").replace(hr,"+")};var R,D,mr=/#.*$/,yr=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,vr=/^(?:GET|HEAD)$/,Cr=/^\/\//,Sr=/\?/,kr=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,_r=/([?&])_=[^&]*/,br=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Er=b.fn.load,wr={},Tr={},Pr=["*/"]+["*"];try{R=B.href}catch(e){(R=v.createElement("a")).href="",R=R.href}function Ir(a){return function(e,t){"string"!=typeof e&&(t=e,e="*");var r,i,n=e.toLowerCase().split(E),o=0,s=n.length;if(b.isFunction(t))for(;o<s;o++)r=n[o],(i=/^\+/.test(r))&&(r=r.substr(1)||"*"),(a[r]=a[r]||[])[i?"unshift":"push"](t)}}function Lr(e,t,r,i,n,o){(o=o||{})[n=n||t.dataTypes[0]]=!0;for(var s,a=e[n],l=0,c=a?a.length:0,p=e===wr;l<c&&(p||!s);l++)"string"==typeof(s=a[l](t,r,i))&&(s=!p||o[s]?_:(t.dataTypes.unshift(s),Lr(e,t,r,i,s,o)));return s=!p&&s||o["*"]?s:Lr(e,t,r,i,"*",o)}function Ar(e,t){var r,i,n=b.ajaxSettings.flatOptions||{};for(r in t)t[r]!==_&&((n[r]?e:i=i||{})[r]=t[r]);i&&b.extend(!0,e,i)}D=br.exec(R.toLowerCase())||[],b.fn.load=function(e,t,r){var i,n,o,s,a;return"string"!=typeof e&&Er?Er.apply(this,arguments):(this.length&&(s=this,0<=(a=e.indexOf(" "))&&(i=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(t)?(r=t,t=_):"object"==typeof t&&(n="POST"),b.ajax({url:e,type:n,dataType:"html",data:t,complete:function(e,t){r&&s.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,s.html(i?b("<div>").append(e.replace(kr,"")).find(i):e)})),this)},b.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,t,r,i){return b.isFunction(t)&&(i=i||r,r=t,t=_),b.ajax({type:n,url:e,data:t,success:r,dataType:i})}}),b.extend({getScript:function(e,t){return b.get(e,_,t,"script")},getJSON:function(e,t,r){return b.get(e,t,r,"json")},ajaxSetup:function(e,t){return t?Ar(e,b.ajaxSettings):(t=e,e=b.ajaxSettings),Ar(e,t),e},ajaxSettings:{url:R,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(D[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Pr},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":y.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Ir(wr),ajaxTransport:Ir(Tr),ajax:function(e,t){"object"==typeof e&&(t=e,e=_);var c,p,r,h,u,i,d=b.ajaxSetup({},t=t||{}),f=d.context||d,g=f!==d&&(f.nodeType||f instanceof b)?b(f):b.event,m=b.Deferred(),y=b.Callbacks("once memory"),v=d.statusCode||{},n={},o={},C=0,s="canceled",S={readyState:0,setRequestHeader:function(e,t){var r;return C||(r=e.toLowerCase(),e=o[r]=o[r]||e,n[e]=t),this},getAllResponseHeaders:function(){return 2===C?p:null},getResponseHeader:function(e){var t;if(2===C){if(!r)for(r={};t=yr.exec(p);)r[t[1].toLowerCase()]=t[2];t=r[e.toLowerCase()]}return t===_?null:t},overrideMimeType:function(e){return C||(d.mimeType=e),this},abort:function(e){return e=e||s,h&&h.abort(e),a(0,e),this}};function a(e,t,r,i){var n,o,s,a,l=t;2!==C&&(C=2,u&&clearTimeout(u),h=_,p=i||"",S.readyState=0<e?4:0,r&&(a=((e,t,r)=>{var i,n,o,s,a=e.contents,l=e.dataTypes,c=e.responseFields;for(n in c)n in r&&(t[c[n]]=r[n]);for(;"*"===l[0];)l.shift(),i===_&&(i=e.mimeType||t.getResponseHeader("content-type"));if(i)for(n in a)if(a[n]&&a[n].test(i)){l.unshift(n);break}if(l[0]in r)o=l[0];else{for(n in r){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}s=s||n}o=o||s}if(o)return o!==l[0]&&l.unshift(o),r[o]})(d,S,r)),200<=e&&e<300||304===e?(d.ifModified&&((i=S.getResponseHeader("Last-Modified"))&&(b.lastModified[c]=i),i=S.getResponseHeader("Etag"))&&(b.etag[c]=i),n=304===e?(l="notmodified",!0):(l=(n=((e,t)=>{var r,i,n,o,s=e.dataTypes.slice(),a=s[0],l={},c=0;if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),s[1])for(r in e.converters)l[r.toLowerCase()]=e.converters[r];for(;n=s[++c];)if("*"!==n){if("*"!==a&&a!==n){if(!(r=l[a+" "+n]||l["* "+n]))for(i in l)if((o=i.split(" "))[1]===n&&(r=l[a+" "+o[0]]||l["* "+o[0]])){!0===r?r=l[i]:!0!==l[i]&&(n=o[0],s.splice(c--,0,n));break}if(!0!==r)if(r&&e.throws)t=r(t);else try{t=r(t)}catch(e){return{state:"parsererror",error:r?e:"No conversion from "+a+" to "+n}}}a=n}return{state:"success",data:t}})(d,a)).state,o=n.data,!(s=n.error))):(s=l)&&!e||(l="error",e<0&&(e=0)),S.status=e,S.statusText=""+(t||l),n?m.resolveWith(f,[o,l,S]):m.rejectWith(f,[S,l,s]),S.statusCode(v),v=_,k&&g.trigger("ajax"+(n?"Success":"Error"),[S,d,n?o:s]),y.fireWith(f,[S,l]),k)&&(g.trigger("ajaxComplete",[S,d]),--b.active||b.event.trigger("ajaxStop"))}if(m.promise(S),S.success=S.done,S.error=S.fail,S.complete=y.add,S.statusCode=function(e){if(e)if(C<2)for(var t in e)v[t]=[v[t],e[t]];else t=e[S.status],S.always(t);return this},d.url=((e||d.url)+"").replace(mr,"").replace(Cr,D[1]+"//"),d.dataTypes=b.trim(d.dataType||"*").toLowerCase().split(E),null==d.crossDomain&&(e=br.exec(d.url.toLowerCase()),d.crossDomain=!(!e||e[1]==D[1]&&e[2]==D[2]&&(e[3]||("http:"===e[1]?80:443))==(D[3]||("http:"===D[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=b.param(d.data,d.traditional)),Lr(wr,d,t,S),2!==C){var l,k=d.global;for(i in d.type=d.type.toUpperCase(),d.hasContent=!vr.test(d.type),k&&0==b.active++&&b.event.trigger("ajaxStart"),d.hasContent||(d.data&&(d.url+=(Sr.test(d.url)?"&":"?")+d.data,delete d.data),c=d.url,!1===d.cache&&(e=b.now(),l=d.url.replace(_r,"$1_="+e),d.url=l+(l===d.url?(Sr.test(d.url)?"&":"?")+"_="+e:""))),(d.data&&d.hasContent&&!1!==d.contentType||t.contentType)&&S.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(c=c||d.url,b.lastModified[c]&&S.setRequestHeader("If-Modified-Since",b.lastModified[c]),b.etag[c])&&S.setRequestHeader("If-None-Match",b.etag[c]),S.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Pr+"; q=0.01":""):d.accepts["*"]),d.headers)S.setRequestHeader(i,d.headers[i]);if(d.beforeSend&&(!1===d.beforeSend.call(f,S,d)||2===C))return S.abort();for(i in s="abort",{success:1,error:1,complete:1})S[i](d[i]);if(h=Lr(Tr,d,t,S)){S.readyState=1,k&&g.trigger("ajaxSend",[S,d]),d.async&&0<d.timeout&&(u=setTimeout(function(){S.abort("timeout")},d.timeout));try{C=1,h.send(n,a)}catch(e){if(!(C<2))throw e;a(-1,e)}}else a(-1,"No Transport")}return S},active:0,lastModified:{},etag:{}});var xr=[],Rr=/\?/,Dr=/(=)\?(?=&|$)|\?\?/,Or=b.now();b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=xr.pop()||b.expando+"_"+Or++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(e,t,r){var i,n,o,s=e.data,a=e.url,l=!1!==e.jsonp,c=l&&Dr.test(a),p=l&&!c&&"string"==typeof s&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dr.test(s);if("jsonp"===e.dataTypes[0]||c||p)return i=e.jsonpCallback=b.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,n=y[i],c?e.url=a.replace(Dr,"$1"+i):p?e.data=s.replace(Dr,"$1"+i):l&&(e.url+=(Rr.test(a)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||b.error(i+" was not called"),o[0]},e.dataTypes[0]="json",y[i]=function(){o=arguments},r.always(function(){y[i]=n,e[i]&&(e.jsonpCallback=t.jsonpCallback,xr.push(i)),o&&b.isFunction(n)&&n(o[0]),o=n=_}),"script"}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===_&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(t){var i,n;if(t.crossDomain)return n=v.head||v.getElementsByTagName("head")[0]||v.documentElement,{send:function(e,r){(i=v.createElement("script")).async="async",t.scriptCharset&&(i.charset=t.scriptCharset),i.src=t.url,i.onload=i.onreadystatechange=function(e,t){!t&&i.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=_,t)||r(200,"success")},n.insertBefore(i,n.firstChild)},abort:function(){i&&i.onload(0,1)}}});var O,Fr=!!y.ActiveXObject&&function(){for(var e in O)O[e](0,1)},Nr=0;function Mr(){try{return new y.XMLHttpRequest}catch(e){}}b.ajaxSettings.xhr=y.ActiveXObject?function(){return!this.isLocal&&Mr()||(()=>{try{return new y.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}})()}:Mr,s=b.ajaxSettings.xhr(),b.extend(b.support,{ajax:!!s,cors:!!s&&"withCredentials"in s}),b.support.ajax&&b.ajaxTransport(function(p){var h;if(!p.crossDomain||b.support.cors)return{send:function(e,a){var l,t,c=p.xhr();if(p.username?c.open(p.type,p.url,p.async,p.username,p.password):c.open(p.type,p.url,p.async),p.xhrFields)for(t in p.xhrFields)c[t]=p.xhrFields[t];p.mimeType&&c.overrideMimeType&&c.overrideMimeType(p.mimeType),p.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(t in e)c.setRequestHeader(t,e[t])}catch(e){}c.send(p.hasContent&&p.data||null),h=function(e,t){var r,i,n,o,s;try{if(h&&(t||4===c.readyState))if(h=_,l&&(c.onreadystatechange=b.noop,Fr)&&delete O[l],t)4!==c.readyState&&c.abort();else{r=c.status,n=c.getAllResponseHeaders(),o={},(s=c.responseXML)&&s.documentElement&&(o.xml=s);try{o.text=c.responseText}catch(e){}try{i=c.statusText}catch(e){i=""}r||!p.isLocal||p.crossDomain?1223===r&&(r=204):r=o.text?200:404}}catch(e){t||a(-1,e)}o&&a(r,i,o,n)},p.async?4===c.readyState?setTimeout(h,0):(l=++Nr,Fr&&(O||(O={},b(y).unload(Fr)),O[l]=h),c.onreadystatechange=h):h()},abort:function(){h&&h(0,1)}}});var Ur,zr,Br=/^(?:toggle|show|hide)$/,Hr=new RegExp("^(?:([-+])=|)("+Z+")([a-z%]*)$","i"),Wr=/queueHooks$/,$r=[function(t,e,r){var i,n,o,s,a,l,c,p,h=this,u=t.style,d={},f=[],g=t.nodeType&&or(t);r.queue||(null==(c=b._queueHooks(t,"fx")).unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,h.always(function(){h.always(function(){c.unqueued--,b.queue(t,"fx").length||c.empty.fire()})}));1===t.nodeType&&("height"in e||"width"in e)&&(r.overflow=[u.overflow,u.overflowX,u.overflowY],"inline"===b.css(t,"display"))&&"none"===b.css(t,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==pr(t.nodeName)?u.zoom=1:u.display="inline-block");r.overflow&&(u.overflow="hidden",b.support.shrinkWrapBlocks||h.done(function(){u.overflow=r.overflow[0],u.overflowX=r.overflow[1],u.overflowY=r.overflow[2]}));for(i in e)o=e[i],Br.exec(o)&&(delete e[i],o!==(g?"hide":"show"))&&f.push(i);if(s=f.length)for(a=b._data(t,"fxshow")||b._data(t,"fxshow",{}),g?b(t).show():h.done(function(){b(t).hide()}),h.done(function(){for(var e in b.removeData(t,"fxshow",!0),d)b.style(t,e,d[e])}),i=0;i<s;i++)n=f[i],l=h.createTween(n,g?a[n]:0),d[n]=a[n]||b.style(t,n),n in a||(a[n]=l.start,g&&(l.end=l.start,l.start="width"===n||"height"===n?1:0))}],Gr={"*":[function(e,t){var r,i,n,o=this.createTween(e,t),t=Hr.exec(t),s=o.cur(),a=+s||0,l=1;if(t){if(r=+t[2],"px"!==(i=t[3]||(b.cssNumber[e]?"":"px"))&&a)for(a=b.css(o.elem,e,!0)||r||1;n=l=l||".5",b.style(o.elem,e,(a/=l)+i),1!==(l=o.cur()/s)&&l!==n;);o.unit=i,o.start=a,o.end=t[1]?a+(t[1]+1)*r:r}return o}]};function jr(){return setTimeout(function(){Ur=_},0),Ur=b.now()}function qr(n,e,t){var r,i,o,s,a,l,c,p=0,h=$r.length,u=b.Deferred().always(function(){delete d.elem}),d=function(){for(var e=Ur||jr(),e=Math.max(0,f.startTime+f.duration-e),t=1-(e/f.duration||0),r=0,i=f.tweens.length;r<i;r++)f.tweens[r].run(t);return u.notifyWith(n,[f,t,e]),t<1&&i?e:(u.resolveWith(n,[f]),!1)},f=u.promise({elem:n,props:b.extend({},e),opts:b.extend(!0,{specialEasing:{}},t),originalProperties:e,originalOptions:t,startTime:Ur||jr(),duration:t.duration,tweens:[],createTween:function(e,t,r){t=b.Tween(n,f.opts,e,t,f.opts.specialEasing[e]||f.opts.easing);return f.tweens.push(t),t},stop:function(e){for(var t=0,r=e?f.tweens.length:0;t<r;t++)f.tweens[t].run(1);return e?u.resolveWith(n,[f,e]):u.rejectWith(n,[f,e]),this}}),g=f.props,m=g,y=f.opts.specialEasing;for(i in m)if(o=b.camelCase(i),s=y[o],a=m[i],b.isArray(a)&&(s=a[1],a=m[i]=a[0]),i!==o&&(m[o]=a,delete m[i]),(l=b.cssHooks[o])&&"expand"in l)for(i in a=l.expand(a),delete m[o],a)i in m||(m[i]=a[i],y[i]=s);else y[o]=s;for(;p<h;p++)if(r=$r[p].call(f,n,g,f.opts))return r;return c=f,b.each(g,function(e,t){for(var r=(Gr[e]||[]).concat(Gr["*"]),i=0,n=r.length;i<n;i++)if(r[i].call(c,e,t))return}),b.isFunction(f.opts.start)&&f.opts.start.call(n,f),b.fx.timer(b.extend(d,{anim:f,queue:f.opts.queue,elem:n})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function F(e,t,r,i,n){return new F.prototype.init(e,t,r,i,n)}function Kr(e,t){for(var r,i={height:e},n=0;n<4;n+=2-t)i["margin"+(r=x[n])]=i["padding"+r]=e;return t&&(i.opacity=i.width=e),i}b.Animation=b.extend(qr,{tweener:function(e,t){for(var r,i=0,n=(e=b.isFunction(e)?(t=e,["*"]):e.split(" ")).length;i<n;i++)r=e[i],Gr[r]=Gr[r]||[],Gr[r].unshift(t)},prefilter:function(e,t){t?$r.unshift(e):$r.push(e)}}),((b.Tween=F).prototype={constructor:F,init:function(e,t,r,i,n,o){this.elem=e,this.prop=r,this.easing=n||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(b.cssNumber[r]?"":"px")},cur:function(){var e=F.propHooks[this.prop];return(e&&e.get?e:F.propHooks._default).get(this)},run:function(e){var t=F.propHooks[this.prop];return this.pos=e=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration),this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(t&&t.set?t:F.propHooks._default).set(this),this}}).init.prototype=F.prototype,(F.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,!1,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}}).scrollTop=F.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(i,n){var o=b.fn[n];b.fn[n]=function(e,t,r){return null==e||"boolean"==typeof e||!i&&b.isFunction(e)&&b.isFunction(t)?o.apply(this,arguments):this.animate(Kr(n,!0),e,t,r)}}),b.fn.extend({fadeTo:function(e,t,r,i){return this.filter(or).css("opacity",0).show().end().animate({opacity:t},e,r,i)},animate:function(t,e,r,i){function n(){var e=qr(this,b.extend({},t),s);o&&e.stop(!0)}var o=b.isEmptyObject(t),s=b.speed(e,r,i);return o||!1===s.queue?this.each(n):this.queue(s.queue,n)},stop:function(n,e,o){function s(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof n&&(o=e,e=n,n=_),e&&!1!==n&&this.queue(n||"fx",[]),this.each(function(){var e=!0,t=null!=n&&n+"queueHooks",r=b.timers,i=b._data(this);if(t)i[t]&&i[t].stop&&s(i[t]);else for(t in i)i[t]&&i[t].stop&&Wr.test(t)&&s(i[t]);for(t=r.length;t--;)r[t].elem!==this||null!=n&&r[t].queue!==n||(r[t].anim.stop(o),e=!1,r.splice(t,1));!e&&o||b.dequeue(this,n)})}}),b.each({slideDown:Kr("show"),slideUp:Kr("hide"),slideToggle:Kr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,i){b.fn[e]=function(e,t,r){return this.animate(i,e,t,r)}}),b.speed=function(e,t,r){var i=e&&"object"==typeof e?b.extend({},e):{complete:r||!r&&t||b.isFunction(e)&&e,duration:e,easing:r&&t||t&&!b.isFunction(t)&&t};return i.duration=b.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in b.fx.speeds?b.fx.speeds[i.duration]:b.fx.speeds._default,null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){b.isFunction(i.old)&&i.old.call(this),i.queue&&b.dequeue(this,i.queue)},i},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=F.prototype.init,b.fx.tick=function(){for(var e,t=b.timers,r=0;r<t.length;r++)(e=t[r])()||t[r]!==e||t.splice(r--,1);t.length||b.fx.stop()},b.fx.timer=function(e){e()&&b.timers.push(e)&&!zr&&(zr=setInterval(b.fx.tick,b.fx.interval))},b.fx.interval=13,b.fx.stop=function(){clearInterval(zr),zr=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(t){return b.grep(b.timers,function(e){return t===e.elem}).length});var Vr=/^(?:body|html)$/i;function Zr(e){return b.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}b.fn.offset=function(t){var e,r,i,n,o,s;return arguments.length?t===_?this:this.each(function(e){b.offset.setOffset(this,t,e)}):(s=(o=this[0])&&o.ownerDocument)?(i=s.body)===o?b.offset.bodyOffset(o):b.contains(e=s.documentElement,o)?(o=o.getBoundingClientRect(),s=Zr(s),r=e.clientTop||i.clientTop||0,i=e.clientLeft||i.clientLeft||0,n=s.pageYOffset||e.scrollTop,s=s.pageXOffset||e.scrollLeft,{top:o.top+n-r,left:o.left+s-i}):{top:0,left:0}:void 0},b.offset={bodyOffset:function(e){var t=e.offsetTop,r=e.offsetLeft;return b.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(b.css(e,"marginTop"))||0,r+=parseFloat(b.css(e,"marginLeft"))||0),{top:t,left:r}},setOffset:function(e,t,r){var i,n=b.css(e,"position"),o=("static"===n&&(e.style.position="relative"),b(e)),s=o.offset(),a=b.css(e,"top"),l=b.css(e,"left"),c={},n=("absolute"===n||"fixed"===n)&&-1<b.inArray("auto",[a,l])?(i=(n=o.position()).top,n.left):(i=parseFloat(a)||0,parseFloat(l)||0);null!=(t=b.isFunction(t)?t.call(e,r,s):t).top&&(c.top=t.top-s.top+i),null!=t.left&&(c.left=t.left-s.left+n),"using"in t?t.using.call(e,c):o.css(c)}},b.fn.extend({position:function(){var e,t,r,i;if(this[0])return e=this[0],t=this.offsetParent(),r=this.offset(),i=Vr.test(t[0].nodeName)?{top:0,left:0}:t.offset(),r.top-=parseFloat(b.css(e,"marginTop"))||0,r.left-=parseFloat(b.css(e,"marginLeft"))||0,i.top+=parseFloat(b.css(t[0],"borderTopWidth"))||0,i.left+=parseFloat(b.css(t[0],"borderLeftWidth"))||0,{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||v.body;e&&!Vr.test(e.nodeName)&&"static"===b.css(e,"position");)e=e.offsetParent;return e||v.body})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var o=/Y/.test(n);b.fn[t]=function(e){return b.access(this,function(e,t,r){var i=Zr(e);if(r===_)return i?n in i?i[n]:i.document.documentElement[t]:e[t];i?i.scrollTo(o?b(i).scrollLeft():r,o?r:b(i).scrollTop()):e[t]=r},t,e,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(o,s){b.each({padding:"inner"+o,content:s,"":"outer"+o},function(i,e){b.fn[e]=function(e,t){var r=arguments.length&&(i||"boolean"!=typeof e),n=i||(!0===e||!0===t?"margin":"border");return b.access(this,function(e,t,r){var i;return b.isWindow(e)?e.document.documentElement["client"+o]:9===e.nodeType?(i=e.documentElement,Math.max(e.body["scroll"+o],i["scroll"+o],e.body["offset"+o],i["offset"+o],i["client"+o])):r===_?b.css(e,t,r,n):b.style(e,t,r,n)},s,r?e:_,r)}})}),y.jQuery=y.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window),(a=>{var e,t,r=0,i=/^ui-id-\d+$/;function n(e,t){var r,i,n,o=e.nodeName.toLowerCase();return"area"===o?(i=(r=e.parentNode).name,!(!e.href||!i||"map"!==r.nodeName.toLowerCase()||!(n=a("img[usemap=#"+i+"]")[0]))&&s(n)):(/input|select|textarea|button|object/.test(o)?!e.disabled:"a"===o&&e.href||t)&&s(e)}function s(e){return a.expr.filters.visible(e)&&!a(e).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:(e=a.fn.focus,function(t,r){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){a(e).focus(),r&&r.call(e)},t)}):e.apply(this,arguments)}),scrollParent:function(){var e=(a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))})).eq(0);return/fixed/.test(this.css("position"))||!e.length?a(document):e},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var t,r=a(this[0]);r.length&&r[0]!==document;){if(("absolute"===(t=r.css("position"))||"relative"===t||"fixed"===t)&&(t=parseInt(r.css("zIndex"),10),!isNaN(t))&&0!==t)return t;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){i.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(t){return function(e){return!!a.data(e,t)}}):function(e,t,r){return!!a.data(e,r[3])},focusable:function(e){return n(e,!isNaN(a.attr(e,"tabindex")))},tabbable:function(e){var t=a.attr(e,"tabindex"),r=isNaN(t);return(r||0<=t)&&n(e,!r)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(e,r){var n="Width"===r?["Left","Right"]:["Top","Bottom"],i=r.toLowerCase(),o={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};function s(e,t,r,i){return a.each(n,function(){t-=parseFloat(a.css(e,"padding"+this))||0,r&&(t-=parseFloat(a.css(e,"border"+this+"Width"))||0),i&&(t-=parseFloat(a.css(e,"margin"+this))||0)}),t}a.fn["inner"+r]=function(e){return void 0===e?o["inner"+r].call(this):this.each(function(){a(this).css(i,s(this,e)+"px")})},a.fn["outer"+r]=function(e,t){return"number"!=typeof e?o["outer"+r].call(this,e):this.each(function(){a(this).css(i,s(this,e,!0,t)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=(t=a.fn.removeData,function(e){return arguments.length?t.call(this,a.camelCase(e)):t.call(this)})),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(e,t,r){var i,n=a.ui[e].prototype;for(i in r)n.plugins[i]=n.plugins[i]||[],n.plugins[i].push([t,r[i]])},call:function(e,t,r){var i,n=e.plugins[t];if(n&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;i<n.length;i++)e.options[n[i][0]]&&n[i][1].apply(e.element,r)}},hasScroll:function(e,t){var r;return"hidden"!==a(e).css("overflow")&&(r=!1,0<e[t=t&&"left"===t?"scrollLeft":"scrollTop"]||(e[t]=1,r=0<e[t],e[t]=0,r))}})})(jQuery),((c,a)=>{var r=0,l=Array.prototype.slice,i=c.cleanData;c.cleanData=function(e){for(var t,r=0;null!=(t=e[r]);r++)try{c(t).triggerHandler("remove")}catch(e){}i(e)},c.widget=function(e,r,t){var i,n,o,s,a={},l=e.split(".")[0];e=e.split(".")[1],i=l+"-"+e,t||(t=r,r=c.Widget),c.expr[":"][i.toLowerCase()]=function(e){return!!c.data(e,i)},c[l]=c[l]||{},n=c[l][e],o=c[l][e]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},c.extend(o,n,{version:t.version,_proto:c.extend({},t),_childConstructors:[]}),(s=new r).options=c.widget.extend({},s.options),c.each(t,function(t,i){function n(){return r.prototype[t].apply(this,arguments)}function o(e){return r.prototype[t].apply(this,e)}c.isFunction(i)?a[t]=function(){var e,t=this._super,r=this._superApply;return this._super=n,this._superApply=o,e=i.apply(this,arguments),this._super=t,this._superApply=r,e}:a[t]=i}),o.prototype=c.widget.extend(s,{widgetEventPrefix:n?s.widgetEventPrefix:e},a,{constructor:o,namespace:l,widgetName:e,widgetFullName:i}),n?(c.each(n._childConstructors,function(e,t){var r=t.prototype;c.widget(r.namespace+"."+r.widgetName,o,t._proto)}),delete n._childConstructors):r._childConstructors.push(o),c.widget.bridge(e,o)},c.widget.extend=function(e){for(var t,r,i=l.call(arguments,1),n=0,o=i.length;n<o;n++)for(t in i[n])r=i[n][t],i[n].hasOwnProperty(t)&&r!==a&&(c.isPlainObject(r)?e[t]=c.isPlainObject(e[t])?c.widget.extend({},e[t],r):c.widget.extend({},r):e[t]=r);return e},c.widget.bridge=function(o,t){var s=t.prototype.widgetFullName||o;c.fn[o]=function(r){var e="string"==typeof r,i=l.call(arguments,1),n=this;return r=!e&&i.length?c.widget.extend.apply(null,[r].concat(i)):r,e?this.each(function(){var e,t=c.data(this,s);return t?c.isFunction(t[r])&&"_"!==r.charAt(0)?(e=t[r].apply(t,i))!==t&&e!==a?(n=e&&e.jquery?n.pushStack(e.get()):e,!1):void 0:c.error("no such method '"+r+"' for "+o+" widget instance"):c.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+r+"'")}):this.each(function(){var e=c.data(this,s);e?e.option(r||{})._init():c.data(this,s,new t(r,this))}),n}},c.Widget=function(){},c.Widget._childConstructors=[],c.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=c(t||this.defaultElement||this)[0],this.element=c(t),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=c.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=c(),this.hoverable=c(),this.focusable=c(),t!==this&&(c.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=c(t.style?t.ownerDocument:t.document||t),this.window=c(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:c.noop,_getCreateEventData:c.noop,_create:c.noop,_init:c.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(c.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:c.noop,widget:function(){return this.element},option:function(e,t){var r,i,n,o=e;if(0===arguments.length)return c.widget.extend({},this.options);if("string"==typeof e)if(o={},e=(r=e.split(".")).shift(),r.length){for(i=o[e]=c.widget.extend({},this.options[e]),n=0;n<r.length-1;n++)i[r[n]]=i[r[n]]||{},i=i[r[n]];if(e=r.pop(),t===a)return i[e]===a?null:i[e];i[e]=t}else{if(t===a)return this.options[e]===a?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,o,e){var s,a=this;"boolean"!=typeof n&&(e=o,o=n,n=!1),e?(o=s=c(o),this.bindings=this.bindings.add(o)):(e=o,o=this.element,s=this.widget()),c.each(e,function(e,t){function r(){if(n||!0!==a.options.disabled&&!c(this).hasClass("ui-state-disabled"))return("string"==typeof t?a[t]:t).apply(a,arguments)}"string"!=typeof t&&(r.guid=t.guid=t.guid||r.guid||c.guid++);var e=e.match(/^(\w+)\s*(.*)$/),i=e[1]+a.eventNamespace,e=e[2];e?s.delegate(e,i,r):o.bind(i,r)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){var r=this;return setTimeout(function(){return("string"==typeof e?r[e]:e).apply(r,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){c(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){c(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){c(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){c(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,r){var i,n,o=this.options[e];if(r=r||{},(t=c.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],n=t.originalEvent)for(i in n)i in t||(t[i]=n[i]);return this.element.trigger(t,r),!(c.isFunction(o)&&!1===o.apply(this.element[0],[t].concat(r))||t.isDefaultPrevented())}},c.each({show:"fadeIn",hide:"fadeOut"},function(o,s){c.Widget.prototype["_"+o]=function(t,e,r){var i=(e="string"==typeof e?{effect:e}:e)?!0!==e&&"number"!=typeof e&&e.effect||s:o,n=!c.isEmptyObject(e="number"==typeof(e=e||{})?{duration:e}:e);e.complete=r,e.delay&&t.delay(e.delay),n&&c.effects&&c.effects.effect[i]?t[o](e):i!==o&&t[i]?t[i](e.duration,e.easing,r):t.queue(function(e){c(this)[o](),r&&r.call(t[0]),e()})}})})(jQuery),(n=>{var o=!1;n(document).mouseup(function(){o=!1}),n.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(!0===n.data(e.target,t.widgetName+".preventClickEvent"))return n.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){var t,r,i;if(!o)return this._mouseStarted&&this._mouseUp(e),r=1===(this._mouseDownEvent=e).which,i=!("string"!=typeof(t=this).options.cancel||!e.target.nodeName)&&n(e.target).closest(this.options.cancel).length,r&&!i&&this._mouseCapture(e)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?e.preventDefault():(!0===n.data(e.target,this.widgetName+".preventClickEvent")&&n.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},n(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),o=!0)),!0},_mouseMove:function(e){return n.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&n.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery),(d=>{function f(e,t,r){return t<e&&e<t+r}function g(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}d.widget("ui.sortable",d.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||g(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;0<=e;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,t){"disabled"===e?(this.options[e]=t,this.widget().toggleClass("ui-sortable-disabled",!!t)):d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,t){var r=null,i=!1,n=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(e),d(e.target).parents().each(function(){if(d.data(this,n.widgetName+"-item")===n)return r=d(this),!1}),!(r=d.data(e.target,n.widgetName+"-item")===n?d(e.target):r))||(this.options.handle&&!t&&(d(this.options.handle,r).find("*").addBack().each(function(){this===e.target&&(i=!0)}),!i)||(this.currentItem=r,this._removeCurrentsFromItems(),0)))},_mouseStart:function(e,t,r){var i,n,o=this.options;if((this.currentContainer=this).refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},d.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",o.cursor),this.storedStylesheet=d("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(n)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;0<=i;i--)this.containers[i]._trigger("activate",e,this._uiHash(this));return d.ui.ddmanager&&(d.ui.ddmanager.current=this),d.ui.ddmanager&&!o.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var t,r,i,n,o=this.options,s=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+o.scrollSpeed:e.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+o.scrollSpeed:e.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(e.pageY-d(document).scrollTop()<o.scrollSensitivity?s=d(document).scrollTop(d(document).scrollTop()-o.scrollSpeed):d(window).height()-(e.pageY-d(document).scrollTop())<o.scrollSensitivity&&(s=d(document).scrollTop(d(document).scrollTop()+o.scrollSpeed)),e.pageX-d(document).scrollLeft()<o.scrollSensitivity?s=d(document).scrollLeft(d(document).scrollLeft()-o.scrollSpeed):d(window).width()-(e.pageX-d(document).scrollLeft())<o.scrollSensitivity&&(s=d(document).scrollLeft(d(document).scrollLeft()+o.scrollSpeed))),!1!==s)&&d.ui.ddmanager&&!o.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,e),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t=this.items.length-1;0<=t;t--)if(i=(r=this.items[t]).item[0],(n=this._intersectsWithPointer(r))&&r.instance===this.currentContainer&&!(i===this.currentItem[0]||this.placeholder[1===n?"next":"prev"]()[0]===i||d.contains(this.placeholder[0],i)||"semi-dynamic"===this.options.type&&d.contains(this.element[0],i))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(e,r),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),d.ui.ddmanager&&d.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){var r,i,n,o;if(e)return d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,e),this.options.revert?(i=(r=this).placeholder.offset(),o={},(n=this.options.axis)&&"x"!==n||(o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,d(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(e)})):this._clear(e,t),!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),d.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},d(e).each(function(){var e=(d(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);e&&r.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},t.each(function(){r.push(d(e.item||this).attr(e.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,r=t+this.helperProportions.width,i=this.positionAbs.top,n=i+this.helperProportions.height,o=e.left,s=o+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,p=this.offset.click.left,c="x"===this.options.axis||a<i+c&&i+c<l,p="y"===this.options.axis||o<t+p&&t+p<s;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c&&p:o<t+this.helperProportions.width/2&&r-this.helperProportions.width/2<s&&a<i+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||f(this.positionAbs.top+this.offset.click.top,e.top,e.height),e="y"===this.options.axis||f(this.positionAbs.left+this.offset.click.left,e.left,e.width),t=t&&e,e=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return!!t&&(this.floating?r&&"right"===r||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(e){var t=f(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),e=f(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?"right"===i&&e||"left"===i&&!e:r&&("down"===r&&t||"up"===r&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(0<e?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(0<e?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t,r,i,n,o=[],s=[],a=this._connectWith();if(a&&e)for(t=a.length-1;0<=t;t--)for(r=(i=d(a[t])).length-1;0<=r;r--)(n=d.data(i[r],this.widgetFullName))&&n!==this&&!n.options.disabled&&s.push([d.isFunction(n.options.items)?n.options.items.call(n.element):d(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n]);for(s.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),t=s.length-1;0<=t;t--)s[t][0].each(function(){o.push(this)});return d(o)},_removeCurrentsFromItems:function(){var r=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=d.grep(this.items,function(e){for(var t=0;t<r.length;t++)if(r[t]===e.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var t,r,i,n,o,s,a,l,c=this.items,p=[[d.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):d(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(t=h.length-1;0<=t;t--)for(r=(i=d(h[t])).length-1;0<=r;r--)(n=d.data(i[r],this.widgetFullName))&&n!==this&&!n.options.disabled&&(p.push([d.isFunction(n.options.items)?n.options.items.call(n.element[0],e,{item:this.currentItem}):d(n.options.items,n.element),n]),this.containers.push(n));for(t=p.length-1;0<=t;t--)for(o=p[t][1],l=(s=p[t][r=0]).length;r<l;r++)(a=d(s[r])).data(this.widgetName+"-item",o),c.push({item:a,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var t,r,i,n;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),t=this.items.length-1;0<=t;t--)(r=this.items[t]).instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?d(this.options.toleranceElement,r.item):r.item,e||(r.width=i.outerWidth(),r.height=i.outerHeight()),n=i.offset(),r.left=n.left,r.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(t=this.containers.length-1;0<=t;t--)n=this.containers[t].element.offset(),this.containers[t].containerCache.left=n.left,this.containers[t].containerCache.top=n.top,this.containers[t].containerCache.width=this.containers[t].element.outerWidth(),this.containers[t].containerCache.height=this.containers[t].element.outerHeight();return this},_createPlaceholder:function(r){var i,n=(r=r||this).options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var e=r.currentItem[0].nodeName.toLowerCase(),t=d("<"+e+">",r.document[0]).addClass(i||r.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===e?r.currentItem.children().each(function(){d("<td>&#160;</td>",r.document[0]).attr("colspan",d(this).attr("colspan")||1).appendTo(t)}):"img"===e&&t.attr("src",r.currentItem.attr("src")),i||t.css("visibility","hidden"),t},update:function(e,t){i&&!n.forcePlaceholderSize||(t.height()||t.height(r.currentItem.innerHeight()-parseInt(r.currentItem.css("paddingTop")||0,10)-parseInt(r.currentItem.css("paddingBottom")||0,10)),t.width())||t.width(r.currentItem.innerWidth()-parseInt(r.currentItem.css("paddingLeft")||0,10)-parseInt(r.currentItem.css("paddingRight")||0,10))}}),r.placeholder=d(n.placeholder.element.call(r.element,r.currentItem)),r.currentItem.after(r.placeholder),n.placeholder.update(r,r.placeholder)},_contactContainers:function(e){for(var t,r,i,n,o,s,a,l,c,p=null,h=null,u=this.containers.length-1;0<=u;u--)d.contains(this.currentItem[0],this.containers[u].element[0])||(this._intersectsWith(this.containers[u].containerCache)?p&&d.contains(this.containers[u].element[0],p.element[0])||(p=this.containers[u],h=u):this.containers[u].containerCache.over&&(this.containers[u]._trigger("out",e,this._uiHash(this)),this.containers[u].containerCache.over=0));if(p)if(1===this.containers.length)this.containers[h].containerCache.over||(this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1);else{for(r=1e4,i=null,o=(c=p.floating||g(this.currentItem))?"width":"height",s=this.positionAbs[n=c?"left":"top"]+this.offset.click[n],t=this.items.length-1;0<=t;t--)!d.contains(this.containers[h].element[0],this.items[t].item[0])||this.items[t].item[0]===this.currentItem[0]||c&&!f(this.positionAbs.top+this.offset.click.top,this.items[t].top,this.items[t].height)||(a=this.items[t].item.offset()[n],l=!1,Math.abs(a-s)>Math.abs(a+this.items[t][o]-s)&&(l=!0,a+=this.items[t][o]),Math.abs(a-s)<r&&(r=Math.abs(a-s),i=this.items[t],this.direction=l?"up":"down"));(i||this.options.dropOnEmpty)&&this.currentContainer!==this.containers[h]&&(i?this._rearrange(e,i,null,!0):this._rearrange(e,null,this.containers[h].element,!0),this._trigger("change",e,this._uiHash()),this.containers[h]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[h],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1)}},_createHelper:function(e){var t=this.options,e=d.isFunction(t.helper)?d(t.helper.apply(this.element[0],[e,this.currentItem])):"clone"===t.helper?this.currentItem.clone():this.currentItem;return e.parents("body").length||d("parent"!==t.appendTo?t.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),e[0].style.width&&!t.forceHelperSize||e.width(this.currentItem.width()),e[0].style.height&&!t.forceHelperSize||e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=d.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&d.ui.ie?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){var e;return"relative"===this.cssPosition?{top:(e=this.currentItem.position()).top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}:{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),"document"!==r.containment&&"window"!==r.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(d("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(e=d(r.containment)[0],r=d(r.containment).offset(),t="hidden"!==d(e).css("overflow"),this.containment=[r.left+(parseInt(d(e).css("borderLeftWidth"),10)||0)+(parseInt(d(e).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(d(e).css("borderTopWidth"),10)||0)+(parseInt(d(e).css("paddingTop"),10)||0)-this.margins.top,r.left+(t?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(d(e).css("borderLeftWidth"),10)||0)-(parseInt(d(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(t?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(d(e).css("borderTopWidth"),10)||0)-(parseInt(d(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,t){t=t||this.position;var e="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);return{top:t.top+this.offset.relative.top*e+this.offset.parent.top*e-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:r.scrollTop())*e,left:t.left+this.offset.relative.left*e+this.offset.parent.left*e-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())*e}},_generatePosition:function(e){var t=this.options,r=e.pageX,i=e.pageY,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&d.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(i=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3])&&(i=this.containment[3]+this.offset.click.top),t.grid)&&(e=this.originalPageY+Math.round((i-this.originalPageY)/t.grid[1])*t.grid[1],i=!this.containment||e-this.offset.click.top>=this.containment[1]&&e-this.offset.click.top<=this.containment[3]?e:e-this.offset.click.top>=this.containment[1]?e-t.grid[1]:e+t.grid[1],e=this.originalPageX+Math.round((r-this.originalPageX)/t.grid[0])*t.grid[0],r=!this.containment||e-this.offset.click.left>=this.containment[0]&&e-this.offset.click.left<=this.containment[2]?e:e-this.offset.click.left>=this.containment[0]?e-t.grid[0]:e+t.grid[0]),{top:i-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())}},_rearrange:function(e,t,r,i){r?r[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!i)})},_clear:function(e,t){this.reverting=!1;var r,i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)"auto"!==this._storedCSS[r]&&"static"!==this._storedCSS[r]||(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&i.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||i.push(function(e){this._trigger("update",e,this._uiHash())}),this===this.currentContainer||t||(i.push(function(e){this._trigger("remove",e,this._uiHash())}),i.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))),r=this.containers.length-1;0<=r;r--)t||i.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),r=0;r<i.length;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(r=0;r<i.length;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return!(this.fromOutside=!1)},_trigger:function(){!1===d.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||d([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}})})(jQuery),(e=>{var t=e({});e.subscribe=function(){t.on.apply(t,arguments)},e.unsubscribe=function(){t.off.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}})(jQuery),(i=>{function n(e,t){this.init("tooltip",e,t)}n.prototype={constructor:n,init:function(e,t,r){this.type=e,this.$element=i(t),this.options=this.getOptions(r),this.enabled=!0,"click"==this.options.trigger?this.$element.on("click."+this.type,this.options.selector,i.proxy(this.toggle,this)):"manual"!=this.options.trigger&&(e="hover"==this.options.trigger?"mouseenter":"focus",t="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(e+"."+this.type,this.options.selector,i.proxy(this.enter,this)),this.$element.on(t+"."+this.type,this.options.selector,i.proxy(this.leave,this))),this.options.selector?this._options=i.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(e){return(e=i.extend({},i.fn[this.type].defaults,e,this.$element.data())).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},enter:function(e){var t=i(e.currentTarget)[this.type](this._options).data(this.type);if(!t.options.delay||!t.options.delay.show)return t.show();clearTimeout(this.timeout),t.hoverState="in",this.timeout=setTimeout(function(){"in"==t.hoverState&&t.show()},t.options.delay.show)},leave:function(e){var t=i(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout&&clearTimeout(this.timeout),!t.options.delay||!t.options.delay.hide)return t.hide();t.hoverState="out",this.timeout=setTimeout(function(){"out"==t.hoverState&&t.hide()},t.options.delay.hide)},show:function(){var e,t,r,i,n,o,s;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),o="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(o),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),r=this.getPosition(t),i=e[0].offsetWidth,n=e[0].offsetHeight,t?o.split(" ")[1]:o){case"bottom":s={top:r.top+r.height,left:r.left+r.width/2-i/2};break;case"top":s={top:r.top-n,left:r.left+r.width/2-i/2};break;case"left":s={top:r.top+r.height/2-n/2,left:r.left-i};break;case"right":s={top:r.top+r.height/2-n/2,left:r.left+r.width}}e.css(s).addClass(o).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){var e,t=this.tip();return t.removeClass("in"),i.support.transition&&this.$tip.hasClass("fade")?(e=setTimeout(function(){t.off(i.support.transition.end).remove()},500),t.one(i.support.transition.end,function(){clearTimeout(e),t.remove()})):t.remove(),this},fixTitle:function(){var e=this.$element;!e.attr("title")&&"string"==typeof e.attr("data-original-title")||e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(e){return i.extend({},e?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e=this.$element,t=this.options;return e.attr("data-original-title")||("function"==typeof t.title?t.title.call(e[0]):t.title)},tip:function(){return this.$tip=this.$tip||i(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},i.fn.tooltip=function(r){return this.each(function(){var e=i(this),t=e.data("tooltip");t||e.data("tooltip",t=new n(this,"object"==typeof r&&r)),"string"==typeof r&&t[r]()})},i.fn.tooltip.Constructor=n,i.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!0}})(window.jQuery);var Constants={DEFAULT:{HEIGHT:32,WIDTH:32,FPS:12,LAYER_OPACITY:.2},MODEL_VERSION:2,MAX_HEIGHT:1024,MAX_WIDTH:1024,MAX_PALETTE_COLORS:256,MAX_WORKER_COLORS:256,PREVIEW_FILM_SIZE:96,ANIMATED_PREVIEW_WIDTH:200,RIGHT_COLUMN_PADDING_LEFT:10,DEFAULT_PEN_COLOR:"#000000",TRANSPARENT_COLOR:"rgba(0, 0, 0, 0)",SEAMLESS_MODE_OVERLAY_COLOR:"rgba(255, 255, 255, 0)",CURRENT_COLORS_PALETTE_ID:"__current-colors",CURRENT_FRAME_COLORS_PALETTE_ID:"__current-frame-colors",SELECTION_TRANSPARENT_COLOR:"rgba(160, 215, 240, 0.6)",TOOL_HIGHLIGHT_COLOR_LIGHT:"rgba(255, 255, 255, 0.2)",TOOL_HIGHLIGHT_COLOR_DARK:"rgba(0, 0, 0, 0.2)",ZOOMED_OUT_BACKGROUND_COLOR:"#A0A0A0",LEFT_BUTTON:0,MIDDLE_BUTTON:1,RIGHT_BUTTON:2,MOUSEMOVE_THROTTLING:10,ABSTRACT_FUNCTION:function(){throw"abstract method should be implemented"},EMPTY_FUNCTION:function(){},DRAWING_TEST_FOLDER:"drawing",APPENGINE_SAVE_LIMIT:1048576,CONFIRM_OVERWRITE:"This will replace your current animation, are you sure you want to continue?",APPENGINE_SAVE_URL:"save",IMAGE_SERVICE_UPLOAD_URL:"{{protocol}}://piskel-imgstore-b.appspot.com/__/upload",IMAGE_SERVICE_GET_URL:"{{protocol}}://piskel-imgstore-b.appspot.com/img/"},Events={TOOL_SELECTED:"TOOL_SELECTED",SELECT_TOOL:"SELECT_TOOL",TOOL_RELEASED:"TOOL_RELEASED",TOOL_PRESSED:"TOOL_PRESSED",SELECT_PRIMARY_COLOR:"SELECT_PRIMARY_COLOR",SELECT_SECONDARY_COLOR:"SELECT_SECONDARY_COLOR",PRIMARY_COLOR_SELECTED:"PRIMARY_COLOR_SELECTED",SECONDARY_COLOR_SELECTED:"SECONDARY_COLOR_SELECTED",CURSOR_MOVED:"CURSOR_MOVED",DRAG_START:"DRAG_START",DRAG_END:"DRAG_END",DIALOG_SHOW:"DIALOG_SHOW",DIALOG_HIDE:"DIALOG_HIDE",PALETTE_LIST_UPDATED:"PALETTE_LIST_UPDATED",USER_SETTINGS_CHANGED:"USER_SETTINGS_CHANGED",SHORTCUTS_CHANGED:"SHORTCUTS_CHANGED",CLOSE_SETTINGS_DRAWER:"CLOSE_SETTINGS_DRAWER",PISKEL_RESET:"PISKEL_RESET",PISKEL_SAVE_STATE:"PISKEL_SAVE_STATE",PISKEL_DESCRIPTOR_UPDATED:"PISKEL_DESCRIPTOR_UPDATED",PISKEL_SAVED_STATUS_UPDATE:"PISKEL_SAVED_STATUS_UPDATE",HISTORY_STATE_SAVED:"HISTORY_STATE_SAVED",HISTORY_STATE_LOADED:"HISTORY_STATE_LOADED",PEN_SIZE_CHANGED:"PEN_SIZE_CHANGED",PISKEL_SAVED:"PISKEL_SAVED",BEFORE_SAVING_PISKEL:"BEFORE_SAVING_PISKEL",AFTER_SAVING_PISKEL:"AFTER_SAVING_PISKEL",FRAME_SIZE_CHANGED:"FRAME_SIZE_CHANGED",FPS_CHANGED:"FPS_CHANGED",SELECTION_CREATED:"SELECTION_CREATED",SELECTION_MOVE_REQUEST:"SELECTION_MOVE_REQUEST",SELECTION_DISMISSED:"SELECTION_DISMISSED",CLIPBOARD_COPY:"CLIPBOARD_COPY",CLIPBOARD_CUT:"CLIPBOARD_CUT",CLIPBOARD_PASTE:"CLIPBOARD_PASTE",SHOW_NOTIFICATION:"SHOW_NOTIFICATION",HIDE_NOTIFICATION:"HIDE_NOTIFICATION",SHOW_PROGRESS:"SHOW_PROGRESS",UPDATE_PROGRESS:"UPDATE_PROGRESS",HIDE_PROGRESS:"HIDE_PROGRESS",ZOOM_CHANGED:"ZOOM_CHANGED",EXPORT_SCALE_CHANGED:"EXPORT_SCALE_CHANGED",CURRENT_COLORS_UPDATED:"CURRENT_COLORS_UPDATED",CURRENT_FRAME_CHANGED:"CURRENT_FRAME_CHANGED",CURRENT_LAYER_CHANGED:"CURRENT_LAYER_CHANGED",CURRENT_PALETTE_CHANGED:"CURRENT_PALETTE_CHANGED",PERFORMANCE_REPORT_CHANGED:"PERFORMANCE_REPORT_CHANGED",PISKEL_FILE_IMPORT_FAILED:"PISKEL_FILE_IMPORT_FAILED",MOUSE_EVENT:"MOUSE_EVENT",KEYBOARD_EVENT:"KEYBOARD_EVENT",TRANSFORMATION_EVENT:"TRANSFORMATION_EVENT",TEST_RECORD_END:"TEST_RECORD_END",TEST_CASE_END:"TEST_CASE_END",TEST_SUITE_END:"TEST_SUITE_END"},ns=(jQuery.namespace=function(){for(var e=arguments,t=null,r=0;r<e.length;r++)for(var i=e[r].split("."),t=window,n=0;n<i.length;n++)t[i[n]]=t[i[n]]||{},t=t[i[n]];return t},Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){var e=r.concat(Array.prototype.slice.call(arguments));return i.apply(this instanceof n&&t?this:t,e)}var r=Array.prototype.slice.call(arguments,1),i=this,n=function(){};return n.prototype=this.prototype,e.prototype=new n,e}),Uint32Array.prototype.fill||(Uint32Array.prototype.fill=function(e,t,r){r=void 0===r?this.length:r,(t=void 0===t?0:t)<0&&(t=this.length+t),r<0&&(r=this.length+r);for(var i=t;i<r;i++)this[i]=e}),(()=>{var r=$.namespace("pskl.utils"),i=(r.rgbToHex=function(e,t,r){return"#"+pskl.utils.componentToHex(e)+pskl.utils.componentToHex(t)+pskl.utils.componentToHex(r)},r.componentToHex=function(e){e=e.toString(16);return 1==e.length?"0"+e:e},{}),n=(r.intToHex=function(e){var t;return i[e]||(t=r.rgbToHex(255&e,e>>8&255,e>>16&255),i[e]=t)},r.normalize=function(e,t){return null==e?t:e},r.inherit=function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).prototype.superclass=t.prototype},r.wrap=function(e,t){for(var r in t)"function"==typeof t[r]&&void 0===e[r]&&(e[r]=t[r].bind(t))},r.hashCode=function(e){var t=0;if(0!==e.length)for(var r=0,i=e.length;r<i;r++)t=31*t+e.charCodeAt(r),t|=0;return t},r.copy=function(e){return JSON.parse(JSON.stringify(e))},{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}),o=(r.escapeHtml=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return n[e]})},{}),s={},a=(r.colorToInt=function(e){var t,r;return"number"==typeof e?e:void 0!==o[e]?o[e]:(t=window.tinycolor(e))&&t.ok?(t=t.toRgb(),t=((r=Math.round(255*t.a))<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,o[e]=t=0===r?0:t,s[t]=e,t):((r=document.createElement("div")).style.color=e,document.body.appendChild(r),e=window.getComputedStyle(r).color,document.body.removeChild(r),pskl.utils.colorToInt(e))},r.intToColor=function(e){var t;return"string"==typeof e?e:void 0!==s[e]?s[e]:(o[t="rgba("+(255&e)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24>>>0&255)/255+")"]=e,s[e]=t)},{});r.unescapeHtml=function(t){return Object.keys(n).forEach(function(e){a[e]=a[e]||new RegExp(n[e],"g"),t=t.replace(a[e],e)}),t}})(),(()=>{var t=$.namespace("pskl.utils"),e=navigator.userAgent;t.UserAgent={isIE:/MSIE/i.test(e),isIE11:/trident/i.test(e),isEdge:/edge\//i.test(e),isFirefox:/Firefox/i.test(e),isMac:/Mac/.test(e),isOpera:/OPR\//.test(e),hasChrome:/Chrome/i.test(e),hasSafari:/Safari\//.test(e)},t.UserAgent.isChrome=t.UserAgent.hasChrome&&!t.UserAgent.isOpera&&!t.UserAgent.isEdge,t.UserAgent.isSafari=t.UserAgent.hasSafari&&!t.UserAgent.isOpera&&!t.UserAgent.isEdge,t.UserAgent.supportedUserAgents=["isIE11","isEdge","isChrome","isFirefox"],t.UserAgent.version=pskl.utils.UserAgent.isIE?parseInt(/MSIE\s?(\d+)/i.exec(e)[1],10):pskl.utils.UserAgent.isChrome?parseInt(/Chrome\/(\d+)/i.exec(e)[1],10):pskl.utils.UserAgent.isFirefox?parseInt(/Firefox\/(\d+)/i.exec(e)[1],10):void 0,t.UserAgent.isUnsupported=function(){return t.UserAgent.supportedUserAgents.every(function(e){return!t.UserAgent[e]})},t.UserAgent.getDisplayName=function(){return t.UserAgent.isIE?"Internet Explorer":t.UserAgent.isChrome?"Chrome":t.UserAgent.isFirefox?"Firefox":t.UserAgent.isSafari?"Safari":t.UserAgent.isOpera?"Opera":e}})(),$.namespace("pskl.utils").Array={find:function(e,t){var r=null,e=(e=Array.isArray(e)?e:[]).filter(t);return r=e.length?e[0]:r},chunk:function(e,t){for(var r=[],i=(t=Math.min(t,e.length),t=Math.max(1,t),Math.round(e.length/t)),n=0;n<t;n++){var o=n==t-1?e.length:(n+1)*i;r.push(e.slice(n*i,o))}return r}},(()=>{var p,e=$.namespace("pskl.utils");Uint8Array&&(p=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),e.Base64={toText:function(e){return window.atob(e.replace(/data\:.*?\;base64\,/,""))},decode:function(e){for(var t=0,r=[0,0],i=0,n=0,o=e.length,s=0,a=new Uint8Array(o/4*3|0);o--;){var l=e.charCodeAt(s++),c=p[l-43];255!==c&&void 0!==c&&(r[1]=r[0],r[0]=l,n=n<<6|c,4===++i)&&(a[t++]=n>>>16,61!==r[1]&&(a[t++]=n>>>8),61!==r[0]&&(a[t++]=n),i=0)}return a.buffer}}})(),(()=>{var e=$.namespace("pskl.utils"),s=/\s*;\s*base64\s*(?:;|$)/i;e.BlobUtils={dataToBlob:function(e,t,r){var i,n=e.indexOf(","),o=e.substring(n+1),e=s.test(e.substring(0,n));Blob.fake?((i=new Blob).encoding=e?"base64":"URI",i.data=o,i.size=o.length):Uint8Array&&(n=e?pskl.utils.Base64.decode(o):decodeURIComponent(o),i=new Blob([n],{type:t})),r(i)},canvasToBlob:function(e,t,r){var i;r=r||"image/png",e.mozGetAsFile?t(e.mozGetAsFile("canvas",r)):(i=Array.prototype.slice.call(arguments,2),e=e.toDataURL.apply(e,i),pskl.utils.BlobUtils.dataToBlob(e,r,t))},stringToBlob:function(e,t,r){r=r||"text/plain",pskl.utils.BlobUtils.dataToBlob("data:"+r+","+e,r,t)}}})(),$.namespace("pskl.utils").CanvasUtils={createCanvas:function(e,t,r){var i=document.createElement("canvas");if(i.setAttribute("width",e),i.setAttribute("height",t),"string"==typeof r&&(r=[r]),Array.isArray(r))for(var n=0;n<r.length;n++)i.classList.add(r[n]);return i},createFromImageData:function(e){var t=pskl.utils.CanvasUtils.createCanvas(e.width,e.height);return t.getContext("2d").putImageData(e,0,0),t},createFromImage:function(e){var t=pskl.utils.CanvasUtils.createCanvas(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t},createFramesFromImage:function(e,t,r,i,n,o,s){for(var a=[],l=t,c=r,p=pskl.utils.CanvasUtils.createCanvas(i,n).toDataURL();l+i<=e.width&&c+n<=e.height;){var h=pskl.utils.CanvasUtils.createCanvas(i,n);h.getContext("2d").drawImage(e,l,c,i,n,0,0,i,n),s&&h.toDataURL()===p||a.push(h),o?(l+=i)+i>e.width&&(l=t,c+=n):(c+=n)+n>e.height&&(l+=i,c=r)}return a},disableImageSmoothing:function(e){pskl.utils.CanvasUtils.setImageSmoothing(e,!1)},enableImageSmoothing:function(e){pskl.utils.CanvasUtils.setImageSmoothing(e,!0)},setImageSmoothing:function(e,t){e=e.getContext("2d");e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.oImageSmoothingEnabled=t,e.webkitImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t},clear:function(e){e&&e.getContext("2d").clearRect(0,0,e.width,e.height)},clone:function(e){var t=pskl.utils.CanvasUtils.createCanvas(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t},getImageDataFromCanvas:function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height).data},getBase64FromCanvas:function(e,t){e=e.toDataURL("image/"+(t=t||"png"));return e.substr(e.indexOf(",")+1)}},$.namespace("pskl.utils").ColorUtils={getUnusedColor:function(e){for(var t={},r=((e=e||[]).forEach(function(e){t[e.toUpperCase()]=!0}),{r:255,g:255,b:0}),i=null;;){var n=window.tinycolor(r).toHexString().toUpperCase();if(!t[n]){i=n;break}n=(r.r?"r":r.g&&"g")||r.b&&"b";if(!n)break;r[n]=r[n]-1}return i}},(()=>{function r(e){return e<10?"0"+e:""+e}$.namespace("pskl.utils").DateUtils={format:function(e,t){return e=new Date(e),pskl.utils.Template.replace(t,{Y:e.getFullYear(),M:r(e.getMonth()+1),D:r(e.getDate()),H:r(e.getHours()),m:r(e.getMinutes()),s:r(e.getSeconds())})}}})(),(()=>{var r=$.namespace("pskl.utils");r.Dom={isParent:function(e,t,r){if(e&&t)for(r&&(e=e.parentNode);e;){if(e===t)return!0;e=e.parentNode}return!1},getParentWithData:function(e,t){for(;e;){if(e.dataset&&void 0!==e.dataset[t])return e;e=e.parentNode}return null},getData:function(e,t){e=r.Dom.getParentWithData(e,t);if(null!==e)return e.dataset[t]},removeClass:function(e,t){for(var r=(t=t||document).querySelectorAll("."+e),i=0;i<r.length;i++)r[i].classList.remove(e)}}})(),(()=>{var e=$.namespace("pskl.utils");e.Event={},e.Event.addEventListener=function(e,t,r,i,n){n={el:e="string"==typeof e?document.querySelector(e):e,type:t,callback:r,handler:n?r.bind(i,n):r.bind(i)};i.__pskl_listeners=i.__pskl_listeners||[],i.__pskl_listeners.push(n),e.addEventListener(t,n.handler)},e.Event.removeEventListener=function(e,t,r,i){if(i&&i.__pskl_listeners)for(var n=i.__pskl_listeners,o=0;o<n.length;o++){var s=n[o];if(s.callback===r&&s.el===e&&s.type===t){e.removeEventListener(t,n[o].handler),n.splice(o,1);break}}},e.Event.removeAllEventListeners=function(e){if(e&&e.__pskl_listeners){for(var t=e.__pskl_listeners,r=0;r<t.length;r++){var i=t[r];i.el.removeEventListener(i.type,i.handler)}e.__pskl_listeners=[]}}})(),$.namespace("pskl.utils").Environment={detectNodeWebkit:function(){var t=!1;if(void 0!==window.process&&void 0!==window.require)try{t=void 0!==window.require("nw.gui")}catch(e){t=!1}return t},isIntegrationTest:function(){return-1!==window.location.href.indexOf("integration-test")},isDebug:function(){return-1!==window.location.href.indexOf("debug")},isHttps:function(){return 0===window.location.href.indexOf("https://")}},$.namespace("pskl.utils").FunctionUtils={memo:function(t,r,i){return function(){var e=Array.prototype.join.call(arguments,"-");return r[e]||(r[e]=t.apply(i,arguments)),r[e]}},throttle:function(t,r){var i,n;return function(){var e=Date.now();i&&e<i+r?(clearTimeout(n),n=setTimeout(function(){i=e,t()},r)):(i=e,t())}}},$.namespace("pskl.utils").Math={minmax:function(e,t,r){return Math.max(Math.min(e,r),t)},distance:function(e,t,r,i){t=Math.abs(t-e),e=Math.abs(i-r);return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}},(()=>{function i(e){e.stopPropagation()}var t=$.namespace("pskl.utils");t.FileUtils={readFile:function(e,t){var r=new FileReader;r.addEventListener("loadend",function(){t(r.result)}),r.readAsDataURL(e)},readFileAsArrayBuffer:function(e,t){var r=new FileReader;r.addEventListener("loadend",function(){t(r.result)}),r.readAsArrayBuffer(e)},readImageFile:function(e,r){t.FileUtils.readFile(e,function(e){var t=new Image;t.onload=r.bind(null,t),t.src=e})},downloadAsFile:function(e,t){var r=window.saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator);r?r(e,t):(r=document.createElement("a"),e=window.URL.createObjectURL(e),r.setAttribute("href",e),r.setAttribute("download",t),document.body.appendChild(r),r.addEventListener("click",i),r.click(),r.removeEventListener("click",i),document.body.removeChild(r))}}})(),(()=>{$.namespace("pskl.utils").FileUtilsDesktop={chooseFilenameDialog:function(e,t){function r(e){o.removeEventListener("change",r),document.removeEventListener("click",r),n.resolve(o.value)}var i,n=Q.defer(),o=(e=e,t=t,(i=document.createElement("INPUT")).setAttribute("type","file"),i.setAttribute("nwworkingdir",""),e&&i.setAttribute("nwsaveas",e),t&&i.setAttribute("accept",t),i);return window.setTimeout(function(){o.click(),o.addEventListener("change",r),document.addEventListener("mousedown",r)},50),n.promise},saveToFile:function(e,t){var r=Q.defer();return window.require("fs").writeFile(t,e,function(e){e?r.reject("FileUtilsDesktop::savetoFile() - error saving file: "+t+" Error: "+e):r.resolve()}),r.promise},readFile:function(r){var i=Q.defer();return window.require("fs").readFile(r,"utf8",function(e,t){e?i.reject("FileUtilsDesktop::readFile() - error reading file: "+r+" Error: "+e):i.resolve(t)}),i.promise}}})(),(()=>{var o=$.namespace("pskl.utils"),h={},u={};o.FrameUtils={toImage:function(e,t,r){t=t||1,r=isNaN(r)?1:r;e=new pskl.rendering.CanvasRenderer(e,t);return e.drawTransparentAs(Constants.TRANSPARENT_COLOR),e.setOpacity(r),e.render()},drawToCanvas:function(e,t,r,i){t=t.getContext("2d");if(i=isNaN(i)?1:i,t.globalAlpha=i,r=r||Constants.TRANSPARENT_COLOR,e instanceof pskl.model.frame.RenderedFrame)t.fillRect(r,0,0,e.getWidth(),e.getHeight()),t.drawImage(e.getRenderedFrame(),0,0);else{var i=e.getWidth(),n=e.getHeight(),o=e.pixels,s=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),a=pskl.utils.colorToInt(r);if(a!=s)for(var l=0,c=(o=e.getPixels()).length;l<c;l++)o[l]==s&&(o[l]=a);var p,r=i+"-"+n,e=u[r]||(u[r]=t.createImageData(i,n)),r=new Uint8ClampedArray(o.buffer),r=(e.data.set(r),i+"-"+n);h[r]?p=h[r]:(p=h[r]=pskl.utils.CanvasUtils.createCanvas(i,n)).context=p.getContext("2d"),p.context.putImageData(e,0,0),t.drawImage(p,0,0,i,n),t.globalAlpha=1}},renderLine_:function(e,t,r,i,n){e!==Constants.TRANSPARENT_COLOR&&null!==e&&(n.fillStyle=e,n.fillRect(t,r,1,i))},merge:function(e){var t=null;if(e.length)for(var t=e[0].clone(),r=1;r<e.length;r++)pskl.utils.FrameUtils.mergeFrames_(t,e[r]);return t},mergeFrames_:function(e,t){for(var r=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),i=0,n=e.getWidth()*e.getHeight();i<n;++i)t.pixels[i]!=r&&e.pixels[i]!=t.pixels[i]&&(e.pixels[i]=t.pixels[i])},addImageToFrame:function(i,e,n,o){e=pskl.utils.FrameUtils.createFromImage(e);n-=Math.floor(e.width/2),o-=Math.floor(e.height/2),n=Math.max(0,n),o=Math.max(0,o),e.width<=i.width&&(n=Math.min(n,i.width-e.width)),e.height<=i.height&&(o=Math.min(o,i.height-e.height)),e.forEachPixel(function(e,t,r){e!=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)&&i.setPixel(n+t,o+r,e)})},resize:function(e,t,r,i){e=pskl.utils.FrameUtils.toImage(e),e=pskl.utils.ImageResizer.resize(e,t,r,i);return pskl.utils.FrameUtils.createFromImage(e)},removeTransparency:function(o){o.forEachPixel(function(e,t,r){var i,n=e>>24>>>0&255;n&&255!=n&&(i=255*Math.round(n/255),o.setPixel(t,r,e-(n<<24>>>0)+(i<<24>>>0)))})},createFromCanvas:function(e,t,r,i,n,o){e=e.getContext("2d").getImageData(t,r,i,n).data;return pskl.utils.FrameUtils.createFromImageData_(e,i,n,o)},createFromImageSrc:function(e,r,i){var n=new Image;n.addEventListener("load",function e(){n.removeEventListener("load",e);var t=o.FrameUtils.createFromImage(n,r);i(t)}),n.src=e},createFromImage:function(e,t){var r=e.width,i=e.height,n=pskl.utils.CanvasUtils.createCanvas(r,i).getContext("2d"),e=(n.drawImage(e,0,0,r,i,0,0,r,i),n.getImageData(0,0,r,i).data);return pskl.utils.FrameUtils.createFromImageData_(e,r,i,t)},createFromImageData_:function(e,t,r,i){t=new pskl.model.Frame(t,r);return t.pixels=new Uint32Array(e.buffer),i||pskl.utils.FrameUtils.removeTransparency(t),t},createFramesFromSpritesheet:function(e,t){for(var r=[],i=0;i<t;i++)r.push([i]);return pskl.utils.FrameUtils.createFramesFromChunk(e,r).map(function(e){return e.frame})},createFramesFromChunk:function(e,t){for(var r=e.width/t.length,i=e.height/t[0].length,n=pskl.utils.CanvasUtils.createCanvas(r,i),o=n.getContext("2d"),s=[],a=0;a<t.length;a++)for(var l=t[a],c=0;c<l.length;c++){o.clearRect(0,0,r,i),o.drawImage(e,r*a,i*c,r,i,0,0,r,i);var p=pskl.utils.FrameUtils.createFromCanvas(n,0,0,r,i);s.push({index:t[a][c],frame:p})}return s},toFrameGrid:function(e){for(var t=[],r=e[0].length,i=e.length,n=0;n<r;n++){t[n]=[];for(var o=0;o<i;o++)t[n][o]=e[o][n]}return t}}})(),(()=>{var i=$.namespace("pskl.utils");i.ImageResizer={scale:function(e,t,r){return i.ImageResizer.resize(e,e.width*t,e.height*t,r)},resize:function(e,t,r,i){var n=pskl.utils.CanvasUtils.createCanvas(t,r),o=n.getContext("2d");return o.save(),i||pskl.utils.CanvasUtils.disableImageSmoothing(n),o.translate(n.width/2,n.height/2),o.scale(t/e.width,r/e.height),o.drawImage(e,-e.width/2,-e.height/2),o.restore(),n}}})(),(()=>{var a=$.namespace("pskl.utils");a.LayerUtils={clone:function(e){var t=e.getFrames().map(function(e){return e.clone()});return pskl.model.Layer.fromFrames(e.getName()+" (clone)",t)},mergeLayers:function(e,t){var r=e.getFrames(),i=t.getFrames(),n=[];return r.forEach(function(e,t){t=i[t];n.push(pskl.utils.FrameUtils.merge([t,e]))}),pskl.model.Layer.fromFrames(e.getName(),n)},getFrameHashAt:function(e,r){var i=[];return e.forEach(function(e){var t=e.getFrameAt(r);return i.push(t.getHash()),i.push(e.getOpacity()),t}),i.join("-")},mergeFrameAt:function(e,t){return e.some(function(e){return e.isTransparent()})?pskl.utils.LayerUtils.mergeTransparentFrameAt_(e,t):pskl.utils.LayerUtils.mergeOpaqueFrameAt_(e,t)},mergeTransparentFrameAt_:function(e,t){var r=pskl.utils.LayerUtils.getFrameHashAt(e,t),i=e[0].frames[0].getWidth(),n=e[0].frames[0].getHeight();return new pskl.model.frame.RenderedFrame(function(){return pskl.utils.LayerUtils.flattenFrameAt(e,t,!0)},i,n,r)},mergeOpaqueFrameAt_:function(e,t){var r=pskl.utils.LayerUtils.getFrameHashAt(e,t),e=e.map(function(e){return e.getFrameAt(t)}),e=pskl.utils.FrameUtils.merge(e);return e.id=r,e.version=0,e},renderFrameAt:function(e,t,r){r=r?e.getOpacity():1,e=e.getFrameAt(t);return pskl.utils.FrameUtils.toImage(e,1,r)},flattenFrameAt:function(e,t,r){var i=e[0].getFrameAt(t).getWidth(),n=e[0].getFrameAt(t).getHeight(),o=pskl.utils.CanvasUtils.createCanvas(i,n),s=o.getContext("2d");return e.forEach(function(e){e=a.LayerUtils.renderFrameAt(e,t,r);s.drawImage(e,0,0,i,n,0,0,i,n)}),o}}})(),(()=>{var a=$.namespace("pskl.utils");a.MergeUtils={merge:function(o,e,t){(e.getWidth()>o.getWidth()||e.getHeight()>o.getHeight())&&"expand"===t.resize?o=pskl.utils.ResizeUtils.resizePiskel(o,{width:Math.max(o.getWidth(),e.getWidth()),height:Math.max(o.getHeight(),e.getHeight()),origin:t.origin,resizeContent:!1}):e=pskl.utils.ResizeUtils.resizePiskel(e,{width:o.getWidth(),height:o.getHeight(),origin:t.origin,resizeContent:!1});for(var s=t.insertIndex,r=("insert"===t.insertMode&&(s-=1),e.getFrameCount()),i=0;i<r;i++){var n=i+s;("add"===t.insertMode||n>=o.getFrameCount())&&a.MergeUtils.addFrameToLayers_(o,n)}return e.getLayers().forEach(function(e){for(var t=e.getName()+" (imported)",r=new pskl.model.Layer(t),i=0;i<o.getFrameCount();i++){var n=i-s,n=(n=e.getFrameAt(n))||a.MergeUtils.createEmptyFrame_(o);r.addFrame(n)}o.addLayer(r)}),o},createEmptyFrame_:function(e){return new pskl.model.Frame(e.getWidth(),e.getHeight())},addFrameToLayers_:function(t,r){t.getLayers().forEach(function(e){e.addFrameAt(a.MergeUtils.createEmptyFrame_(t),r)})}}})(),$.namespace("pskl").PixelUtils={getRectanglePixels:function(e,t,r,i){for(var n=this.getOrderedRectangleCoordinates(e,t,r,i),o=[],s=n.x0;s<=n.x1;s++)for(var a=n.y0;a<=n.y1;a++)o.push({col:s,row:a});return o},getOrderedRectangleCoordinates:function(e,t,r,i){return{x0:Math.min(e,r),y0:Math.min(t,i),x1:Math.max(e,r),y1:Math.max(t,i)}},getSimilarConnectedPixelsFromFrame:function(r,e,t){var i,n=r.getPixel(e,t);return null===n?[]:(i={},pskl.PixelUtils.visitConnectedPixels({col:e,row:t},r,function(e){var t=e.col+"-"+e.row;return!i[t]&&(i[t]=!0,r.getPixel(e.col,e.row)==n)}))},resizePixel:function(e,t,r){for(var i=[],n=0;n<r;n++)for(var o=0;o<r;o++)i.push([e-Math.floor(r/2)+o,t-Math.floor(r/2)+n]);return i},resizePixels:function(e,r){return e.reduce(function(e,t){return e.concat(pskl.PixelUtils.resizePixel(t.col,t.row,r))},[])},paintSimilarConnectedPixelsFromFrame:function(t,r,e,i,n){var o;"string"==typeof n&&(n=pskl.utils.colorToInt(n));try{o=t.getPixel(e,i)}catch(e){}if(null!==o&&o!=n)return pskl.PixelUtils.visitConnectedPixels({col:e,row:i},t,function(e){return t.getPixel(e.col,e.row)==o&&(t.setPixel(e.col,e.row,n),r.setPixel(e.col,e.row,n),!0)})},visitConnectedPixels:function(e,t,r){e.col;for(var i=[],n=[],o=[-1,0,1,0],s=[0,1,0,-1],a=(i.push(e),n.push(e),r(e),0),l=t.getWidth()*t.getHeight();0<i.length;){a++;for(var c=i.pop(),p=0;p<4;p++){var h=c.col+s[p],u=c.row+o[p];try{var d={col:h,row:u};r(d)&&(i.push(d),n.push(d))}catch(e){}}if(10*l<a){console.log("loop breaker called");break}}return n},calculateZoomForContainer:function(e,t,r){return this.calculateZoom(e.height(),e.width(),t,r)},getLinePixels:function(e,t,r,i){for(var n=[],o=(t=pskl.utils.normalize(t,0),i=pskl.utils.normalize(i,0),Math.abs(t-e)),s=Math.abs(i-r),a=e<t?1:-1,l=r<i?1:-1,c=o-s;n.push({col:e,row:r}),e!=t||r!=i;){var p=2*c;-s<p&&(c-=s,e+=a),p<o&&(c+=o,r+=l)}return n},getUniformLinePixels:function(e,t,r,i){for(var n=[],o=(t=pskl.utils.normalize(t,0),i=pskl.utils.normalize(i,0),Math.abs(t-e)+1),s=Math.abs(i-r)+1,a=e<t?1:-1,l=r<i?1:-1,c=Math.max(o,s)/Math.min(o,s),p=Math.round(c)||0,h=(p>Math.min(o,s)&&(p=1/0),pskl.utils.Math.distance(e,t,r,i)),u=e,d=r,f=0;f++,n.push({col:u,row:d}),!(pskl.utils.Math.distance(e,u,r,d)>=h);){var g=f%p==0;(s<=o||g)&&(u+=a),(o<=s||g)&&(d+=l)}return n}},(()=>{var n=$.namespace("pskl.utils");n.PiskelFileUtils={FAILURE:{EMPTY:"No data found in piskel file",INVALID:"Invalid piskel file, contact us on twitter @piskelapp",DESERIALIZATION:"Piskel data deserialization failed"},loadFromFile:function(t,r,i){pskl.utils.FileUtils.readFile(t,function(e){e=pskl.utils.Base64.toText(e);n.PiskelFileUtils.decodePiskelFile(e,function(e){pskl.utils.Environment.detectNodeWebkit()&&(e.savePath=t.path),r(e)},i)})},decodePiskelFile:function(e,t,r){var i;if(0===e.length)r(n.PiskelFileUtils.FAILURE.EMPTY);else{try{i=JSON.parse(e)}catch(e){return void r(n.PiskelFileUtils.FAILURE.INVALID)}i.piskel;pskl.utils.serialization.Deserializer.deserialize(i,t,function(){r(n.PiskelFileUtils.FAILURE.DESERIALIZATION)})}}}})(),(()=>{var s=$.namespace("pskl.utils");s.ResizeUtils={resizePiskel:function(e,t){var r=e.getFPS(),i=e.getLayers().map(function(e){return s.ResizeUtils.resizeLayer(e,t)}),i=pskl.model.Piskel.fromLayers(i,r,e.getDescriptor());return i.savePath=e.savePath,i},resizeLayer:function(e,t){var r=e.getOpacity(),i=e.getFrames().map(function(e){return s.ResizeUtils.resizeFrame(e,t)}),e=pskl.model.Layer.fromFrames(e.getName(),i);return e.setOpacity(r),e},resizeFrame:function(i,e){var n,t=e.width,r=e.height,o=e.origin;return e.resizeContent?pskl.utils.FrameUtils.resize(i,t,r,!1):(n=new pskl.model.Frame(t,r),i.forEachPixel(function(e,t,r){t=s.ResizeUtils.translateCoordinates(t,r,i,n,o);n.containsPixel(t.x,t.y)&&n.setPixel(t.x,t.y,e)}),n)},translateCoordinates:function(e,t,r,i,n){return{x:s.ResizeUtils.translateX(e,r.width,i.width,n),y:s.ResizeUtils.translateY(t,r.height,i.height,n)}},translateX:function(e,t,r,i){return-1!=i.indexOf("LEFT")?e:-1!=i.indexOf("RIGHT")?e-(t-r):e-Math.round((t-r)/2)},translateY:function(e,t,r,i){return-1!=i.indexOf("TOP")?e:-1!=i.indexOf("BOTTOM")?e-(t-r):e-Math.round((t-r)/2)}}})(),$.namespace("pskl.utils").StringUtils={leftPad:function(e,t,r){return(new Array(t).join(r)+e).slice(-t)},formatSize:function(e,t){return e+"Ã"+t}},(()=>{var n=$.namespace("pskl.utils"),r={};n.Template={get:function(e){var t;return r[e]||((t=document.getElementById(e))?r[e]=t.innerHTML:console.error("Could not find template for id :",e)),r[e]},getAsHTML:function(e){e=n.Template.get(e);if(e)return n.Template.createFromHTML(e)},createFromHTML:function(e){var t=n.Template._getDummyEl(),e=(t.innerHTML=e,t.children[0]);return pskl.utils.UserAgent.isIE11||(t.innerHTML=""),e},replace:function(e,t){for(var r in t){var i;t.hasOwnProperty(r)&&(i=t[r],-1!==r.indexOf(":")&&(!0===i?i=r.split(":")[1]:!1===i&&(i="")),/^!.*!$/.test(r)||(i=n.Template.sanitize(i)),e=e.replace(new RegExp("\\{\\{"+r+"\\}\\}","g"),i))}return e},getAndReplace:function(e,t){var r="",e=pskl.utils.Template.get(e);return r=e?pskl.utils.Template.replace(e,t):r},sanitize:function(e){var t=n.Template._getDummyEl(),e=(t.textContent=e,t.innerHTML);return pskl.utils.UserAgent.isIE11||(t.innerHTML=""),e},_getDummyEl:pskl.utils.UserAgent.isIE11?function(){return document.createElement("div")}:function(){return n.Template._dummyEl||(n.Template._dummyEl=document.createElement("div")),n.Template._dummyEl}}})(),(()=>{var e=$.namespace("pskl.utils");e.TooltipFormatter={},e.TooltipFormatter.format=function(e,t,r){var i=pskl.utils.Template.get("tooltip-container-template");return t=t?"("+t.getDisplayKey()+")":"",pskl.utils.Template.replace(i,{helptext:e,shortcut:t,"!descriptors!":this.formatDescriptors_(r)})},e.TooltipFormatter.formatDescriptors_=function(e){return(e=e||[]).reduce(function(e,t){return e+this.formatDescriptor_(t)}.bind(this),"")},e.TooltipFormatter.formatDescriptor_=function(e){var t;return e.key?(t=pskl.utils.Template.get("tooltip-modifier-descriptor-template"),e.key=e.key.toUpperCase(),pskl.utils.UserAgent.isMac&&(e.key=e.key.replace("CTRL","CMD"),e.key=e.key.replace("ALT","OPTION"))):t=pskl.utils.Template.get("tooltip-simple-descriptor-template"),pskl.utils.Template.replace(t,e)}})(),$.namespace("pskl").UserSettings={GRID_COLOR:"GRID_COLOR",GRID_ENABLED:"GRID_ENABLED",GRID_WIDTH:"GRID_WIDTH",GRID_SPACING:"GRID_SPACING",MAX_FPS:"MAX_FPS",DEFAULT_SIZE:"DEFAULT_SIZE",CANVAS_BACKGROUND:"CANVAS_BACKGROUND",SELECTED_PALETTE:"SELECTED_PALETTE",SEAMLESS_OPACITY:"SEAMLESS_OPACITY",SEAMLESS_MODE:"SEAMLESS_MODE",PREVIEW_SIZE:"PREVIEW_SIZE",ONION_SKIN:"ONION_SKIN",LAYER_PREVIEW:"LAYER_PREVIEW",LAYER_OPACITY:"LAYER_OPACITY",EXPORT_SCALE:"EXPORT_SCALE",EXPORT_TAB:"EXPORT_TAB",EXPORT_GIF_REPEAT:"EXPORT_GIF_REPEAT",PEN_SIZE:"PEN_SIZE",RESIZE_SETTINGS:"RESIZE_SETTINGS",COLOR_FORMAT:"COLOR_FORMAT",TRANSFORM_SHOW_MORE:"TRANSFORM_SHOW_MORE",PREFERENCES_TAB:"PREFERENCES_TAB",KEY_TO_DEFAULT_VALUE_MAP_:{GRID_COLOR:Constants.TRANSPARENT_COLOR,GRID_ENABLED:!1,GRID_WIDTH:1,GRID_SPACING:1,MAX_FPS:24,DEFAULT_SIZE:{width:Constants.DEFAULT.WIDTH,height:Constants.DEFAULT.HEIGHT},CANVAS_BACKGROUND:"lowcont-dark-canvas-background",SELECTED_PALETTE:Constants.CURRENT_COLORS_PALETTE_ID,SEAMLESS_OPACITY:.3,SEAMLESS_MODE:!1,PREVIEW_SIZE:"original",ONION_SKIN:!1,LAYER_OPACITY:.2,LAYER_PREVIEW:!0,EXPORT_SCALE:1,EXPORT_TAB:"gif",EXPORT_GIF_REPEAT:!0,PEN_SIZE:1,RESIZE_SETTINGS:{maintainRatio:!0,resizeContent:!1,origin:"TOPLEFT"},COLOR_FORMAT:"hex",TRANSFORM_SHOW_MORE:!1,PREFERENCES_TAB:"misc"},cache_:{},get:function(e){var t;return this.checkKeyValidity_(e),e in this.cache_||(t=this.readFromLocalStorage_(e),this.cache_[e]=null!=t?t:this.readFromDefaults_(e)),this.cache_[e]},set:function(e,t){this.checkKeyValidity_(e),this.cache_[e]=t,this.writeToLocalStorage_(e,t),$.publish(Events.USER_SETTINGS_CHANGED,[e,t])},readFromLocalStorage_:function(e){e=window.localStorage[e];return e=void 0!==e?JSON.parse(e):e},writeToLocalStorage_:function(e,t){window.localStorage[e]=JSON.stringify(t)},readFromDefaults_:function(e){return this.KEY_TO_DEFAULT_VALUE_MAP_[e]},checkKeyValidity_:function(e){if(0===e.indexOf(pskl.service.keyboard.Shortcut.USER_SETTINGS_PREFIX))return!0;e in this.KEY_TO_DEFAULT_VALUE_MAP_||console.error("UserSettings key <"+e+"> not found in supported keys.")}},(()=>{$.namespace("pskl.utils").Uuid={generate:function(){return"ss-s-s-s-sss".replace(/s/g,function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})}}})(),(()=>{var r=$.namespace("pskl.utils"),i={};r.WorkerUtils={createWorker:function(e,t){return i[t]||(i[t]=r.WorkerUtils.createWorkerURL(e)),new Worker(i[t])},createWorkerURL:function(e){e=[(e+"").replace(/function\s*\(\)\s*\{/,"").replace(/\}[^}]*$/,"")],e=new Blob(e,{type:"application/javascript"});return window.URL.createObjectURL(e)}}})(),(()=>{var s=$.namespace("pskl.utils");s.Xhr={get:function(e,t,r){s.Xhr.xhr_(e,"GET",t,r).send()},post:function(e,t,r,i){var e=s.Xhr.xhr_(e,"POST",r,i),n=new FormData;if("object"==typeof t)for(var o in t)t.hasOwnProperty(o)&&n.append(o,t[o]);e.send(n)},xhr_:function(e,t,r,i){r=r||function(){},i=i||function(){};var n=new XMLHttpRequest;return n.open(t,e,!0),n.onload=function(e){200==this.status?r(this):this.onerror(this,e)},n.onerror=function(e){i(e,this)},n}}})(),(()=>{var l=$.namespace("pskl.utils.serialization");l.Serializer={serialize:function(e){var t=e.getLayers().map(function(e){return pskl.utils.serialization.Serializer.serializeLayer(e)});return JSON.stringify({modelVersion:Constants.MODEL_VERSION,piskel:{name:e.getDescriptor().name,description:e.getDescriptor().description,fps:pskl.app.piskelController.getFPS(),height:e.getHeight(),width:e.getWidth(),layers:t,hiddenFrames:e.hiddenFrames}})},serializeLayer:function(e){for(var t,r=e.getFrames(),e={name:e.getName(),opacity:e.getOpacity(),frameCount:r.length},i=[];!(t=i).length||!t.every(function(e){return e.base64PNG&&"data:,"!==e.base64PNG});){if(i.length>=r.length){i=[];break}for(var n=pskl.utils.Array.chunk(r,i.length+1),i=[],o=0,s=0;s<n.length;s++){var a=n[s];i.push({layout:((e,t)=>{for(var r=[],i=0;i<e;i++)r.push([i+t]);return r})(a.length,o),base64PNG:l.Serializer.serializeFramesToBase64(a)}),o+=a.length}}return e.chunks=i,JSON.stringify(e)},serializeFramesToBase64:function(e){try{return new pskl.rendering.FramesheetRenderer(e).renderAsCanvas().toDataURL()}catch(e){return""}}}})(),(()=>{var n=$.namespace("pskl.utils.serialization");n.Deserializer=function(e,t){this.layersToLoad_=0,this.data_=e,this.callback_=t,this.piskel_=null,this.layers_=[]},n.Deserializer.deserialize=function(e,t,r){try{var i=new(e.modelVersion==Constants.MODEL_VERSION?n.Deserializer:1==e.modelVersion?n.backward.Deserializer_v1:n.backward.Deserializer_v0)(e,t);i.deserialize()}catch(e){console.error(e),"function"==typeof r&&r(e)}},n.Deserializer.prototype.deserialize=function(){var e=this.data_.piskel,t=e.name||"Deserialized piskel",r=void 0!==e.fps?e.fps:12,t=new pskl.model.piskel.Descriptor(t,e.description||"");this.piskel_=new pskl.model.Piskel(e.width,e.height,r,t),this.hiddenFrames=e.hiddenFrames||[],this.layersToLoad_=e.layers.length,e.layers.forEach(this.deserializeLayer.bind(this))},n.Deserializer.prototype.deserializeLayer=function(e,t){var e=JSON.parse(e),r=new pskl.model.Layer(e.name),e=(r.setOpacity(e.opacity),void 0===e.chunks&&e.base64PNG&&this.normalizeLayerData_(e),e.chunks),i=[];return Q.all(e.map(function(e){var t=Q.defer(),r=new Image;return r.onload=function(){pskl.utils.FrameUtils.createFramesFromChunk(r,e.layout).forEach(function(e){i[e.index]=e.frame}),t.resolve()},r.src=e.base64PNG,t.promise})).then(function(){i.forEach(function(e){r.addFrame(e)}),this.layers_[t]=r,this.onLayerLoaded_()}.bind(this)).catch(function(e){console.error("Failed to deserialize layer"),console.error(e)}),r},n.Deserializer.prototype.onLayerLoaded_=function(){this.layersToLoad_=this.layersToLoad_-1,0===this.layersToLoad_&&(this.layers_.forEach(function(e){this.piskel_.addLayer(e)}.bind(this)),this.piskel_.hiddenFrames=this.hiddenFrames,this.callback_(this.piskel_))},n.Deserializer.prototype.normalizeLayerData_=function(e){for(var t=[],r=0;r<e.frameCount;r++)t.push([r]);e.chunks=[{base64PNG:e.base64PNG,layout:t}]}})(),$.namespace("pskl.utils.serialization.arraybuffer").ArrayBufferDeserializer={deserialize:function(e,t){for(var r=new Uint8Array(e),i=new Uint16Array(r.buffer),e=(i[0],i[1]),n=i[2],o=i[3],s=i[4],a=i[5],l=i[6],c=i[7],p=8,h="",u=0;u<s;u++)h+=String.fromCharCode(i[p+u]);p+=s;var d="";for(u=0;u<a;u++)d=String.fromCharCode(i[8+s+u]);p+=a;var f="";for(u=0;u<c;u++)f=String.fromCharCode(i[8+s+u]);var g=f.split("-"),m=(p+=c,[]);for(u=0;u<l;u++){for(var y={},v=i[p],C=i[p+1]/65535,S=i[p+2],k=i[p+3],_=i[p+4]>>>0|k<<16>>>0,b="",E=0;E<v;E++)b+=String.fromCharCode(i[p+5+E]);var w="";for(E=0;E<_;E++)w+=String.fromCharCode(r[2*(p+5+v)+E]);w="data:image/png;base64,"+w,p+=Math.ceil(5+v+_/2),y.name=b,y.opacity=C,y.frameCount=S,y.dataUri=w,m.push(y)}function T(t,e){var r=new Image;r.onload=function(){pskl.utils.FrameUtils.createFramesFromSpritesheet(this,t.frameCount).forEach(function(e){t.model.addFrame(e)}),++L==l&&e(I)},r.src=t.dataUri}var P=new pskl.model.piskel.Descriptor(h,d),I=new pskl.model.Piskel(e,n,o,P),L=(I.hiddenFrames=g,0);for(u=0;u<l;u++){y=m[u];var A=new pskl.model.Layer(y.name);(y.model=A).setOpacity(y.opacity),I.addLayer(A),T.bind(this,y,t)()}}},(()=>{var _=$.namespace("pskl.utils.serialization.arraybuffer");_.ArrayBufferSerializer={calculateRequiredBytes:function(e,t){e.getWidth(),e.getHeight();for(var r=e.getDescriptor().name.length,i=e.getDescriptor().description.length,n=(e.getLayers().length,0),n=(n=(n+=8)+4+2)+2*r+2*i,o=0,s=e.getLayers();o<s.length;o++)(n=(n=(n+=10)+2*s[o].name.length)+t[o].length)%2==1&&n++;return n},serialize:function(e){for(var t,r=[],i=0,n=e.getLayers();i<n.length;i++){var o,s=(o=new pskl.rendering.FramesheetRenderer(n[i].getFrames()).renderAsCanvas().toDataURL().split(",")[1]).length;r.push({uri:o,length:s})}pskl.app.piskelController.getLayerAt(0).getFrames();var a=e.hiddenFrames.join("-"),l=_.ArrayBufferSerializer.calculateRequiredBytes(e,r,a),l=new ArrayBuffer(l),c=new Uint8Array(l),p=new Uint16Array(l),h=e.getWidth(),u=e.getHeight(),d=e.getDescriptor().name,f=d.length,g=e.getDescriptor().description,m=g.length,y=(p[0]=Constants.MODEL_VERSION,p[1]=h,p[2]=u,p[3]=pskl.app.piskelController.getFPS(),p[4]=f,p[5]=m,p[6]=e.getLayers().length,p[7]=a.length,8);for(i=0;i<f;i++)p[y+i]=d.charCodeAt(i);for(y+=f,i=0;i<m;i++)p[y+i]=g.charCodeAt(i);for(y+=m,i=0;i<a.length;i++)p[y+i]=a.charCodeAt(i);for(y+=a.length,i=0,n=e.getLayers();i<n.length;i++){var v=n[i],C=v.getFrames(),S=v.getName(),k=S.length,v=v.getOpacity(),C=C.length;for(o=r[i].uri,s=r[i].length,p[y]=k,p[y+1]=Math.floor(65535*v),p[y+2]=C,p[y+3]=(4294901760&s)>>16>>>0,p[y+4]=(65535&s)>>>0,t=0;t<k;t++)p[y+5+t]=S.charCodeAt(t);for(t=0;t<s;t++)c[2*(y+5+k)+t]=o.charCodeAt(t);y+=Math.ceil(5+k+s/2)}return l}}})(),(()=>{var e=$.namespace("pskl.utils.serialization.backward");e.Deserializer_v0=function(e,t){this.data_=e,this.callback_=t},e.Deserializer_v0.prototype.deserialize=function(){var e=this.data_.map(function(e){return pskl.model.Frame.fromPixelGrid(e)}),t=new pskl.model.piskel.Descriptor("Deserialized piskel",""),e=pskl.model.Layer.fromFrames("Layer 1",e);this.callback_(pskl.model.Piskel.fromLayers([e],Constants.DEFAULT.FPS,t))}})(),(()=>{var e=$.namespace("pskl.utils.serialization.backward");e.Deserializer_v1=function(e,t){this.callback_=t,this.data_=e},e.Deserializer_v1.prototype.deserialize=function(){var e=this.data_.piskel,t=new pskl.model.piskel.Descriptor("Deserialized piskel",""),r=new pskl.model.Piskel(e.width,e.height,Constants.DEFAULT.FPS,t);e.layers.forEach(function(e){e=this.deserializeLayer(e);r.addLayer(e)}.bind(this)),this.callback_(r)},e.Deserializer_v1.prototype.deserializeLayer=function(e){var e=JSON.parse(e),t=new pskl.model.Layer(e.name);return e.frames.forEach(function(e){e=this.deserializeFrame(e);t.addFrame(e)}.bind(this)),t},e.Deserializer_v1.prototype.deserializeFrame=function(e){e=JSON.parse(e);return pskl.model.Frame.fromPixelGrid(e)}})(),(()=>{function e(){!function(e){function p(e,t){if({}.hasOwnProperty.call(p.cache,e))return p.cache[e];var r,i=p.resolve(e);if(i)return r={id:e,require:p,filename:e,exports:{},loaded:!1,parent:t,children:[]},t&&t.children.push(r),t=e.slice(0,e.lastIndexOf("/")+1),p.cache[e]=r.exports,i.call(r.exports,r,r.exports,t,e),r.loaded=!0,p.cache[e]=r.exports;throw new Error("Failed to resolve module "+e)}p.modules={},p.cache={},p.resolve=function(e){return{}.hasOwnProperty.call(p.modules,e)?p.modules[e]:void 0},p.define=function(e,t){p.modules[e]=t},p.define("/gif.worker.coffee",function(e,t,r,i){var o=p("/GIFEncoder.js",e),n=function(i){var n,e=new o(i.width,i.height);return 0===i.index?e.writeHeader():e.firstFrame=!1,e.setTransparent(i.transparent),e.setRepeat(i.repeat),e.setDelay(i.delay),e.setQuality(i.quality),e.setPreserveColors(i.preserveColors),e.addFrame(i.data),i.last&&e.finish(),e=e.stream(),i.data=e.pages,i.cursor=e.cursor,i.pageSize=e.constructor.pageSize,i.canTransfer?(e=function(e){for(var t=0,r=i.data.length;t<r;++t)n=i.data[t],e.push(n.buffer);return e}.call(this,[]),self.postMessage(i,e)):self.postMessage(i)};self.onmessage=function(e){return n(e.data)}}),p.define("/GIFEncoder.js",function(e,t,r,i){function n(){this.page=-1,this.pages=[],this.newPage()}function o(e,t){this.width=~~e,this.height=~~t,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new n}var s=p("/TypedNeuQuant.js",e),a=p("/SimpleQuant.js",e),l=p("/LZWEncoder.js",e);n.pageSize=4096,n.charMap={};for(var c=0;c<256;c++)n.charMap[c]=String.fromCharCode(c);n.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(n.pageSize),this.cursor=0},n.prototype.getData=function(){for(var e="",t=0;t<this.pages.length;t++)for(var r=0;r<n.pageSize;r++)e+=n.charMap[this.pages[t][r]];return e},n.prototype.writeByte=function(e){this.cursor>=n.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=e},n.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))},n.prototype.writeBytes=function(e,t,r){for(var i=r||e.length,n=t||0;n<i;n++)this.writeByte(e[n])},o.prototype.setDelay=function(e){this.delay=Math.round(e/10)},o.prototype.setFrameRate=function(e){this.delay=Math.round(100/e)},o.prototype.setDispose=function(e){0<=e&&(this.dispose=e)},o.prototype.setRepeat=function(e){this.repeat=e},o.prototype.setTransparent=function(e){this.transparent=e},o.prototype.setPreserveColors=function(e){this.preserveColors=e},o.prototype.addFrame=function(e){this.image=e,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),0<=this.repeat)&&this.writeNetscapeExt(),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},o.prototype.finish=function(){this.out.writeByte(59)},o.prototype.setQuality=function(e){this.sample=e=e<1?1:e},o.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},o.prototype.analyzePixels=function(){for(var e,t,r=this.pixels.length/3,i=(this.indexedPixels=new Uint8Array(r),(t=this.preserveColors?(e=this.toRGBComponents(this.transparent),new a(this.pixels,this.sample,e)):new s(this.pixels,this.sample)).buildColormap(),this.colorTab=t.getColormap(),0),n=0;n<r;n++){var o=t.lookupRGB(255&this.pixels[i++],255&this.pixels[i++],255&this.pixels[i++]);this.usedEntry[o]=!0,this.indexedPixels[n]=o}this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=this.findClosest(this.transparent))},o.prototype.toRGBComponents=function(e){return e?{r:(16711680&e)>>16,g:(65280&e)>>8,b:255&e}:null},o.prototype.findClosest=function(e){if(null===this.colorTab)return-1;for(var t=(16711680&e)>>16,r=(65280&e)>>8,i=255&e,n=0,o=16777216,s=this.colorTab.length,a=0;a<s;){var l=t-(255&this.colorTab[a++]),c=r-(255&this.colorTab[a++]),p=i-(255&this.colorTab[a]),l=l*l+c*c+p*p,c=parseInt(a/3);(this.preserveColors||this.usedEntry[c])&&l<o&&(o=l,n=c),a++}return n},o.prototype.getImagePixels=function(){for(var e=this.width,t=this.height,r=(this.pixels=new Uint8Array(e*t*3),this.image),i=0,n=0;n<t;n++)for(var o=0;o<e;o++){var s=n*e*4+4*o;this.pixels[i++]=r[s],this.pixels[i++]=r[1+s],this.pixels[i++]=r[2+s]}},o.prototype.writeGraphicCtrlExt=function(){var e,t;this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),t=null===this.transparent?e=0:(e=1,2),0<=this.dispose&&(t=7&dispose),this.out.writeByte(0|(t<<=2)|e),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},o.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},o.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},o.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},o.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var e=768-this.colorTab.length,t=0;t<e;t++)this.out.writeByte(0)},o.prototype.writeShort=function(e){this.out.writeByte(255&e),this.out.writeByte(e>>8&255)},o.prototype.writePixels=function(){new l(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this.out)},o.prototype.stream=function(){return this.out},e.exports=o}),p.define("/LZWEncoder.js",function(e,t,r,i){var E=-1,w=12,T=5003,P=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=function(t,r,e,i){function n(e,t){v[d++]=e,254<=d&&s(t)}function c(e){for(var t=0;t<e;++t)C[t]=-1}function o(e,t){var r,i,n,o,s,a,l;for(b=!1,n_bits=g=e,f=p(n_bits),y=(m=1<<e-1)+1,_=m+2,d=0,n=h(),a=0,r=T;r<65536;r*=2)++a;a=8-a,c(s=T),u(m,t);e:for(;(l=h())!=E;)if(C[i=l<<a^n]===(r=(l<<w)+n))n=S[i];else{if(0<=C[i]){o=0===i?1:s-i;do{if((i-=o)<0&&(i+=s),C[i]===r){n=S[i];continue e}}while(0<=C[i])}u(n,t),n=l,_<1<<w?(S[i]=_++,C[i]=r):(l=t,c(T),_=m+2,b=!0,u(m,l))}u(n,t),u(y,t)}function s(e){0<d&&(e.writeByte(d),e.writeBytes(v,0,d),d=0)}function p(e){return(1<<e)-1}function h(){return 0===remaining?E:(--remaining,255&e[curPixel++])}function u(e,t){for(a&=P[k],0<k?a|=e<<k:a=e,k+=n_bits;8<=k;)n(255&a,t),a>>=8,k-=8;if((f<_||b)&&(b?(f=p(n_bits=g),b=!1):(++n_bits,f=n_bits==w?1<<w:p(n_bits))),e==y){for(;0<k;)n(255&a,t),a>>=8,k-=8;s(t)}}var a,d,f,g,m,y,l=Math.max(2,i),v=new Uint8Array(256),C=new Int32Array(T),S=new Int32Array(T),k=0,_=0,b=!1;this.encode=function(e){e.writeByte(l),remaining=t*r,curPixel=0,o(l+1,e),e.writeByte(0)}}}),p.define("/SimpleQuant.js",function(e,t,r,i){function n(e,t,r){return[e,t,r].join(".")}e.exports=function(e,t,s){this.pixels=e,this.palette=[],this.paletteIndex={},this.getColormap=function(){return this.palette},this.buildColormap=function(){for(var e=this.pixels.length/3,t=0,r=0;r<e;r++){var i=this.pixels[t++],n=this.pixels[t++],o=this.pixels[t++];this.addColorToPalette(i,n,o)}s&&this.addColorToPalette(s.r,s.g,s.b)},this.addColorToPalette=function(e,t,r){var i=n(e,t,r);this.paletteIndex.hasOwnProperty(i)||(this.palette.push(e),this.palette.push(t),this.palette.push(r),this.paletteIndex[i]=this.palette.length/3-1)},this.lookupRGB=function(e,t,r){return this.paletteIndex[n(e,t,r)]}}}),p.define("/TypedNeuQuant.js",function(e,t,r,i){var F=100,N=256,d=N-1,M=4,U=16,f=1<<U,z=10,B=10,H=f>>B,W=f<<z-B,$=6,G=(N>>3)*(1<<$),j=30,q=1024,K=256,V=1<<18,Z=499,Y=491,X=487,Q=503,J=3*Q;e.exports=function(L,A){function h(){var e=L.length,t=30+(A-1)/3,r=e/(3*A),i=~~(r/F),n=q,o=G,s=o>>$;for(s<=1&&(s=0),m=0;m<s;m++)O[m]=n*((s*s-m*m)*K/(s*s));for(var a,l,c,p,h,u,d,f=e<J?(A=1,3):e%Z!=0?3*Z:e%Y!=0?3*Y:e%X!=0?3*X:3*Q,g=0,m=0;m<r;){if(a=(255&L[g])<<M,p=((e,t,r)=>{for(var i,n=2147483647,o=n,s=-1,a=s,l=0;l<N;l++)i=x[l],(i=Math.abs(i[0]-e)+Math.abs(i[1]-t)+Math.abs(i[2]-r))<n&&(n=i,s=l),(i=i-(R[l]>>U-M))<o&&(o=i,a=l),i=D[l]>>B,D[l]-=i,R[l]+=i<<z;return D[s]+=H,R[s]-=W,a})(a,l=(255&L[g+1])<<M,c=(255&L[g+2])<<M),h=n,y=a,v=l,d=c,x[u=p][0]-=h*(x[u][0]-y)/q,x[u][1]-=h*(x[u][1]-v)/q,x[u][2]-=h*(x[u][2]-d)/q,0!==s){b=_=I=P=T=w=E=k=S=C=v=y=void 0;for(var y=s,v=p,C=a,S=l,k=c,_,b,E=Math.abs(v-y),w=Math.min(v+y,N),T=v+1,P=v-1,I=1;T<w||E<P;)b=O[I++],T<w&&((_=x[T++])[0]-=b*(_[0]-C)/V,_[1]-=b*(_[1]-S)/V,_[2]-=b*(_[2]-k)/V),E<P&&((_=x[P--])[0]-=b*(_[0]-C)/V,_[1]-=b*(_[1]-S)/V,_[2]-=b*(_[2]-k)/V)}if(e<=(g+=f)&&(g-=e),++m%(i=0===i?1:i)==0)for(n-=n/t,(s=(o-=o/j)>>$)<=1&&(s=0),p=0;p<s;p++)O[p]=n*((s*s-p*p)*K/(s*s))}}var x,u,R,D,O;this.buildColormap=function(){var e,t;for(x=[],u=new Int32Array(256),R=new Int32Array(N),D=new Int32Array(N),O=new Int32Array(N>>3),e=0;e<N;e++)t=(e<<M+8)/N,x[e]=new Float64Array([t,t,t,0]),D[e]=f/N,R[e]=0;h();for(var r=0;r<N;r++)x[r][0]>>=M,x[r][1]>>=M,x[r][2]>>=M,x[r][3]=r;for(var i,n,o,s,a,l=0,c=0,p=0;p<N;p++){for(a=(n=x[s=p])[1],i=p+1;i<N;i++)(o=x[i])[1]<a&&(s=i,a=o[1]);if(o=x[s],p!=s&&(i=o[0],o[0]=n[0],n[0]=i,i=o[1],o[1]=n[1],n[1]=i,i=o[2],o[2]=n[2],n[2]=i,i=o[3],o[3]=n[3],n[3]=i),a!=l){for(u[l]=c+p>>1,i=l+1;i<a;i++)u[i]=p;l=a,c=p}}for(u[l]=c+d>>1,i=l+1;i<256;i++)u[i]=d},this.getColormap=function(){for(var e=[],t=[],r=0;r<N;r++)t[x[r][3]]=r;for(var i=0,n=0;n<N;n++){var o=t[n];e[i++]=x[o][0],e[i++]=x[o][1],e[i++]=x[o][2]}return e},this.lookupRGB=function(e,t,r){for(var i,n,o,s=1e3,a=-1,l=u[t],c=l-1;l<N||0<=c;)l<N&&(s<=(o=(n=x[l])[1]-t)?l=N:(l++,o<0&&(o=-o),(o+=i=(i=n[0]-e)<0?-i:i)<s&&(o+=i=(i=n[2]-r)<0?-i:i)<s&&(s=o,a=n[3]))),0<=c&&(s<=(o=t-(n=x[c])[1])?c=-1:(c--,o<0&&(o=-o),(o+=i=(i=n[0]-e)<0?-i:i)<s&&(o+=i=(i=n[2]-r)<0?-i:i)<s&&(s=o,a=n[3])));return a}}}),p("/gif.worker.coffee")}.call(this,this)}var t,r,i;try{pskl.utils.UserAgent.isIE11?(i="js/lib/gif/gif.ie.worker.js",window.pskl&&window.pskl.appEngineToken_&&(i="../"+i)):(t=(e+"").replace(/function\s?\(\)\s?\{/,"").replace(/\}[^}]*$/,""),r=new Blob([t],{type:"application/javascript"}),i=URL.createObjectURL(r)),window.GifWorkerURL=i}catch(e){console.error("Could not create worker",e.message)}})(),!function(e){function p(e,t){if({}.hasOwnProperty.call(p.cache,e))return p.cache[e];var r,i=p.resolve(e);if(i)return r={id:e,require:p,filename:e,exports:{},loaded:!1,parent:t,children:[]},t&&t.children.push(r),t=e.slice(0,e.lastIndexOf("/")+1),p.cache[e]=r.exports,i.call(r.exports,r,r.exports,t,e),r.loaded=!0,p.cache[e]=r.exports;throw new Error("Failed to resolve module "+e)}p.modules={},p.cache={},p.resolve=function(e){return{}.hasOwnProperty.call(p.modules,e)?p.modules[e]:void 0},p.define=function(e,t){p.modules[e]=t};t="/";var t,n={title:"browser",version:"v0.8.19",browser:!0,env:{},argv:[],nextTick:e.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return t},chdir:function(e){t=e}};p.define("/gif.coffee",function(e,t,r,i){function o(e,t){return{}.hasOwnProperty.call(e,t)}var s,a,l=p("events",e).EventEmitter,c=p("/browser.coffee",e),n=(()=>{function e(e){var t,r;for(t in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),s)r=s[t],null!=this.options[t]?this.options[t]:this.options[t]=r}var t,r=e,i=l;function n(){this.constructor=r}for(t in i)o(i,t)&&(r[t]=i[t]);return n.prototype=i.prototype,r.prototype=new n,r.__super__=i.prototype,s={workerScript:window.GifWorkerURL,workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,preserveColors:!1},a={delay:500,copy:!1},e.prototype.setOption=function(e,t){return this.options[e]=t,null==this._canvas||"width"!==e&&"height"!==e?void 0:this._canvas[e]=t},e.prototype.setOptions=function(t){var r,i;return function(e){for(r in t)o(t,r)&&(i=t[r],e.push(this.setOption(r,i)));return e}.call(this,[])},e.prototype.addFrame=function(e,t){var r,i;for(i in null==t&&(t={}),(r={}).transparent=this.options.transparent,a)r[i]=t[i]||a[i];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!=ImageData&&e instanceof ImageData)r.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?r.data=this.getContextData(e):r.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?r.data=this.getImageData(e):r.image=e}return this.frames.push(r)},e.prototype.render=function(){if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(e){for(var t=function(){for(var e=[],t=0;0<=this.frames.length?t<this.frames.length:t>this.frames.length;0<=this.frames.length?++t:--t)e.push(t);return e}.apply(this,arguments),r=0,i=t.length;r<i;++r)t[r],e.push(null);return e}.call(this,[]);for(var r=this.spawnWorkers(),e=function(){for(var e=[],t=0;0<=r?t<r:r<t;0<=r?++t:--t)e.push(t);return e}.apply(this,arguments),t=0,i=e.length;t<i;++t)e[t],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)console.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var i,r=Math.min(this.options.workers,this.frames.length);return function(){for(var e=[],t=this.freeWorkers.length;this.freeWorkers.length<=r?t<r:r<t;this.freeWorkers.length<=r?++t:--t)e.push(t);return e}.apply(this,arguments).forEach((i=this,function(e){var t,r;return console.log("spawning worker "+e),(t=new Worker(i.options.workerScript)).onmessage=(r=i,function(e){return r.activeWorkers.splice(r.activeWorkers.indexOf(t),1),r.freeWorkers.push(t),r.frameFinished(e.data)}),i.freeWorkers.push(t)})),r},e.prototype.frameFinished=function(e){return console.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,((e,t)=>{for(var r=0,i=t.length;r<i;++r)if(r in t&&t[r]===e)return 1})(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){for(var e,t,r,i=0,n=0,o=this.imageParts.length;n<o;++n)i+=((p=this.imageParts[n]).data.length-1)*p.pageSize+p.cursor;i+=p.pageSize-p.cursor,console.log("rendering finished - filesize "+Math.round(i/1e3)+"kb");for(var s=new Uint8Array(i),a=0,l=0,c=this.imageParts.length;l<c;++l)for(var p,h=0,u=(p=this.imageParts[l]).data.length;h<u;++h)r=p.data[h],e=h,s.set(r,a),e===p.data.length-1?a+=p.cursor:a+=p.pageSize;return t=new Blob([s],{type:"image/gif"}),this.emit("finished",t,s)},e.prototype.renderNextFrame=function(){var e,t;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(e=this.frames[this.nextFrame++],t=this.freeWorkers.shift(),e=this.getTask(e),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(t),t.postMessage(e))},e.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},e.prototype.getTask=function(e){var t=this.frames.indexOf(e),t={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,preserveColors:this.options.preserveColors,repeat:this.options.repeat,canTransfer:"chrome"===c.name};if(null!=e.data)t.data=e.data;else if(null!=e.context)t.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");t.data=this.getImageData(e.image)}return t},e})();e.exports=n}),p.define("/browser.coffee",function(e,t,r,i){var n=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),s=n.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],a="ie"===s[1]&&document.documentMode,a={name:"version"===s[1]?s[3]:s[1],version:a||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:n.match(/ip(?:ad|od|hone)/)?"ios":(n.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}};a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,e.exports=a}),p.define("events",function(e,t,r,i){n.EventEmitter||(n.EventEmitter=function(){});var t=t.EventEmitter=n.EventEmitter,s="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._events.maxListeners=e},t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"!=typeof t){if(s(t)){for(var r=Array.prototype.slice.call(arguments,1),i=t.slice(),n=0,o=i.length;n<o;n++)i[n].apply(this,r);return!0}return!1}switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1);t.apply(this,r)}return!0},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");var r;return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?s(this._events[e])?(this._events[e].warned||(r=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace()),this._events[e].push(t)):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(t,r){var i=this;return i.on(t,function e(){i.removeListener(t,e),r.apply(this,arguments)}),this},t.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(this._events&&this._events[e]){var r=this._events[e];if(s(r)){var i=r.indexOf(t);if(i<0)return this;r.splice(i,1),0==r.length&&delete this._events[e]}else this._events[e]===t&&delete this._events[e]}return this},t.prototype.removeAllListeners=function(e){return e&&this._events&&this._events[e]&&(this._events[e]=null),this},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}),e.GIF=p("/gif.coffee")}.call(this,this),(e=>{function t(e){this.data=e,this.len=this.data.length,this.pos=0}t.prototype.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},t.prototype.readBytes=function(e){for(var t=[],r=0;r<e;r++)t.push(this.readByte());return t},t.prototype.read=function(e){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readByte());return t},t.prototype.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]},(e.SuperGIF=e.SuperGIF||{}).Stream=t})(window),(k=>{function _(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],r=0;r<e;r++)t.push(this.readByte());return t},this.read=function(e){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}}function b(o,s){s=s||{};var i=function(e){for(var t=[],r=0;r<e;r++)t.push(o.readBytes(3));return t},a=function(){for(var e,t="";e=o.readByte(),t+=o.read(e),0!==e;);return t},t=function(e){function t(e){var t;o.readByte(),e.identifier=o.read(8),e.authCode=o.read(3),"NETSCAPE"===e.identifier?(t=e,o.readByte(),t.unknown=o.readByte(),t.iterations=o.readUnsigned(),t.terminator=o.readByte(),s.app&&s.app.NETSCAPE&&s.app.NETSCAPE(t)):((t=e).appData=a(),s.app&&s.app[t.identifier]&&s.app[t.identifier](t))}var r,i;switch(e.label=o.readByte(),e.label){case 249:e.extType="gce",n=e,o.readByte(),i=p(o.readByte()),n.reserved=i.splice(0,3),n.disposalMethod=c(i.splice(0,3)),n.userInput=i.shift(),n.transparencyGiven=i.shift(),n.delayTime=o.readUnsigned(),n.transparencyIndex=o.readByte(),n.terminator=o.readByte(),s.gce&&s.gce(n);break;case 254:e.extType="com",(i=e).comment=a(),s.com&&s.com(i);break;case 1:e.extType="pte";var n=e;o.readByte(),n.ptHeader=o.readBytes(12),n.ptData=a(),s.pte&&s.pte(n);break;case 255:e.extType="app",t(e);break;default:e.extType="unknown",(r=e).data=a(),s.unknown&&s.unknown(r)}},r=function(e){function t(e,t){for(var r=new Array(e.length),i=e.length/t,n=[0,4,2,1],o=[8,8,4,2],s=0,a=0;a<4;a++)for(var l=n[a];l<i;l+=o[a]){p=c=void 0;var c=l,p=s;p=e.slice(p*t,(p+1)*t),r.splice.apply(r,[c*t,t].concat(p)),s++}return r}e.leftPos=o.readUnsigned(),e.topPos=o.readUnsigned(),e.width=o.readUnsigned(),e.height=o.readUnsigned();var r=p(o.readByte()),r=(e.lctFlag=r.shift(),e.interlaced=r.shift(),e.sorted=r.shift(),e.reserved=r.splice(0,2),e.lctSize=c(r.splice(0,3)),e.lctFlag&&(e.lct=i(1<<e.lctSize+1)),e.lzwMinCodeSize=o.readByte(),a());e.pixels=h(e.lzwMinCodeSize,r),e.interlaced&&(e.pixels=t(e.pixels,e.width)),s.img&&s.img(e)},n=function(){var e={};switch(e.sentinel=o.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",t(e);break;case",":e.type="img",r(e);break;case";":e.type="eof",s.eof&&s.eof(e);break;default:return s.onError(new Error("Unknown block: 0x"+e.sentinel.toString(16)))}"eof"!==e.type&&setTimeout(n,0)},e={};if(e.sig=o.read(3),e.ver=o.read(3),"GIF"!==e.sig)throw s.onError(),new Error("Not a GIF file.");e.width=o.readUnsigned(),e.height=o.readUnsigned();var l=p(o.readByte());e.gctFlag=l.shift(),e.colorRes=c(l.splice(0,3)),e.sorted=l.shift(),e.gctSize=c(l.splice(0,3)),e.bgColor=o.readByte(),e.pixelAspectRatio=o.readByte(),e.gctFlag&&(e.gct=i(1<<e.gctSize+1)),s.hdr&&s.hdr(e),setTimeout(n,0)}var c=function(e){return e.reduce(function(e,t){return 2*e+t},0)},p=function(e){for(var t=[],r=7;0<=r;r--)t.push(!!(e&1<<r));return t},h=function(e,i){for(var t,r,n=0,o=[],s=1<<e,a=1+s,l=e+1,c=[];;)if(r=t,(t=(e=>{for(var t=0,r=0;r<e;r++)i.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<r),n++;return t})(l))===s){p=void 0,c=[],l=e+1;for(var p=0;p<s;p++)c[p]=[p];c[s]=[],c[a]=null}else{if(t===a)break;if(t<c.length)r!==s&&c.push(c[r].concat(c[t][0]));else{if(t!==c.length)throw new Error("Invalid LZW code.");c.push(c[r].concat(c[r][0]))}o.push.apply(o,c[t]),c.length===1<<l&&l<12&&l++}return o};k.SuperGif=function(e){var t,r,n,i={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(t in e)i[t]=e[t];i.vp_w&&i.vp_h&&(i.is_vp=!0);function o(){try{b(r,y)}catch(e){s("parse")}}function s(e){n={width:m.width,height:m.height},g=[]}function a(){d&&g.push({data:d.getImageData(0,0,n.width,n.height),delay:c})}var l=null,c=null,p=null,h=0,u=null,d=null,f=null,g=[],m=i.gif,y={hdr:function(e){var t;e=(n=e).width,t=n.height,S.width=e,S.height=t,S.getContext("2d").setTransform(1,0,0,1,0,0)},gce:function(e){a(),u=p,d=p=c=l=null,l=e.transparencyGiven?e.transparencyIndex:null,c=e.delayTime,p=e.disposalMethod},img:function(e){d=d||S.getContext("2d");var t=g.length,r=e.lctFlag?e.lct:n.gct,t=(0<t&&(3===u?d.putImageData(g[h].data,0,0):h=t-1,2===u)&&d.clearRect(f.leftPos,f.topPos,f.width,f.height),d.getImageData(e.leftPos,e.topPos,e.width,e.height)),i=t.data;e.pixels.forEach(function(e,t){e!==l&&(i[4*t+0]=r[e][0],i[4*t+1]=r[e][1],i[4*t+2]=r[e][2],i[4*t+3]=255)}),d.putImageData(t,e.leftPos,e.topPos),f=e},eof:function(e){a(),v&&v()},onError:function(e){C&&C()}},v=!1,C=!1,S=document.createElement("canvas");return{load:function(e){var t;v=e.success,C=e.error,-1!==m.src.indexOf("data:")?(e=m.src.substring(m.src.indexOf(",")+1),r=new _(k.atob(e)),o()):((t=new XMLHttpRequest).overrideMimeType("text/plain; charset=x-user-defined"),t.onload=function(e){r=new _(t.responseText),setTimeout(o,0)},t.onerror=function(){s("xhr")},t.open("GET",m.getAttribute("data-animated-src")||m.src,!0),t.send())},getFrames:function(){return g}}}})(window),(e=>{"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.JSZip=e():"undefined"!=typeof global?global.JSZip=e():"undefined"!=typeof self&&(self.JSZip=e())})(function(){return function i(n,o,s){function a(r,e){if(!o[r]){if(!n[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);throw new Error("Cannot find module '"+r+"'")}e=o[r]={exports:{}};n[r][0].call(e.exports,function(e){var t=n[r][1][e];return a(t||e)},e,e.exports,i,n,o,s)}return o[r].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,r){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,n,o,s,a="",l=0;l<e.length;)i=(t=e.charCodeAt(l++))>>2,n=(3&t)<<4|(t=e.charCodeAt(l++))>>4,o=(15&t)<<2|(r=e.charCodeAt(l++))>>6,s=63&r,isNaN(t)?o=s=64:isNaN(r)&&(s=64),a=a+c.charAt(i)+c.charAt(n)+c.charAt(o)+c.charAt(s);return a},r.decode=function(e){var t,r,i,n,o,s,a="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)i=c.indexOf(e.charAt(l++)),t=(15&(n=c.indexOf(e.charAt(l++))))<<4|(o=c.indexOf(e.charAt(l++)))>>2,r=(3&o)<<6|(s=c.indexOf(e.charAt(l++))),a+=String.fromCharCode(i<<2|n>>4),64!=o&&(a+=String.fromCharCode(t)),64!=s&&(a+=String.fromCharCode(r));return a}},{}],2:[function(e,t){function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){r.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":6}],4:[function(e,t){function r(){this.data=null,this.length=0,this.index=0}var i=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":14}],5:[function(e,t,r){r.base64=!1,r.binary=!1,r.dir=!1,r.date=null,r.compression=null},{}],6:[function(e,t,r){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("zlibjs/bin/rawdeflate.min").Zlib,o=e("zlibjs/bin/rawinflate.min").Zlib;r.uncompressInputType=i?"uint8array":"array",r.compressInputType=i?"uint8array":"array",r.magic="\b\0",r.compress=function(e){return new n.RawDeflate(e).compress()},r.uncompress=function(e){return new o.RawInflate(e).decompress()}},{"zlibjs/bin/rawdeflate.min":19,"zlibjs/bin/rawinflate.min":20}],7:[function(e,t){function r(e,t){return this instanceof r?(this.files={},this.root="",e&&this.load(e,t),void(this.clone=function(){var e,t=new r;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t})):new r(e,t)}(r.prototype=e("./object")).load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./utils"),r.base64=e("./base64"),r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":5,"./load":8,"./object":9,"./support":12,"./utils":14}],8:[function(e,t){var o=e("./base64"),s=e("./zipEntries");t.exports=function(e,t){var r,i,n;for((t=t||{}).base64&&(e=o.decode(e)),r=new s(e,t).files,i=0;i<r.length;i++)n=r[i],this.file(n.fileName,n.decompressed,{binary:!0,optimizedBinaryString:!0,date:n.date,dir:n.dir});return this}},{"./base64":1,"./zipEntries":15}],9:[function(e,t){function r(e){var t;return e._data instanceof _&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===v.getTypeOf(e._data))&&(t=e._data,e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)),e._data}function n(e){var t=r(e);if("string"!==v.getTypeOf(t))return t;if(!e.options.binary){if(c)return c.encode(t);if(h.nodebuffer)return b(t,"utf-8")}return e.asBinary()}function i(e){var t=r(this);return null==t?"":(this.options.base64&&(t=S.decode(t)),t=e&&this.options.binary?T.utf8decode(t):v.transformTo("string",t),t=e||this.options.binary?t:T.utf8encode(t))}function o(e,t,r){this.name=e,this._data=t,this.options=r}function d(e,t){for(var r="",i=0;i<t;i++)r+=String.fromCharCode(255&e),e>>>=8;return r}function s(e){return!0===(e=e||{}).base64&&null==e.binary&&(e.binary=!0),(e=E(e,u)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e}function a(e){var t=(e="/"==e.slice(-1)?e.substring(0,e.length-1):e).lastIndexOf("/");return 0<t?e.substring(0,t):""}function l(e){return"/"!=e.slice(-1)&&(e+="/"),this.files[e]||w.call(this,e,null,{dir:!0}),this.files[e]}function f(e,t){var r,i=new _;return e._data instanceof _?(i.uncompressedSize=e._data.uncompressedSize,i.crc32=e._data.crc32,0===i.uncompressedSize||e.options.dir?(t=k.STORE,i.compressedContent="",i.crc32=0):e._data.compressionMethod===t.magic?i.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),i.compressedContent=t.compress(v.transformTo(t.compressInputType,r)))):((r=n(e))&&0!==r.length&&!e.options.dir||(t=k.STORE,r=""),i.uncompressedSize=r.length,i.crc32=this.crc32(r),i.compressedContent=t.compress(v.transformTo(t.compressInputType,r))),i.compressedSize=i.compressedContent.length,i.compressionMethod=t.magic,i}function g(e,t,r,i){r.compressedContent;var n,o=this.utf8encode(t.name),s=o!==t.name,a="",l=(c=t.options).date.getHours(),c=(l=(l=((l<<=6)|c.date.getMinutes())<<5)|c.date.getSeconds()/2,n=c.date.getFullYear()-1980,n=(n=((n<<=4)|c.date.getMonth()+1)<<5)|c.date.getDate(),s&&(c=d(1,1)+d(this.crc32(o),4)+o,a+="up"+d(c.length,2)+c),""),c=(c=(c=(c=(c=(c=(c=(c=(c+="\n\0")+(s?"\0\b":"\0\0")+r.compressionMethod)+d(l,2))+d(n,2))+d(r.crc32,4))+d(r.compressedSize,4))+d(r.uncompressedSize,4))+d(o.length,2))+d(a.length,2);return{fileRecord:C.LOCAL_FILE_HEADER+c+o+a,dirRecord:C.CENTRAL_FILE_HEADER+"\0"+c+"\0\0\0\0\0\0"+(!0===t.options.dir?"\0\0\0":"\0\0\0\0")+d(i,4)+o+a,compressedObject:r}}function m(){this.data=[]}function y(e){this.data=new Uint8Array(e),this.index=0}var c,p,h=e("./support"),v=e("./utils"),C=e("./signature"),u=e("./defaults"),S=e("./base64"),k=e("./compressions"),_=e("./compressedObject"),b=e("./nodeBuffer"),E=(h.uint8array&&"function"==typeof TextEncoder&&"function"==typeof TextDecoder&&(c=new TextEncoder("utf-8"),p=new TextDecoder("utf-8")),o.prototype={asText:function(){return i.call(this,!0)},asBinary:function(){return i.call(this,!1)},asNodeBuffer:function(){var e=n(this);return v.transformTo("nodebuffer",e)},asUint8Array:function(){var e=n(this);return v.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}},function(){for(var e,t={},r=0;r<arguments.length;r++)for(e in arguments[r])arguments[r].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[r][e]);return t}),w=function(e,t,r){var i=a(e),n=v.getTypeOf(t);if(i&&l.call(this,i),(r=s(r)).dir||null==t)r.base64=!1,r.binary=!1,t=null;else if("string"===n)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=v.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(n||t instanceof _))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===n&&(t=v.transformTo("uint8array",t))}i=new o(e,t,r);return this.files[e]=i},T=(m.prototype={append:function(e){e=v.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},y.prototype={append:function(e){0!==e.length&&(e=v.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},{load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,i,n=[];for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],i=new o(i.name,i._data,E(i.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root)&&e(r,i)&&n.push(i);return n},file:function(r,e,t){var i;return 1===arguments.length?v.isRegExp(r)?(i=r,this.filter(function(e,t){return!t.options.dir&&i.test(e)})):this.filter(function(e,t){return!t.options.dir&&e===r})[0]||null:(r=this.root+r,w.call(this,r,e,t),this)},folder:function(r){var e,t;return r?v.isRegExp(r)?this.filter(function(e,t){return t.options.dir&&r.test(e)}):(e=this.root+r,e=l.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(r){r=this.root+r;var e=this.files[r];if(e||("/"!=r.slice(-1)&&(r+="/"),e=this.files[r]),e)if(e.options.dir)for(var t=this.filter(function(e,t){return t.name.slice(0,r.length)===r}),i=0;i<t.length;i++)delete this.files[t[i].name];else delete this.files[r];return this},generate:function(e){e=E(e||{},{base64:!0,compression:"STORE",type:"base64"}),v.checkSupport(e.type);var t,r=[],i=0,n=0;for(t in this.files)if(this.files.hasOwnProperty(t)){var o=this.files[t],s=o.options.compression||e.compression.toUpperCase(),a=k[s];if(!a)throw new Error(s+" is not a valid compression method !");s=f.call(this,o,a),a=g.call(this,t,o,s,i);i+=a.fileRecord.length+s.compressedSize,n+=a.dirRecord.length,r.push(a)}for(var l=C.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(r.length,2)+d(r.length,2)+d(n,4)+d(i,4)+"\0\0",c=e.type.toLowerCase(),p="uint8array"===c||"arraybuffer"===c||"blob"===c||"nodebuffer"===c?new y(i+n+l.length):new m,h=0;h<r.length;h++)p.append(r[h].fileRecord),p.append(r[h].compressedObject.compressedContent);for(h=0;h<r.length;h++)p.append(r[h].dirRecord);p.append(l);var u=p.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return v.transformTo(e.type.toLowerCase(),u);case"blob":return v.arrayBuffer2Blob(v.transformTo("arraybuffer",u));case"base64":return e.base64?S.encode(u):u;default:return u}},crc32:function(e,t){if(void 0===e||!e.length)return 0;var r="string"!==v.getTypeOf(e),i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];void 0===t&&(t=0);t^=-1;for(var n=0,o=e.length;n<o;n++)t=t>>>8^i[255&(t^(r?e[n]:e.charCodeAt(n)))];return-1^t},utf8encode:function(e){var t;if(c)return t=c.encode(e),v.transformTo("string",t);if(h.nodebuffer)return v.transformTo("string",b(e,"utf-8"));for(var r=[],i=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?r[i++]=String.fromCharCode(o):(127<o&&o<2048?r[i++]=String.fromCharCode(o>>6|192):(r[i++]=String.fromCharCode(o>>12|224),r[i++]=String.fromCharCode(o>>6&63|128)),r[i++]=String.fromCharCode(63&o|128))}return r.join("")},utf8decode:function(e){var t,r,i=[],n=0,o="string"!==v.getTypeOf(e),s=0,a=0;if(p)return p.decode(v.transformTo("uint8array",e));if(h.nodebuffer)return v.transformTo("nodebuffer",e).toString("utf-8");for(;s<e.length;)(t=o?e[s]:e.charCodeAt(s))<128?(i[n++]=String.fromCharCode(t),s++):191<t&&t<224?(a=o?e[s+1]:e.charCodeAt(s+1),i[n++]=String.fromCharCode((31&t)<<6|63&a),s+=2):(a=o?e[s+1]:e.charCodeAt(s+1),r=o?e[s+2]:e.charCodeAt(s+2),i[n++]=String.fromCharCode((15&t)<<12|(63&a)<<6|63&r),s+=3);return i.join("")}});t.exports=T},{"./base64":1,"./compressedObject":2,"./compressions":3,"./defaults":5,"./nodeBuffer":17,"./signature":10,"./support":12,"./utils":14}],10:[function(e,t,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],11:[function(e,t){function r(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0}var i=e("./dataReader"),n=e("./utils");(r.prototype=new i).byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":4,"./utils":14}],12:[function(t,e,r){t=t("__browserify_process");if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=!t.browser,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{t=new ArrayBuffer(0);try{r.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(t),r.blob=0===i.getBlob("application/zip").size}catch(e){r.blob=!1}}}},{__browserify_process:18}],13:[function(e,t){function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}e=e("./dataReader");(r.prototype=new e).byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),i=e.charCodeAt(2),n=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===r&&this.data[o+2]===i&&this.data[o+3]===n)return o;return-1},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":4}],14:[function(e,t,c){function r(e){return e}function i(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function n(e){var t=65536,r=[],i=e.length,n=c.getTypeOf(e),o=0,s=!0;try{switch(n){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,p(0))}}catch(e){s=!1}if(!s){for(var a="",l=0;l<e.length;l++)a+=String.fromCharCode(e[l]);return a}for(;o<i&&1<t;)try{r.push("array"===n||"nodebuffer"===n?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,i))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,i)))),o+=t}catch(e){t=Math.floor(t/2)}return r.join("")}function o(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var s=e("./support"),a=e("./compressions"),p=e("./nodeBuffer"),l=(c.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},c.string2Uint8Array=function(e){return c.transformTo("uint8array",e)},c.uint8Array2String=function(e){return c.transformTo("string",e)},c.string2Blob=function(e){e=c.transformTo("arraybuffer",e);return c.arrayBuffer2Blob(e)},c.arrayBuffer2Blob=function(t){c.checkSupport("blob");try{return new Blob([t],{type:"application/zip"})}catch(e){try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return r.append(t),r.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},{});l.string={string:r,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,p(e.length))}},l.array={string:n,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return p(e)}},l.arraybuffer={string:function(e){return n(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return p(new Uint8Array(e))}},l.uint8array={string:n,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return p(e)}},l.nodebuffer={string:n,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:r},c.transformTo=function(e,t){if(t=t||"",!e)return t;c.checkSupport(e);var r=c.getTypeOf(t);return l[r][e](t)},c.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&p.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(e){if(!s[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(e){for(var t,r="",i=0;i<(e||"").length;i++)r+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return r},c.findCompression=function(e){for(var t in a)if(a.hasOwnProperty(t)&&a[t].magic===e)return a[t];return null},c.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":17,"./support":12}],15:[function(e,t){function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var i=e("./stringReader"),n=e("./nodeBufferReader"),o=e("./uint8ArrayReader"),s=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===a.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=s.getTypeOf(e);this.reader="string"!==t||c.uint8array?"nodebuffer"===t?new n(e):new o(s.transformTo("uint8array",e)):new i(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":17,"./signature":10,"./stringReader":11,"./support":12,"./uint8ArrayReader":13,"./utils":14,"./zipEntry":16}],16:[function(e,t){function r(e,t){this.options=e,this.loadOptions=t}var i=e("./stringReader"),o=e("./utils"),n=e("./compressedObject"),s=e("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(r,i,n){return function(){var e=r.index,t=(r.setIndex(i),r.readData(n));return r.setIndex(e),t}},prepareContent:function(e,t,r,i,n){return function(){var e=o.transformTo(i.uncompressInputType,this.getCompressedContent()),e=i.uncompress(e);if(e.length!==n)throw new Error("Bug : uncompressed data size mismatch");return e}},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(t),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=o.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new n,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=o.transformTo("string",this.decompressed.getContent()),s.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){var e;this.extraFields[1]&&(e=new i(this.extraFields[1].value),this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS)&&(this.diskNumberStart=e.readInt(4))},readExtraFields:function(e){var t,r,i,n=e.index;for(this.extraFields=this.extraFields||{};e.index<n+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),i=e.readString(r),this.extraFields[t]={id:t,length:r,value:i}},handleUTF8:function(){var e;this.useUTF8()?(this.fileName=s.utf8decode(this.fileName),this.fileComment=s.utf8decode(this.fileComment)):null!==(e=this.findExtraFieldUnicodePath())&&(this.fileName=e)},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=new i(t.value)).readInt(1)||s.crc32(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readString(t.length-5))}},t.exports=r},{"./compressedObject":2,"./object":9,"./stringReader":11,"./utils":14}],17:[function(){},{}],18:[function(e,t){var r,i,n,t=t.exports={};t.nextTick=(i="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener,i?function(e){return window.setImmediate(e)}:n?(r=[],window.addEventListener("message",function(e){var t=e.source;(t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),0<r.length)&&r.shift()()},!0),function(e){r.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.binding=function(){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(){throw new Error("process.chdir is not supported")}},{}],19:[function(){!function(){function e(e,t){var r,i=e.split("."),n=o;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(;i.length&&(r=i.shift());)i.length||t===re?n=n[r]||(n[r]={}):n[r]=t}function Q(e,t){if(this.index="number"==typeof t?t:0,this.d=0,this.buffer=e instanceof(ne?Uint8Array:Array)?e:new(ne?Uint8Array:Array)(32768),2*this.buffer.length<=this.index)throw Error("invalid index");this.buffer.length<=this.index&&l(this)}function l(e){var t,r=e.buffer,i=r.length,n=new(ne?Uint8Array:Array)(i<<1);if(ne)n.set(r);else for(t=0;t<i;++t)n[t]=r[t];return e.buffer=n}function p(e){this.buffer=new(ne?Uint16Array:Array)(2*e),this.length=0}function t(e,t){this.e=oe,this.f=0,this.input=ne&&e instanceof Array?new Uint8Array(e):e,this.c=0,t&&(t.lazy&&(this.f=t.lazy),"number"==typeof t.compressionType&&(this.e=t.compressionType),t.outputBuffer&&(this.b=ne&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex)&&(this.c=t.outputIndex),this.b||(this.b=new(ne?Uint8Array:Array)(32768))}function C(e,t){this.length=e,this.g=t}function J(e,t){function r(e,t){var r,i,n,o=e.g,s=[],a=0,l=S[e.length];switch(s[a++]=65535&l,s[a++]=l>>16&255,s[a++]=l>>24,ie){case 1===o:r=[0,o-1,0];break;case 2===o:r=[1,o-2,0];break;case 3===o:r=[2,o-3,0];break;case 4===o:r=[3,o-4,0];break;case o<=6:r=[4,o-5,1];break;case o<=8:r=[5,o-7,1];break;case o<=12:r=[6,o-9,2];break;case o<=16:r=[7,o-13,2];break;case o<=24:r=[8,o-17,3];break;case o<=32:r=[9,o-25,3];break;case o<=48:r=[10,o-33,4];break;case o<=64:r=[11,o-49,4];break;case o<=96:r=[12,o-65,5];break;case o<=128:r=[13,o-97,5];break;case o<=192:r=[14,o-129,6];break;case o<=256:r=[15,o-193,6];break;case o<=384:r=[16,o-257,7];break;case o<=512:r=[17,o-385,7];break;case o<=768:r=[18,o-513,8];break;case o<=1024:r=[19,o-769,8];break;case o<=1536:r=[20,o-1025,9];break;case o<=2048:r=[21,o-1537,9];break;case o<=3072:r=[22,o-2049,10];break;case o<=4096:r=[23,o-3073,10];break;case o<=6144:r=[24,o-4097,11];break;case o<=8192:r=[25,o-6145,11];break;case o<=12288:r=[26,o-8193,12];break;case o<=16384:r=[27,o-12289,12];break;case o<=24576:r=[28,o-16385,13];break;case o<=32768:r=[29,o-24577,13];break;default:throw"invalid distance"}for(l=r,s[a++]=l[0],s[+a]=l[1],s[5]=l[2],i=0,n=s.length;i<n;++i)d[f++]=s[i];m[s[0]]++,y[s[3]]++,g=e.length+t-1,p=null}var i,n,o,s,a,l,c,p,h,u={},d=ne?new Uint16Array(2*t.length):[],f=0,g=0,m=new(ne?Uint32Array:Array)(286),y=new(ne?Uint32Array:Array)(30),v=e.f;if(!ne){for(o=0;o<=285;)m[o++]=0;for(o=0;o<=29;)y[o++]=0}for(m[256]=1,i=0,n=t.length;i<n;++i){for(o=a=0,s=3;o<s&&i+o!==n;++o)a=a<<8|t[i+o];if(u[a]===re&&(u[a]=[]),l=u[a],!(0<g--)){for(;0<l.length&&32768<i-l[0];)l.shift();if(n<=i+3){for(p&&r(p,-1),o=0,s=n-i;o<s;++o)h=t[i+o],d[f++]=h,++m[h];break}0<l.length?(c=((e,t,r)=>{var i,n,o,s,a,l,c=0,p=e.length;s=0,l=r.length;e:for(;s<l;s++){if(i=r[l-s-1],(o=3)<c){for(a=c;3<a;a--)if(e[i+a-1]!==e[t+a-1])continue e;o=c}for(;o<258&&t+o<p&&e[i+o]===e[t+o];)++o;if(c<o&&(n=i,c=o),258===o)break}return new C(c,t-n)})(t,i,l),p?p.length<c.length?(h=t[i-1],d[f++]=h,++m[h],r(c,0)):r(p,-1):c.length<v?p=c:r(c,0)):p?r(p,-1):(h=t[i],d[f++]=h,++m[h])}l.push(i)}return d[f++]=256,m[256]++,e.j=m,e.i=y,ne?d.subarray(0,f):d}function ee(e,t){var r,i,n,o,s,a=e.length,l=new p(572),c=new(ne?Uint8Array:Array)(a);if(!ne)for(o=0;o<a;o++)c[o]=0;for(o=0;o<a;++o)0<e[o]&&l.push(o,e[o]);if(r=Array(l.length/2),i=new(ne?Uint32Array:Array)(l.length/2),1===r.length)c[l.pop().index]=1;else{for(o=0,s=l.length/2;o<s;++o)r[o]=l.pop(),i[o]=r[o].value;for(n=((e,i,t)=>{var r,n,o,s,a,l=new(ne?Uint16Array:Array)(t),c=new(ne?Uint8Array:Array)(t),p=new(ne?Uint8Array:Array)(i),h=Array(t),u=Array(t),d=Array(t),f=(1<<t)-i,g=1<<t-1;for(l[t-1]=i,n=0;n<t;++n)f<g?c[n]=0:(c[n]=1,f-=g),f<<=1,l[t-2-n]=(l[t-1-n]/2|0)+i;for(l[0]=c[0],h[0]=Array(l[0]),u[0]=Array(l[0]),n=1;n<t;++n)l[n]>2*l[n-1]+c[n]&&(l[n]=2*l[n-1]+c[n]),h[n]=Array(l[n]),u[n]=Array(l[n]);for(r=0;r<i;++r)p[r]=t;for(o=0;o<l[t-1];++o)h[t-1][o]=e[o],u[t-1][o]=o;for(r=0;r<t;++r)d[r]=0;for(1===c[t-1]&&(--p[0],++d[t-1]),n=t-2;0<=n;--n){for(s=r=0,a=d[n+1],o=0;o<l[n];o++)(s=h[n+1][a]+h[n+1][a+1])>e[r]?(h[n][o]=s,u[n][o]=i,a+=2):(h[n][o]=e[r],u[n][o]=r,++r);d[n]=0,1===c[n]&&function e(t){var r=u[t][d[t]];r===i?(e(t+1),e(t+1)):--p[r],++d[t]}(n)}return p})(i,i.length,t),o=0,s=r.length;o<s;++o)c[r[o].index]=n[o]}return c}function te(e){for(var t,r,i=new(ne?Uint16Array:Array)(e.length),n=[],o=[],s=0,a=0,l=e.length;a<l;a++)n[e[a]]=1+(0|n[e[a]]);for(a=1,l=16;a<=l;a++)s=(o[a]=s)+(0|n[a])<<1;for(a=0,l=e.length;a<l;a++)for(s=o[e[a]],o[e[a]]+=1,t=i[a]=0,r=e[a];t<r;t++)i[a]=i[a]<<1|1&s,s>>>=1;return i}var re=void 0,ie=!0,o=this,ne="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;Q.prototype.a=function(e,t,r){var i,n=this.buffer,o=this.index,s=this.d,a=n[o];if(r&&1<t&&(e=8<t?(c[255&e]<<24|c[e>>>8&255]<<16|c[e>>>16&255]<<8|c[e>>>24&255])>>32-t:c[e]>>8-t),t+s<8)a=a<<t|e,s+=t;else for(i=0;i<t;++i)a=a<<1|e>>t-i-1&1,8==++s&&(s=0,n[o++]=c[a],a=0,o===n.length)&&(n=l(this));n[o]=a,this.buffer=n,this.d=s,this.index=o},Q.prototype.finish=function(){var e=this.buffer,t=this.index;return 0<this.d&&(e[t]<<=8-this.d,e[t]=c[e[t]],t++),ne?e.subarray(0,t):(e.length=t,e)};for(var r=new(ne?Uint8Array:Array)(256),i=0;i<256;++i){for(var n=a=i,s=7,a=a>>>1;a;a>>>=1)n=n<<1|1&a,--s;r[i]=(n<<s&255)>>>0}var c=r;p.prototype.getParent=function(e){return 2*((e-2)/4|0)},p.prototype.push=function(e,t){var r,i,n=this.buffer,o=this.length;for(n[this.length++]=t,n[this.length++]=e;0<o&&(r=this.getParent(o),n[o]>n[r]);)i=n[o],n[o]=n[r],n[r]=i,i=n[o+1],n[o+1]=n[r+1],n[r+1]=i,o=r;return this.length},p.prototype.pop=function(){var e,t,r,i=this.buffer,n=i[0],o=i[1];for(this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],r=0;!((t=2*r+2)>=this.length)&&(t+2<this.length&&i[t+2]>i[t]&&(t+=2),i[t]>i[r]);)e=i[r],i[r]=i[t],i[t]=e,e=i[r+1],i[r+1]=i[t+1],i[t+1]=e,r=t;return{index:o,value:n,length:this.length}};for(var oe=2,se=[],h=0;h<288;h++)switch(ie){case h<=143:se.push([h+48,8]);break;case h<=255:se.push([h-144+400,9]);break;case h<=279:se.push([h-256,7]);break;case h<=287:se.push([h-280+192,8]);break;default:throw"invalid literal: "+h}t.prototype.h=function(){var e,t,N,r=this.input;switch(this.e){case 0:for(t=0,N=r.length;t<N;){var M,U,i=n=ne?r.subarray(t,t+65535):r.slice(t,t+65535),n=(t+=n.length)===N,o=re,s=this.b,a=this.c;if(ne){for(s=new Uint8Array(this.b.buffer);s.length<=a+i.length+5;)s=new Uint8Array(s.length<<1);s.set(this.b)}if(s[a++]=0|(n?1:0),M=65536+~(n=i.length)&65535,s[a++]=255&n,s[a++]=n>>>8&255,s[a++]=255&M,s[a++]=M>>>8&255,ne)s.set(i,a),a+=i.length,s=s.subarray(0,a);else{for(o=0,U=i.length;o<U;++o)s[a++]=i[o];s.length=a}this.c=a,this.b=s}break;case 1:var l=new Q(ne?new Uint8Array(this.b.buffer):this.b,this.c);l.a(1,1,ie),l.a(1,2,ie);for(var c,p=J(this,r),h=0,z=p.length;h<z;h++)if(c=p[h],Q.prototype.a.apply(l,se[c]),256<c)l.a(p[++h],p[++h],ie),l.a(p[++h],5),l.a(p[++h],p[++h],ie);else if(256===c)break;this.b=l.finish(),this.c=this.b.length;break;case oe:var u,d,f,g,m,y,v,B,C,S,k,H,_=new Q(ne?new Uint8Array(this.b.buffer):this.b,this.c),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=Array(19),b=oe;for(_.a(1,1,ie),_.a(b,2,ie),u=J(this,r),b=te(m=ee(this.j,15)),O=te(y=ee(this.i,7)),d=286;257<d&&0===m[d-1];d--);for(f=30;1<f&&0===y[f-1];f--);for(var E,w,T,P,I,G=d,j=f,L=new(ne?Uint32Array:Array)(G+j),A=new(ne?Uint32Array:Array)(316),x=new(ne?Uint8Array:Array)(19),R=E=0;R<G;R++)L[E++]=m[R];for(R=0;R<j;R++)L[E++]=y[R];if(!ne)for(R=0,T=x.length;R<T;++R)x[R]=0;for(R=P=0,T=L.length;R<T;R+=E){for(E=1;R+E<T&&L[R+E]===L[R];++E);if(w=E,0===L[R])if(w<3)for(;0<w--;)x[A[P++]=0]++;else for(;0<w;)(I=w-3<(I=w<138?w:138)&&I<w?w-3:I)<=10?(A[P++]=17,A[P++]=I-3,x[17]++):(A[P++]=18,A[P++]=I-11,x[18]++),w-=I;else if(A[P++]=L[R],x[L[R]]++,--w<3)for(;0<w--;)A[P++]=L[R],x[L[R]]++;else for(;0<w;)w-3<(I=w<6?w:6)&&I<w&&(I=w-3),A[P++]=16,A[P++]=I-3,x[16]++,w-=I}for(e=ne?A.subarray(0,P):A.slice(0,P),v=ee(x,7),k=0;k<19;k++)$[k]=v[W[k]];for(g=19;4<g&&0===$[g-1];g--);for(B=te(v),_.a(d-257,5,ie),_.a(f-1,5,ie),_.a(g-4,4,ie),k=0;k<g;k++)_.a($[k],3,ie);for(k=0,H=e.length;k<H;k++)if(C=e[k],_.a(B[C],v[C],ie),16<=C){switch(k++,C){case 16:S=2;break;case 17:S=3;break;case 18:S=7;break;default:throw"invalid code: "+C}_.a(e[k],S,ie)}for(var D,q,b=[b,m],O=[O,y],K=b[0],V=b[1],Z=O[0],Y=O[1],F=0,X=u.length;F<X;++F)if(D=u[F],_.a(K[D],V[D],ie),256<D)_.a(u[++F],u[++F],ie),q=u[++F],_.a(Z[q],Y[q],ie),_.a(u[++F],u[++F],ie);else if(256===D)break;this.b=_.finish(),this.c=this.b.length;break;default:throw"invalid compression type"}return this.b};var u=(()=>{for(var e,t=[],r=3;r<=258;r++)e=(e=>{switch(ie){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case e<=12:return[265,e-11,1];case e<=14:return[266,e-13,1];case e<=16:return[267,e-15,1];case e<=18:return[268,e-17,1];case e<=22:return[269,e-19,2];case e<=26:return[270,e-23,2];case e<=30:return[271,e-27,2];case e<=34:return[272,e-31,2];case e<=42:return[273,e-35,3];case e<=50:return[274,e-43,3];case e<=58:return[275,e-51,3];case e<=66:return[276,e-59,3];case e<=82:return[277,e-67,4];case e<=98:return[278,e-83,4];case e<=114:return[279,e-99,4];case e<=130:return[280,e-115,4];case e<=162:return[281,e-131,5];case e<=194:return[282,e-163,5];case e<=226:return[283,e-195,5];case e<=257:return[284,e-227,5];case 258===e:return[285,e-258,0];default:throw"invalid length: "+e}})(r),t[r]=e[2]<<24|e[1]<<16|e[0];return t})(),S=ne?new Uint32Array(u):u;e("Zlib.RawDeflate",t),e("Zlib.RawDeflate.prototype.compress",t.prototype.h);var d,f,g,m,y={NONE:0,FIXED:1,DYNAMIC:oe};if(Object.keys)d=Object.keys(y);else for(f in d=[],g=0,y)d[g++]=f;for(g=0,m=d.length;g<m;++g)e("Zlib.RawDeflate.CompressionType."+(f=d[g]),y[f])}.call(this)},{}],20:[function(){!function(){function e(e,t){var r,i=e.split("."),n=o;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(;i.length&&(r=i.shift());)i.length||void 0===t?n=n[r]||(n[r]={}):n[r]=t}function v(e){for(var t,r,i,n,o,s,a,l,c,p=e.length,h=0,u=Number.POSITIVE_INFINITY,d=0;d<p;++d)e[d]>h&&(h=e[d]),e[d]<u&&(u=e[d]);for(t=1<<h,r=new(k?Uint32Array:Array)(t),i=1,n=0,o=2;i<=h;){for(d=0;d<p;++d)if(e[d]===i){for(a=n,l=s=0;l<i;++l)s=s<<1|1&a,a>>=1;for(c=i<<16|d,l=s;l<t;l+=o)r[l]=c;++n}++i,n<<=1,o<<=1}return[r,h,u]}function t(e,t){switch(this.g=[],this.h=32768,this.c=this.f=this.d=this.k=0,this.input=k?new Uint8Array(e):e,this.l=!1,this.i=1,this.q=!1,(t?(t.index&&(this.d=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize):(t={},0))&&(this.q=t.resize),this.i){case 0:this.a=32768,this.b=new(k?Uint8Array:Array)(32768+this.h+258);break;case 1:this.a=0,this.b=new(k?Uint8Array:Array)(this.h),this.e=this.v,this.m=this.s,this.j=this.t;break;default:throw Error("invalid inflate mode")}}function C(e,t){for(var r,i=e.f,n=e.c,o=e.input,s=e.d,a=o.length;n<t;){if(a<=s)throw Error("input buffer is broken");i|=o[s++]<<n,n+=8}return r=i&(1<<t)-1,e.f=i>>>t,e.c=n-t,e.d=s,r}function S(e,t){for(var r=e.f,i=e.c,n=e.input,o=e.d,s=n.length,a=t[0],l=t[1];i<l&&!(s<=o);)r|=n[o++]<<i,i+=8;return t=a[r&(1<<l)-1],e.f=r>>(a=t>>>16),e.c=i-a,e.d=o,65535&t}var o=this,k="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;t.prototype.u=function(){for(;!this.l;){var e=C(this,3);switch(1&e&&(this.l=!0),e>>>=1){case 0:var t=this.input,r=this.d,i=this.b,n=this.a,o=t.length,s=void 0,a=i.length,l=void 0;if(this.c=this.f=0,o<=r+1)throw Error("invalid uncompressed block header: LEN");if(s=t[r++]|t[r++]<<8,o<=r+1)throw Error("invalid uncompressed block header: NLEN");if(s===~(t[r++]|t[r++]<<8))throw Error("invalid uncompressed block header: length verify");if(t.length<r+s)throw Error("input buffer is broken");switch(this.i){case 0:for(;n+s>i.length;){if(s-=l=a-n,k)i.set(t.subarray(r,r+l),n),n+=l,r+=l;else for(;l--;)i[n++]=t[r++];this.a=n,i=this.e(),n=this.a}break;case 1:for(;n+s>i.length;)i=this.e({o:2});break;default:throw Error("invalid inflate mode")}if(k)i.set(t.subarray(r,r+s),n),n+=s,r+=s;else for(;s--;)i[n++]=t[r++];this.d=r,this.a=n,this.b=i;break;case 1:this.j(b,E);break;case 2:m=g=f=d=y=p=c=o=h=void 0;for(var c,p,h=this,u=function(e,t,r){for(var i,n,o=this.p,s=0;s<e;)switch(i=S(this,t)){case 16:for(n=3+C(this,2);n--;)r[s++]=o;break;case 17:for(n=3+C(this,3);n--;)r[s++]=0;o=0;break;case 18:for(n=11+C(this,7);n--;)r[s++]=0;o=0;break;default:o=r[s++]=i}return this.p=o,r},d=C(h,5)+257,f=C(h,5)+1,g=C(h,4)+4,m=new(k?Uint8Array:Array)(_.length),y=0;y<g;++y)m[_[y]]=C(h,3);if(!k)for(y=g,g=m.length;y<g;++y)m[_[y]]=0;o=v(m),c=new(k?Uint8Array:Array)(d),p=new(k?Uint8Array:Array)(f),h.p=0,h.j(v(u.call(h,d,o,c)),v(u.call(h,f,o,p)));break;default:throw Error("unknown BTYPE: "+e)}}return this.m()};for(var r=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_=k?new Uint16Array(r):r,r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],c=k?new Uint16Array(r):r,r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],p=k?new Uint8Array(r):r,r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],h=k?new Uint16Array(r):r,r=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=k?new Uint8Array(r):r,i=new(k?Uint8Array:Array)(288),n=0,s=i.length;n<s;++n)i[n]=n<=143?8:n<=255?9:n<=279?7:8;for(var b=v(i),a=new(k?Uint8Array:Array)(30),l=0,d=a.length;l<d;++l)a[l]=5;var E=v(a);t.prototype.j=function(e,t){var r=this.b,i=this.a;this.n=e;for(var n,o,s,a,l=r.length-258;256!==(n=S(this,e));)if(n<256)l<=i&&(this.a=i,r=this.e(),i=this.a),r[i++]=n;else for(a=c[o=n-257],0<p[o]&&(a+=C(this,p[o])),n=S(this,t),s=h[n],0<u[n]&&(s+=C(this,u[n])),l<=i&&(this.a=i,r=this.e(),i=this.a);a--;)r[i]=r[i++-s];for(;8<=this.c;)this.c-=8,this.d--;this.a=i},t.prototype.t=function(e,t){var r=this.b,i=this.a;this.n=e;for(var n,o,s,a,l=r.length;256!==(n=S(this,e));)if(n<256)l<=i&&(l=(r=this.e()).length),r[i++]=n;else for(a=c[o=n-257],0<p[o]&&(a+=C(this,p[o])),n=S(this,t),s=h[n],0<u[n]&&(s+=C(this,u[n])),l<i+a&&(l=(r=this.e()).length);a--;)r[i]=r[i++-s];for(;8<=this.c;)this.c-=8,this.d--;this.a=i},t.prototype.e=function(){var e,t,r=new(k?Uint8Array:Array)(this.a-32768),i=this.a-32768,n=this.b;if(k)r.set(n.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=n[e+32768];if(this.g.push(r),this.k+=r.length,k)n.set(n.subarray(i,32768+i));else for(e=0;e<32768;++e)n[e]=n[i+e];return this.a=32768,n},t.prototype.v=function(e){var t,r=this.input.length/this.d+1|0,i=this.input,n=this.b;return e&&("number"==typeof e.o&&(r=e.o),"number"==typeof e.r)&&(r+=e.r),i=r<2?(e=(i.length-this.d)/this.n[2]/2*258|0)<n.length?n.length+e:n.length<<1:n.length*r,k?(t=new Uint8Array(i)).set(n):t=n,this.b=t},t.prototype.m=function(){var e,t,r,i,n,o=0,s=this.b,a=this.g,l=new(k?Uint8Array:Array)(this.k+(this.a-32768));if(0===a.length)return k?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,r=a.length;t<r;++t)for(i=0,n=(e=a[t]).length;i<n;++i)l[o++]=e[i];for(t=32768,r=this.a;t<r;++t)l[o++]=s[t];return this.g=[],this.buffer=l},t.prototype.s=function(){var e,t=this.a;return k?this.q?(e=new Uint8Array(t)).set(this.b.subarray(0,t)):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},e("Zlib.RawInflate",t),e("Zlib.RawInflate.prototype.decompress",t.prototype.u);var f,g,m,y,w={ADAPTIVE:1,BLOCK:0};if(Object.keys)f=Object.keys(w);else for(g in f=[],m=0,w)f[m++]=g;for(m=0,y=f.length;m<y;++m)e("Zlib.RawInflate.BufferType."+(g=f[m]),w[g])}.call(this)},{}]},{},[7])(7)}),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,r=window.getComputedStyle(t,null),i=parseInt(r.getPropertyValue("border-top-width")),r=parseInt(r.getPropertyValue("border-left-width")),n=this.offsetTop-t.offsetTop<t.scrollTop,o=this.offsetTop-t.offsetTop+this.clientHeight-i>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,a=this.offsetLeft-t.offsetLeft+this.clientWidth-r>t.scrollLeft+t.clientWidth,l=n&&!o;(n||o)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-i+this.clientHeight/2),(s||a)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-r+this.clientWidth/2),(n||o||s||a)&&!e&&this.scrollIntoView(l)}),((h,u)=>{function e(){var e,i,a,l;function c(e,t){this.scrollLeft=e,this.scrollTop=t}function n(e){if("object"!=typeof e||void 0===e.behavior||"auto"===e.behavior||"instant"===e.behavior)return 1;if("object"!=typeof e||"smooth"!==e.behavior)throw new TypeError("behavior not valid")}function p(e){e.frame=h.requestAnimationFrame(p.bind(h,e));var t,r=l(),r=1<(r=(r-e.startTime)/i)?1:r,r=.5*(1-Math.cos(Math.PI*r));e.method.call(e.scrollable,t=e.startX+(e.x-e.startX)*r,r=e.startY+(e.y-e.startY)*r),t===e.x&&r===e.y&&h.cancelAnimationFrame(e.frame)}function o(e,t,r){var i,n,o,s=l(),e=e===u.body?(n=(i=h).scrollX||h.pageXOffset,o=h.scrollY||h.pageYOffset,a.scroll):(n=(i=e).scrollLeft,o=e.scrollTop,c);p({scrollable:i,method:e,startTime:s,startX:n,startY:o,x:t,y:r,frame:void 0})}"scrollBehavior"in u.documentElement.style||(e=h.HTMLElement||h.Element,i=468,a={scroll:h.scroll||h.scrollTo,scrollBy:h.scrollBy,scrollIntoView:e.prototype.scrollIntoView},l=h.performance&&h.performance.now?h.performance.now.bind(h.performance):Date.now,h.scroll=h.scrollTo=function(){n(arguments[0])?a.scroll.call(h,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):o.call(h,u.body,~~arguments[0].left,~~arguments[0].top)},h.scrollBy=function(){n(arguments[0])?a.scrollBy.call(h,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):o.call(h,u.body,~~arguments[0].left+(h.scrollX||h.pageXOffset),~~arguments[0].top+(h.scrollY||h.pageYOffset))},e.prototype.scrollIntoView=function(){var e,t,r;n(arguments[0])?a.scrollIntoView.call(this,arguments[0]||!0):(t=(e=(e=>{for(;(e=e.parentNode)!==u.body&&!(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth););return e})(this)).getBoundingClientRect(),r=this.getBoundingClientRect(),e!==u.body?(o.call(this,e,e.scrollLeft+r.left-t.left,e.scrollTop+r.top-t.top),h.scrollBy({left:t.left,top:t.top,behavior:"smooth"})):h.scrollBy({left:r.left,top:r.top,behavior:"smooth"}))})}"object"==typeof exports?module.exports={polyfill:e}:e()})(window,document),((be,Ee)=>{var we={beforeShow:t,move:t,change:t,show:t,hide:t,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},Te=[],Pe=!!/msie/i.exec(be.navigator.userAgent),Ie=((s=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",e(s.backgroundColor,"rgba")||e(s.backgroundColor,"hsla")),De=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),Oe=(()=>{var e="";if(Pe)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")})();function e(e,t){return!!~(""+e).indexOf(t)}function Le(e,t,r){for(var i=[],n=0;n<e.length;n++){var o=Re(e[n]),s=o.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",a=(s+=Re.equals(t,e[n])?" sp-thumb-active":"",Ie?"background-color:"+o.toRgbString():"filter:"+o.toFilter());i.push('<span title="'+o.toRgbString()+'" data-color="'+o.toRgbString()+'" class="'+s+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+r+"'>"+i.join("")+"</div>"}function p(e,t){t=t,o=e,(t=Ee.extend({},we,t)).callbacks={move:Ae(t.move,o),change:Ae(t.change,o),show:Ae(t.show,o),hide:Ae(t.hide,o),beforeShow:Ae(t.beforeShow,o)};var N,M,U,r,s=t,i=s.flat,z=s.showSelectionPalette,n=s.localStorageKey,o=s.theme,a=s.callbacks,B=(N=O,function(){var e=this,t=arguments;U&&clearTimeout(r),!U&&r||(r=setTimeout(function(){r=null,N.apply(e,t)},M))}),l=!(M=10),c=0,p=0,h=0,u=0,H=0,W=0,$=0,d=0,f=0,g=0,m=1,t=s.palette.slice(0),y=Ee.isArray(t[0])?t:[t],v=s.selectionPalette.slice(0),G=s.maxSelectionSize,j="sp-dragging",C=null,S=e.ownerDocument,k=(S.body,Ee(e)),q=!1,_=Ee(Oe,S).addClass(o),K=_.find(".sp-color"),V=_.find(".sp-dragger"),Z=_.find(".sp-hue"),Y=_.find(".sp-slider"),b=_.find(".sp-alpha-inner"),X=_.find(".sp-alpha"),Q=_.find(".sp-alpha-handle"),E=_.find(".sp-input"),J=_.find(".sp-palette"),ee=_.find(".sp-initial"),t=_.find(".sp-cancel"),e=_.find(".sp-choose"),te=k.is("input"),re=te&&!i,w=re?Ee(De).addClass(o).addClass(s.className):Ee([]),T=re?w:k,ie=w.find(".sp-preview-inner"),o=s.color||te&&k.val(),P=!1,ne=s.preferredFormat,I=ne,oe=!s.showButtons||s.clickoutFiresChange;function se(){s.showPaletteOnly&&(s.showPalette=!0),_.toggleClass("sp-flat",i),_.toggleClass("sp-input-disabled",!s.showInput),_.toggleClass("sp-alpha-enabled",s.showAlpha),_.toggleClass("sp-buttons-disabled",!s.showButtons),_.toggleClass("sp-palette-disabled",!s.showPalette),_.toggleClass("sp-palette-only",s.showPaletteOnly),_.toggleClass("sp-initial-disabled",!s.showInitial),_.addClass(s.className),O()}function ae(e){if(z){e=Re(e).toRgbString();if(-1===Ee.inArray(e,v))for(v.push(e);v.length>G;)v.shift();if(n&&be.localStorage)try{be.localStorage[n]=v.join(";")}catch(e){}}}function le(){var r=x(),e=Ee.map(y,function(e,t){return Le(e,r,"sp-palette-row sp-palette-row-"+t)});v&&e.push(Le((()=>{var e,t=[],r=v,i={};if(s.showPalette){for(var n=0;n<y.length;n++)for(var o=0;o<y[n].length;o++)i[e=Re(y[n][o]).toRgbString()]=!0;for(n=0;n<r.length;n++)e=Re(r[n]).toRgbString(),i.hasOwnProperty(e)||(t.push(r[n]),i[e]=!0)}return t.reverse().slice(0,s.maxSelectionSize)})(),r,"sp-palette-row sp-palette-row-selection")),J.html(e.join(""))}function ce(){var e,t;s.showInitial&&(e=P,t=x(),ee.html(Le([e,t],t,"sp-palette-row-initial")))}function pe(){(p<=0||c<=0||u<=0)&&O(),_.addClass(j),C=null}function he(){_.removeClass(j)}function ue(){var e=Re(E.val());e.ok?A(e):E.addClass("sp-validation-error")}function de(){(l?L:fe)()}function fe(){var e=Ee.Event("beforeShow.spectrum");if(l)O();else if(P=x(),k.trigger(e,[P]),!1!==a.beforeShow(P)&&!e.isDefaultPrevented()){A(P);for(var t=0;t<Te.length;t++)Te[t]&&Te[t].hide();l=!0,Ee(S).bind("mousedown.spectrum",ge),i||Ee(S).bind("mouseup.spectrum",me),Ee(be).bind("resize.spectrum",B),w.addClass("sp-active"),_.removeClass("sp-hidden"),s.showPalette&&le(),O(),D(),ce(),a.show(P),k.trigger("show.spectrum",[P])}}function ge(e){var t=Ee(e.target);t.parents().is(_)||t.is(_)||L(e)}function me(e){Re.equals(x(),P)||(oe&&"cancel"!==e?ve(!0):A(P,!0))}function L(e){e&&"click"==e.type&&2==e.button||l&&!i&&(l=!1,Ee(S).unbind("mousedown.spectrum",ge),Ee(S).unbind("mouseup.spectrum",me),Ee(be).unbind("resize.spectrum",B),w.removeClass("sp-active"),_.addClass("sp-hidden"),me(e),ae(x()),a.hide(x()),k.trigger("hide.spectrum",[x()]))}function A(e,t){var r;Re.equals(e,x())||(r=(e=Re(e)).toHsv(),d=r.h%360/360,f=r.s,g=r.v,m=r.a,D(),e.ok&&!t&&(I=ne||e.format))}function x(e){return e=e||{},Re.fromRatio({h:d,s:f,v:g,a:Math.round(100*m)/100},{format:e.format||I})}function R(){D(),a.move(x()),k.trigger("move.spectrum",[x()])}function D(){E.removeClass("sp-validation-error"),ye();var e,t=Re.fromRatio({h:d,s:1,v:1}),t=(K.css("background-color",t.toHexString()),I),t=(m<1&&("hex"!==I&&"hex3"!==I&&"hex6"!==I&&"name"!==I||(t="rgb")),x({format:t})),r=t.toHexString(),i=t.toRgbString();Ie||1===t.alpha?ie.css("background-color",i):(ie.css("background-color","transparent"),ie.css("filter",t.toFilter())),s.showAlpha&&((i=t.toRgb()).a=0,e="linear-gradient(left, "+(i=Re(i).toRgbString())+", "+r+")",Pe?b.css("filter",Re(i).toFilter({gradientType:1},r)):(b.css("background","-webkit-"+e),b.css("background","-moz-"+e),b.css("background","-ms-"+e),b.css("background",e))),s.showInput&&(i=pskl.UserSettings.get(pskl.UserSettings.COLOR_FORMAT),E.val(t.toString(i))),s.showPalette&&le(),ce()}function ye(){var e=f*c,t=p-g*p,e=Math.max(-h/2,Math.min(c-h/2,e-h/2)),t=Math.max(-h/2,Math.min(p-h/2,t-h/2)),t=(V.css({top:t,left:e}),m*H),e=(Q.css({left:t-W/2}),d*u);Y.css({top:e-$/2})}function ve(e){var t=x(),r=(te&&k.val(t.toString(I)),!Re.equals(t,P));P=t,e&&r&&(a.change(t),k.trigger("change",[t]))}function O(){c=K.width(),p=K.height(),h=V.height()+4,Z.width(),u=Z.height(),$=Y.height()+4,H=X.width(),W=Q.width(),i||(_.css("position","absolute"),_.offset(((e,t)=>{var r=e.outerWidth(),i=e.outerHeight(),n=t.outerHeight(),o=e[0].ownerDocument,s=(a=o.documentElement).clientWidth+Ee(o).scrollLeft(),a=a.clientHeight+Ee(o).scrollTop();return(o=t.offset()).top+=n,Math.min(o.left,s<o.left+r&&r<s)?(o.left-=Math.abs(o.left+r-s),e.attr("data-x-position","right")):(o.left-=0,e.attr("data-x-position","left")),Math.min(o.top,o.top+i>a&&i<a)?(o.top-=Math.abs(+(i+n)),e.attr("data-y-position","top")):(o.top-=0,e.attr("data-y-position","bottom")),o})(_,T))),ye()}function Ce(){L(),q=!0,k.attr("disabled",!0),T.addClass("sp-disabled")}if(Pe&&_.find("*:not(input)").attr("unselectable","on"),se(),re&&k.after(w).hide(),i?k.after(_).hide():(F=1!==(F="parent"===s.appendTo?k.parent():Ee(s.appendTo)).length?Ee("body"):F).append(_),n&&be.localStorage){try{var Se=be.localStorage[n].split(",#");1<Se.length&&(delete be.localStorage[n],Ee.each(Se,function(e,t){ae(t)}))}catch(e){}try{v=be.localStorage[n].split(";")}catch(e){}}function ke(e){return(e.data&&e.data.ignore?(A(Ee(this).data("color")),R):(A(Ee(this).data("color")),ve(!0),R(),L))(),!1}T.bind("click.spectrum touchstart.spectrum",function(e){q||de(),e.stopPropagation(),Ee(e.target).is("input")||e.preventDefault()}),!k.is(":disabled")&&!0!==s.disabled||Ce(),_.click(Fe),E.change(ue),E.bind("paste",function(){setTimeout(ue,1)}),E.keydown(function(e){13==e.keyCode&&ue()}),t.text(s.cancelText),t.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),L("cancel")}),e.text(s.chooseText),e.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),E.hasClass("sp-validation-error")||(ve(!0),L())}),xe(X,function(e,t,r){m=e/H,r.shiftKey&&(m=Math.round(10*m)/10),R()}),xe(Z,function(e,t){d=parseFloat(t/u),R()},pe,he),xe(K,function(e,t,r){r.shiftKey?C||(r=f*c,i=p-g*p,r=Math.abs(e-r)>Math.abs(t-i),C=r?"x":"y"):C=null;var i=!C||"x"===C,r=!C||"y"===C;i&&(f=parseFloat(e/c)),r&&(g=parseFloat((p-t)/p)),R()},pe,he),o?(A(o),D(),I=ne||Re(o).format,ae(o)):D(),i&&fe();var F=Pe?"mousedown.spectrum":"click.spectrum touchstart.spectrum",_e=(J.delegate(".sp-thumb-el",F,ke),ee.delegate(".sp-thumb-el:nth-child(1)",F,{ignore:!0},ke),{show:fe,hide:L,toggle:de,reflow:O,option:function(e,t){return void 0===e?Ee.extend({},s):void 0===t?s[e]:(s[e]=t,void se())},enable:function(){q=!1,k.attr("disabled",!1),T.removeClass("sp-disabled")},disable:Ce,set:function(e){A(e),ve()},get:x,destroy:function(){k.show(),T.unbind("click.spectrum touchstart.spectrum"),_.remove(),w.remove(),Te[_e.id]=null},container:_});return _e.id=Te.push(_e)-1,_e}function t(){}function Fe(e){e.stopPropagation()}function Ae(e,t){var r=Array.prototype.slice,i=r.call(arguments,2);return function(){return e.apply(t,i.concat(r.call(arguments)))}}function xe(i,n,r,e){n=n||function(){},r=r||function(){},e=e||function(){};var o=i.ownerDocument||document,s=!1,a={},l=0,c=0,p="ontouchstart"in be,h={};function u(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function d(e){if(s){if(Pe&&document.documentMode<9&&!e.button)return f();var t=e.originalEvent.touches,r=(t?t[0]:e).pageX,t=(t?t[0]:e).pageY,r=Math.max(0,Math.min(r-a.left,c)),t=Math.max(0,Math.min(t-a.top,l));p&&u(e),n.apply(i,[r,t,e])}}function f(){s&&(Ee(o).unbind(h),Ee(o.body).removeClass("sp-dragging"),e.apply(i,arguments)),s=!1}h.selectstart=u,h.dragstart=u,h["touchmove mousemove"]=d,h["touchend mouseup"]=f,Ee(i).bind("touchstart mousedown",function(e){var t=e.which?3==e.which:2==e.button;e.originalEvent.touches,t||s||!1!==r.apply(i,arguments)&&(s=!0,l=Ee(i).height(),c=Ee(i).width(),a=Ee(i).offset(),Ee(o).bind(h),Ee(o.body).addClass("sp-dragging"),p||d(e),u(e))})}var o,h,r,u,n,d,f,i,g,m,s,a,y,l="spectrum.id";function v(e,s){var a,l,c,p,i,t;return s=s||{},"object"==typeof(e=e||"")&&e.hasOwnProperty("_tc_id")?e:(e=(e=>{var t={r:0,g:0,b:0},r=1,i=!1,n=!1;return"string"==typeof e&&(e=(e=>{e=e.replace(o,"").replace(h,"").toLowerCase();var t,r=!1;if(g[e])e=g[e],r=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};return(t=y.rgb.exec(e))?{r:t[1],g:t[2],b:t[3]}:(t=y.rgba.exec(e))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=y.hsl.exec(e))?{h:t[1],s:t[2],l:t[3]}:(t=y.hsla.exec(e))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=y.hsv.exec(e))?{h:t[1],s:t[2],v:t[3]}:(t=y.hex6.exec(e))?{r:E(t[1]),g:E(t[2]),b:E(t[3]),format:r?"name":"hex"}:!!(t=y.hex3.exec(e))&&{r:E(t[1]+""+t[1]),g:E(t[2]+""+t[2]),b:E(t[3]+""+t[3]),format:r?"name":"hex"}})(e)),r=_(r="object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=((e,t,r)=>({r:255*b(e,255),g:255*b(t,255),b:255*b(r,255)}))(e.r,e.g,e.b),i=!0,n="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=T(e.s),e.v=T(e.v),t=((e,t,r)=>{e=6*b(e,360),t=b(t,100),r=b(r,100);var i=u.floor(e),n=r*(1-t),o=r*(1-(e=e-i)*t);return{r:255*[r,o,n,n,e=r*(1-(1-e)*t),r][t=i%6],g:255*[e,r,r,o,n,n][t],b:255*[n,n,e,r,r,o][t]}})(e.h,e.s,e.v),i=!0,n="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=T(e.s),e.l=T(e.l),t=((e,t,r)=>{var i,n,o;function s(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}return e=b(e,360),t=b(t,100),r=b(r,100),0===t?i=n=o=r:(i=s(t=2*r-(r=r<.5?r*(1+t):r+t-r*t),r,e+1/3),n=s(t,r,e),o=s(t,r,e-1/3)),{r:255*i,g:255*n,b:255*o}})(e.h,e.s,e.l),i=!0,n="hsl"),e.hasOwnProperty("a"))?e.a:r),{ok:i,format:e.format||n,r:d(255,f(t.r,0)),g:d(255,f(t.g,0)),b:d(255,f(t.b,0)),a:r}})(e),a=e.r,l=e.g,c=e.b,i=n(100*(p=e.a))/100,t=s.format||e.format,a<1&&(a=n(a)),l<1&&(l=n(l)),c<1&&(c=n(c)),{ok:e.ok,format:t,_tc_id:r++,alpha:p,getAlpha:function(){return p},setAlpha:function(e){p=_(e),i=n(100*p)/100},toHsv:function(){var e=S(a,l,c);return{h:360*e.h,s:e.s,v:e.v,a:p}},toHsvString:function(){var e=S(a,l,c),t=n(360*e.h),r=n(100*e.s),e=n(100*e.v);return 1==p?"hsv("+t+", "+r+"%, "+e+"%)":"hsva("+t+", "+r+"%, "+e+"%, "+i+")"},toHsl:function(){var e=C(a,l,c);return{h:360*e.h,s:e.s,l:e.l,a:p}},toHslString:function(){var e=C(a,l,c),t=n(360*e.h),r=n(100*e.s),e=n(100*e.l);return 1==p?"hsl("+t+", "+r+"%, "+e+"%)":"hsla("+t+", "+r+"%, "+e+"%, "+i+")"},toHex:function(e){return k(a,l,c,e)},toHexString:function(e){return"#"+k(a,l,c,e)},toRgb:function(){return{r:n(a),g:n(l),b:n(c),a:p}},toRgbString:function(){return 1==p?"rgb("+n(a)+", "+n(l)+", "+n(c)+")":"rgba("+n(a)+", "+n(l)+", "+n(c)+", "+i+")"},toPercentageRgb:function(){return{r:n(100*b(a,255))+"%",g:n(100*b(l,255))+"%",b:n(100*b(c,255))+"%",a:p}},toPercentageRgbString:function(){return 1==p?"rgb("+n(100*b(a,255))+"%, "+n(100*b(l,255))+"%, "+n(100*b(c,255))+"%)":"rgba("+n(100*b(a,255))+"%, "+n(100*b(l,255))+"%, "+n(100*b(c,255))+"%, "+i+")"},toName:function(){return 0===p?"transparent":m[k(a,l,c,!0)]||!1},toFilter:function(e){var t=k(a,l,c),r=t,i=Math.round(255*parseFloat(p)).toString(16),n=i,o=s&&s.gradientType?"GradientType = 1, ":"";return e&&(r=(e=v(e)).toHex(),n=Math.round(255*parseFloat(e.alpha)).toString(16)),"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr=#"+w(i)+t+",endColorstr=#"+w(n)+r+")"},toString:function(e){var t=!!e,r=(e=e||this.format,!1),t=!t&&p<1&&0<p&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return"rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),t?this.toRgbString():r||this.toHexString()}})}function C(e,t,r){e=b(e,255),t=b(t,255),r=b(r,255);var i,n=f(e,t,r),o=d(e,t,r),s=(n+o)/2;if(n==o)i=l=0;else{var a=n-o,l=.5<s?a/(2-n-o):a/(n+o);switch(n){case e:i=(t-r)/a+(t<r?6:0);break;case t:i=(r-e)/a+2;break;case r:i=(e-t)/a+4}i/=6}return{h:i,s:l,l:s}}function S(e,t,r){e=b(e,255),t=b(t,255),r=b(r,255);var i,n=f(e,t,r),o=d(e,t,r),s=n,a=n-o,l=0===n?0:a/n;if(n==o)i=0;else{switch(n){case e:i=(t-r)/a+(t<r?6:0);break;case t:i=(r-e)/a+2;break;case r:i=(e-t)/a+4}i/=6}return{h:i,s:l,v:s}}function k(e,t,r,i){e=[w(n(e).toString(16)),w(n(t).toString(16)),w(n(r).toString(16))];return i&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function _(e){return e=parseFloat(e),e=isNaN(e)||e<0||1<e?1:e}function b(e,t){"string"==typeof(r=e)&&-1!=r.indexOf(".")&&1===parseFloat(r)&&(e="100%");var r="string"==typeof(r=e)&&-1!=r.indexOf("%");return e=d(t,f(0,parseFloat(e))),r&&(e=parseInt(e*t,10)/100),u.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function c(e){return d(1,f(0,e))}function E(e){return parseInt(e,16)}function w(e){return 1==e.length?"0"+e:""+e}function T(e){return e=e<=1?100*e+"%":e}Ee.fn.spectrum=function(r,e){var i,n;return"string"==typeof r?(i=this,n=Array.prototype.slice.call(arguments,1),this.each(function(){var e=Te[Ee(this).data(l)];if(e){var t=e[r];if(!t)throw new Error("Spectrum: no such method: '"+r+"'");"get"==r?i=e.get():"container"==r?i=e.container:"option"==r?i=e.option.apply(e,n):"destroy"==r?(e.destroy(),Ee(this).removeData(l)):t.apply(e,n)}}),i):this.spectrum("destroy").each(function(){var e=p(this,r);Ee(this).data(l,e.id)})},Ee.fn.spectrum.load=!0,Ee.fn.spectrum.loadOpts={},Ee.fn.spectrum.draggable=xe,Ee.fn.spectrum.defaults=we,Ee.spectrum={},Ee.spectrum.localization={},Ee.spectrum.palettes={},Ee.fn.spectrum.processNativeColorInputs=function(){var e=Ee("<input type='color' value='!' />")[0];"color"===e.type&&"!"!=e.value||Ee("input[type=color]").spectrum({preferredFormat:"hex6"})},o=/^[\s,#]+/,h=/\s+$/,r=0,u=Math,n=u.round,d=u.min,f=u.max,i=u.random,v.fromRatio=function(e,t){if("object"==typeof e){var r,i={};for(r in e)e.hasOwnProperty(r)&&(i[r]="a"===r?e[r]:T(e[r]));e=i}return v(e,t)},v.equals=function(e,t){return!(!e||!t)&&v(e).toRgbString()==v(t).toRgbString()},v.random=function(){return v.fromRatio({r:i(),g:i(),b:i()})},v.desaturate=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.s-=t/100,e.s=c(e.s),v(e)},v.saturate=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.s+=t/100,e.s=c(e.s),v(e)},v.greyscale=function(e){return v.desaturate(e,100)},v.lighten=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.l+=t/100,e.l=c(e.l),v(e)},v.darken=function(e,t){t=0===t?0:t||10;e=v(e).toHsl();return e.l-=t/100,e.l=c(e.l),v(e)},v.complement=function(e){e=v(e).toHsl();return e.h=(e.h+180)%360,v(e)},v.triad=function(e){var t=v(e).toHsl(),r=t.h;return[v(e),v({h:(r+120)%360,s:t.s,l:t.l}),v({h:(r+240)%360,s:t.s,l:t.l})]},v.tetrad=function(e){var t=v(e).toHsl(),r=t.h;return[v(e),v({h:(r+90)%360,s:t.s,l:t.l}),v({h:(r+180)%360,s:t.s,l:t.l}),v({h:(r+270)%360,s:t.s,l:t.l})]},v.splitcomplement=function(e){var t=v(e).toHsl(),r=t.h;return[v(e),v({h:(r+72)%360,s:t.s,l:t.l}),v({h:(r+216)%360,s:t.s,l:t.l})]},v.analogous=function(e,t,r){t=t||6,r=r||30;var i=v(e).toHsl(),n=360/r,o=[v(e)];for(i.h=(i.h-(n*t>>1)+720)%360;--t;)i.h=(i.h+n)%360,o.push(v(i));return o},v.monochromatic=function(e,t){t=t||6;for(var e=v(e).toHsv(),r=e.h,i=e.s,n=e.v,o=[],s=1/t;t--;)o.push(v({h:r,s:i,v:n})),n=(n+s)%1;return o},v.readability=function(e,t){var e=v(e).toRgb(),t=v(t).toRgb(),r=(299*e.r+587*e.g+114*e.b)/1e3,i=(299*t.r+587*t.g+114*t.b)/1e3,e=Math.max(e.r,t.r)-Math.min(e.r,t.r)+Math.max(e.g,t.g)-Math.min(e.g,t.g)+Math.max(e.b,t.b)-Math.min(e.b,t.b);return{brightness:Math.abs(r-i),color:e}},v.readable=function(e,t){e=v.readability(e,t);return 125<e.brightness&&500<e.color},v.mostReadable=function(e,t){for(var r=null,i=0,n=!1,o=0;o<t.length;o++){var s=v.readability(e,t[o]),a=125<s.brightness&&500<s.color,s=s.brightness/125*3+s.color/500;(a&&!n||a&&n&&i<s||!a&&!n&&i<s)&&(n=a,i=s,r=v(t[o]))}return r},g=v.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},m=v.hexNames=(e=>{var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[e[t]]=t);return r})(g),a="[\\s|\\(]+("+(s="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",s="[\\s|\\(]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",y={rgb:new RegExp("rgb"+a),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+a),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+a),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},be.tinycolor=v;var Re=be.tinycolor;Ee(function(){Ee.fn.spectrum.load&&Ee.fn.spectrum.processNativeColorInputs()})})(window,jQuery),(e=>{if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses)ses.ok()&&(ses.makeQ=e);else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=e()}})(function(){var a=!1;try{throw new Error}catch(e){a=!!e.stack}function t(){}var o,e,r,i,n,s,l,c,p,N=k();s=n={task:void 0,next:null},c=void 0,p=l=!1,e=function(e){s=s.next={task:e,domain:p&&process.domain,next:null},l||(l=!0,c())},c="undefined"!=typeof process&&process.nextTick?(p=!0,function(){process.nextTick(h)}):"function"==typeof setImmediate?"undefined"!=typeof window?setImmediate.bind(window,h):function(){setImmediate(h)}:"undefined"!=typeof MessageChannel?((r=new MessageChannel).port1.onmessage=function(){c=i,(r.port1.onmessage=h)()},i=function(){r.port2.postMessage(0)},function(){setTimeout(h,0),i()}):function(){setTimeout(h,0)};function h(){for(;n.next;){var e=(n=n.next).task,t=(n.task=void 0,n.domain);t&&(n.domain=void 0,t.enter());try{e()}catch(e){if(p)throw t&&t.exit(),setTimeout(h,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}l=!1}var M=Function.call;function u(e){return function(){return M.apply(e,arguments)}}var d=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(e,t){var r=0,i=this.length;if(1===arguments.length)for(;;){if(r in this){t=this[r++];break}if(++r>=i)throw new TypeError}for(;r<i;r++)r in this&&(t=e(t,this[r],r));return t}),U=u(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),g=u(Array.prototype.map||function(i,n){var o=this,s=[];return f(o,function(e,t,r){s.push(i.call(n,t,r,o))},void 0),s}),m=Object.create||function(e){function t(){}return t.prototype=e,new t},z=u(Object.prototype.hasOwnProperty),B=Object.keys||function(e){var t,r=[];for(t in e)z(e,t)&&r.push(t);return r},H=u(Object.prototype.toString);var y="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e},v="From previous event:";function C(e,t){if(a&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(v)){for(var r=[],i=t;i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(e.stack);t=r.join("\n"+v+"\n");e.stack=(e=>{for(var t=e.split("\n"),r=[],i=0;i<t.length;++i){var n=t[i];(e=>{var t;return(e=S(e))&&(t=e[0],e=e[1],t===o)&&N<=e&&e<=X})(n)||(e=>-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:"))(n)||!n||r.push(n)}return r.join("\n")})(t)}}function S(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);return(t=t||/at ([^ ]+):(\d+):(?:\d+)$/.exec(e))?[t[1],Number(t[2])]:(t=/.*@(.+):(\d+)$/.exec(e))?[t[1],Number(t[2])]:void 0}function k(){if(a)try{throw new Error}catch(e){var t=e.stack.split("\n"),t=S(0<t[0].indexOf("@")?t[1]:t[2]);if(t)return o=t[0],t[1]}}function _(e){return e instanceof w?e:G(e)?(t=e,r=b(),_.nextTick(function(){try{t.then(r.resolve,r.reject,r.notify)}catch(e){r.reject(e)}}),r.promise):O(e);var t,r}function b(){var n,o=[],s=[],e=m(b.prototype),t=m(w.prototype);if(t.promiseDispatch=function(e,t,r){var i=d(arguments);o?(o.push(i),"when"===t&&r[1]&&s.push(r[1])):_.nextTick(function(){n.promiseDispatch.apply(n,i)})},t.valueOf=function(){var e;return o?t:(P(e=$(n))&&(n=e),e)},t.inspect=function(){return n?n.inspect():{state:"pending"}},_.longStackSupport&&a)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1)}function r(r){n=r,t.source=r,f(o,function(e,t){_.nextTick(function(){r.promiseDispatch.apply(r,t)})},void 0),s=o=void 0}return e.promise=t,e.resolve=function(e){n||r(_(e))},e.fulfill=function(e){n||r(O(e))},e.reject=function(e){n||r(D(e))},e.notify=function(r){n||f(s,function(e,t){_.nextTick(function(){t(r)})},void 0)},e}function E(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=b();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function W(n){return E(function(e,t){for(var r=0,i=n.length;r<i;r++)_(n[r]).then(e,t)})}function w(n,o,t){void 0===o&&(o=function(e){return D(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var e,s=m(w.prototype);return s.promiseDispatch=function(e,t,r){var i;try{i=n[t]?n[t].apply(s,r):o.call(s,t,r)}catch(e){i=D(e)}e&&e(i)},(s.inspect=t)&&("rejected"===(e=t()).state&&(s.exception=e.reason),s.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?s:e.value}),s}function T(e,t,r,i){return _(e).then(t,r,i)}function $(e){if(P(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function P(e){return e instanceof w}function G(e){return e===Object(e)&&"function"==typeof e.then}(_.resolve=_).nextTick=e,_.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(_.longStackSupport=!0),(_.defer=b).prototype.makeNodeResolver=function(){var r=this;return function(e,t){e?r.reject(e):2<arguments.length?r.resolve(d(arguments,1)):r.resolve(t)}},_.Promise=E,(_.promise=E).race=W,E.all=F,E.reject=D,(E.resolve=_).passByCopy=function(e){return e},w.prototype.passByCopy=function(){return this},_.join=function(e,t){return _(e).join(t)},w.prototype.join=function(e){return _([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},_.race=W,w.prototype.race=function(){return this.then(_.race)},(_.makePromise=w).prototype.toString=function(){return"[object Promise]"},w.prototype.then=function(t,r,n){var i=this,o=b(),s=!1;return _.nextTick(function(){i.promiseDispatch(function(e){s||(s=!0,o.resolve((e=>{try{return"function"==typeof t?t(e):e}catch(e){return D(e)}})(e)))},"when",[function(e){s||(s=!0,o.resolve((e=>{if("function"==typeof r){C(e,i);try{return r(e)}catch(e){return D(e)}}return D(e)})(e)))}])}),i.promiseDispatch(void 0,"when",[void 0,function(e){var t,r,i=!1;try{r=e,t="function"==typeof n?n(r):r}catch(e){if(i=!0,!_.onerror)throw e;_.onerror(e)}i||o.notify(t)}]),o.promise},_.tap=function(e,t){return _(e).tap(t)},w.prototype.tap=function(t){return t=_(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},_.when=T,w.prototype.thenResolve=function(e){return this.then(function(){return e})},_.thenResolve=function(e,t){return _(e).thenResolve(t)},w.prototype.thenReject=function(e){return this.then(function(){throw e})},_.thenReject=function(e,t){return _(e).thenReject(t)},_.nearer=$,_.isPromise=P,_.isPromiseAlike=G,_.isPending=function(e){return P(e)&&"pending"===e.inspect().state},w.prototype.isPending=function(){return"pending"===this.inspect().state},_.isFulfilled=function(e){return!P(e)||"fulfilled"===e.inspect().state},w.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},_.isRejected=function(e){return P(e)&&"rejected"===e.inspect().state},w.prototype.isRejected=function(){return"rejected"===this.inspect().state};var I,j,q,L=[],A=[],x=!0;function R(){L.length=0,A.length=0,x=x||!0}function D(r){var e,t,i=w({when:function(e){var t;return e&&(t=this,x)&&-1!==(t=U(A,t))&&(A.splice(t,1),L.splice(t,1)),e?e(r):this}},function(){return this},function(){return{state:"rejected",reason:r}});return e=i,t=r,x&&(A.push(e),t&&void 0!==t.stack?L.push(t.stack):L.push("(no stack) "+t)),i}function O(r){return w({when:function(){return r},get:function(e){return r[e]},set:function(e,t){r[e]=t},delete:function(e){delete r[e]},post:function(e,t){return null==e?r.apply(void 0,t):r[e].apply(r,t)},apply:function(e,t){return r.apply(e,t)},keys:function(){return B(r)}},void 0,function(){return{state:"fulfilled",value:r}})}function K(e,t,r){return _(e).spread(t,r)}function V(e,t,r){return _(e).dispatch(t,r)}function F(e){return T(e,function(n){var o=0,s=b();return f(n,function(e,t,r){var i;P(t)&&"fulfilled"===(i=t.inspect()).state?n[r]=i.value:(++o,T(t,function(e){n[r]=e,0==--o&&s.resolve(n)},s.reject,function(e){s.notify({index:r,value:e})}))},void 0),0===o&&s.resolve(n),s.promise})}function Z(n){var o,s;return 0===n.length?_.resolve():(o=_.defer(),f(n,function(e,t,r){var i=n[r];s++,T(i,function(e){o.resolve(e)},function(){0==--s&&o.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(e){o.notify({index:r,value:e})})},void(s=0)),o.promise)}function Y(e){return T(e,function(e){return e=g(e,_),T(F(g(e,function(e){return T(e,t,t)})),function(){return e})})}_.resetUnhandledRejections=R,_.getUnhandledReasons=function(){return L.slice()},_.stopUnhandledRejectionTracking=function(){R(),x=!1},R(),_.reject=D,_.fulfill=O,_.master=function(r){return w({isDef:function(){}},function(e,t){return V(r,e,t)},function(){return _(r).inspect()})},_.spread=K,w.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},_.async=function(t){return function(){function e(t,e){var r;if("undefined"==typeof StopIteration){try{r=i[t](e)}catch(e){return D(e)}return r.done?_(r.value):T(r.value,n,o)}try{r=i[t](e)}catch(e){return"[object StopIteration]"===H(t=e)||t instanceof y?_(e.value):D(e)}return T(r,n,o)}var i=t.apply(this,arguments),n=e.bind(e,"next"),o=e.bind(e,"throw");return n()}},_.spawn=function(e){_.done(_.async(e)())},_.return=function(e){throw new y(e)},_.promised=function(r){return function(){return K([this,F(arguments)],function(e,t){return r.apply(e,t)})}},_.dispatch=V,w.prototype.dispatch=function(e,t){var r=this,i=b();return _.nextTick(function(){r.promiseDispatch(i.resolve,e,t)}),i.promise},_.get=function(e,t){return _(e).dispatch("get",[t])},w.prototype.get=function(e){return this.dispatch("get",[e])},_.set=function(e,t,r){return _(e).dispatch("set",[t,r])},w.prototype.set=function(e,t){return this.dispatch("set",[e,t])},_.del=_.delete=function(e,t){return _(e).dispatch("delete",[t])},w.prototype.del=w.prototype.delete=function(e){return this.dispatch("delete",[e])},_.mapply=_.post=function(e,t,r){return _(e).dispatch("post",[t,r])},w.prototype.mapply=w.prototype.post=function(e,t){return this.dispatch("post",[e,t])},_.send=_.mcall=_.invoke=function(e,t){return _(e).dispatch("post",[t,d(arguments,2)])},w.prototype.send=w.prototype.mcall=w.prototype.invoke=function(e){return this.dispatch("post",[e,d(arguments,1)])},_.fapply=function(e,t){return _(e).dispatch("apply",[void 0,t])},w.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},_.try=_.fcall=function(e){return _(e).dispatch("apply",[void 0,d(arguments,1)])},w.prototype.fcall=function(){return this.dispatch("apply",[void 0,d(arguments)])},_.fbind=function(e){var t=_(e),r=d(arguments,1);return function(){return t.dispatch("apply",[this,r.concat(d(arguments))])}},w.prototype.fbind=function(){var e=this,t=d(arguments);return function(){return e.dispatch("apply",[this,t.concat(d(arguments))])}},_.keys=function(e){return _(e).dispatch("keys",[])},w.prototype.keys=function(){return this.dispatch("keys",[])},_.all=F,w.prototype.all=function(){return F(this)},_.any=Z,w.prototype.any=function(){return Z(this)},_.allResolved=(I=Y,j="allResolved",q="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(j+" is deprecated, use "+q+" instead.",new Error("").stack),I.apply(I,arguments)}),w.prototype.allResolved=function(){return Y(this)},_.allSettled=function(e){return _(e).allSettled()},w.prototype.allSettled=function(){return this.then(function(e){return F(g(e,function(e){function t(){return e.inspect()}return(e=_(e)).then(t,t)}))})},_.fail=_.catch=function(e,t){return _(e).then(void 0,t)},w.prototype.fail=w.prototype.catch=function(e){return this.then(void 0,e)},_.progress=function(e,t){return _(e).then(void 0,void 0,t)},w.prototype.progress=function(e){return this.then(void 0,void 0,e)},_.fin=_.finally=function(e,t){return _(e).finally(t)},w.prototype.fin=w.prototype.finally=function(t){return t=_(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},_.done=function(e,t,r,i){return _(e).done(t,r,i)},w.prototype.done=function(e,t,r){var i=function(e){_.nextTick(function(){if(C(e,n),!_.onerror)throw e;_.onerror(e)})},n=e||t||r?this.then(e,t,r):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),n.then(void 0,i)},_.timeout=function(e,t,r){return _(e).timeout(t,r)},w.prototype.timeout=function(e,t){var r=b(),i=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),r.reject(t)},e);return this.then(function(e){clearTimeout(i),r.resolve(e)},function(e){clearTimeout(i),r.reject(e)},r.notify),r.promise},_.delay=function(e,t){return void 0===t&&(t=e,e=void 0),_(e).delay(t)},w.prototype.delay=function(r){return this.then(function(e){var t=b();return setTimeout(function(){t.resolve(e)},r),t.promise})},_.nfapply=function(e,t){return _(e).nfapply(t)},w.prototype.nfapply=function(e){var t=b(),e=d(e);return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},_.nfcall=function(e){var t=d(arguments,1);return _(e).nfapply(t)},w.prototype.nfcall=function(){var e=d(arguments),t=b();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},_.nfbind=_.denodeify=function(r){var i=d(arguments,1);return function(){var e=i.concat(d(arguments)),t=b();return e.push(t.makeNodeResolver()),_(r).fapply(e).fail(t.reject),t.promise}},w.prototype.nfbind=w.prototype.denodeify=function(){var e=d(arguments);return e.unshift(this),_.denodeify.apply(void 0,e)},_.nbind=function(r,i){var n=d(arguments,2);return function(){var e=n.concat(d(arguments)),t=b();return e.push(t.makeNodeResolver()),_(function(){return r.apply(i,arguments)}).fapply(e).fail(t.reject),t.promise}},w.prototype.nbind=function(){var e=d(arguments,0);return e.unshift(this),_.nbind.apply(void 0,e)},_.nmapply=_.npost=function(e,t,r){return _(e).npost(t,r)},w.prototype.nmapply=w.prototype.npost=function(e,t){var t=d(t||[]),r=b();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},_.nsend=_.nmcall=_.ninvoke=function(e,t){var r=d(arguments,2),i=b();return r.push(i.makeNodeResolver()),_(e).dispatch("post",[t,r]).fail(i.reject),i.promise},w.prototype.nsend=w.prototype.nmcall=w.prototype.ninvoke=function(e){var t=d(arguments,1),r=b();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},_.nodeify=function(e,t){return _(e).nodeify(t)},w.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){_.nextTick(function(){t(null,e)})},function(e){_.nextTick(function(){t(e)})})};var X=k();return _}),(()=>{var e=$.namespace("pskl.rendering");e.DrawingLoop=function(){this.requestAnimationFrame=this.getRequestAnimationFrameShim_(),this.isRunning=!1,this.previousTime=0,this.callbacks=[],this.loop_=this.loop_.bind(this)},e.DrawingLoop.prototype.addCallback=function(e,t,r){e={fn:e,scope:t,args:r};return this.callbacks.push(e),e},e.DrawingLoop.prototype.removeCallback=function(e){e=this.callbacks.indexOf(e);-1!=e&&this.callbacks.splice(e,1)},e.DrawingLoop.prototype.start=function(){this.isRunning=!0,this.loop_()},e.DrawingLoop.prototype.loop_=function(){var e=Date.now(),t=e-this.previousTime;this.executeCallbacks_(t),this.previousTime=e,this.requestAnimationFrame.call(window,this.loop_)},e.DrawingLoop.prototype.executeCallbacks_=function(e){for(var t=0;t<this.callbacks.length;t++){var r=this.callbacks[t];r.fn.call(r.scope,e,r.args)}},e.DrawingLoop.prototype.stop=function(){this.isRunning=!1},e.DrawingLoop.prototype.getRequestAnimationFrameShim_=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}})(),(()=>{var r=$.namespace("pskl.model"),i=0,n=(r.Frame=function(e,t){if(!e||!t)throw"Bad arguments in pskl.model.Frame constructor : "+e+", "+t;this.width=e,this.height=t,this.id=i++,this.version=0,this.pixels=r.Frame.createEmptyPixelGrid_(e,t),this.colorPalette=[],this.stateIndex=0},r.Frame.fromPixelGrid=function(e,t,r){if(e.length){if(e[0].length)for(var i=e.length,n=e[0].length,o=[],s=0;s<n;s++)for(var a=0;a<i;a++)"string"==typeof e[a][s]?o[s*i+a]=pskl.utils.colorToInt(e[a][s]):o[s*i+a]=e[a][s];else{if(!t||!r)throw"Bad arguments in pskl.model.frame.fromPixelGrid, missing width and height";i=t,n=r,o=e}t=new pskl.model.Frame(i,n);return t.setPixels(o),t}throw"Bad arguments in pskl.model.Frame.fromPixelGrid"},{});r.Frame.createEmptyPixelGrid_=function(e,t){var r,i=e+"-"+t;return n[i]?r=n[i]:(r=n[i]=new Uint32Array(e*t),i=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),r.fill(i)),new Uint32Array(r)},r.Frame.createEmptyFromFrame=function(e){return new r.Frame(e.getWidth(),e.getHeight())},r.Frame.prototype.clone=function(){var e=new r.Frame(this.width,this.height);return e.setPixels(this.pixels),e},r.Frame.prototype.getPixels=function(){return this.clonePixels_(this.pixels)},r.Frame.prototype.setPixels=function(e){this.pixels=this.clonePixels_(e),this.version++},r.Frame.prototype.clear=function(){this.pixels=r.Frame.createEmptyPixelGrid_(this.getWidth(),this.getHeight()),this.version++},r.Frame.prototype.clonePixels_=function(e){return new Uint32Array(e)},r.Frame.prototype.getHash=function(){return[this.id,this.version].join("-")},r.Frame.prototype.setPixel=function(e,t,r){this.containsPixel(e,t)&&(t=t*this.width+e,this.pixels[t]!==(e=pskl.utils.colorToInt(r)))&&(r=e||pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),this.pixels[t]=r,this.version++)},r.Frame.prototype.getPixel=function(e,t){return this.containsPixel(e,t)?this.pixels[t*this.width+e]:null},r.Frame.prototype.forEachPixel=function(e){for(var t=this.getWidth(),r=t*this.getHeight(),i=0;i<r;i++)e(this.pixels[i],i%t,Math.floor(i/t),this)},r.Frame.prototype.getWidth=function(){return this.width},r.Frame.prototype.getHeight=function(){return this.height},r.Frame.prototype.containsPixel=function(e,t){return 0<=e&&0<=t&&e<this.width&&t<this.height},r.Frame.prototype.isSameSize=function(e){return this.getHeight()==e.getHeight()&&this.getWidth()==e.getWidth()}})(),(()=>{var r=$.namespace("pskl.model");r.Layer=function(e){if(!e)throw"Invalid arguments in Layer constructor : 'name' is mandatory";this.name=e,this.frames=[],this.opacity=1},r.Layer.fromFrames=function(e,t){e=new r.Layer(e);return t.forEach(e.addFrame.bind(e)),e},r.Layer.prototype.getName=function(){return this.name},r.Layer.prototype.setName=function(e){this.name=e},r.Layer.prototype.getOpacity=function(){return this.opacity},r.Layer.prototype.setOpacity=function(e){null===(e="string"==typeof e?parseFloat(e):e)||isNaN(e)||e<0||1<e||(this.opacity=+e.toFixed(3))},r.Layer.prototype.isTransparent=function(){return this.opacity<1},r.Layer.prototype.getFrames=function(){return this.frames},r.Layer.prototype.getFrameAt=function(e){return this.frames[e]},r.Layer.prototype.addFrame=function(e){this.frames.push(e)},r.Layer.prototype.addFrameAt=function(e,t){this.frames.splice(t,0,e)},r.Layer.prototype.removeFrame=function(e){e=this.frames.indexOf(e);this.removeFrameAt(e)},r.Layer.prototype.removeFrameAt=function(e){this.frames[e]?this.frames.splice(e,1):console.error("Invalid index in removeFrameAt : %s (size : %s)",e,this.size())},r.Layer.prototype.moveFrame=function(e,t){e=this.frames.splice(e,1)[0];this.frames.splice(t,0,e)},r.Layer.prototype.swapFramesAt=function(e,t){var r=this.frames[e],i=this.frames[t];r&&i?(this.frames[t]=r,this.frames[e]=i):console.error("Frame not found in moveFrameAt (from %s, to %s)",e,t)},r.Layer.prototype.duplicateFrame=function(e){e=this.frames.indexOf(e);this.duplicateFrameAt(e)},r.Layer.prototype.duplicateFrameAt=function(e){var t=this.frames[e];t?(t=t.clone(),this.addFrameAt(t,e)):console.error("Frame not found in duplicateFrameAt (at %s)",e)},r.Layer.prototype.size=function(){return this.frames.length},r.Layer.prototype.getHash=function(){return this.frames.map(function(e){return e.getHash()}).join("-")}})(),$.namespace("pskl.model.piskel").Descriptor=function(e,t,r){this.name=e,this.description=t,this.isPublic=r},(()=>{function e(e){return pskl.utils.FrameUtils.toImage(e)}function t(e){return e}var r=$.namespace("pskl.model.frame"),o="__cache_default__";r.CachedFrameProcessor=function(){this.cache_={},this.cacheQueue_=[],this.frameProcessor=e,this.outputCloner=t,this.defaultNamespace=o},r.CachedFrameProcessor.prototype.clear=function(){this.cache_={}},r.CachedFrameProcessor.prototype.setFrameProcessor=function(e){this.frameProcessor=e},r.CachedFrameProcessor.prototype.setOutputCloner=function(e){this.outputCloner=e},r.CachedFrameProcessor.prototype.get=function(e,t){var r=null,i=(this.cache_[t=t||o]||(this.cache_[t]={}),this.cache_[t]),n=e.getHash();return i[n]?r=i[n]:(r=this.frameProcessor(e),i[n]=r,this.cacheQueue_.unshift([t,n]),100<this.cacheQueue_.length&&(e=this.cacheQueue_.pop(),this.cache_[e[0]][e[1]]=null)),r}})(),(()=>{var t=$.namespace("pskl.model.frame");t.AsyncCachedFrameProcessor=function(e){t.CachedFrameProcessor.call(this,e)},pskl.utils.inherit(t.AsyncCachedFrameProcessor,t.CachedFrameProcessor),t.AsyncCachedFrameProcessor.prototype.get=function(e,t){var r=null,i=(t=t||this.defaultNamespace,this.cache_[t]||(this.cache_[t]={}),Q.defer()),t=this.cache_[t],n=e.getHash();return t[n]?r=t[n]:(t=this.onProcessorComplete_.bind(this,i,t,n),this.frameProcessor(e,t)),r&&i.resolve(r),i.promise},t.AsyncCachedFrameProcessor.prototype.onProcessorComplete_=function(e,t,r,i){t[r]=i,e.resolve(i)}})(),(()=>{var e=$.namespace("pskl.model.frame");e.RenderedFrame=function(e,t,r,i){this.width=t,this.height=r,this.id=i,this.renderFn=e},e.RenderedFrame.prototype.getRenderedFrame=function(){return this.renderFn()},e.RenderedFrame.prototype.getHash=function(){return this.id},e.RenderedFrame.prototype.getWidth=function(){return this.width},e.RenderedFrame.prototype.getHeight=function(){return this.height},e.RenderedFrame.prototype.getPixels=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.containsPixel=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.isSameSize=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.clone=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.setPixels=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.clear=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.setPixel=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.getPixel=Constants.ABSTRACT_FUNCTION,e.RenderedFrame.prototype.forEachPixel=Constants.ABSTRACT_FUNCTION})(),(()=>{var r=$.namespace("pskl.model");r.Palette=function(e,t,r){this.id=e,this.name=t,this.colors=r},r.Palette.fromObject=function(e){var t=e.colors.slice(0,e.colors.length);return new r.Palette(e.id,e.name,t)},r.Palette.prototype.getColors=function(){return this.colors},r.Palette.prototype.setColors=function(e){this.colors=e},r.Palette.prototype.get=function(e){return this.colors[e]},r.Palette.prototype.set=function(e,t){this.colors[e]=t},r.Palette.prototype.add=function(e){this.colors.push(e)},r.Palette.prototype.size=function(){return this.colors.length},r.Palette.prototype.removeAt=function(e){this.colors.splice(e,1)},r.Palette.prototype.move=function(e,t){this.colors.splice(t,0,this.colors.splice(e,1)[0])}})(),(()=>{var e=$.namespace("pskl.model");e.Piskel=function(e,t,r,i){if(!(e&&t&&i))throw"Missing arguments in Piskel constructor : "+Array.prototype.join.call(arguments,",");this.layers=[],this.width=e,this.height=t,this.descriptor=i,this.savePath=null,this.fps=r,this.hiddenFrames=[]},e.Piskel.fromLayers=function(e,t,r){var i,n=null;if(0<e.length&&0<e[0].size())return i=e[0].getFrameAt(0),n=new pskl.model.Piskel(i.getWidth(),i.getHeight(),t,r),e.forEach(n.addLayer.bind(n)),n;throw"Piskel.fromLayers expects array of non empty pskl.model.Layer as first argument"},e.Piskel.prototype.getLayers=function(){return this.layers},e.Piskel.prototype.getHeight=function(){return this.height},e.Piskel.prototype.getWidth=function(){return this.width},e.Piskel.prototype.getFPS=function(){return this.fps},e.Piskel.prototype.getLayers=function(){return this.layers},e.Piskel.prototype.getLayerAt=function(e){return this.layers[e]},e.Piskel.prototype.getLayersByName=function(t){return this.layers.filter(function(e){return e.getName()==t})},e.Piskel.prototype.getFrameCount=function(){return this.getLayerAt(0).size()},e.Piskel.prototype.addLayer=function(e){this.layers.push(e)},e.Piskel.prototype.addLayerAt=function(e,t){this.layers.splice(t,0,e)},e.Piskel.prototype.moveLayerUp=function(e,t){e=this.layers.indexOf(e),t=t?this.layers.length-1:e+1;this.moveLayer_(e,t)},e.Piskel.prototype.moveLayerDown=function(e,t){e=this.layers.indexOf(e);this.moveLayer_(e,t?0:e-1)},e.Piskel.prototype.moveLayer_=function(e,t){-1!=e&&-1!=t&&e!=t&&(t=pskl.utils.Math.minmax(t,0,this.layers.length-1),e=this.layers.splice(e,1)[0],this.layers.splice(t,0,e))},e.Piskel.prototype.removeLayer=function(e){e=this.layers.indexOf(e);-1!=e&&this.layers.splice(e,1)},e.Piskel.prototype.removeLayerAt=function(e){this.layers.splice(e,1)},e.Piskel.prototype.getDescriptor=function(){return this.descriptor},e.Piskel.prototype.setDescriptor=function(e){this.descriptor=e,$.publish(Events.PISKEL_DESCRIPTOR_UPDATED)},e.Piskel.prototype.setName=function(e){this.descriptor.name=e,$.publish(Events.PISKEL_DESCRIPTOR_UPDATED)},e.Piskel.prototype.getHash=function(){return this.layers.map(function(e){return e.getHash()}).join("-")}})(),(()=>{function t(e){var t=Q.defer();return e.onsuccess=t.resolve.bind(t),e.onerror=t.reject.bind(t),t.promise}var e=$.namespace("pskl.database"),r="PiskelSessionsDatabase";e.BackupDatabase=function(){this.db=null},e.BackupDatabase.DB_NAME=r,e.BackupDatabase.prototype.init=function(){var e=window.indexedDB.open(r,1);return e.onupgradeneeded=this.onUpgradeNeeded_.bind(this),t(e).then(function(e){return this.db=e.target.result,this.db}.bind(this)).catch(function(e){console.log("Could not initialize the piskel backup database")})},e.BackupDatabase.prototype.onUpgradeNeeded_=function(e){this.db=e.target.result;e=this.db.createObjectStore("snapshots",{keyPath:"id",autoIncrement:!0});e.createIndex("session_id","session_id",{unique:!1}),e.createIndex("date","date",{unique:!1}),e.createIndex("session_id, date",["session_id","date"],{unique:!1}),e.transaction.oncomplete=function(e){}.bind(this)},e.BackupDatabase.prototype.openObjectStore_=function(){return this.db.transaction(["snapshots"],"readwrite").objectStore("snapshots")},e.BackupDatabase.prototype.createSnapshot=function(e){e=this.openObjectStore_().add(e);return t(e)},e.BackupDatabase.prototype.updateSnapshot=function(e){e=this.openObjectStore_().put(e);return t(e)},e.BackupDatabase.prototype.deleteSnapshot=function(e){e=this.openObjectStore_().delete(e.id);return t(e)},e.BackupDatabase.prototype.getSnapshot=function(e){e=this.openObjectStore_().get(e);return t(e).then(function(e){return e.target.result})},e.BackupDatabase.prototype.findLastSnapshot=function(r){var i=Q.defer(),e=this.db.transaction(["snapshots"]).objectStore("snapshots").index("date"),t=IDBKeyRange.upperBound(1/0);return e.openCursor(t,"prev").onsuccess=function(e){var e=e.target.result,t=e&&e.value;t?r(t)?i.resolve(t):e.continue():i.resolve(null)},i.promise},e.BackupDatabase.prototype.getSnapshotsBySessionId=function(e){var t=Q.defer(),r=this.db.transaction(["snapshots"]).objectStore("snapshots").index("session_id, date"),e=IDBKeyRange.bound([e,0],[e,1/0]),i=[];return r.openCursor(e,"prev").onsuccess=function(e){e=e.target.result;e?(i.push(e.value),e.continue()):t.resolve(i)},t.promise},e.BackupDatabase.prototype.getSessions=function(){var n=Q.defer(),e=this.db.transaction(["snapshots"]).objectStore("snapshots"),o={},e=e.index("date"),t=IDBKeyRange.upperBound(1/0);return e.openCursor(t,"prev").onsuccess=function(e){var t,r,e=e.target.result,i=e&&e.value;i?(o[i.session_id]?((r=o[(t=i).session_id]).startDate=Math.min(r.startDate,t.date),r.endDate=Math.max(r.endDate,t.date),r.count++,r.endDate===t.date&&(r.name=t.name,r.description=t.description)):o[i.session_id]={startDate:i.date,endDate:i.date,name:i.name,description:i.description,id:i.session_id,count:1},e.continue()):n.resolve(o)},n.promise.then(function(t){return Object.keys(t).map(function(e){return t[e]})})},e.BackupDatabase.prototype.deleteSnapshotsForSession=function(e){var t=Q.defer(),r=this.openObjectStore_().index("session_id"),e=IDBKeyRange.only(e);return r.openCursor(e).onsuccess=function(e){e=e.target.result;e?(e.delete(),e.continue()):t.resolve()},t.promise}})(),(()=>{function o(e){var t=Q.defer();return e.onsuccess=t.resolve.bind(t),e.onerror=t.reject.bind(t),t.promise}var e=$.namespace("pskl.database"),t="PiskelDatabase";e.PiskelDatabase=function(e){this.db=null},e.PiskelDatabase.DB_NAME=t,e.PiskelDatabase.prototype.init=function(){var e=window.indexedDB.open(t,1);return e.onupgradeneeded=this.onUpgradeNeeded_.bind(this),o(e).then(function(e){return this.db=e.target.result,this.db}.bind(this))},e.PiskelDatabase.prototype.onUpgradeNeeded_=function(e){this.db=e.target.result,this.db.createObjectStore("piskels",{keyPath:"name"}).transaction.oncomplete=function(e){pskl.database.migrate.MigrateLocalStorageToIndexedDb.migrate(this)}.bind(this)},e.PiskelDatabase.prototype.openObjectStore_=function(){return this.db.transaction(["piskels"],"readwrite").objectStore("piskels")},e.PiskelDatabase.prototype.get=function(e){var t=this.openObjectStore_();return o(t.get(e)).then(function(e){return e.target.result})},e.PiskelDatabase.prototype.list=function(){var t=Q.defer(),r=[],e=this.openObjectStore_().openCursor();return e.onsuccess=function(e){e=e.target.result;e?(r.push({name:e.value.name,date:e.value.date,description:e.value.description}),e.continue()):t.resolve(r)},e.onerror=function(){t.reject()},t.promise},e.PiskelDatabase.prototype.update=function(e,t,r,i){var n={},e=(n.name=e,n.serialized=i,n.date=r,n.description=t,this.openObjectStore_());return o(e.put(n))},e.PiskelDatabase.prototype.create=function(e,t,r,i){var n={},e=(n.name=e,n.serialized=i,n.date=r,n.description=t,this.openObjectStore_());return o(e.add(n))},e.PiskelDatabase.prototype.delete=function(e){var t=this.openObjectStore_();return o(t.delete(e))}})(),(()=>{var s=$.namespace("pskl.database.migrate");s.MigrateLocalStorageToIndexedDb={},s.MigrateLocalStorageToIndexedDb.migrate=function(e){function i(t){var r=o[t];r?s.MigrateLocalStorageToIndexedDb.save_(e,r).then(function(){i(t+1)}).catch(function(e){console.error("Failed to migrate local storage sprite for name: "+r.name),i(t+1)}):(console.log("Data migration from local storage to indexed db finished."),console.log("Local storage piskels successfully migrated. Old copies will be deleted."),s.MigrateLocalStorageToIndexedDb.deleteLocalStoragePiskels(),n.resolve())}var n=Q.defer(),t=pskl.app.localStorageService,o=t.getKeys().map(function(e){return{name:e.name,description:e.description,date:e.date,serialized:t.getPiskel(e.name)}});return i(0),n.promise},s.MigrateLocalStorageToIndexedDb.save_=function(t,r){return t.get(r.name).then(function(e){return void 0!==e?t.update(r.name,r.description,r.date,r.serialized):t.create(r.name,r.description,r.date,r.serialized)})},s.MigrateLocalStorageToIndexedDb.deleteLocalStoragePiskels=function(){pskl.app.localStorageService.getKeys().forEach(function(e){window.localStorage.removeItem("piskel."+e.name)}),window.localStorage.removeItem("piskel.keys")}})(),(()=>{var e=$.namespace("pskl.selection"),r="REPLAY_PASTE",n="REPLAY_ERASE";e.SelectionManager=function(e){this.piskelController=e,this.currentSelection=null},e.SelectionManager.prototype.init=function(){$.subscribe(Events.SELECTION_CREATED,this.onSelectionCreated_.bind(this)),$.subscribe(Events.SELECTION_DISMISSED,this.onSelectionDismissed_.bind(this)),$.subscribe(Events.SELECTION_MOVE_REQUEST,this.onSelectionMoved_.bind(this)),$.subscribe(Events.CLIPBOARD_COPY,this.copy.bind(this)),$.subscribe(Events.CLIPBOARD_CUT,this.copy.bind(this)),$.subscribe(Events.CLIPBOARD_PASTE,this.paste.bind(this));var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.SELECTION.DELETE,this.onDeleteShortcut_.bind(this)),pskl.app.shortcutService.registerShortcut(e.SELECTION.COMMIT,this.commit.bind(this)),$.subscribe(Events.TOOL_SELECTED,this.onToolSelected_.bind(this))},e.SelectionManager.prototype.cleanSelection_=function(){this.currentSelection&&(this.currentSelection.reset(),this.currentSelection=null)},e.SelectionManager.prototype.onToolSelected_=function(e,t){t instanceof pskl.tools.drawing.selection.BaseSelect||this.cleanSelection_()},e.SelectionManager.prototype.onSelectionDismissed_=function(e){this.cleanSelection_()},e.SelectionManager.prototype.onDeleteShortcut_=function(e){if(!this.currentSelection)return!0;this.erase()},e.SelectionManager.prototype.erase=function(){for(var e=this.currentSelection.pixels,t=this.piskelController.getCurrentFrame(),r=0,i=e.length;r<i;r++)t.setPixel(e[r].col,e[r].row,Constants.TRANSPARENT_COLOR);$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:{type:n,pixels:JSON.parse(JSON.stringify(e))}})},e.SelectionManager.prototype.copy=function(e,t){this.currentSelection&&this.piskelController.getCurrentFrame()&&(this.currentSelection.fillSelectionFromFrame(this.piskelController.getCurrentFrame()),t&&(t.clipboardData.setData("text/plain",this.currentSelection.stringify()),t.preventDefault()),e.type===Events.CLIPBOARD_CUT)&&this.erase()},e.SelectionManager.prototype.paste=function(e,t){var r=t?t.clipboardData.items:[];try{for(var i=0;i<r.length;i++){var n=r[i];if(/^image/i.test(n.type))return this.pasteImage_(n),void e.stopPropagation();if(/^text\/plain/i.test(n.type))return this.pasteText_(n),void e.stopPropagation()}}catch(e){}this.currentSelection&&this.currentSelection.hasPastedContent&&this.pastePixelsOnCurrentFrame_(this.currentSelection.pixels)},e.SelectionManager.prototype.pasteImage_=function(e){var t=e.getAsFile();pskl.utils.FileUtils.readImageFile(t,function(e){pskl.app.fileDropperService.dropPosition_={x:0,y:0},pskl.app.fileDropperService.onImageLoaded_(e,t)}.bind(this))},e.SelectionManager.prototype.pasteText_=function(e){e.getAsString(function(e){var e=JSON.parse(e),t=e.time,e=e.pixels;(e=this.currentSelection&&this.currentSelection.time>=t?this.currentSelection.pixels:e)&&this.pastePixelsOnCurrentFrame_(e)}.bind(this))},e.SelectionManager.prototype.pastePixelsOnCurrentFrame_=function(e){var t=this.piskelController.getCurrentFrame();this.pastePixels_(t,e),$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:{type:r,pixels:JSON.parse(JSON.stringify(e.slice(0)))}})},e.SelectionManager.prototype.commit=function(){var e=pskl.app.drawingController.currentToolBehavior;e instanceof pskl.tools.drawing.selection.BaseSelect&&e.commitSelection()},e.SelectionManager.prototype.replay=function(t,e){e.type===r?this.pastePixels_(t,e.pixels):e.type===n&&e.pixels.forEach(function(e){t.setPixel(e.col,e.row,Constants.TRANSPARENT_COLOR)})},e.SelectionManager.prototype.pastePixels_=function(t,e){e.forEach(function(e){e.color!==Constants.TRANSPARENT_COLOR&&null!==e.color&&t.setPixel(e.col,e.row,e.color)})},e.SelectionManager.prototype.onSelectionCreated_=function(e,t){t?this.currentSelection=t:console.error("No selection provided to SelectionManager")},e.SelectionManager.prototype.onSelectionMoved_=function(e,t,r){this.currentSelection?this.currentSelection.move(t,r):console.error("Bad state: No currentSelection set when trying to move it in SelectionManager")}})(),(()=>{var e=$.namespace("pskl.selection");e.BaseSelection=function(){this.reset()},e.BaseSelection.prototype.stringify=function(){return JSON.stringify({pixels:this.pixels,time:this.time})},e.BaseSelection.prototype.parse=function(e){e=JSON.parse(e);this.pixels=e.pixels,this.time=e.time},e.BaseSelection.prototype.reset=function(){this.pixels=[],this.hasPastedContent=!1,this.time=-1},e.BaseSelection.prototype.move=function(e,t){for(var r=[],i=0,n=this.pixels.length;i<n;i++){var o=this.pixels[i];o.col+=e,o.row+=t,r.push(o)}this.pixels=r},e.BaseSelection.prototype.fillSelectionFromFrame=function(r){this.pixels.forEach(function(e){var t=r.getPixel(e.col,e.row);e.color=t||Constants.TRANSPARENT_COLOR}),this.hasPastedContent=!0,this.time=Date.now()}})(),(()=>{var e=$.namespace("pskl.selection");e.LassoSelection=function(e,t){this.pixelsMap={},e.forEach(function(e){this.setPixelInMap_(e,1)}.bind(this)),this.pixels=this.getLassoPixels_(t)},pskl.utils.inherit(e.LassoSelection,e.BaseSelection),e.LassoSelection.prototype.getLassoPixels_=function(i){var n=[];return i.forEachPixel(function(e,t,r){t={col:t,row:r};this.isInSelection_(t,i)&&n.push(t)}.bind(this)),n},e.LassoSelection.prototype.isInSelection_=function(e,t){return this.getPixelInMap_(e)||this.visitPixel_(e,t),1==this.getPixelInMap_(e)},e.LassoSelection.prototype.visitPixel_=function(e,t){var r=!1;pskl.PixelUtils.visitConnectedPixels(e,t,function(e){return!(this.getPixelInMap_(e)||(t.containsPixel(e.col,e.row)?(this.setPixelInMap_(e,2),0):r=!0))}.bind(this)).forEach(function(e){this.setPixelInMap_(e,r?-1:1)}.bind(this))},e.LassoSelection.prototype.setPixelInMap_=function(e,t){this.pixelsMap[e.col]=this.pixelsMap[e.col]||{},this.pixelsMap[e.col][e.row]=t},e.LassoSelection.prototype.getPixelInMap_=function(e){return this.pixelsMap[e.col]&&this.pixelsMap[e.col][e.row]}})(),(()=>{var e=$.namespace("pskl.selection");e.RectangularSelection=function(e,t,r,i){this.pixels=pskl.PixelUtils.getRectanglePixels(e,t,r,i)},pskl.utils.inherit(e.RectangularSelection,e.BaseSelection)})(),(()=>{var e=$.namespace("pskl.selection");e.ShapeSelection=function(e){this.pixels=e},pskl.utils.inherit(e.ShapeSelection,e.BaseSelection)})(),(()=>{var e=$.namespace("pskl.rendering");e.AbstractRenderer=function(){},e.AbstractRenderer.prototype.clear=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.render=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getCoordinates=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setGridWidth=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getGridWidth=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setZoom=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getZoom=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setOffset=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getOffset=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.setDisplaySize=Constants.ABSTRACT_FUNCTION,e.AbstractRenderer.prototype.getDisplaySize=Constants.ABSTRACT_FUNCTION})(),(()=>{var e=$.namespace("pskl.rendering");e.CompositeRenderer=function(){this.renderers=[]},pskl.utils.inherit(pskl.rendering.CompositeRenderer,pskl.rendering.AbstractRenderer),e.CompositeRenderer.prototype.add=function(e){return this.renderers.push(e),this},e.CompositeRenderer.prototype.clear=function(){this.renderers.forEach(function(e){e.clear()})},e.CompositeRenderer.prototype.setZoom=function(t){this.renderers.forEach(function(e){e.setZoom(t)})},e.CompositeRenderer.prototype.getZoom=function(){return this.getSampleRenderer_().getZoom()},e.CompositeRenderer.prototype.setDisplaySize=function(t,r){this.renderers.forEach(function(e){e.setDisplaySize(t,r)})},e.CompositeRenderer.prototype.getDisplaySize=function(){return this.getSampleRenderer_().getDisplaySize()},e.CompositeRenderer.prototype.setOffset=function(t,r){this.renderers.forEach(function(e){e.setOffset(t,r)})},e.CompositeRenderer.prototype.getOffset=function(){return this.getSampleRenderer_().getOffset()},e.CompositeRenderer.prototype.setGridWidth=function(t){this.renderers.forEach(function(e){e.setGridWidth(t)})},e.CompositeRenderer.prototype.getGridWidth=function(){return this.getSampleRenderer_().getGridWidth()},e.CompositeRenderer.prototype.getSampleRenderer_=function(){if(0<this.renderers.length)return this.renderers[0];throw"Renderer manager is empty"}})(),(()=>{var e=$.namespace("pskl.rendering.layer");e.LayersRenderer=function(e,t,r){pskl.rendering.CompositeRenderer.call(this),this.piskelController=r,this.belowRenderer=new pskl.rendering.frame.FrameRenderer(e,t,["layers-canvas","layers-below-canvas"]),this.aboveRenderer=new pskl.rendering.frame.FrameRenderer(e,t,["layers-canvas","layers-above-canvas"]),this.add(this.belowRenderer),this.add(this.aboveRenderer),this.serializedRendering="",this.stylesheet_=document.createElement("style"),document.head.appendChild(this.stylesheet_),this.updateLayersCanvasOpacity_(pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY)),$.subscribe(Events.PISKEL_RESET,this.flush.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},pskl.utils.inherit(pskl.rendering.layer.LayersRenderer,pskl.rendering.CompositeRenderer),e.LayersRenderer.prototype.render=function(){var e=this.getOffset(),t=this.getDisplaySize(),r=this.piskelController.getLayers(),i=this.piskelController.getCurrentFrameIndex(),n=this.piskelController.getCurrentLayerIndex(),o=r.slice(0,n),n=r.slice(n+1,r.length),e=[this.getZoom(),this.getGridWidth(),e.x,e.y,t.width,t.height,pskl.utils.LayerUtils.getFrameHashAt(o,i),pskl.utils.LayerUtils.getFrameHashAt(n,i),r.length].join("-");this.serializedRendering!=e&&(this.serializedRendering=e,this.clear(),0<o.length&&(t=pskl.utils.LayerUtils.mergeFrameAt(o,i),this.belowRenderer.render(t)),0<n.length)&&(r=pskl.utils.LayerUtils.mergeFrameAt(n,i),this.aboveRenderer.render(r))},e.LayersRenderer.prototype.setDisplaySize=function(e,t){var r=this.getDisplaySize();r.width===e&&r.height===t||this.superclass.setDisplaySize.call(this,e,t)},e.LayersRenderer.prototype.onUserSettingsChange_=function(e,t,r){t==pskl.UserSettings.LAYER_OPACITY&&this.updateLayersCanvasOpacity_(r)},e.LayersRenderer.prototype.updateLayersCanvasOpacity_=function(e){this.stylesheet_.innerHTML=".layers-canvas { opacity : "+e+"}"},e.LayersRenderer.prototype.flush=function(){this.serializedRendering=""}})(),(()=>{var e=$.namespace("pskl.rendering.frame");e.FrameRenderer=function(e,t,r){if(this.defaultRenderingOptions={supportGridRendering:!1,zoom:1},t=$.extend(!0,{},this.defaultRenderingOptions,t),void 0===e)throw"Bad FrameRenderer initialization. <container> undefined.";if(isNaN(t.zoom))throw"Bad FrameRenderer initialization. <zoom> not well defined.";this.container=e,this.zoom=t.zoom,this.offset={x:0,y:0},this.margin={x:0,y:0},this.supportGridRendering=t.supportGridRendering,this.classList=r||[],this.classList.push("canvas"),this.canvas=null,this.displayCanvas=null,this.setDisplaySize(t.width,t.height),this.setGridWidth(this.getUserGridWidth_()),this.setGridSpacing(this.getUserGridSpacing_()),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},pskl.utils.inherit(pskl.rendering.frame.FrameRenderer,pskl.rendering.AbstractRenderer),e.FrameRenderer.prototype.render=function(e){e&&(this.clear(),this.renderFrame_(e))},e.FrameRenderer.prototype.clear=function(){pskl.utils.CanvasUtils.clear(this.canvas),pskl.utils.CanvasUtils.clear(this.displayCanvas)},e.FrameRenderer.prototype.setZoom=function(e){var t,r=Math.min(this.displayWidth,this.displayHeight)/10;(e=pskl.utils.Math.minmax(e,1,r))!=this.zoom&&(r=this.offset.x+this.displayWidth/(2*this.zoom),t=this.offset.y+this.displayHeight/(2*this.zoom),this.zoom=e,this.setOffset(r-this.displayWidth/(2*this.zoom),t-this.displayHeight/(2*this.zoom)))},e.FrameRenderer.prototype.getZoom=function(){return this.zoom},e.FrameRenderer.prototype.setDisplaySize=function(e,t){this.displayWidth=e,this.displayHeight=t,this.displayCanvas&&(this.displayCanvas.parentNode.removeChild(this.displayCanvas),this.displayCanvas=null),this.createDisplayCanvas_()},e.FrameRenderer.prototype.getDisplaySize=function(){return{height:this.displayHeight,width:this.displayWidth}},e.FrameRenderer.prototype.getOffset=function(){return{x:this.offset.x,y:this.offset.y}},e.FrameRenderer.prototype.setOffset=function(e,t){var r=pskl.app.piskelController.getWidth(),i=pskl.app.piskelController.getHeight(),r=r-this.displayWidth/this.zoom,r=(e=pskl.utils.Math.minmax(e,0,r),i-this.displayHeight/this.zoom);t=pskl.utils.Math.minmax(t,0,r),this.offset.x=e,this.offset.y=t},e.FrameRenderer.prototype.getGridColor=function(){return pskl.UserSettings.get(pskl.UserSettings.GRID_COLOR)},e.FrameRenderer.prototype.setGridWidth=function(e){this.gridWidth_=e},e.FrameRenderer.prototype.setGridSpacing=function(e){this.gridSpacing_=e},e.FrameRenderer.prototype.getGridWidth=function(){return this.supportGridRendering?this.gridWidth_:0},e.FrameRenderer.prototype.getGridSpacing=function(){return this.supportGridRendering?this.gridSpacing_:0},e.FrameRenderer.prototype.computeGridWidthForDisplay_=function(){var e=this.getGridSpacing();if(this.zoom*e<6)return 0;for(var t=this.getGridWidth();1<t&&this.zoom<6*t;)t--;return t},e.FrameRenderer.prototype.updateMargins_=function(e){var t=this.displayWidth-this.zoom*e.getWidth(),t=(this.margin.x=Math.max(0,t)/2,this.displayHeight-this.zoom*e.getHeight());this.margin.y=Math.max(0,t)/2},e.FrameRenderer.prototype.createDisplayCanvas_=function(){var e=this.displayHeight,t=this.displayWidth;this.displayCanvas=pskl.utils.CanvasUtils.createCanvas(t,e,this.classList),pskl.utils.CanvasUtils.disableImageSmoothing(this.displayCanvas),this.container.appendChild(this.displayCanvas)},e.FrameRenderer.prototype.onUserSettingsChange_=function(e,t,r){var i=pskl.UserSettings;t!=i.GRID_WIDTH&&t!=i.GRID_SPACING&&t!=i.GRID_ENABLED||(this.setGridWidth(this.getUserGridWidth_()),this.setGridSpacing(this.getUserGridSpacing_()))},e.FrameRenderer.prototype.getUserGridWidth_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED),t=pskl.UserSettings.get(pskl.UserSettings.GRID_WIDTH);return e?t:0},e.FrameRenderer.prototype.getUserGridSpacing_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED),t=pskl.UserSettings.get(pskl.UserSettings.GRID_SPACING);return e?t:0},e.FrameRenderer.prototype.getCoordinates=function(e,t){var r=this.container.getBoundingClientRect(),r=(e=(e-=r.left)-this.margin.x,t=t-r.top-this.margin.y,this.zoom);return e+=this.offset.x*r,t+=this.offset.y*r,{x:Math.floor(e/r),y:Math.floor(t/r)}},e.FrameRenderer.prototype.reverseCoordinates=function(e,t){var r=this.zoom,i=(e=e*r-this.offset.x*r,t=t*r-this.offset.y*r,e+=this.margin.x,t+=this.margin.y,this.container.getBoundingClientRect());return{x:(e+=i.left)+r/2,y:(t+=i.top)+r/2}},e.FrameRenderer.prototype.renderFrame_=function(e){this.canvas&&e.getWidth()==this.canvas.width&&e.getHeight()==this.canvas.height||(this.canvas=pskl.utils.CanvasUtils.createCanvas(e.getWidth(),e.getHeight()));var t=this.canvas.width,r=this.canvas.height,i=this.zoom,n=(pskl.utils.FrameUtils.drawToCanvas(e,this.canvas),this.updateMargins_(e),this.displayCanvas.getContext("2d")),o=(n.save(),this.margin.x-this.offset.x*i),s=this.margin.y-this.offset.y*i,a=((0<o||0<s)&&(n.fillStyle=Constants.ZOOMED_OUT_BACKGROUND_COLOR,n.fillRect(0,0,this.displayCanvas.width-1,this.displayCanvas.height-1)),n.translate(o,s),n.scale(i,i),pskl.UserSettings.get("SEAMLESS_MODE")?n.clearRect(-1*t,-1*r,3*t,3*r):n.clearRect(0,0,t,r),pskl.UserSettings.get("SEAMLESS_MODE")&&this.drawTiledFrames_(n,this.canvas,t,r,1),n.drawImage(this.canvas,0,0),this.computeGridWidthForDisplay_()),l=this.getGridSpacing();if(0<a){o=this.getGridColor();n.scale(1/i,1/i);for(var c=(o===Constants.TRANSPARENT_COLOR?n.clearRect:(n.fillStyle=o,n.fillRect)).bind(n),p=1;p<e.getWidth();p++)p%l==0&&c(p*i-a/2,0,a,r*i);for(var h=1;h<e.getHeight();h++)h%l==0&&c(0,h*i-a/2,t*i,a)}n.restore()},e.FrameRenderer.prototype.drawTiledFrames_=function(t,r,i,n,o){var e=pskl.UserSettings.get("SEAMLESS_OPACITY"),e=pskl.utils.Math.minmax(e,0,1);t.fillStyle="rgba(255, 255, 255, "+e+")",[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]].forEach(function(e){t.drawImage(r,e[0]*i*o,e[1]*n*o),t.fillRect(e[0]*i*o,e[1]*n*o,i*o,n*o)})}})(),(()=>{var i=$.namespace("pskl.rendering");i.OnionSkinRenderer=function(e,t){pskl.rendering.CompositeRenderer.call(this),this.piskelController=t,this.renderer=e,this.add(this.renderer),this.hash=""},i.OnionSkinRenderer.createInContainer=function(e,t,r){e=new pskl.rendering.frame.FrameRenderer(e,t,["onion-skin-canvas"]);return new i.OnionSkinRenderer(e,r)},pskl.utils.inherit(pskl.rendering.OnionSkinRenderer,pskl.rendering.CompositeRenderer),i.OnionSkinRenderer.prototype.render=function(){var e=this.getOnionFrames_(),t=this.computeHash_(e);this.hash!=t&&(this.hash=t,this.clear(),0<e.length)&&(t=pskl.utils.FrameUtils.merge(e),this.renderer.render(t))},i.OnionSkinRenderer.prototype.getOnionFrames_=function(){var e=[],t=this.piskelController.getCurrentFrameIndex(),r=this.piskelController.getCurrentLayer(),i=r.getFrameAt(t-1);i&&e.push(i);i=r.getFrameAt(t+1);return i&&e.push(i),e},i.OnionSkinRenderer.prototype.computeHash_=function(e){var t=this.getOffset(),r=this.getDisplaySize(),i=this.piskelController.getLayers();return[this.getZoom(),this.getGridWidth(),t.x,t.y,r.width,r.height,e.map(function(e){return e.getHash()}).join("-"),i.length].join("-")},i.OnionSkinRenderer.prototype.setDisplaySize=function(e,t){var r=this.getDisplaySize();r.width===e&&r.height===t||this.superclass.setDisplaySize.call(this,e,t)},i.OnionSkinRenderer.prototype.flush=function(){this.hash=""}})(),(()=>{var e=$.namespace("pskl.rendering.frame");e.BackgroundImageFrameRenderer=function(e,t){this.container=e,this.setZoom(t);t=e.ownerDocument;this.frameContainer=t.createElement("div"),this.frameContainer.classList.add("background-image-frame-container"),e.appendChild(this.frameContainer),this.cachedFrameProcessor=new pskl.model.frame.CachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.frameToDataUrl_.bind(this))},e.BackgroundImageFrameRenderer.prototype.frameToDataUrl_=function(e){e=e instanceof pskl.model.frame.RenderedFrame?pskl.utils.ImageResizer.scale(e.getRenderedFrame(),this.zoom):pskl.utils.FrameUtils.toImage(e,this.zoom);return e.toDataURL("image/png")},e.BackgroundImageFrameRenderer.prototype.render=function(e){e=this.cachedFrameProcessor.get(e,this.zoom);this.frameContainer.style.backgroundImage="url("+e+")"},e.BackgroundImageFrameRenderer.prototype.show=function(){this.frameContainer&&(this.frameContainer.style.display="block")},e.BackgroundImageFrameRenderer.prototype.setZoom=function(e){this.zoom=e},e.BackgroundImageFrameRenderer.prototype.getZoom=function(){return this.zoom},e.BackgroundImageFrameRenderer.prototype.setRepeated=function(e){e=e?"repeat":"no-repeat";this.frameContainer.style.backgroundRepeat=e}})(),(()=>{var e=$.namespace("pskl.rendering.frame");e.CachedFrameRenderer=function(e,t,r){pskl.rendering.frame.FrameRenderer.call(this,e,t,r),this.serializedFrame=""},pskl.utils.inherit(pskl.rendering.frame.CachedFrameRenderer,pskl.rendering.frame.FrameRenderer),e.CachedFrameRenderer.prototype.setDisplaySize=function(e,t){this.displayWidth===e&&this.displayHeight===t||this.superclass.setDisplaySize.call(this,e,t)},e.CachedFrameRenderer.prototype.render=function(e){var t=this.getOffset(),r=this.getDisplaySize(),t=[this.getZoom(),this.getGridWidth(),this.getGridSpacing(),this.getGridColor(),pskl.UserSettings.get("SEAMLESS_MODE"),pskl.UserSettings.get("SEAMLESS_OPACITY"),t.x,t.y,r.width,r.height,e.getHash()].join("-");this.serializedFrame!=t&&(this.serializedFrame=t,this.superclass.render.call(this,e))}})(),(()=>{var e=$.namespace("pskl.rendering");e.CanvasRenderer=function(e,t){this.frame=e,this.zoom=t,this.opacity_=1,this.transparentColor_="white"},e.CanvasRenderer.prototype.drawTransparentAs=function(e){this.transparentColor_=e},e.CanvasRenderer.prototype.setOpacity=function(e){this.opacity_=e},e.CanvasRenderer.prototype.render=function(){var e=this.createCanvas_(),t=(pskl.utils.FrameUtils.drawToCanvas(this.frame,e,this.transparentColor_,this.opacity_),this.createCanvas_(this.zoom)),r=t.getContext("2d");return pskl.utils.CanvasUtils.disableImageSmoothing(t),r.scale(this.zoom,this.zoom),r.drawImage(e,0,0),t},e.CanvasRenderer.prototype.createCanvas_=function(e){e=e||1;var t=this.frame.getWidth()*e,e=this.frame.getHeight()*e;return pskl.utils.CanvasUtils.createCanvas(t,e)}})(),(()=>{var e=$.namespace("pskl.rendering");e.FramesheetRenderer=function(e){if(!(0<e.length))throw"FramesheetRenderer : Invalid argument : frames is empty";this.frames=e},e.FramesheetRenderer.prototype.renderAsCanvas=function(e){e=e||this.frames.length;for(var t=Math.ceil(this.frames.length/e),r=this.createCanvas_(e,t),i=0;i<this.frames.length;i++){var n=this.frames[i],o=i%e*n.getWidth(),s=Math.floor(i/e)*n.getHeight();this.drawFrameInCanvas_(n,r,o,s)}return r},e.FramesheetRenderer.prototype.drawFrameInCanvas_=function(e,t,r,i){var t=t.getContext("2d"),n=t.createImageData(e.getWidth(),e.getHeight()),e=e.getPixels(),e=new Uint8ClampedArray(e.buffer);n.data.set(e),t.putImageData(n,r,i)},e.FramesheetRenderer.prototype.createCanvas_=function(e,t){var r=this.frames[0],e=e*r.getWidth(),t=t*r.getHeight();return pskl.utils.CanvasUtils.createCanvas(e,t)}})(),(()=>{var e=$.namespace("pskl.rendering");e.PiskelRenderer=function(e){for(var t=[],r=0;r<e.getFrameCount();r++)t.push(e.renderFrameAt(r,!0));this.piskelController=e,this.frames=t},e.PiskelRenderer.prototype.renderAsCanvas=function(e){e=e||this.frames.length;for(var t=Math.ceil(this.frames.length/e),r=this.createCanvas_(e,t),i=0;i<this.frames.length;i++){var n=this.frames[i],o=i%e*this.piskelController.getWidth(),s=Math.floor(i/e)*this.piskelController.getHeight();this.drawFrameInCanvas_(n,r,o,s)}return r},e.PiskelRenderer.prototype.drawFrameInCanvas_=function(e,t,r,i){t.getContext("2d").drawImage(e,r,i,e.width,e.height)},e.PiskelRenderer.prototype.createCanvas_=function(e,t){e*=this.piskelController.getWidth(),t*=this.piskelController.getHeight();return pskl.utils.CanvasUtils.createCanvas(e,t)}})(),(()=>{var e=$.namespace("pskl.controller.piskel");e.PiskelController=function(e){if(!e)throw"A piskel instance is mandatory for instanciating PiskelController";this.setPiskel(e)},e.PiskelController.prototype.setPiskel=function(e,t){this.piskel=e,(t=t||{}).preserveState||(this.currentLayerIndex=0,this.currentFrameIndex=0),this.layerIdCounter=1},e.PiskelController.prototype.init=function(){},e.PiskelController.prototype.getHeight=function(){return this.piskel.getHeight()},e.PiskelController.prototype.getWidth=function(){return this.piskel.getWidth()},e.PiskelController.prototype.getFPS=function(){return this.piskel.fps},e.PiskelController.prototype.setFPS=function(e){"number"==typeof e&&(this.piskel.fps=e,$.publish(Events.FPS_CHANGED))},e.PiskelController.prototype.getLayers=function(){return this.piskel.getLayers()},e.PiskelController.prototype.getCurrentLayer=function(){return this.getLayerAt(this.currentLayerIndex)},e.PiskelController.prototype.getLayerAt=function(e){return this.piskel.getLayerAt(e)},e.PiskelController.prototype.hasLayerAt=function(e){return!!this.getLayerAt(e)},e.PiskelController.prototype.getLayerByIndex=function(e){var t=this.getLayers();return t[e]||null},e.PiskelController.prototype.getCurrentFrame=function(){return this.getCurrentLayer().getFrameAt(this.currentFrameIndex)},e.PiskelController.prototype.getCurrentLayerIndex=function(){return this.currentLayerIndex},e.PiskelController.prototype.getCurrentFrameIndex=function(){return this.currentFrameIndex},e.PiskelController.prototype.getPiskel=function(){return this.piskel},e.PiskelController.prototype.isTransparent=function(){return this.getLayers().some(function(e){return e.isTransparent()})},e.PiskelController.prototype.renderFrameAt=function(e,t){return pskl.utils.LayerUtils.flattenFrameAt(this.getLayers(),e,t)},e.PiskelController.prototype.hasFrameAt=function(e){return!!this.getCurrentLayer().getFrameAt(e)},e.PiskelController.prototype.addFrame=function(){this.addFrameAt(this.getFrameCount())},e.PiskelController.prototype.addFrameAtCurrentIndex=function(){this.addFrameAt(this.currentFrameIndex+1)},e.PiskelController.prototype.addFrameAt=function(t){this.getLayers().forEach(function(e){e.addFrameAt(this.createEmptyFrame_(),t)}.bind(this)),this.onFrameAddedAt_(t)},e.PiskelController.prototype.onFrameAddedAt_=function(t){this.piskel.hiddenFrames=this.piskel.hiddenFrames.map(function(e){return t<=e?e+1:e}),this.setCurrentFrameIndex(t)},e.PiskelController.prototype.createEmptyFrame_=function(){var e=this.piskel.getWidth(),t=this.piskel.getHeight();return new pskl.model.Frame(e,t)},e.PiskelController.prototype.removeFrameAt=function(t){this.getLayers().forEach(function(e){e.removeFrameAt(t)}),this.piskel.hiddenFrames=this.piskel.hiddenFrames.map(function(e){return t<e?e-1:e}),this.currentFrameIndex>=t&&0<this.currentFrameIndex&&this.setCurrentFrameIndex(this.currentFrameIndex-1)},e.PiskelController.prototype.duplicateCurrentFrame=function(){this.duplicateFrameAt(this.currentFrameIndex)},e.PiskelController.prototype.duplicateFrameAt=function(t){this.getLayers().forEach(function(e){e.duplicateFrameAt(t)}),this.onFrameAddedAt_(t+1)},e.PiskelController.prototype.toggleFrameVisibilityAt=function(t){var e=this.piskel.hiddenFrames;-1===e.indexOf(t)?e.push(t):e=e.filter(function(e){return e!==t}),this.piskel.hiddenFrames=e.sort()},e.PiskelController.prototype.moveFrame=function(t,r){this.getLayers().forEach(function(e){e.moveFrame(t,r)}),this.piskel.hiddenFrames=this.piskel.hiddenFrames.map(function(e){return e===t?r:e>=Math.min(t,r)&&e<=Math.max(t,r)?t<r?e-1:e+1:void 0})},e.PiskelController.prototype.hasVisibleFrameAt=function(e){return-1===this.piskel.hiddenFrames.indexOf(e)},e.PiskelController.prototype.getVisibleFrameIndexes=function(){return this.getCurrentLayer().getFrames().map(function(e,t){return t}).filter(function(e){return-1===this.piskel.hiddenFrames.indexOf(e)}.bind(this))},e.PiskelController.prototype.getFrameCount=function(){return this.piskel.getFrameCount()},e.PiskelController.prototype.setCurrentFrameIndex=function(e){this.hasFrameAt(e)?(this.currentFrameIndex=e,$.publish(Events.CURRENT_FRAME_CHANGED)):window.console.error("Could not set current frame index to "+e)},e.PiskelController.prototype.selectNextFrame=function(){var e=this.currentFrameIndex+1;e<this.getFrameCount()&&this.setCurrentFrameIndex(e)},e.PiskelController.prototype.selectPreviousFrame=function(){var e=this.currentFrameIndex-1;0<=e&&this.setCurrentFrameIndex(e)},e.PiskelController.prototype.setCurrentLayerIndex=function(e){this.hasLayerAt(e)?(this.currentLayerIndex=e,$.publish(Events.CURRENT_LAYER_CHANGED)):window.console.error("Could not set current layer index to "+e)},e.PiskelController.prototype.selectLayer=function(e){e=this.getLayers().indexOf(e);-1!=e&&this.setCurrentLayerIndex(e)},e.PiskelController.prototype.renameLayerAt=function(e,t){e=this.getLayerByIndex(e);e&&e.setName(t)},e.PiskelController.prototype.setLayerOpacityAt=function(e,t){e=this.getLayerByIndex(e);e&&e.setOpacity(t)},e.PiskelController.prototype.mergeDownLayerAt=function(e){var t=this.getLayerByIndex(e),r=this.getLayerByIndex(e-1);t&&r&&(t=pskl.utils.LayerUtils.mergeLayers(t,r),this.removeLayerAt(e),this.piskel.addLayerAt(t,e),this.removeLayerAt(e-1),this.selectLayer(t))},e.PiskelController.prototype.generateLayerName_=function(){for(var e="Layer "+this.layerIdCounter;this.hasLayerForName_(e);)this.layerIdCounter++,e="Layer "+this.layerIdCounter;return e},e.PiskelController.prototype.duplicateCurrentLayer=function(){var e=this.getCurrentLayer(),e=pskl.utils.LayerUtils.clone(e),t=this.getCurrentLayerIndex();this.piskel.addLayerAt(e,t+1),this.setCurrentLayerIndex(t+1)},e.PiskelController.prototype.createLayer=function(e){if(e=e||this.generateLayerName_(),this.hasLayerForName_(e))throw"Layer name should be unique";for(var t=new pskl.model.Layer(e),r=0;r<this.getFrameCount();r++)t.addFrame(this.createEmptyFrame_());e=this.getCurrentLayerIndex();this.piskel.addLayerAt(t,e+1),this.setCurrentLayerIndex(e+1)},e.PiskelController.prototype.hasLayerForName_=function(e){return 0<this.piskel.getLayersByName(e).length},e.PiskelController.prototype.moveLayerUp=function(e){var t=this.getCurrentLayer();this.piskel.moveLayerUp(t,e),this.selectLayer(t)},e.PiskelController.prototype.moveLayerDown=function(e){var t=this.getCurrentLayer();this.piskel.moveLayerDown(t,e),this.selectLayer(t)},e.PiskelController.prototype.removeCurrentLayer=function(){var e=this.getCurrentLayerIndex();this.removeLayerAt(e)},e.PiskelController.prototype.removeLayerAt=function(e){var t;this.hasLayerAt(e)&&(t=this.getLayerAt(e),this.piskel.removeLayer(t),this.getCurrentLayerIndex()===e)&&this.setCurrentLayerIndex(Math.max(0,e-1))},e.PiskelController.prototype.serialize=function(){return pskl.utils.serialization.Serializer.serialize(this.piskel)},e.PiskelController.prototype.isEmpty=function(){return 0===pskl.app.currentColorsService.getCurrentColors().length}})(),(()=>{var e=$.namespace("pskl.controller.piskel");e.PublicPiskelController=function(e){this.piskelController=e,pskl.utils.wrap(this,this.piskelController)},e.PublicPiskelController.prototype.init=function(){this.resetWrap_("setCurrentFrameIndex"),this.resetWrap_("selectNextFrame"),this.resetWrap_("selectPreviousFrame"),this.resetWrap_("setCurrentLayerIndex"),this.resetWrap_("selectLayer"),this.saveWrap_("renameLayerAt",!1),this.saveWrap_("removeCurrentLayer",!0),this.saveWrap_("addFrame",!0),this.saveWrap_("addFrameAtCurrentIndex",!0),this.saveWrap_("addFrameAt",!0),this.saveWrap_("removeFrameAt",!0),this.saveWrap_("duplicateCurrentFrame",!0),this.saveWrap_("duplicateFrameAt",!0),this.saveWrap_("moveFrame",!0),this.saveWrap_("createLayer",!0),this.saveWrap_("duplicateCurrentLayer",!0),this.saveWrap_("mergeDownLayerAt",!0),this.saveWrap_("moveLayerUp",!0),this.saveWrap_("moveLayerDown",!0),this.saveWrap_("removeCurrentLayer",!0),this.saveWrap_("setLayerOpacityAt",!0),this.saveWrap_("toggleFrameVisibilityAt",!0);var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.MISC.PREVIOUS_FRAME,this.selectPreviousFrame.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.NEXT_FRAME,this.selectNextFrame.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.NEW_FRAME,this.addFrameAtCurrentIndex.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.DUPLICATE_FRAME,this.duplicateCurrentFrame.bind(this))},e.PublicPiskelController.prototype.getWrappedPiskelController=function(){return this.piskelController},e.PublicPiskelController.prototype.setPiskel=function(e,t){this.piskelController.setPiskel(e,t),$.publish(Events.FRAME_SIZE_CHANGED),$.publish(Events.PISKEL_RESET),t&&t.noSnapshot||$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.SNAPSHOT})},e.PublicPiskelController.prototype.resetWrap_=function(e){this[e]=function(){this.piskelController[e].apply(this.piskelController,arguments),$.publish(Events.PISKEL_RESET)}},e.PublicPiskelController.prototype.saveWrap_=function(t,e){this[t]=e?function(){var e=this.getStateInfo_();this.piskelController[t].apply(this.piskelController,arguments),this.raiseSaveStateEvent_(this.piskelController[t],arguments,e),$.publish(Events.PISKEL_RESET)}:function(){var e=this.getStateInfo_();this.piskelController[t].apply(this.piskelController,arguments),this.raiseSaveStateEvent_(this.piskelController[t],arguments,e)}},e.PublicPiskelController.prototype.getStateInfo_=function(){return{frameIndex:this.piskelController.currentFrameIndex,layerIndex:this.piskelController.currentLayerIndex}},e.PublicPiskelController.prototype.raiseSaveStateEvent_=function(e,t,r){$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:{fn:e,args:t},state:r})},e.PublicPiskelController.prototype.replay=function(e,t){t.fn.apply(this.piskelController,t.args)}})(),(()=>{var e=$.namespace("pskl.controller");e.CursorCoordinatesController=function(e){this.piskelController=e,this.origin=null,this.coordinates={x:-1,y:-1}},e.CursorCoordinatesController.prototype.init=function(){this.coordinatesContainer=document.querySelector(".cursor-coordinates"),$.subscribe(Events.CURSOR_MOVED,this.onCursorMoved_.bind(this)),$.subscribe(Events.DRAG_START,this.onDragStart_.bind(this)),$.subscribe(Events.DRAG_END,this.onDragEnd_.bind(this)),$.subscribe(Events.FRAME_SIZE_CHANGED,this.redraw.bind(this)),$.subscribe(Events.ZOOM_CHANGED,this.redraw.bind(this)),$.subscribe(Events.PISKEL_RESET,this.redraw.bind(this)),this.redraw()},e.CursorCoordinatesController.prototype.redraw=function(){var e="",t=(this.origin&&(e+=this.origin.x+":"+this.origin.y+" to "),this.coordinates.x),r=this.coordinates.y;this.piskelController.getCurrentFrame().containsPixel(t,r)&&(e+=t+":"+r,this.origin)&&(e+=" ("+(Math.abs(t-this.origin.x)+1)+"x"+(Math.abs(r-this.origin.y)+1)+")"),pskl.app.drawingController&&(e+='<div class="drawing-zoom">x'+pskl.app.drawingController.compositeRenderer.getZoom().toFixed(2)+"</div>"),this.coordinatesContainer.innerHTML=this.getFrameSizeHTML_()+e+this.getCurrentFrameIndexHTML_()},e.CursorCoordinatesController.prototype.getCurrentFrameIndexHTML_=function(){return'<div class="frame-info">'+(this.piskelController.getCurrentFrameIndex()+1)+"/"+this.piskelController.getFrameCount()+"</div>"},e.CursorCoordinatesController.prototype.getFrameSizeHTML_=function(){return"["+this.piskelController.getWidth()+"x"+this.piskelController.getHeight()+"] "},e.CursorCoordinatesController.prototype.onCursorMoved_=function(e,t,r){this.coordinates={x:t,y:r},this.redraw()},e.CursorCoordinatesController.prototype.onDragStart_=function(e,t,r){this.origin={x:t,y:r},this.redraw()},e.CursorCoordinatesController.prototype.onDragEnd_=function(e){this.origin=null,this.redraw()}})(),(()=>{var r=$.namespace("pskl.controller");r.DrawingController=function(e,t){this.piskelController=e,this.dragHandler=new r.drawing.DragHandler(this),this.overlayFrame=pskl.model.Frame.createEmptyFromFrame(e.getCurrentFrame()),this.container=t;t={zoom:this.calculateZoom_(),supportGridRendering:!1,height:this.getContainerHeight_(),width:this.getContainerWidth_(),xOffset:0,yOffset:0};this.overlayRenderer=new pskl.rendering.frame.CachedFrameRenderer(this.container,t,["canvas-overlay"]),this.onionSkinRenderer=pskl.rendering.OnionSkinRenderer.createInContainer(this.container,t,e),this.layersRenderer=new pskl.rendering.layer.LayersRenderer(this.container,t,e),t.supportGridRendering=!0,this.renderer=new pskl.rendering.frame.CachedFrameRenderer(this.container,t,["drawing-canvas"]),this.compositeRenderer=new pskl.rendering.CompositeRenderer,this.compositeRenderer.add(this.overlayRenderer).add(this.renderer).add(this.layersRenderer).add(this.onionSkinRenderer),this.isClicked=!1,this.previousMousemoveTime=0,this.currentToolBehavior=null},r.DrawingController.prototype.init=function(){this.initMouseBehavior(),$.subscribe(Events.TOOL_SELECTED,function(e,t){this.currentToolBehavior=t,this.overlayFrame.clear()}.bind(this)),window.addEventListener("resize",this.startResizeTimer_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this));var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.MISC.RESET_ZOOM,this.resetZoom_.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.INCREASE_ZOOM,this.updateZoom_.bind(this,1)),pskl.app.shortcutService.registerShortcut(e.MISC.DECREASE_ZOOM,this.updateZoom_.bind(this,-1)),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_UP,this.updateOffset_.bind(this,"up")),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_RIGHT,this.updateOffset_.bind(this,"right")),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_DOWN,this.updateOffset_.bind(this,"down")),pskl.app.shortcutService.registerShortcut(e.MISC.OFFSET_LEFT,this.updateOffset_.bind(this,"left")),window.setTimeout(function(){this.afterWindowResize_(),this.resetZoom_()}.bind(this),100)},r.DrawingController.prototype.initMouseBehavior=function(){this.container.addEventListener("mousedown",this.onMousedown_.bind(this)),pskl.utils.UserAgent.isChrome||pskl.utils.UserAgent.isIE11?this.container.addEventListener("mousewheel",this.onMousewheel_.bind(this)):this.container.addEventListener("wheel",this.onMousewheel_.bind(this)),window.addEventListener("mouseup",this.onMouseup_.bind(this)),window.addEventListener("mousemove",this.onMousemove_.bind(this)),window.addEventListener("keyup",this.onKeyup_.bind(this)),window.addEventListener("touchstart",this.onTouchstart_.bind(this)),window.addEventListener("touchmove",this.onTouchmove_.bind(this)),window.addEventListener("touchend",this.onTouchend_.bind(this)),document.body.addEventListener("contextmenu",this.onCanvasContextMenu_.bind(this))},r.DrawingController.prototype.startResizeTimer_=function(){this.resizeTimer&&window.clearInterval(this.resizeTimer),this.resizeTimer=window.setTimeout(this.afterWindowResize_.bind(this),200)},r.DrawingController.prototype.afterWindowResize_=function(){var e=this.compositeRenderer.getDisplaySize().width;this.compositeRenderer.setDisplaySize(this.getContainerWidth_(),this.getContainerHeight_());e=this.compositeRenderer.getDisplaySize().width/e*this.compositeRenderer.getZoom();this.compositeRenderer.setZoom(e),$.publish(Events.ZOOM_CHANGED)},r.DrawingController.prototype.onUserSettingsChange_=function(e,t,r){t==pskl.UserSettings.SHOW_GRID?console.warn("DrawingController:onUserSettingsChange_ not implemented !"):t!=pskl.UserSettings.ONION_SKIN&&t!=pskl.UserSettings.LAYER_PREVIEW||(this.onionSkinRenderer.clear(),this.onionSkinRenderer.flush(),this.layersRenderer.clear(),this.layersRenderer.flush(),this.render())},r.DrawingController.prototype.onFrameSizeChange_=function(){this.compositeRenderer.setDisplaySize(this.getContainerWidth_(),this.getContainerHeight_()),this.compositeRenderer.setZoom(this.calculateZoom_()),this.compositeRenderer.setOffset(0,0),$.publish(Events.ZOOM_CHANGED)},r.DrawingController.prototype.onTouchstart_=function(e){this.onMousedown_(e)},r.DrawingController.prototype.onTouchmove_=function(e){this.onMousemove_(e),e.preventDefault()},r.DrawingController.prototype.onTouchend_=function(e){this.onMouseup_(e)},r.DrawingController.prototype.onMousedown_=function(e){$.publish(Events.MOUSE_EVENT,[e,this]);var t=this.piskelController.getCurrentFrame(),r=this.getSpriteCoordinates(e.clientX,e.clientY);e.changedTouches&&e.changedTouches[0]&&(r=this.getSpriteCoordinates(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),this.isClicked=!0,e.button===Constants.MIDDLE_BUTTON?this.dragHandler.startDrag(e.clientX,e.clientY):e.altKey&&!this.currentToolBehavior.supportsAlt()?(this.currentToolBehavior.hideHighlightedPixel(this.overlayFrame),this.isPickingColor=!0):(this.currentToolBehavior.hideHighlightedPixel(this.overlayFrame),$.publish(Events.TOOL_PRESSED),this.currentToolBehavior.applyToolAt(r.x,r.y,t,this.overlayFrame,e))},r.DrawingController.prototype.onMousemove_=function(e){this._clientX=e.clientX,this._clientY=e.clientY,e.changedTouches&&e.changedTouches[0]&&(this._clientX=e.changedTouches[0].clientX,this._clientY=e.changedTouches[0].clientY);var t=(new Date).getTime();t-this.previousMousemoveTime>Constants.MOUSEMOVE_THROTTLING&&(this.moveTool_(this._clientX,this._clientY,e),this.previousMousemoveTime=t)},r.DrawingController.prototype.onKeyup_=function(e){this.moveTool_(this._clientX,this._clientY,e)},r.DrawingController.prototype.moveTool_=function(e,t,r){var i=this.getSpriteCoordinates(e,t),n=this.piskelController.getCurrentFrame();this.isClicked?pskl.app.mouseStateService.isMiddleButtonPressed()?this.dragHandler.updateDrag(e,t):this.isPickingColor||($.publish(Events.MOUSE_EVENT,[r,this]),this.currentToolBehavior.moveToolAt(0|i.x,0|i.y,n,this.overlayFrame,r)):this.currentToolBehavior.moveUnactiveToolAt(i.x,i.y,n,this.overlayFrame,r),$.publish(Events.CURSOR_MOVED,[i.x,i.y])},r.DrawingController.prototype.onMousewheel_=function(e){var t=pskl.utils.UserAgent.isIE11?e.wheelDelta:pskl.utils.UserAgent.isFirefox?-40*e.deltaY:e.wheelDeltaY,t=(t=t||0)/120,e=((pskl.utils.UserAgent.isMac?e.metaKey:e.ctrlKey)&&(t*=5,e.preventDefault()),this.getSpriteCoordinates(e.clientX,e.clientY));this.updateZoom_(t,e)},r.DrawingController.prototype.updateOffset_=function(e){var t=this.getOffset();"up"===e?--t.y:"right"===e?t.x+=1:"down"===e?t.y+=1:"left"===e&&--t.x,this.setOffset(t.x,t.y)},r.DrawingController.prototype.updateZoom_=function(e,t){var r,i,n,o,s;0!==e&&(r=this.getOffset(),i=this.getContainerWidth_()/this.renderer.getZoom(),n=this.getContainerHeight_()/this.renderer.getZoom(),e=e*this.getZoomStep_(),this.setZoom_(this.renderer.getZoom()+e),"object"==typeof t)&&(e=(t.x-r.x)/i,t=(t.y-r.y)/n,o=this.getContainerWidth_()/this.renderer.getZoom(),s=this.getContainerHeight_()/this.renderer.getZoom(),this.setOffset(r.x-(o-i)*e,r.y-(s-n)*t))},r.DrawingController.prototype.onMouseup_=function(e){var t,r,i;this.isClicked&&(t=this.getSpriteCoordinates(e.clientX,e.clientY),e.changedTouches&&e.changedTouches[0]&&(t=this.getSpriteCoordinates(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),this.isClicked=!1,r=(i=pskl.app.mouseStateService.isMiddleButtonPressed())&&!this.dragHandler.isDragging(),i=i&&this.dragHandler.isDragging(),this.isPickingColor||r?(this.pickColorAt_(t),this.isPickingColor=!1,this.flashColorPicker_()):i?this.dragHandler.stopDrag():(this.currentToolBehavior.releaseToolAt(t.x,t.y,this.piskelController.getCurrentFrame(),this.overlayFrame,e),$.publish(Events.TOOL_RELEASED)),$.publish(Events.MOUSE_EVENT,[e,this]))},r.DrawingController.prototype.pickColorAt_=function(e){var t=this.piskelController.getCurrentFrame();t.containsPixel(e.x,e.y)&&(t=pskl.utils.intToColor(t.getPixel(e.x,e.y)),e=pskl.app.mouseStateService.isRightButtonPressed()?Events.SELECT_SECONDARY_COLOR:Events.SELECT_PRIMARY_COLOR,$.publish(e,[t]))},r.DrawingController.prototype.flashColorPicker_=function(){document.body.classList.add("tool-colorpicker"),document.body.classList.remove(this.currentToolBehavior.toolId),window.clearTimeout(this.flashColorPickerTimer),this.flashColorPickerTimer=window.setTimeout(function(){document.body.classList.remove("tool-colorpicker"),document.body.classList.add(this.currentToolBehavior.toolId)}.bind(this),200)},r.DrawingController.prototype.getSpriteCoordinates=function(e,t){return this.renderer.getCoordinates(e,t)},r.DrawingController.prototype.getScreenCoordinates=function(e,t){return this.renderer.reverseCoordinates(e,t)},r.DrawingController.prototype.onCanvasContextMenu_=function(e){if(e.target.closest&&e.target.closest("#drawing-canvas-container"))return e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)},r.DrawingController.prototype.render=function(){var e=this.piskelController.getCurrentFrame();e.isSameSize(this.overlayFrame)||(this.overlayFrame=pskl.model.Frame.createEmptyFromFrame(e)),pskl.UserSettings.get(pskl.UserSettings.ONION_SKIN)&&this.onionSkinRenderer.render(),pskl.UserSettings.get(pskl.UserSettings.LAYER_PREVIEW)&&this.layersRenderer.render(),this.renderer.render(e),this.overlayRenderer.render(this.overlayFrame)},r.DrawingController.prototype.calculateZoom_=function(){var e=this.piskelController.getCurrentFrame().getHeight(),t=this.piskelController.getCurrentFrame().getWidth();return Math.min(this.getAvailableWidth_()/t,this.getAvailableHeight_()/e)},r.DrawingController.prototype.getAvailableHeight_=function(){return document.querySelector("#main-wrapper").getBoundingClientRect().height},r.DrawingController.prototype.getSelectorWidth_=function(e){return document.querySelector(e).getBoundingClientRect().width},r.DrawingController.prototype.getAvailableWidth_=function(){var e=this.getSelectorWidth_(".left-column")+this.getSelectorWidth_(".right-column")+this.getSelectorWidth_("#tool-section")+this.getSelectorWidth_("#application-action-section");return this.getSelectorWidth_("#main-wrapper")-e-10},r.DrawingController.prototype.getContainerHeight_=function(){return this.getAvailableHeight_()},r.DrawingController.prototype.getContainerWidth_=function(){return this.getAvailableWidth_()},r.DrawingController.prototype.getRenderer=function(){return this.compositeRenderer},r.DrawingController.prototype.getOffset=function(){return this.compositeRenderer.getOffset()},r.DrawingController.prototype.setOffset=function(e,t){this.compositeRenderer.setOffset(e,t),$.publish(Events.ZOOM_CHANGED)},r.DrawingController.prototype.resetZoom_=function(){this.setZoom_(this.calculateZoom_())},r.DrawingController.prototype.getZoomStep_=function(){return Math.max(.1,this.renderer.getZoom()/15)},r.DrawingController.prototype.setZoom_=function(e){this.compositeRenderer.setZoom(e),$.publish(Events.ZOOM_CHANGED)}})(),(()=>{var e=$.namespace("pskl.controller.drawing");e.DragHandler=function(e){this.drawingController=e,this.isDragging_=!1,this.updateOrigin_(-1,-1)},e.DragHandler.prototype.startDrag=function(e,t){e=this.drawingController.getSpriteCoordinates(e,t);this.updateOrigin_(e.x,e.y)},e.DragHandler.prototype.updateDrag=function(e,t){var r=this.drawingController.getOffset(),i=this.calculateOffset_(e,t);r.y===i.y&&r.x===i.x||(this.isDragging_=!0,this.drawingController.setOffset(i.x,i.y),r=this.drawingController.getSpriteCoordinates(e,t),this.updateOrigin_(r.x,r.y))},e.DragHandler.prototype.stopDrag=function(){this.isDragging_=!1,this.origin=null},e.DragHandler.prototype.isDragging=function(){return this.isDragging_},e.DragHandler.prototype.calculateOffset_=function(e,t){e=this.drawingController.getSpriteCoordinates(e,t),t=this.drawingController.getOffset();return{x:t.x-2*(e.x-this.origin.x),y:t.y-2*(e.y-this.origin.y)}},e.DragHandler.prototype.updateOrigin_=function(e,t){this.origin=this.origin||{},this.origin.x=e,this.origin.y=t}})(),(()=>{var e=$.namespace("pskl.controller"),o="select",s="clone",a="delete",n="newframe",l="toggle";e.FramesListController=function(e,t){this.piskelController=e,this.container=t,this.previewList=t.querySelector("#preview-list"),this.refreshZoom_(),this.redrawFlag=!0,this.regenerateDomFlag=!0,this.justDropped=!1,this.cachedFrameProcessor=new pskl.model.frame.CachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.frameToPreviewCanvas_.bind(this)),this.cachedFrameProcessor.setOutputCloner(this.clonePreviewCanvas_.bind(this)),this.initDragndropBehavior_()},e.FramesListController.prototype.init=function(){$.subscribe(Events.TOOL_RELEASED,this.flagForRedraw_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.flagForRedraw_.bind(this,!0)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.flagForRedraw_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.refreshZoom_.bind(this)),this.previewListScroller=document.querySelector("#preview-list-scroller"),this.previewListScroller.addEventListener("scroll",this.updateScrollerOverflows.bind(this)),this.container.addEventListener("click",this.onContainerClick_.bind(this)),this.updateScrollerOverflows()},e.FramesListController.prototype.flagForRedraw_=function(e){this.redrawFlag=!0,e&&(this.regenerateDomFlag=!0)},e.FramesListController.prototype.refreshZoom_=function(){this.zoom=this.calculateZoom_()},e.FramesListController.prototype.render=function(){this.redrawFlag&&(this.regenerateDomFlag&&(this.tiles=[],this.addFrameTile=null,this.createPreviews_(),this.regenerateDomFlag=!1),this.updatePreviews_(),this.redrawFlag=!1)},e.FramesListController.prototype.updateScrollerOverflows=function(){var e=this.previewListScroller,t=e.offsetHeight,e=e.scrollTop,r=this.previewList.offsetHeight,i=this.container.querySelector(".top-overflow").offsetHeight,n=!1,o=!1;t<r&&(i<e&&(n=!0),i<r-e-t)&&(o=!0),this.container.classList.toggle("top-overflow-visible",n),this.container.classList.toggle("bottom-overflow-visible",o)},e.FramesListController.prototype.onContainerClick_=function(e){var t,r,e=pskl.utils.Dom.getParentWithData(e.target,"tileAction");e&&(t=e.dataset.tileAction,e=parseInt(e.dataset.tileNumber,10),t===s?(this.piskelController.duplicateFrameAt(e),r=this.createPreviewTile_(e+1),this.previewList.insertBefore(r,this.tiles[e].nextSibling),this.tiles.splice(e,0,r),this.updateScrollerOverflows()):t===a?(this.piskelController.removeFrameAt(e),this.previewList.removeChild(this.tiles[e]),this.tiles.splice(e,1),this.updateScrollerOverflows()):t!==o||this.justDropped?t===n?(this.piskelController.addFrame(),r=this.createPreviewTile_(this.tiles.length),this.tiles.push(r),this.previewList.insertBefore(r,this.addFrameTile),this.updateScrollerOverflows()):t==l&&this.piskelController.toggleFrameVisibilityAt(e):this.piskelController.setCurrentFrameIndex(e),this.flagForRedraw_())},e.FramesListController.prototype.updatePreviews_=function(){for(var e=0,t=this.tiles.length;e<t;e++){this.tiles[e].classList.remove("selected"),this.tiles[e].querySelector(".tile-count").classList.remove("toggled"),this.tiles[e].setAttribute("data-tile-number",e),this.tiles[e].querySelector(".tile-count").innerHTML=e+1,this.piskelController.hasVisibleFrameAt(e)&&this.tiles[e].querySelector(".tile-count").classList.add("toggled");var r=this.piskelController.getCurrentLayer().getFrameAt(e).getHash();this.tiles[e].getAttribute("data-tile-hash")!==r&&(this.tiles[e].querySelector("canvas")?this.tiles[e].querySelector(".canvas-container").replaceChild(this.getCanvasForFrame(this.piskelController.getCurrentLayer().getFrameAt(e)),this.tiles[e].querySelector("canvas")):this.tiles[e].querySelector(".canvas-container").appendChild(this.getCanvasForFrame(this.piskelController.getCurrentLayer().getFrameAt(e))))}var i=this.container.querySelectorAll(".delete-frame-action, .dnd-action"),n=1<this.piskelController.getFrameCount()?"block":"none";for(e=0,t=i.length;e<t;e++)i[e].style.display=n;this.tiles[this.piskelController.getCurrentFrameIndex()].classList.add("selected")},e.FramesListController.prototype.createPreviews_=function(){this.previewList.innerHTML="";for(var e=document.querySelectorAll(".tooltip"),t=(Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)}),this.piskelController.getFrameCount()),r=0;r<t;r++){var i=this.createPreviewTile_(r);this.previewList.appendChild(i),this.tiles[r]=i}e=document.createElement("div");e.id="add-frame-action",e.className="add-frame-action",e.setAttribute("data-tile-action",n),e.innerHTML='<div class="add-frame-action-icon icon-frame-plus-white"></div><div class="label">Add new frame</div>',this.previewList.appendChild(e),this.addFrameTile=e,this.updateScrollerOverflows()},e.FramesListController.prototype.initDragndropBehavior_=function(){$(this.previewList).sortable({placeholder:"preview-tile preview-tile-drop-proxy",update:this.onUpdate_.bind(this),stop:this.onSortableStop_.bind(this),items:".preview-tile",axis:"y",tolerance:"pointer"}),$(this.previewList).disableSelection()},e.FramesListController.prototype.onUpdate_=function(e,t){var t=t.item.get(0),r=parseInt(t.dataset.tileNumber,10),i=document.querySelectorAll(".preview-tile"),i=Array.prototype.indexOf.call(i,t),t=(this.piskelController.moveFrame(r,i),this.piskelController.setCurrentFrameIndex(i),this.tiles.splice(r,1)[0]);this.tiles.splice(i,0,t),this.flagForRedraw_()},e.FramesListController.prototype.onSortableStop_=function(e,t){this.justDropped=!0,this.resizeTimer=window.setTimeout(function(){this.justDropped=!1}.bind(this),200)},e.FramesListController.prototype.createPreviewTile_=function(e){var t=this.piskelController.getCurrentLayer().getFrameAt(e),r=document.createElement("li"),i=(r.setAttribute("data-tile-number",e),r.setAttribute("data-tile-hash",t.getHash()),r.setAttribute("data-tile-action",o),r.classList.add("preview-tile"),this.piskelController.getCurrentFrame()==t&&r.classList.add("selected"),document.createElement("div")),n=(i.classList.add("canvas-container",pskl.UserSettings.get(pskl.UserSettings.CANVAS_BACKGROUND)),this.zoom*this.piskelController.getCurrentFrame().getHeight()),n=(Constants.PREVIEW_FILM_SIZE-n)/2,n=(i.style.marginTop=n+"px",this.zoom*this.piskelController.getCurrentFrame().getWidth()),n=(Constants.PREVIEW_FILM_SIZE-n)/2,n=(i.style.marginLeft=n+"px",i.style.marginRight=n+"px",document.createElement("div")),n=(n.className="canvas-background",i.appendChild(n),i.appendChild(this.getCanvasForFrame(t)),r.appendChild(i),document.createElement("button")),t=(n.setAttribute("rel","tooltip"),n.setAttribute("data-placement","right"),n.setAttribute("data-tile-number",e),n.setAttribute("data-tile-action",s),n.setAttribute("title","Duplicate this frame"),n.className="tile-overlay duplicate-frame-action icon-frame-duplicate-white",r.appendChild(n),document.createElement("button")),i=(t.setAttribute("rel","tooltip"),t.setAttribute("data-placement","right"),t.setAttribute("title","Delete this frame"),t.setAttribute("data-tile-number",e),t.setAttribute("data-tile-action",a),t.className="tile-overlay delete-frame-action icon-frame-recyclebin-white",r.appendChild(t),document.createElement("div")),n=(i.className="tile-overlay dnd-action icon-frame-dragndrop-white",r.appendChild(i),document.createElement("button"));return n.setAttribute("rel","tooltip"),n.setAttribute("title","Toggle for preview"),n.setAttribute("data-tile-number",e),n.setAttribute("data-tile-action",l),n.className="tile-overlay tile-count toggle-frame-action",n.innerHTML=e+1,r.appendChild(n),r},e.FramesListController.prototype.getCanvasForFrame=function(e){return this.cachedFrameProcessor.get(e,this.zoom)},e.FramesListController.prototype.frameToPreviewCanvas_=function(e){e=new pskl.rendering.CanvasRenderer(e,this.zoom),e.drawTransparentAs(Constants.TRANSPARENT_COLOR),e=e.render();return e.classList.add("tile-view","canvas"),e},e.FramesListController.prototype.clonePreviewCanvas_=function(e){e=pskl.utils.CanvasUtils.clone(e);return e.classList.add("tile-view","canvas"),e},e.FramesListController.prototype.calculateZoom_=function(){var e=this.piskelController.getCurrentFrame(),e=Math.max(e.getHeight(),e.getWidth());return Constants.PREVIEW_FILM_SIZE/e}})(),(()=>{var e=$.namespace("pskl.controller");e.HeaderController=function(e,t){this.piskelController=e,this.savedStatusService=t},e.HeaderController.prototype.init=function(){this.piskelName_=document.querySelector(".piskel-name"),$.subscribe(Events.BEFORE_SAVING_PISKEL,this.onBeforeSavingPiskelEvent_.bind(this)),$.subscribe(Events.AFTER_SAVING_PISKEL,this.onAfterSavingPiskelEvent_.bind(this)),$.subscribe(Events.PISKEL_DESCRIPTOR_UPDATED,this.updateHeader_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.updateHeader_.bind(this)),$.subscribe(Events.PISKEL_SAVED_STATUS_UPDATE,this.updateHeader_.bind(this)),this.updateHeader_()},e.HeaderController.prototype.updateHeader_=function(){try{var e=this.piskelController.getPiskel().getDescriptor().name;this.savedStatusService.isDirty()&&(e+=" *"),this.piskelName_&&(this.piskelName_.textContent=e)}catch(e){console.warn("Could not update header : "+e.message)}},e.HeaderController.prototype.onBeforeSavingPiskelEvent_=function(){this.piskelName_&&this.piskelName_.classList.add("piskel-name-saving")},e.HeaderController.prototype.onAfterSavingPiskelEvent_=function(){this.piskelName_&&this.piskelName_.classList.remove("piskel-name-saving")}})(),(()=>{var e=$.namespace("pskl.controller");e.LayersListController=function(e){this.piskelController=e,this.layerPreviewShortcut=pskl.service.keyboard.Shortcuts.MISC.LAYER_PREVIEW,this.startRenamingCurrentLayer_=this.startRenamingCurrentLayer_.bind(this),this.onRenameInput_=this.onRenameInput_.bind(this)},e.LayersListController.prototype.init=function(){this.isRenaming=!1,this.layerItemTemplate_=pskl.utils.Template.get("layer-item-template"),this.layerNameInputTemplate_=pskl.utils.Template.get("layer-name-input-template"),this.rootEl=document.querySelector(".layers-list-container"),this.layersListEl=document.querySelector(".layers-list"),this.toggleLayerPreviewEl=document.querySelector(".layers-toggle-preview"),this.rootEl.addEventListener("click",this.onClick_.bind(this)),this.toggleLayerPreviewEl.addEventListener("click",this.toggleLayerPreview_.bind(this)),this.createButtonTooltips_(),this.initToggleLayerPreview_(),this.renderLayerList_(),this.updateToggleLayerPreview_(),$.subscribe(Events.PISKEL_RESET,this.renderLayerList_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},e.LayersListController.prototype.renderLayerList_=function(){var e=this.layersListEl.scrollTop;this.layersListEl.innerHTML="";this.piskelController.getLayers().forEach(this.addLayerItem.bind(this)),this.updateButtonStatus_(),this.layersListEl.scrollTop=e;e=this.layersListEl.querySelector(".current-layer-item");e&&e.scrollIntoViewIfNeeded(!1)},e.LayersListController.prototype.createButtonTooltips_=function(){var e=pskl.utils.TooltipFormatter.format("Create a layer",null,[{key:"shift",description:"Clone current layer"}]),e=(this.rootEl.querySelector('[data-action="add"]').setAttribute("title",e),pskl.utils.TooltipFormatter.format("Move layer down",null,[{key:"shift",description:"Move to the bottom"}])),e=(this.rootEl.querySelector('[data-action="down"]').setAttribute("title",e),pskl.utils.TooltipFormatter.format("Move layer up",null,[{key:"shift",description:"Move to the top"}]));this.rootEl.querySelector('[data-action="up"]').setAttribute("title",e)},e.LayersListController.prototype.initToggleLayerPreview_=function(){pskl.app.shortcutService.registerShortcut(this.layerPreviewShortcut,this.toggleLayerPreview_.bind(this));var e=pskl.utils.TooltipFormatter.format("Preview all layers",this.layerPreviewShortcut,[{description:"Opacity defined in PREFERENCES"}]);this.toggleLayerPreviewEl.setAttribute("title",e)},e.LayersListController.prototype.updateButtonStatus_=function(){var e=this.piskelController.getLayers(),t=this.piskelController.getCurrentLayerIndex(),r=0===t,i=1===e.length,t=t===e.length-1;this.toggleButtonDisabledState_("up",t),this.toggleButtonDisabledState_("down",r),this.toggleButtonDisabledState_("merge",r),this.toggleButtonDisabledState_("delete",i)},e.LayersListController.prototype.toggleButtonDisabledState_=function(e,t){e=document.querySelector('.layers-button[data-action="'+e+'"]');t?(e.setAttribute("disabled","disabled"),e.blur()):e.removeAttribute("disabled")},e.LayersListController.prototype.updateToggleLayerPreview_=function(){var e="layers-toggle-preview-enabled";pskl.UserSettings.get(pskl.UserSettings.LAYER_PREVIEW)?this.toggleLayerPreviewEl.classList.add(e):this.toggleLayerPreviewEl.classList.remove(e)},e.LayersListController.prototype.onUserSettingsChange_=function(e,t,r){t==pskl.UserSettings.LAYER_PREVIEW&&this.updateToggleLayerPreview_()},e.LayersListController.prototype.addLayerItem=function(e,t){var r,i=this.piskelController.getCurrentLayer()===e,n=i&&this.isRenaming,t=pskl.utils.Template.replace(this.layerItemTemplate_,{layername:e.getName(),layerindex:t,"isselected:current-layer-item":i,opacity:e.getOpacity()}),t=pskl.utils.Template.createFromHTML(t),i=(this.layersListEl.insertBefore(t,this.layersListEl.firstChild),t.offsetWidth<t.scrollWidth&&((r=t.querySelector(".layer-name")).classList.add("overflowing-name"),r.setAttribute("title",e.getName()),r.setAttribute("rel","tooltip")),i&&(t.removeEventListener("dblclick",this.startRenamingCurrentLayer_),t.addEventListener("dblclick",this.startRenamingCurrentLayer_)),n&&(i=pskl.utils.Template.replace(this.layerNameInputTemplate_,{layername:e.getName()}),n=pskl.utils.Template.createFromHTML(i),r=t.querySelector(".layer-name"),t.replaceChild(n,r),n.removeEventListener("blur",this.onRenameInput_),n.removeEventListener("keydown",this.onRenameInput_),n.addEventListener("blur",this.onRenameInput_),n.addEventListener("keydown",this.onRenameInput_),n.focus(),n.select()),e.getOpacity());t.querySelector(".layer-item-opacity").style.color=1==i?"#ffd700":0==i?"#969696":"#ffffff"},e.LayersListController.prototype.onClick_=function(e){var t,r=e.target||e.srcElement;r.classList.contains("button")?this.onButtonClick_(r,e):r.classList.contains("layer-name")?(e=this.piskelController.getCurrentLayerIndex(),(t=pskl.utils.Dom.getData(r,"layerIndex"))!=e&&(r.parentElement.parentElement.querySelector(".current-layer-item").removeEventListener("dblclick",this.startRenamingCurrentLayer_),this.piskelController.setCurrentLayerIndex(parseInt(t,10)))):r.classList.contains("layer-item-opacity")&&(t=pskl.utils.Dom.getData(r,"layerIndex"),e=this.piskelController.getLayerAt(parseInt(t,10)),r=window.prompt("Set layer opacity (value between 0 and 1)",e.getOpacity()),this.piskelController.setLayerOpacityAt(t,r))},e.LayersListController.prototype.startRenamingCurrentLayer_=function(){this.isRenaming=!0,this.renderLayerList_()},e.LayersListController.prototype.onRenameInput_=function(e){var t=e.target||e.srcElement;"Enter"===e.key?this.finishRenamingCurrentLayer_(t,t.value):e.key&&"Escape"!==e.key||this.finishRenamingCurrentLayer_(t)},e.LayersListController.prototype.finishRenamingCurrentLayer_=function(e,t){var r;t&&(r=this.piskelController.getCurrentLayerIndex(),this.piskelController.renameLayerAt(r,t)),e.removeEventListener("blur",this.onRenameInput_),e.removeEventListener("keydown",this.onRenameInput_),this.isRenaming=!1,this.renderLayerList_()},e.LayersListController.prototype.mergeDownCurrentLayer_=function(){var e=this.piskelController.getCurrentLayerIndex();this.piskelController.mergeDownLayerAt(e),this.renderLayerList_()},e.LayersListController.prototype.onButtonClick_=function(e,t){e=e.getAttribute("data-action");"up"==e?this.piskelController.moveLayerUp(t.shiftKey):"down"==e?this.piskelController.moveLayerDown(t.shiftKey):"add"==e?t.shiftKey?this.piskelController.duplicateCurrentLayer():this.piskelController.createLayer():"delete"==e?this.piskelController.removeCurrentLayer():"merge"==e?this.mergeDownCurrentLayer_():"edit"==e&&this.startRenamingCurrentLayer_()},e.LayersListController.prototype.toggleLayerPreview_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.LAYER_PREVIEW),t=pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY),e=!e;pskl.UserSettings.set(pskl.UserSettings.LAYER_PREVIEW,e),e&&0===t&&pskl.UserSettings.set(pskl.UserSettings.LAYER_OPACITY,Constants.DEFAULT.LAYER_OPACITY)}})(),(()=>{var e=$.namespace("pskl.controller.preview");e.PopupPreviewController=function(e){this.piskelController=e,this.popup=null,this.renderer=null,this.renderFlag=!1},e.PopupPreviewController.prototype.init=function(){pskl.utils.Event.addEventListener(window,"unload",this.onMainWindowUnload_,this)},e.PopupPreviewController.prototype.isOpen=function(){return!!this.popup},e.PopupPreviewController.prototype.open=function(){this.isOpen()?this.popup.focus():(this.popup=window.open("about:blank","","width=320,height=320"),window.setTimeout(this.onPopupLoaded.bind(this),500))},e.PopupPreviewController.prototype.onPopupLoaded=function(){this.popup.document.title="Piskel - preview",this.popup.document.body.innerHTML=pskl.utils.Template.get("popup-preview-partial"),pskl.utils.Event.addEventListener(this.popup,"resize",this.onWindowResize_,this),pskl.utils.Event.addEventListener(this.popup,"unload",this.onPopupClosed_,this);var e=this.popup.document.querySelector(".preview-container");this.renderer=new pskl.rendering.frame.BackgroundImageFrameRenderer(e),this.updateZoom_(),this.renderFlag=!0},e.PopupPreviewController.prototype.render=function(e){this.isOpen()&&this.renderer&&(this.renderer.render(e),this.renderFlag=!1)},e.PopupPreviewController.prototype.onWindowResize_=function(e){this.updateZoom_(),this.renderFlag=!0},e.PopupPreviewController.prototype.updateZoom_=function(){var e=this.popup.document.documentElement,t=e.clientWidth/this.piskelController.getWidth(),r=e.clientHeight/this.piskelController.getHeight(),t=Math.min(t,r),r=(this.renderer.setZoom(t),this.piskelController.getHeight()*t),t=this.piskelController.getWidth()*t,i=this.popup.document.querySelector(".preview-container"),r=(i.style.height=r+"px",i.style.width=t+"px",(e.clientHeight-r)/2),r=(i.style.marginTop=r+"px",i.style.marginBottom=r+"px",(e.clientWidth-t)/2);i.style.marginLeft=r+"px",i.style.marginRight=r+"px"},e.PopupPreviewController.prototype.onPopupClosed_=function(){this.popup;this.popup=null},e.PopupPreviewController.prototype.onMainWindowUnload_=function(){this.isOpen()&&this.popup.close()}})(),(()=>{var e=$.namespace("pskl.controller.preview");e.PreviewActionsController=function(e,t){this.previewController=e,this.piskelController=e.piskelController,this.container=t,this.onionSkinShortcut=pskl.service.keyboard.Shortcuts.MISC.ONION_SKIN,this.toggleGridShortcut=pskl.service.keyboard.Shortcuts.MISC.TOGGLE_GRID,this.fpsRangeInput=document.querySelector("#preview-fps"),this.fpsCounterDisplay=document.querySelector("#display-fps"),this.openPopupPreview=document.querySelector(".open-popup-preview-button"),this.toggleGridButton=document.querySelector(".toggle-grid-button"),this.previewSizeDropdown=document.querySelector(".preview-drop-down"),this.previewSizes={original:{button:document.querySelector(".original-size-button"),shortcut:pskl.service.keyboard.Shortcuts.MISC.X1_PREVIEW,tooltip:"Original size preview"},best:{button:document.querySelector(".best-size-button"),shortcut:pskl.service.keyboard.Shortcuts.MISC.BEST_PREVIEW,tooltip:"Best size preview"},full:{button:document.querySelector(".full-size-button"),shortcut:pskl.service.keyboard.Shortcuts.MISC.FULL_PREVIEW,tooltip:"Full size preview"}},this.toggleOnionSkinButton=document.querySelector(".preview-toggle-onion-skin")},e.PreviewActionsController.prototype.init=function(){this.fpsRangeInput.addEventListener("change",this.onFpsRangeInputUpdate_.bind(this)),this.fpsRangeInput.addEventListener("input",this.onFpsRangeInputUpdate_.bind(this));var e,t,r,i=pskl.utils.Event.addEventListener,n=(i(this.toggleOnionSkinButton,"click",this.toggleOnionSkin_,this),i(this.openPopupPreview,"click",this.onOpenPopupPreviewClick_,this),i(this.toggleGridButton,"click",this.toggleGrid_,this),pskl.app.shortcutService.registerShortcut.bind(pskl.app.shortcutService)),o=(n(this.onionSkinShortcut,this.toggleOnionSkin_.bind(this)),n(this.toggleGridShortcut,this.toggleGrid_.bind(this)),pskl.utils.TooltipFormatter.format("Toggle onion skin",this.onionSkinShortcut));for(e in this.toggleOnionSkinButton.setAttribute("title",o),this.previewSizes)this.previewSizes.hasOwnProperty(e)&&(i((t=this.previewSizes[e]).button,"click",this.onChangePreviewSize_,this,e),n(t.shortcut,this.onChangePreviewSize_.bind(this,e)),r=pskl.utils.TooltipFormatter.format(t.tooltip,t.shortcut),t.button.setAttribute("title",r));$.subscribe(Events.FRAME_SIZE_CHANGED,this.updatePreviewSizeButtons_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.FPS_CHANGED,this.updateFPS_.bind(this)),$.subscribe(Events.PISKEL_RESET,this.updateFPS_.bind(this)),this.updatePreviewSizeButtons_(),this.updateOnionSkinPreview_(),this.selectPreviewSizeButton_(),this.updateFPS_(),this.updateMaxFPS_(),this.updateToggleGridButton_()},e.PreviewActionsController.prototype.updateToggleGridButton_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED);this.toggleGridButton.classList.toggle("icon-minimap-grid-white",!e),this.toggleGridButton.classList.toggle("icon-minimap-grid-gold",e),this.toggleGridButton.classList.toggle("preview-contextual-action-enabled",e)},e.PreviewActionsController.prototype.toggleGrid_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED);pskl.UserSettings.set(pskl.UserSettings.GRID_ENABLED,!e)},e.PreviewActionsController.prototype.updatePreviewSizeButtons_=function(){var e,t,r=this.previewController.getZoom(),i=Math.floor(r),n=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),o=r<1?(this.disablePreviewSizeWidget_("No other option available"),["full"]):1===r?(this.disablePreviewSizeWidget_("No other option available"),["original"]):n?(this.disablePreviewSizeWidget_("Disabled in tile mode"),["original"]):(this.enablePreviewSizeWidget_(),r===i?["original","best"]:1===i?["full","original"]:["full","original","best"]);for(e in this.previewSizes.best.button.textContent=Math.floor(r)+"x",this.previewSizes)this.previewSizes.hasOwnProperty(e)&&(t=this.previewSizes[e],-1!=o.indexOf(e)?t.button.classList.remove("preview-contextual-action-hidden"):t.button.classList.add("preview-contextual-action-hidden"));n=pskl.UserSettings.get(pskl.UserSettings.PREVIEW_SIZE);-1===o.indexOf(n)&&this.onChangePreviewSize_(o[0])},e.PreviewActionsController.prototype.enablePreviewSizeWidget_=function(){this.previewSizeDropdown.classList.remove("preview-drop-down-disabled")},e.PreviewActionsController.prototype.disablePreviewSizeWidget_=function(e){document.querySelector(".preview-disable-overlay").setAttribute("data-original-title",e),this.previewSizeDropdown.classList.add("preview-drop-down-disabled")},e.PreviewActionsController.prototype.onOpenPopupPreviewClick_=function(){this.previewController.openPopupPreview()},e.PreviewActionsController.prototype.onChangePreviewSize_=function(e){this.previewSizes[e].button.classList.contains("preview-contextual-action-hidden")||pskl.UserSettings.set(pskl.UserSettings.PREVIEW_SIZE,e)},e.PreviewActionsController.prototype.onUserSettingsChange_=function(e,t,r){t==pskl.UserSettings.ONION_SKIN?this.updateOnionSkinPreview_():t==pskl.UserSettings.MAX_FPS?this.updateMaxFPS_():t===pskl.UserSettings.SEAMLESS_MODE?this.updatePreviewSizeButtons_():t===pskl.UserSettings.GRID_ENABLED?this.updateToggleGridButton_():this.selectPreviewSizeButton_()},e.PreviewActionsController.prototype.updateOnionSkinPreview_=function(){var e="preview-toggle-onion-skin-enabled";pskl.UserSettings.get(pskl.UserSettings.ONION_SKIN)?this.toggleOnionSkinButton.classList.add(e):this.toggleOnionSkinButton.classList.remove(e)},e.PreviewActionsController.prototype.selectPreviewSizeButton_=function(){var e=document.querySelector(".size-button-selected"),e=(e&&e.classList.remove("size-button-selected"),pskl.UserSettings.get(pskl.UserSettings.PREVIEW_SIZE));this.previewSizes[e].button.classList.add("size-button-selected")},e.PreviewActionsController.prototype.updateMaxFPS_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.MAX_FPS);this.fpsRangeInput.setAttribute("max",e),this.piskelController.setFPS(Math.min(e,this.piskelController.getFPS()))},e.PreviewActionsController.prototype.onFpsRangeInputUpdate_=function(e){var t=parseInt(this.fpsRangeInput.value,10);this.piskelController.setFPS(t),"change"===e.type&&this.fpsRangeInput.blur()},e.PreviewActionsController.prototype.updateFPS_=function(){var e=this.piskelController.getFPS();e!==this.fpsRangeInput.value&&(this.fpsRangeInput.value=0,this.fpsRangeInput.value=e,this.fpsCounterDisplay.innerHTML=e+" FPS")},e.PreviewActionsController.prototype.toggleOnionSkin_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.ONION_SKIN);pskl.UserSettings.set(pskl.UserSettings.ONION_SKIN,!e)}})(),(()=>{var r=$.namespace("pskl.controller.preview");r.PreviewController=function(e,t){this.piskelController=e,this.container=t,this.elapsedTime=0,this.currentIndex=0,this.lastRenderTime=0,this.renderFlag=!0,this.renderer=new pskl.rendering.frame.BackgroundImageFrameRenderer(this.container),this.popupPreviewController=new r.PopupPreviewController(e),this.previewActionsController=new r.PreviewActionsController(this,t)},r.PreviewController.prototype.init=function(){var e=Constants.ANIMATED_PREVIEW_WIDTH+Constants.RIGHT_COLUMN_PADDING_LEFT;document.querySelector(".right-column").style.width=e+"px",$.subscribe(Events.FRAME_SIZE_CHANGED,this.onFrameSizeChange_.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.PISKEL_SAVE_STATE,this.setRenderFlag_.bind(this,!0)),$.subscribe(Events.PISKEL_RESET,this.setRenderFlag_.bind(this,!0)),this.popupPreviewController.init(),this.previewActionsController.init(),this.updateZoom_(),this.updateContainerDimensions_()},r.PreviewController.prototype.openPopupPreview=function(){this.popupPreviewController.open()},r.PreviewController.prototype.onUserSettingsChange_=function(e,t,r){t===pskl.UserSettings.SEAMLESS_MODE?this.onFrameSizeChange_():(this.updateZoom_(),this.updateContainerDimensions_())},r.PreviewController.prototype.updateZoom_=function(){var e,t=pskl.UserSettings.get(pskl.UserSettings.PREVIEW_SIZE);"original"===t?e=1:"best"===t?e=Math.floor(this.calculateZoom_()):"full"===t&&(e=this.calculateZoom_()),this.renderer.setZoom(e),this.setRenderFlag_(!0)},r.PreviewController.prototype.getZoom=function(){return this.calculateZoom_()},r.PreviewController.prototype.getCoordinates=function(e,t){var r=this.container.getBoundingClientRect(),r=(e-=r.left,t-=r.top,this.getZoom());return{x:Math.floor(e/r),y:Math.floor(t/r)}},r.PreviewController.prototype.render=function(e){this.elapsedTime+=e;var e=this.getNextIndex_(e);!this.shouldRender_()&&this.currentIndex==e||(this.currentIndex=e,e=pskl.utils.LayerUtils.mergeFrameAt(this.piskelController.getLayers(),e),this.renderer.render(e),this.renderFlag=!1,this.lastRenderTime=Date.now(),this.popupPreviewController.render(e))},r.PreviewController.prototype.getNextIndex_=function(e){var t,r=this.piskelController.getFPS();return 0===r?this.piskelController.getCurrentFrameIndex():(r=Math.floor(this.elapsedTime/(1e3/r)),(t=this.piskelController.getVisibleFrameIndexes()).length<=r?(this.elapsedTime=0,t.length?t[0]:this.piskelController.getCurrentFrameIndex()):t[r])},r.PreviewController.prototype.calculateZoom_=function(){var e=this.piskelController.getCurrentFrame(),t=200/e.getHeight(),e=200/e.getWidth();return Math.min(t,e)},r.PreviewController.prototype.onFrameSizeChange_=function(){this.updateZoom_(),this.updateContainerDimensions_()},r.PreviewController.prototype.updateContainerDimensions_=function(){var e,t=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),t=(this.renderer.setRepeated(t),e=t?r=200:(t=this.getZoom(),r=(e=this.piskelController.getCurrentFrame()).getHeight()*t,e.getWidth()*t),this.container),r=(t.style.height=r+"px",t.style.width=e+"px",(200-r)/2),r=(t.style.marginTop=r+"px",t.style.marginBottom=r+"px",(200-e)/2);t.style.marginLeft=r+"px",t.style.marginRight=r+"px"},r.PreviewController.prototype.setRenderFlag_=function(e){this.renderFlag=e},r.PreviewController.prototype.shouldRender_=function(){return(this.renderFlag||this.popupPreviewController.renderFlag)&&300<Date.now()-this.lastRenderTime}})(),(()=>{var e=$.namespace("pskl.controller");e.MinimapController=function(e,t,r,i){this.piskelController=e,this.previewController=t,this.drawingController=r,this.container=i,this.isClicked=!1,this.isVisible=!1},e.MinimapController.prototype.init=function(){this.minimapEl=document.createElement("DIV"),this.minimapEl.className="minimap-crop-frame",this.minimapEl.style.display="none",this.container.appendChild(this.minimapEl),this.container.addEventListener("mousedown",this.onMinimapMousedown_.bind(this)),document.body.addEventListener("mousemove",this.onMinimapMousemove_.bind(this)),document.body.addEventListener("mouseup",this.onMinimapMouseup_.bind(this)),$.subscribe(Events.ZOOM_CHANGED,this.renderMinimap_.bind(this))},e.MinimapController.prototype.renderMinimap_=function(){var e=this.getVerticalRatio_(),t=this.getHorizontalRatio_();1<e||1<t?this.displayMinimap_():this.hideMinimap_()},e.MinimapController.prototype.displayMinimap_=function(){var e=this.getMinimapSize_(),t=this.getPreviewSize_(),r=this.container.getBoundingClientRect(),i=r.height,r=r.width,n=this.drawingController.getRenderer().getOffset(),o=(r-Math.max(e.width,t.width))/2+n.x*this.previewController.getZoom(),t=(i-Math.max(e.height,t.height))/2+n.y*this.previewController.getZoom();this.minimapEl.style.display="block",this.minimapEl.style.width=Math.min(e.width,r)+"px",this.minimapEl.style.height=Math.min(e.height,i)+"px",this.minimapEl.style.left=Math.max(0,o)+Constants.RIGHT_COLUMN_PADDING_LEFT+"px",this.minimapEl.style.top=Math.max(0,t)+"px",this.isVisible=!0},e.MinimapController.prototype.getMinimapSize_=function(){var e=this.drawingController.getRenderer().getZoom()/this.previewController.getZoom(),t=this.drawingController.getRenderer().getDisplaySize();return{width:t.width/e,height:t.height/e}},e.MinimapController.prototype.getPreviewSize_=function(){var e=this.piskelController.getCurrentFrame();return{width:e.getWidth()*this.previewController.getZoom(),height:e.getHeight()*this.previewController.getZoom()}},e.MinimapController.prototype.hideMinimap_=function(){this.minimapEl.style.display="none",this.isVisible=!1},e.MinimapController.prototype.onMinimapMousemove_=function(e){this.isVisible&&this.isClicked&&(e=this.getCoordinatesCenteredAround_(e.clientX,e.clientY),this.drawingController.setOffset(e.x,e.y))},e.MinimapController.prototype.onMinimapMousedown_=function(e){this.isClicked=!0},e.MinimapController.prototype.onMinimapMouseup_=function(e){this.isClicked=!1},e.MinimapController.prototype.getCoordinatesCenteredAround_=function(e,t){var e=this.previewController.getCoordinates(e,t),t=this.piskelController.getCurrentFrame().getWidth(),r=this.piskelController.getCurrentFrame().getHeight(),t=t/this.getHorizontalRatio_(),r=r/this.getVerticalRatio_();return{x:e.x-t/2,y:e.y-r/2}},e.MinimapController.prototype.getVerticalRatio_=function(){var e=this.drawingController.getRenderer().getZoom();return this.piskelController.getCurrentFrame().getHeight()*e/this.drawingController.getRenderer().getDisplaySize().height},e.MinimapController.prototype.getHorizontalRatio_=function(){var e=this.drawingController.getRenderer().getZoom();return this.piskelController.getCurrentFrame().getWidth()*e/this.drawingController.getRenderer().getDisplaySize().width}})(),(()=>{var e=$.namespace("pskl.controller");e.ToolController=function(){this.tools=[new pskl.tools.drawing.SimplePen,new pskl.tools.drawing.VerticalMirrorPen,new pskl.tools.drawing.PaintBucket,new pskl.tools.drawing.ColorSwap,new pskl.tools.drawing.Eraser,new pskl.tools.drawing.Stroke,new pskl.tools.drawing.Rectangle,new pskl.tools.drawing.Circle,new pskl.tools.drawing.Move,new pskl.tools.drawing.selection.ShapeSelect,new pskl.tools.drawing.selection.RectangleSelect,new pskl.tools.drawing.selection.LassoSelect,new pskl.tools.drawing.Lighten,new pskl.tools.drawing.ShiftIndex,new pskl.tools.drawing.DitheringTool,new pskl.tools.drawing.ColorPicker],this.toolIconBuilder=new pskl.tools.ToolIconBuilder},e.ToolController.prototype.init=function(){this.createToolsDom_(),this.addKeyboardShortcuts_(),this.selectTool_(this.tools[0]),document.querySelector("#tool-section").addEventListener("mousedown",this.onToolIconClicked_.bind(this)),$.subscribe(Events.SELECT_TOOL,this.onSelectToolEvent_.bind(this)),$.subscribe(Events.SHORTCUTS_CHANGED,this.createToolsDom_.bind(this))},e.ToolController.prototype.activateToolOnStage_=function(e){var t=document.body,r=t.dataset.selectedToolClass;r&&(t.classList.remove(r),t.classList.remove(pskl.tools.drawing.Move.TOOL_ID)),t.classList.add(e.toolId),t.dataset.selectedToolClass=e.toolId},e.ToolController.prototype.onSelectToolEvent_=function(e,t){t=this.getToolById_(t);t&&this.selectTool_(t)},e.ToolController.prototype.selectTool_=function(e){this.currentSelectedTool=e,this.activateToolOnStage_(this.currentSelectedTool);var t=document.querySelector("#tool-section .tool-icon.selected");t&&t.classList.remove("selected"),document.querySelector("[data-tool-id="+e.toolId+"]").classList.add("selected"),$.publish(Events.TOOL_SELECTED,[e])},e.ToolController.prototype.onToolIconClicked_=function(e){var e=e.target,e=pskl.utils.Dom.getParentWithData(e,"toolId");e&&(e=e.dataset.toolId,e=this.getToolById_(e))&&this.selectTool_(e)},e.ToolController.prototype.onKeyboardShortcut_=function(e,t){e=this.getToolById_(e);null!==e&&this.selectTool_(e)},e.ToolController.prototype.getToolById_=function(t){return pskl.utils.Array.find(this.tools,function(e){return e.toolId==t})},e.ToolController.prototype.createToolsDom_=function(){for(var e="",t=0;t<this.tools.length;t++){var r=this.tools[t];e+=this.toolIconBuilder.createIcon(r)}document.querySelector("#tools-container").innerHTML=e},e.ToolController.prototype.addKeyboardShortcuts_=function(){for(var e=0;e<this.tools.length;e++){var t=this.tools[e];pskl.app.shortcutService.registerShortcut(t.shortcut,this.onKeyboardShortcut_.bind(this,t.toolId))}}})(),(()=>{var e=$.namespace("pskl.controller");e.PaletteController=function(){},e.PaletteController.prototype.init=function(){$.subscribe(Events.SELECT_PRIMARY_COLOR,this.onColorSelected_.bind(this,{isPrimary:!0})),$.subscribe(Events.SELECT_SECONDARY_COLOR,this.onColorSelected_.bind(this,{isPrimary:!1}));var e=pskl.service.keyboard.Shortcuts,e=(pskl.app.shortcutService.registerShortcut(e.COLOR.SWAP,this.swapColors.bind(this)),pskl.app.shortcutService.registerShortcut(e.COLOR.RESET,this.resetColors.bind(this)),{showPalette:!0,showButtons:!1,showInput:!0,palette:[["rgba(0,0,0,0)"]],clickoutFiresChange:!0,beforeShow:function(e){e.setAlpha(1)}}),t=$("#color-picker"),t=(t.spectrum($.extend({color:Constants.DEFAULT_PEN_COLOR},e)),t.change({isPrimary:!0},this.onPickerChange_.bind(this)),this.setTitleOnPicker_(Constants.DEFAULT_PEN_COLOR,t.get(0)),$("#secondary-color-picker"));t.spectrum($.extend({color:Constants.TRANSPARENT_COLOR},e)),t.change({isPrimary:!1},this.onPickerChange_.bind(this)),this.setTitleOnPicker_(Constants.TRANSPARENT_COLOR,t.get(0)),document.querySelector(".swap-colors-button").addEventListener("click",this.swapColors.bind(this))},e.PaletteController.prototype.onPickerChange_=function(e){var t=e.target.value;t!=Constants.TRANSPARENT_COLOR&&(t=window.tinycolor(t).toHexString()),e.data.isPrimary?this.setPrimaryColor_(t):this.setSecondaryColor_(t)},e.PaletteController.prototype.onColorSelected_=function(e,t,r){e.isPrimary?this.setPrimaryColor_(r):this.setSecondaryColor_(r)},e.PaletteController.prototype.setPrimaryColor_=function(e){this.updateColorPicker_(e,document.querySelector("#color-picker")),$.publish(Events.PRIMARY_COLOR_SELECTED,[e])},e.PaletteController.prototype.setSecondaryColor_=function(e){this.updateColorPicker_(e,document.querySelector("#secondary-color-picker")),$.publish(Events.SECONDARY_COLOR_SELECTED,[e])},e.PaletteController.prototype.swapColors=function(){var e=pskl.app.selectedColorsService.getPrimaryColor();this.setPrimaryColor_(pskl.app.selectedColorsService.getSecondaryColor()),this.setSecondaryColor_(e)},e.PaletteController.prototype.resetColors=function(){this.setPrimaryColor_(Constants.DEFAULT_PEN_COLOR),this.setSecondaryColor_(Constants.TRANSPARENT_COLOR)},e.PaletteController.prototype.updateColorPicker_=function(e,t){var r=$(t);e==Constants.TRANSPARENT_COLOR?(r.spectrum("set",Constants.TRANSPARENT_COLOR),t.value=Constants.TRANSPARENT_COLOR):r.spectrum("set",e),this.setTitleOnPicker_(e,t)},e.PaletteController.prototype.setTitleOnPicker_=function(e,t){t=t.parentNode;e=t.dataset.initialTitle+"<br/>"+e,t.dataset.originalTitle=e}})(),(()=>{var e=$.namespace("pskl.controller"),n="palettes-list-primary-color",o="palettes-list-secondary-color",s="palettes-list-cycled-color";e.PalettesListController=function(e){this.usedColorService=e,this.paletteService=pskl.app.paletteService},e.PalettesListController.prototype.init=function(){this.paletteColorTemplate_=pskl.utils.Template.get("palette-color-template"),this.colorListContainer_=document.querySelector(".palettes-list-colors"),this.colorPaletteSelect_=document.querySelector(".palettes-list-select");var e=document.querySelector(".create-palette-button"),t=document.querySelector(".edit-palette-button"),e=(this.colorPaletteSelect_.addEventListener("change",this.onPaletteSelected_.bind(this)),this.colorListContainer_.addEventListener("mouseup",this.onColorContainerMouseup.bind(this)),this.colorListContainer_.addEventListener("contextmenu",this.onColorContainerContextMenu.bind(this)),e.addEventListener("click",this.onCreatePaletteClick_.bind(this)),t.addEventListener("click",this.onEditPaletteClick_.bind(this)),$.subscribe(Events.PALETTE_LIST_UPDATED,this.onPaletteListUpdated.bind(this)),$.subscribe(Events.CURRENT_COLORS_UPDATED,this.fillColorListContainer.bind(this)),$.subscribe(Events.PRIMARY_COLOR_SELECTED,this.highlightSelectedColors.bind(this)),$.subscribe(Events.SECONDARY_COLOR_SELECTED,this.highlightSelectedColors.bind(this)),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),$.subscribe(Events.TOOL_SELECTED,this.onToolEvent_.bind(this)),pskl.service.keyboard.Shortcuts);pskl.app.shortcutService.registerShortcut(e.COLOR.PREVIOUS_COLOR,this.selectPreviousColor_.bind(this)),pskl.app.shortcutService.registerShortcut(e.COLOR.NEXT_COLOR,this.selectNextColor_.bind(this)),pskl.app.shortcutService.registerShortcut(e.COLOR.SELECT_COLOR,this.selectColorForKey_.bind(this)),this.fillPaletteList(),this.updateFromUserSettings(),this.fillColorListContainer()},e.PalettesListController.prototype.onToolEvent_=function(e,t){this.showColorCycles="tool-shift-index"===t.toolId,this.highlightSelectedColors()},e.PalettesListController.prototype.fillPaletteList=function(){var e=this.paletteService.getPalettes().map(function(e){return pskl.utils.Template.replace('<option value="{{id}}">{{name}}</option>',e)}).join("");this.colorPaletteSelect_.innerHTML=e},e.PalettesListController.prototype.fillColorListContainer=function(){var e,t=this.getSelectedPaletteColors_();0<t.length?(e=t.filter(function(e){return!!e}).map(function(e,t){return pskl.utils.Template.replace(this.paletteColorTemplate_,{color:e,index:t+1,title:e.toUpperCase()})}.bind(this)).join(""),this.colorListContainer_.innerHTML=e,this.highlightSelectedColors()):this.colorListContainer_.innerHTML=pskl.utils.Template.get("palettes-list-no-colors-partial"),this.colorListContainer_.classList.toggle("tiny",10<t.length)},e.PalettesListController.prototype.selectPalette=function(e){pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,e),$.publish(Events.CURRENT_PALETTE_CHANGED)},e.PalettesListController.prototype.getSelectedPaletteColors_=function(){var e=[],t=this.getSelectedPalette_();return e=(e=t?t.getColors():e).length>Constants.MAX_PALETTE_COLORS?e.slice(0,Constants.MAX_PALETTE_COLORS):e},e.PalettesListController.prototype.getSelectedPalette_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE);return this.paletteService.getPaletteById(e)},e.PalettesListController.prototype.selectNextColor_=function(){this.selectColor_(this.getCurrentColorIndex_()+1)},e.PalettesListController.prototype.selectPreviousColor_=function(){this.selectColor_(this.getCurrentColorIndex_()-1)},e.PalettesListController.prototype.getCurrentColorIndex_=function(){var e=0,t=document.querySelector("."+n);return e=t?parseInt(t.dataset.colorIndex,10)-1:e},e.PalettesListController.prototype.selectColorForKey_=function(e){e=parseInt(e,10);this.selectColor_((e+9)%10)},e.PalettesListController.prototype.selectColor_=function(e){e=this.getSelectedPaletteColors_()[e];e&&$.publish(Events.SELECT_PRIMARY_COLOR,[e])},e.PalettesListController.prototype.onUserSettingsChange_=function(e,t,r){t==pskl.UserSettings.SELECTED_PALETTE&&this.updateFromUserSettings()},e.PalettesListController.prototype.updateFromUserSettings=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE);this.fillColorListContainer(),this.colorPaletteSelect_.value=e},e.PalettesListController.prototype.onPaletteSelected_=function(e){var t=this.colorPaletteSelect_.value;this.selectPalette(t),this.colorPaletteSelect_.blur()},e.PalettesListController.prototype.onCreatePaletteClick_=function(e){var t=this.colorPaletteSelect_.value;$.publish(Events.DIALOG_SHOW,{dialogId:"create-palette",initArgs:t})},e.PalettesListController.prototype.onEditPaletteClick_=function(e){var t=this.colorPaletteSelect_.value;$.publish(Events.DIALOG_SHOW,{dialogId:"create-palette",initArgs:t})},e.PalettesListController.prototype.onColorContainerContextMenu=function(e){e.preventDefault()},e.PalettesListController.prototype.onColorContainerMouseup=function(e){var t=e.target.dataset.color;t&&(e.button==Constants.LEFT_BUTTON?$.publish(Events.SELECT_PRIMARY_COLOR,[t]):e.button==Constants.RIGHT_BUTTON&&$.publish(Events.SELECT_SECONDARY_COLOR,[t]))},e.PalettesListController.prototype.highlightSelectedColors=function(){var r,e=pskl.app.palettesListController.getSelectedPaletteColors_(),t=(e.forEach(function(e,t){pskl.app.palettesListController.getColorContainer_(e).classList.remove(n),pskl.app.palettesListController.getColorContainer_(e).classList.remove(o),pskl.app.palettesListController.getColorContainer_(e).classList.remove(s)}),this.getColorContainer_(pskl.app.selectedColorsService.getSecondaryColor())),i=(t&&(t.classList.remove(n),t.classList.add(o)),this.getColorContainer_(pskl.app.selectedColorsService.getPrimaryColor()));i&&(i.classList.remove(o),i.classList.add(n)),this.primaryColorIndex=i?e.indexOf(pskl.app.selectedColorsService.getPrimaryColor()):-1,i&&t&&(i=e.indexOf(pskl.app.selectedColorsService.getPrimaryColor()))!==(t=e.indexOf(pskl.app.selectedColorsService.getSecondaryColor()))&&(r=t+1-i,this.showColorCycles)&&0<r&&(e.splice(0,t+1),e.forEach(function(e,t){t+=1;t%r==1&&(pskl.app.palettesListController.getColorContainer_(e).classList.add(n),pskl.app.palettesListController.getColorContainer_(e).classList.add(s)),t%r==0&&(pskl.app.palettesListController.getColorContainer_(e).classList.add(o),pskl.app.palettesListController.getColorContainer_(e).classList.add(s))}))},e.PalettesListController.prototype.getColorContainer_=function(e){return this.colorListContainer_.querySelector('.palettes-list-color[data-color="'+e+'"]')},e.PalettesListController.prototype.removeClass_=function(e){var t=document.querySelector("."+e);t&&t.classList.remove(e)},e.PalettesListController.prototype.onPaletteListUpdated=function(){this.fillPaletteList(),this.updateFromUserSettings()}})(),(()=>{var e=$.namespace("pskl.controller");e.PenSizeController=function(){this.sizePicker=new pskl.widgets.SizePicker(this.onSizePickerChanged_.bind(this))},e.PenSizeController.prototype.init=function(){this.sizePicker.init(document.querySelector(".pen-size-container")),$.subscribe(Events.PEN_SIZE_CHANGED,this.onPenSizeChanged_.bind(this)),this.updateSelectedOption_()},e.PenSizeController.prototype.onSizePickerChanged_=function(e){pskl.app.penSizeService.setPenSize(e)},e.PenSizeController.prototype.onPenSizeChanged_=function(e){this.updateSelectedOption_()},e.PenSizeController.prototype.updateSelectedOption_=function(){var e=pskl.app.penSizeService.getPenSize();this.sizePicker.setSize(e)}})(),(()=>{var e=$.namespace("pskl.controller");e.ProgressBarController=function(){this.template=pskl.utils.Template.get("progress-bar-template"),this.progressBar=null,this.progressBarStatus=null,this.showProgressTimer_=0},e.ProgressBarController.prototype.init=function(){$.subscribe(Events.SHOW_PROGRESS,this.showProgress_.bind(this)),$.subscribe(Events.UPDATE_PROGRESS,this.updateProgress_.bind(this)),$.subscribe(Events.HIDE_PROGRESS,this.hideProgress_.bind(this))},e.ProgressBarController.prototype.showProgress_=function(e,t){this.removeProgressBar_(),this.showProgressTimer_=window.setTimeout(this.onTimerExpired_.bind(this,t),300)},e.ProgressBarController.prototype.onTimerExpired_=function(e){e=pskl.utils.Template.replace(this.template,{name:e.name,status:0}),e=pskl.utils.Template.createFromHTML(e);document.body.appendChild(e),this.progressBar=document.querySelector(".progress-bar"),this.progressBarStatus=document.querySelector(".progress-bar-status")},e.ProgressBarController.prototype.updateProgress_=function(e,t){var r;this.progressBar&&this.progressBarStatus&&(t=t.progress,r=this.progressBar.offsetWidth,this.progressBar.style.backgroundPosition=-(r-t*r/100)+"px 0",this.progressBarStatus.innerHTML=t+"%")},e.ProgressBarController.prototype.hideProgress_=function(e,t){this.showProgressTimer_&&window.clearTimeout(this.showProgressTimer_),this.removeProgressBar_()},e.ProgressBarController.prototype.removeProgressBar_=function(){var e=document.querySelector(".progress-bar-container");e&&(e.parentNode.removeChild(e),this.progressBar=null,this.progressBarStatus=null)}})(),(()=>{var e=$.namespace("pskl.controller");e.NotificationController=function(){},e.NotificationController.prototype.init=function(){$.subscribe(Events.SHOW_NOTIFICATION,this.displayMessage_.bind(this)),$.subscribe(Events.HIDE_NOTIFICATION,this.removeMessage_.bind(this))},e.NotificationController.prototype.displayMessage_=function(e,t){this.removeMessage_();var r=document.createElement("div");r.id="user-message",r.className="user-message",r.innerHTML=t.content,r.innerHTML=r.innerHTML+'<div title="Close message" class="close">x</div>',document.body.appendChild(r),r.querySelector(".close").addEventListener("click",this.removeMessage_.bind(this)),t.hideDelay&&window.setTimeout(this.removeMessage_.bind(this),t.hideDelay)},e.NotificationController.prototype.removeMessage_=function(e){var t=document.querySelector("#user-message");t&&t.parentNode.removeChild(t)}})(),(()=>{var e=$.namespace("pskl.controller");e.TransformationsController=function(){this.tools=[new pskl.tools.transform.Flip,new pskl.tools.transform.Rotate,new pskl.tools.transform.Clone,new pskl.tools.transform.Center,new pskl.tools.transform.Crop,new pskl.tools.transform.PaletteApply],this.toolIconBuilder=new pskl.tools.ToolIconBuilder},e.TransformationsController.prototype.init=function(){this.container=document.querySelector(".transformations-container"),this.container.addEventListener("click",this.onTransformationClick_.bind(this)),this.showMoreLink=this.container.querySelector(".transformations-show-more-link"),this.showMoreLink.addEventListener("click",this.toggleShowMoreTools_.bind(this)),this.createToolsDom_(),this.updateShowMoreLink_(),$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this))},e.TransformationsController.prototype.applyTool=function(t,r){this.tools.forEach(function(e){e.toolId===t&&($.publish(Events.TRANSFORMATION_EVENT,[t,r]),e.applyTransformation(r))}.bind(this))},e.TransformationsController.prototype.onTransformationClick_=function(e){var t=e.target.dataset.toolId;t&&this.applyTool(t,e)},e.TransformationsController.prototype.toggleShowMoreTools_=function(e){var t=pskl.UserSettings.get(pskl.UserSettings.TRANSFORM_SHOW_MORE);pskl.UserSettings.set(pskl.UserSettings.TRANSFORM_SHOW_MORE,!t)},e.TransformationsController.prototype.onUserSettingsChange_=function(e,t){t==pskl.UserSettings.TRANSFORM_SHOW_MORE&&this.updateShowMoreLink_()},e.TransformationsController.prototype.updateShowMoreLink_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.TRANSFORM_SHOW_MORE);this.container.classList.toggle("show-more",e),this.showMoreLink.classList.toggle("hidden",this.tools.length<5)},e.TransformationsController.prototype.createToolsDom_=function(){var e=this.tools.reduce(function(e,t){return e+this.toolIconBuilder.createIcon(t,"left")}.bind(this),"");this.container.querySelector(".tools-wrapper").innerHTML=e}})(),(()=>{var e=$.namespace("pskl.controller");e.CanvasBackgroundController=function(){this.body=document.body},e.CanvasBackgroundController.prototype.init=function(){$.subscribe(Events.USER_SETTINGS_CHANGED,this.onUserSettingsChange_.bind(this)),this.updateBackgroundClass_(pskl.UserSettings.get(pskl.UserSettings.CANVAS_BACKGROUND))},e.CanvasBackgroundController.prototype.onUserSettingsChange_=function(e,t,r){t==pskl.UserSettings.CANVAS_BACKGROUND&&this.updateBackgroundClass_(r)},e.CanvasBackgroundController.prototype.updateBackgroundClass_=function(e){var t=this.body.dataset.currentBackgroundClass;t&&this.body.classList.remove(t),this.body.classList.add(e),this.body.dataset.currentBackgroundClass=e}})(),(()=>{var e=$.namespace("pskl.controller");e.UserWarningController=function(e,t){this.piskelController=e,this.currentColorsService=t},e.UserWarningController.showPerformanceInfoDialog=function(){$.publish(Events.DIALOG_SHOW,{dialogId:"performance-info"})},e.UserWarningController.prototype.init=function(){$.subscribe(Events.PERFORMANCE_REPORT_CHANGED,this.onPerformanceReportChanged_.bind(this)),this.performanceLinkEl=document.querySelector(".performance-link"),pskl.utils.Event.addEventListener(this.performanceLinkEl,"click",e.UserWarningController.showPerformanceInfoDialog,this)},e.UserWarningController.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.performanceLinkEl=null},e.UserWarningController.prototype.onPerformanceReportChanged_=function(e,t){var t=t.hasProblem(),r=this.performanceLinkEl.classList.contains("visible");t?this.performanceLinkEl.classList.add("visible"):this.performanceLinkEl.classList.remove("visible"),t&&!r&&$.publish(Events.SHOW_NOTIFICATION,[{content:'Performance problem detected, <a href="#" style="color:red;"onclick="pskl.controller.UserWarningController.showPerformanceInfoDialog()">learn more?</a>',hideDelay:5e3}])}})(),(()=>{var e=$.namespace("pskl.controller.settings");e.AbstractSettingController=function(){},e.AbstractSettingController.prototype.addEventListener=function(e,t,r){pskl.utils.Event.addEventListener(e,t,r,this)},e.AbstractSettingController.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.nullifyDomReferences_()},e.AbstractSettingController.prototype.nullifyDomReferences_=function(){for(var e in this)this.hasOwnProperty(e)&&this[e]&&this[e].nodeName&&(this[e]=null)}})(),(()=>{var e=$.namespace("pskl.controller.settings.preferences"),s={transparent:Constants.TRANSPARENT_COLOR,white:"#FFF1E8","light-gray":"#C2C3C7","dark-gray":"#5F574F",black:"#000000",blue:"#29ADFF","dark-blue":"#1D2B53",green:"#00E436","dark-green":"#008751",peach:"#FFCCAA",pink:"#FF77A8",yellow:"#FFEC27",orange:"#FFA300",red:"#FF004D"};e.GridPreferencesController=function(e,t){this.piskelController=e,this.preferencesController=t,this.sizePicker=new pskl.widgets.SizePicker(this.onSizePickerChanged_.bind(this)),this.spacingPicker=new pskl.widgets.SizePicker(this.onSpacingPickerChanged_.bind(this))},pskl.utils.inherit(e.GridPreferencesController,pskl.controller.settings.AbstractSettingController),e.GridPreferencesController.prototype.init=function(){var e=pskl.UserSettings.get(pskl.UserSettings.GRID_ENABLED),t=document.querySelector(".enable-grid-checkbox"),e=(e&&t.setAttribute("checked","true"),this.addEventListener(t,"change",this.onEnableGridChange_),pskl.UserSettings.get(pskl.UserSettings.GRID_WIDTH)),t=(this.sizePicker.init(document.querySelector(".grid-size-container")),this.sizePicker.setSize(e),pskl.UserSettings.get(pskl.UserSettings.GRID_SPACING)),i=(this.spacingPicker.init(document.querySelector(".grid-spacing-container")),this.spacingPicker.setSize(t),pskl.utils.Template.get("color-list-item-template")),n=pskl.UserSettings.get(pskl.UserSettings.GRID_COLOR),o=(document.querySelector("#grid-color"),"");Object.keys(s).forEach(function(e,t){var r="transparent"===e?"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":s[e];o+=pskl.utils.Template.replace(i,{color:s[e],title:e,background:r,":selected":n===s[e]})}),this.gridColorList=document.querySelector(".grid-colors-list"),this.gridColorList.innerHTML=o,this.addEventListener(this.gridColorList,"click",this.onGridColorClicked_.bind(this))},e.GridPreferencesController.prototype.destroy=function(){this.sizePicker.destroy(),this.spacingPicker.destroy(),this.superclass.destroy.call(this)},e.GridPreferencesController.prototype.onSizePickerChanged_=function(e){pskl.UserSettings.set(pskl.UserSettings.GRID_WIDTH,e)},e.GridPreferencesController.prototype.onSpacingPickerChanged_=function(e){pskl.UserSettings.set(pskl.UserSettings.GRID_SPACING,e)},e.GridPreferencesController.prototype.onEnableGridChange_=function(e){pskl.UserSettings.set(pskl.UserSettings.GRID_ENABLED,e.currentTarget.checked)},e.GridPreferencesController.prototype.onGridColorClicked_=function(e){var t=e.target.dataset.color;t&&(pskl.UserSettings.set(pskl.UserSettings.GRID_COLOR,t),this.gridColorList.querySelector(".selected").classList.remove("selected"),e.target.classList.add("selected"))}})(),(()=>{var e=$.namespace("pskl.controller.settings.preferences");e.MiscPreferencesController=function(e,t){this.piskelController=e,this.preferencesController=t},pskl.utils.inherit(e.MiscPreferencesController,pskl.controller.settings.AbstractSettingController),e.MiscPreferencesController.prototype.init=function(){this.backgroundContainer=document.querySelector(".background-picker-wrapper"),this.addEventListener(this.backgroundContainer,"click",this.onBackgroundClick_);var e=pskl.UserSettings.get(pskl.UserSettings.CANVAS_BACKGROUND),e=this.backgroundContainer.querySelector("[data-background="+e+"]"),e=(e&&e.classList.add("selected"),document.querySelector(".max-fps-input")),e=(e.value=pskl.UserSettings.get(pskl.UserSettings.MAX_FPS),this.addEventListener(e,"change",this.onMaxFpsChange_),pskl.UserSettings.get(pskl.UserSettings.COLOR_FORMAT)),t=document.querySelector(".color-format-select"),e=t.querySelector('option[value="'+e+'"]'),e=(e&&e.setAttribute("selected","selected"),this.addEventListener(t,"change",this.onColorFormatChange_),document.querySelector(".layer-opacity-input"));e.value=pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY),this.addEventListener(e,"change",this.onLayerOpacityChange_),this.addEventListener(e,"input",this.onLayerOpacityChange_),this.updateLayerOpacityText_(e.value)},e.MiscPreferencesController.prototype.onBackgroundClick_=function(e){var e=e.target,t=e.dataset.background;t&&(pskl.UserSettings.set(pskl.UserSettings.CANVAS_BACKGROUND,t),(t=this.backgroundContainer.querySelector(".selected"))&&t.classList.remove("selected"),e.classList.add("selected"))},e.MiscPreferencesController.prototype.onColorFormatChange_=function(e){pskl.UserSettings.set(pskl.UserSettings.COLOR_FORMAT,e.target.value)},e.MiscPreferencesController.prototype.onMaxFpsChange_=function(e){var e=e.target,t=parseInt(e.value,10);t&&!isNaN(t)?pskl.UserSettings.set(pskl.UserSettings.MAX_FPS,t):e.value=pskl.UserSettings.get(pskl.UserSettings.MAX_FPS)},e.MiscPreferencesController.prototype.onLayerOpacityChange_=function(e){var e=e.target,t=parseFloat(e.value);isNaN(t)?e.value=pskl.UserSettings.get(pskl.UserSettings.LAYER_OPACITY):(pskl.UserSettings.set(pskl.UserSettings.LAYER_OPACITY,t),pskl.UserSettings.set(pskl.UserSettings.LAYER_PREVIEW,0!==t),this.updateLayerOpacityText_(t))},e.MiscPreferencesController.prototype.updateLayerOpacityText_=function(e){document.querySelector(".layer-opacity-text").innerHTML=(+e).toFixed(2)}})(),(()=>{var e=$.namespace("pskl.controller.settings.preferences");e.TilePreferencesController=function(e,t){this.piskelController=e,this.preferencesController=t},pskl.utils.inherit(e.TilePreferencesController,pskl.controller.settings.AbstractSettingController),e.TilePreferencesController.prototype.init=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_MODE),t=document.querySelector(".tile-mode-checkbox"),e=(e&&t.setAttribute("checked",e),this.addEventListener(t,"change",this.onTileModeChange_),document.querySelector(".tile-mask-opacity-input"));e.value=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_OPACITY),this.addEventListener(e,"change",this.onTileMaskOpacityChange_),this.addEventListener(e,"input",this.onTileMaskOpacityChange_),this.updateTileMaskOpacityText_(e.value)},e.TilePreferencesController.prototype.onTileModeChange_=function(e){pskl.UserSettings.set(pskl.UserSettings.SEAMLESS_MODE,e.currentTarget.checked)},e.TilePreferencesController.prototype.onTileMaskOpacityChange_=function(e){var e=e.target,t=parseFloat(e.value);isNaN(t)?e.value=pskl.UserSettings.get(pskl.UserSettings.SEAMLESS_OPACITY):(pskl.UserSettings.set(pskl.UserSettings.SEAMLESS_OPACITY,t),this.updateTileMaskOpacityText_(t))},e.TilePreferencesController.prototype.updateTileMaskOpacityText_=function(e){document.querySelector(".tile-mask-opacity-text").innerHTML=(+e).toFixed(2)}})(),(()=>{var e=$.namespace("pskl.controller.settings"),t={misc:{template:"templates/settings/preferences/misc.html",controller:e.preferences.MiscPreferencesController},grid:{template:"templates/settings/preferences/grid.html",controller:e.preferences.GridPreferencesController},tile:{template:"templates/settings/preferences/tile.html",controller:e.preferences.TilePreferencesController}};e.PreferencesController=function(){this.tabsWidget=new pskl.widgets.Tabs(t,this,pskl.UserSettings.PREFERENCES_TAB)},pskl.utils.inherit(e.PreferencesController,pskl.controller.settings.AbstractSettingController),e.PreferencesController.prototype.init=function(){var e=document.querySelector(".settings-section-preferences");this.tabsWidget.init(e)},e.PreferencesController.prototype.destroy=function(){this.tabsWidget.destroy(),this.superclass.destroy.call(this)}})(),(()=>{var e=$.namespace("pskl.controller.settings.exportimage");e.GifExportController=function(e,t){this.piskelController=e,this.exportController=t},pskl.utils.inherit(e.GifExportController,pskl.controller.settings.AbstractSettingController),e.GifExportController.prototype.init=function(){this.uploadStatusContainerEl=document.querySelector(".gif-upload-status"),this.previewContainerEl=document.querySelector(".gif-export-preview"),this.uploadButton=document.querySelector(".gif-upload-button"),this.downloadButton=document.querySelector(".gif-download-button"),this.repeatCheckbox=document.querySelector(".gif-repeat-checkbox"),this.repeatCheckbox.checked=this.getRepeatSetting_(),this.addEventListener(this.uploadButton,"click",this.onUploadButtonClick_),this.addEventListener(this.downloadButton,"click",this.onDownloadButtonClick_),this.addEventListener(this.repeatCheckbox,"change",this.onRepeatCheckboxChange_);var e=256<=pskl.app.currentColorsService.getCurrentColors().length;document.querySelector(".gif-export-warning").classList.toggle("visible",e)},e.GifExportController.prototype.getZoom_=function(){return this.exportController.getExportZoom()},e.GifExportController.prototype.onUploadButtonClick_=function(e){e.preventDefault();var e=this.getZoom_(),t=this.piskelController.getFPS();this.renderAsImageDataAnimatedGIF(e,t,this.uploadImageData_.bind(this))},e.GifExportController.prototype.onDownloadButtonClick_=function(e){var t=this.getZoom_(),r=this.piskelController.getFPS();this.renderAsImageDataAnimatedGIF(t,r,this.downloadImageData_.bind(this))},e.GifExportController.prototype.downloadImageData_=function(e){var t=this.piskelController.getPiskel().getDescriptor().name+".gif";pskl.utils.BlobUtils.dataToBlob(e,"image/gif",function(e){pskl.utils.FileUtils.downloadAsFile(e,t)})},e.GifExportController.prototype.uploadImageData_=function(e){this.updatePreview_(e),this.previewContainerEl.classList.add("preview-upload-ongoing"),pskl.app.imageUploadService.upload(e,this.onImageUploadCompleted_.bind(this),this.onImageUploadFailed_.bind(this))},e.GifExportController.prototype.onImageUploadCompleted_=function(e){this.updatePreview_(e),this.updateStatus_(e),this.previewContainerEl.classList.remove("preview-upload-ongoing")},e.GifExportController.prototype.onImageUploadFailed_=function(e,t){500===t.status&&$.publish(Events.SHOW_NOTIFICATION,[{content:"Upload failed : "+t.responseText,hideDelay:5e3}])},e.GifExportController.prototype.updatePreview_=function(e){this.previewContainerEl.innerHTML='<div><img style="max-width:32px;" src="'+e+'"/></div>'},e.GifExportController.prototype.renderAsImageDataAnimatedGIF=function(e,t,r){var i,n=pskl.app.currentColorsService.getCurrentColors(),o=!this.piskelController.getLayers().some(function(e){return e.isTransparent()})&&n.length<256,n=o?(i=this.getTransparentColor(n),parseInt(i.substring(1),16)):(i="#FFFFFF",null),s=this.piskelController.getWidth(),a=this.piskelController.getHeight(),l=new window.GIF({workers:5,quality:1,width:s*e,height:a*e,preserveColors:o,repeat:this.getRepeatSetting_()?0:-1,transparent:n}),c=pskl.utils.CanvasUtils.createCanvas(s,a),p=c.getContext("2d");p.fillStyle=i;for(var h=0;h<this.piskelController.getFrameCount();h++){var u=this.piskelController.renderFrameAt(h,!0),u=(p.clearRect(0,0,s,a),p.fillRect(0,0,s,a),p.drawImage(u,0,0,s,a),pskl.utils.ImageResizer.scale(c,e));l.addFrame(u.getContext("2d"),{delay:1e3/t})}$.publish(Events.SHOW_PROGRESS,[{name:"Building animated GIF ..."}]),l.on("progress",function(e){$.publish(Events.UPDATE_PROGRESS,[{progress:(100*e).toFixed(1)}])}.bind(this)),l.on("finished",function(e){$.publish(Events.HIDE_PROGRESS),pskl.utils.FileUtils.readFile(e,r)}.bind(this)),l.render()},e.GifExportController.prototype.getTransparentColor=function(e){e=pskl.utils.ColorUtils.getUnusedColor(e);return e||(console.error("Unable to find unused color to use as transparent color in the current sprite"),e="#FF00FF"),e},e.GifExportController.prototype.onRepeatCheckboxChange_=function(){var e=this.repeatCheckbox.checked;pskl.UserSettings.set(pskl.UserSettings.EXPORT_GIF_REPEAT,e)},e.GifExportController.prototype.getRepeatSetting_=function(){return pskl.UserSettings.get(pskl.UserSettings.EXPORT_GIF_REPEAT)},e.GifExportController.prototype.updateStatus_=function(e,t){e&&(e=pskl.utils.Template.replace('<a class="highlight" href="{{link}}" target="_blank">{{shortLink}}</a>',{link:e,shortLink:this.shorten_(e,30,"...")}),this.uploadStatusContainerEl.innerHTML="Your image is now available at : "+e)},e.GifExportController.prototype.shorten_=function(e,t,r){return e.length>t&&(t=Math.round((t-r.length)/2),e=e.substring(0,t)+r+e.substring(e.length-t,e.length)),e}})(),(()=>{function o(e,t){return 1===t?"1 "+e:t+" "+e+"s"}var e=$.namespace("pskl.controller.settings.exportimage"),s=pskl.utils.Template.replace;e.PngExportController=function(e,t){this.piskelController=e,this.exportController=t,this.onScaleChanged_=this.onScaleChanged_.bind(this)},pskl.utils.inherit(e.PngExportController,pskl.controller.settings.AbstractSettingController),e.PngExportController.prototype.init=function(){this.layoutContainer=document.querySelector(".png-export-layout-section"),this.dimensionInfo=document.querySelector(".png-export-dimension-info"),this.rowsInput=document.querySelector("#png-export-rows"),this.columnsInput=document.querySelector("#png-export-columns");var e=document.querySelector(".png-download-button"),t=document.querySelector(".png-pixi-download-button"),r=document.querySelector(".datauri-open-button"),i=document.querySelector(".selected-frame-download-button");this.pixiInlineImageCheckbox=document.querySelector(".png-pixi-inline-image-checkbox"),this.initLayoutSection_(),this.updateDimensionLabel_(),this.addEventListener(this.columnsInput,"input",this.onColumnsInput_),this.addEventListener(e,"click",this.onDownloadClick_),this.addEventListener(t,"click",this.onPixiDownloadClick_),this.addEventListener(r,"click",this.onDataUriClick_),this.addEventListener(i,"click",this.onDownloadSelectedFrameClick_),$.subscribe(Events.EXPORT_SCALE_CHANGED,this.onScaleChanged_)},e.PngExportController.prototype.destroy=function(){$.unsubscribe(Events.EXPORT_SCALE_CHANGED,this.onScaleChanged_),this.superclass.destroy.call(this)},e.PngExportController.prototype.initLayoutSection_=function(){var e=this.piskelController.getFrameCount();1===e?this.layoutContainer.style.display="none":(this.columnsInput.setAttribute("max",e),this.columnsInput.value=this.getBestFit_(),this.onColumnsInput_())},e.PngExportController.prototype.updateDimensionLabel_=function(){var e=this.exportController.getExportZoom(),t=this.piskelController.getFrameCount(),r=this.piskelController.getWidth()*e,e=this.piskelController.getHeight()*e,i=this.getColumns_(),n=this.getRows_();this.dimensionInfo.innerHTML=s("{{width}} x {{height}} px, {{frames}}<br/>{{columns}}, {{rows}}.",{width:r*=i,height:e*=n,rows:o("row",n),columns:o("column",i),frames:o("frame",t)})},e.PngExportController.prototype.getColumns_=function(){return parseInt(this.columnsInput.value||1,10)},e.PngExportController.prototype.getRows_=function(){return parseInt(this.rowsInput.value||1,10)},e.PngExportController.prototype.getBestFit_=function(){var e=this.piskelController.getWidth()/this.piskelController.getHeight(),t=this.piskelController.getFrameCount(),e=Math.round(Math.sqrt(t/e));return pskl.utils.Math.minmax(e,1,t)},e.PngExportController.prototype.onScaleChanged_=function(){this.updateDimensionLabel_()},e.PngExportController.prototype.onColumnsInput_=function(){var e=this.columnsInput.value;""!==e&&(e=parseInt(e,10),isNaN(e)&&(e=1),e=pskl.utils.Math.minmax(e,1,this.piskelController.getFrameCount()),this.columnsInput.value=e,this.rowsInput.value=Math.ceil(this.piskelController.getFrameCount()/e),this.updateDimensionLabel_())},e.PngExportController.prototype.createPngSpritesheet_=function(){var e=new pskl.rendering.PiskelRenderer(this.piskelController).renderAsCanvas(this.getColumns_(),this.getRows_()),t=e.width,r=e.height,i=this.exportController.getExportZoom();return e=1!=i?pskl.utils.ImageResizer.resize(e,t*i,r*i,!1):e},e.PngExportController.prototype.onDownloadClick_=function(e){var t=this.createPngSpritesheet_();this.downloadCanvas_(t)},e.PngExportController.prototype.downloadCanvas_=function(e,t){var r=(t=t||this.piskelController.getPiskel().getDescriptor().name)+".png";pskl.utils.BlobUtils.canvasToBlob(e,function(e){pskl.utils.FileUtils.downloadAsFile(e,r)})},e.PngExportController.prototype.onPixiDownloadClick_=function(){for(var e=new window.JSZip,t=this.createPngSpritesheet_(),r=this.piskelController.getPiskel().getDescriptor().name,i=(this.pixiInlineImageCheckbox.checked?p=t.toDataURL("image/png"):e.file(p=r+".png",pskl.utils.CanvasUtils.getBase64FromCanvas(t)+"\n",{base64:!0}),t.width/this.getColumns_()),n=t.height/this.getRows_(),o=this.piskelController.getFrameCount(),s={},a=0;a<o;a++){var l=a%this.getColumns_(),c=(a-l)/this.getColumns_();s[r+a+".png"]={frame:{x:i*l,y:n*c,w:i,h:n},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i,h:n},sourceSize:{w:i,h:n}}}var p={frames:s,meta:{app:"https://github.com/piskelapp/piskel/",version:"1.0",image:p,format:"RGBA8888",size:{w:t.width,h:t.height}}},t=(e.file(r+".json",JSON.stringify(p)),e.generate({type:"blob"}));pskl.utils.FileUtils.downloadAsFile(t,r+".zip")},e.PngExportController.prototype.onDataUriClick_=function(e){var t=window.open("about:blank"),r=this.createPngSpritesheet_().toDataURL("image/png");window.setTimeout(function(){var e=pskl.utils.Template.getAndReplace("data-uri-export-partial",{src:r});t.document.title=r,t.document.body.innerHTML=e}.bind(this),500)},e.PngExportController.prototype.onDownloadSelectedFrameClick_=function(e){var t=this.piskelController.getCurrentFrameIndex(),r=this.piskelController.getPiskel().getDescriptor().name,i=this.piskelController.renderFrameAt(t,!0),n=this.exportController.getExportZoom(),n=(1!=n&&(i=pskl.utils.ImageResizer.resize(i,i.width*n,i.height*n,!1)),r+"-"+(t+1)+".png");this.downloadCanvas_(i,n)}})(),(()=>{var e=$.namespace("pskl.controller.settings.exportimage");e.ZipExportController=function(e,t){this.piskelController=e,this.exportController=t},pskl.utils.inherit(e.ZipExportController,pskl.controller.settings.AbstractSettingController),e.ZipExportController.prototype.init=function(){this.pngFilePrefixInput=document.querySelector(".zip-prefix-name"),this.pngFilePrefixInput.value="sprite_",this.splitByLayersCheckbox=document.querySelector(".zip-split-layers-checkbox"),this.addEventListener(this.splitByLayersCheckbox,"change",this.onSplitLayersClick_),this.useLayerNamesContainer=document.querySelector(".use-layer-names-container"),this.useLayerNamesCheckbox=document.querySelector(".zip-use-layer-names-checkbox"),this.toggleHideUseLayerNamesCheckbox();var e=document.querySelector(".zip-generate-button");this.addEventListener(e,"click",this.onZipButtonClick_)},e.ZipExportController.prototype.toggleHideUseLayerNamesCheckbox=function(){this.useLayerNamesContainer.style.display=this.splitByLayersCheckbox.checked?"block":"none"},e.ZipExportController.prototype.onSplitLayersClick_=function(){this.toggleHideUseLayerNamesCheckbox()},e.ZipExportController.prototype.onZipButtonClick_=function(){var e=new window.JSZip,t=(this.splitByLayersCheckbox.checked?this.splittedExport_(e):this.mergedExport_(e),this.getPiskelName_()+".zip"),e=e.generate({type:"blob"});pskl.utils.FileUtils.downloadAsFile(e,t)},e.ZipExportController.prototype.mergedExport_=function(e){for(var t=(""+this.piskelController.getFrameCount()).length,r=this.exportController.getExportZoom(),i=0;i<this.piskelController.getFrameCount();i++){var n=this.piskelController.renderFrameAt(i,!0),n=pskl.utils.ImageResizer.scale(n,r),o=this.pngFilePrefixInput.value,s=pskl.utils.StringUtils.leftPad(i,t,"0");e.file(o+s+".png",pskl.utils.CanvasUtils.getBase64FromCanvas(n)+"\n",{base64:!0})}},e.ZipExportController.prototype.splittedExport_=function(e){for(var t=this.piskelController.getLayers(),r=(""+this.piskelController.getFrameCount()).length,i=(""+t.length).length,n=this.exportController.getExportZoom(),o=0;this.piskelController.hasLayerAt(o);o++)for(var s=this.piskelController.getLayerAt(o),a=pskl.utils.StringUtils.leftPad(o,i,"0"),l=0;l<this.piskelController.getFrameCount();l++){var c=pskl.utils.LayerUtils.renderFrameAt(s,l,!0),c=pskl.utils.ImageResizer.scale(c,n),p=this.pngFilePrefixInput.value,h=pskl.utils.StringUtils.leftPad(l+1,r,"0"),u="l"+a+"_"+p+h+".png";this.useLayerNamesCheckbox.checked&&(u=s.getName()+"_"+p+h+".png"),e.file(u,pskl.utils.CanvasUtils.getBase64FromCanvas(c)+"\n",{base64:!0})}},e.ZipExportController.prototype.getPiskelName_=function(){return this.piskelController.getPiskel().getDescriptor().name}})(),(()=>{var e=$.namespace("pskl.controller.settings.exportimage");e.MiscExportController=function(e){this.piskelController=e},pskl.utils.inherit(e.MiscExportController,pskl.controller.settings.AbstractSettingController),e.MiscExportController.prototype.init=function(){var e=document.querySelector(".c-download-button");this.addEventListener(e,"click",this.onDownloadCFileClick_)},e.MiscExportController.prototype.onDownloadCFileClick_=function(e){for(var t=this.getPiskelName_()+".c",r=this.getPiskelName_().replace(" ","_"),i=this.piskelController.getWidth(),n=this.piskelController.getHeight(),o=this.piskelController.getFrameCount(),s="#include <stdint.h>\n\n",s=(s=(s=(s=(s+="#define "+r.toUpperCase()+"_FRAME_COUNT "+this.piskelController.getFrameCount()+"\n")+("#define "+r.toUpperCase()+"_FRAME_WIDTH "+i+"\n"))+("#define "+r.toUpperCase()+"_FRAME_HEIGHT "+n+"\n\n"))+('/* Piskel data for "'+this.getPiskelName_()+'" */\n\n'))+("static const uint32_t "+r.toLowerCase())+("_data["+o+"]["+i*n+"] = {\n"),a=0;a<o;a++){var l=this.piskelController.renderFrameAt(a,!0).getContext("2d").getImageData(0,0,i,n).data;s+="{\n";for(var c=0;c<l.length;c+=4)s+=this.rgbToCHex(l[c],l[c+1],l[c+2],l[c+3]),c!=l.length-4&&(s+=", "),(c+4)%(4*i)==0&&(s+="\n");s+=a!=o-1?"},\n":"}\n"}s+="};\n",pskl.utils.BlobUtils.stringToBlob(s,function(e){pskl.utils.FileUtils.downloadAsFile(e,t)}.bind(this),"application/text")},e.MiscExportController.prototype.getPiskelName_=function(){return this.piskelController.getPiskel().getDescriptor().name},e.MiscExportController.prototype.rgbToCHex=function(e,t,r,i){var n="0x";return(n+=("00"+i.toString(16)).substr(-2))+("00"+r.toString(16)).substr(-2)+("00"+t.toString(16)).substr(-2)+("00"+e.toString(16)).substr(-2)}})(),(()=>{var e=$.namespace("pskl.controller.settings.exportimage"),t={png:{template:"templates/settings/export/png.html",controller:e.PngExportController},gif:{template:"templates/settings/export/gif.html",controller:e.GifExportController},zip:{template:"templates/settings/export/zip.html",controller:e.ZipExportController},misc:{template:"templates/settings/export/misc.html",controller:e.MiscExportController}};e.ExportController=function(e){this.piskelController=e,this.tabsWidget=new pskl.widgets.Tabs(t,this,pskl.UserSettings.EXPORT_TAB),this.onSizeInputChange_=this.onSizeInputChange_.bind(this)},pskl.utils.inherit(e.ExportController,pskl.controller.settings.AbstractSettingController),e.ExportController.prototype.init=function(){this.scaleInput=document.querySelector(".export-scale .scale-input"),this.addEventListener(this.scaleInput,"change",this.onScaleChange_),this.addEventListener(this.scaleInput,"input",this.onScaleChange_),this.widthInput=document.querySelector(".export-resize .resize-width"),this.heightInput=document.querySelector(".export-resize .resize-height");var e=pskl.UserSettings.get(pskl.UserSettings.EXPORT_SCALE),e=(this.sizeInputWidget=new pskl.widgets.SizeInput({widthInput:this.widthInput,heightInput:this.heightInput,initWidth:this.piskelController.getWidth()*e,initHeight:this.piskelController.getHeight()*e,onChange:this.onSizeInputChange_}),this.onSizeInputChange_(),document.querySelector(".settings-section-export"));this.tabsWidget.init(e)},e.ExportController.prototype.destroy=function(){this.sizeInputWidget.destroy(),this.tabsWidget.destroy(),this.superclass.destroy.call(this)},e.ExportController.prototype.onScaleChange_=function(){var e=parseFloat(this.scaleInput.value);isNaN(e)||(Math.round(this.getExportZoom())!=e&&this.sizeInputWidget.setWidth(this.piskelController.getWidth()*e),pskl.UserSettings.set(pskl.UserSettings.EXPORT_SCALE,e))},e.ExportController.prototype.updateScaleText_=function(e){e=e.toFixed(1),document.querySelector(".export-scale .scale-text").innerHTML=e+"x"},e.ExportController.prototype.onSizeInputChange_=function(){var e=this.getExportZoom();isNaN(e)||(this.updateScaleText_(e),$.publish(Events.EXPORT_SCALE_CHANGED),this.scaleInput.value=Math.round(e),1<=e&&e<=32&&this.onScaleChange_())},e.ExportController.prototype.getExportZoom=function(){return parseInt(this.widthInput.value,10)/this.piskelController.getWidth()}})(),(()=>{var r=$.namespace("pskl.controller.settings.resize");r.ResizeController=function(e){this.piskelController=e,this.container=document.querySelector(".resize-canvas");var t=this.container.querySelector(".resize-anchor-container");this.anchorWidget=new pskl.widgets.AnchorWidget(t),this.defaultSizeController=new r.DefaultSizeController(e)},pskl.utils.inherit(r.ResizeController,pskl.controller.settings.AbstractSettingController),r.ResizeController.prototype.init=function(){this.widthInput=this.container.querySelector('[name="resize-width"]'),this.heightInput=this.container.querySelector('[name="resize-height"]'),this.resizeForm=this.container.querySelector("form"),this.resizeContentCheckbox=this.container.querySelector(".resize-content-checkbox"),this.maintainRatioCheckbox=this.container.querySelector(".resize-ratio-checkbox"),this.sizeInputWidget=new pskl.widgets.SizeInput({widthInput:this.widthInput,heightInput:this.heightInput,initWidth:this.piskelController.getWidth(),initHeight:this.piskelController.getHeight()});var e=pskl.UserSettings.get("RESIZE_SETTINGS"),t=pskl.widgets.AnchorWidget.ORIGIN[e.origin]||"TOPLEFT";this.anchorWidget.setOrigin(t),e.resizeContent&&(this.resizeContentCheckbox.checked=!0,this.anchorWidget.disable()),e.maintainRatio?this.maintainRatioCheckbox.checked=!0:this.sizeInputWidget.disableSync(),this.addEventListener(this.resizeForm,"submit",this.onResizeFormSubmit_),this.addEventListener(this.resizeContentCheckbox,"change",this.onResizeContentChange_),this.addEventListener(this.maintainRatioCheckbox,"change",this.onMaintainRatioChange_),this.defaultSizeController.init()},r.ResizeController.prototype.destroy=function(){this.updateUserPreferences_(),this.anchorWidget.destroy(),this.sizeInputWidget.destroy(),this.superclass.destroy.call(this)},r.ResizeController.prototype.onResizeFormSubmit_=function(e){e.preventDefault();e=this.piskelController.getPiskel(),e=pskl.utils.ResizeUtils.resizePiskel(e,{width:parseInt(this.widthInput.value,10),height:parseInt(this.heightInput.value,10),origin:this.anchorWidget.getOrigin(),resizeContent:this.resizeContentCheckbox.checked});pskl.app.piskelController.setPiskel(e,{preserveState:!0}),$.publish(Events.CLOSE_SETTINGS_DRAWER)},r.ResizeController.prototype.onResizeContentChange_=function(e){e.target.checked?this.anchorWidget.disable():this.anchorWidget.enable()},r.ResizeController.prototype.onMaintainRatioChange_=function(e){e.target.checked?this.sizeInputWidget.enableSync():this.sizeInputWidget.disableSync()},r.ResizeController.prototype.updateUserPreferences_=function(){pskl.UserSettings.set("RESIZE_SETTINGS",{origin:this.anchorWidget.getOrigin(),resizeContent:!!this.resizeContentCheckbox.checked,maintainRatio:!!this.maintainRatioCheckbox.checked})}})(),(()=>{var e=$.namespace("pskl.controller.settings.resize");e.DefaultSizeController=function(e){this.piskelController=e},pskl.utils.inherit(e.DefaultSizeController,pskl.controller.settings.AbstractSettingController),e.DefaultSizeController.prototype.init=function(){this.container=document.querySelector(".settings-default-size");var e=pskl.UserSettings.get(pskl.UserSettings.DEFAULT_SIZE);this.widthInput=this.container.querySelector('[name="default-width"]'),this.heightInput=this.container.querySelector('[name="default-height"]'),this.widthInput.value=e.width,this.heightInput.value=e.height,this.defaultSizeForm=this.container.querySelector("form"),this.addEventListener(this.defaultSizeForm,"submit",this.onFormSubmit_)},e.DefaultSizeController.prototype.onFormSubmit_=function(e){e.preventDefault();var e=pskl.UserSettings.get(pskl.UserSettings.DEFAULT_SIZE),t=this.toNumber_(this.widthInput.value,e.width),e=this.toNumber_(this.heightInput.value,e.height);pskl.UserSettings.set(pskl.UserSettings.DEFAULT_SIZE,{width:t,height:e}),$.publish(Events.CLOSE_SETTINGS_DRAWER)},e.DefaultSizeController.prototype.toNumber_=function(e,t){e=parseInt(e,10);return e=0!==e&&!isNaN(e)?e:t}})(),(()=>{var e=$.namespace("pskl.controller.settings"),t="save-desktop-partial",r="save-gallery-partial",i="save-gallery-unavailable-partial",n="save-localstorage-partial",o="save-file-download-partial";e.SaveController=function(e){this.piskelController=e},pskl.utils.inherit(e.SaveController,pskl.controller.settings.AbstractSettingController),e.SaveController.prototype.init=function(){this.saveForm=document.querySelector(".save-form"),this.insertSavePartials_(),this.piskelName=document.querySelector(".piskel-name"),this.descriptionInput=document.querySelector("#save-description"),this.nameInput=document.querySelector("#save-name"),this.isPublicCheckbox=document.querySelector("input[name=save-public-checkbox]"),this.updateDescriptorInputs_(),this.saveLocalStorageButton=document.querySelector("#save-localstorage-button"),this.saveGalleryButton=document.querySelector("#save-gallery-button"),this.saveDesktopButton=document.querySelector("#save-desktop-button"),this.saveDesktopAsNewButton=document.querySelector("#save-desktop-as-new-button"),this.saveFileDownloadButton=document.querySelector("#save-file-download-button"),this.safeAddEventListener_(this.saveLocalStorageButton,"click",this.saveToIndexedDb_),this.safeAddEventListener_(this.saveGalleryButton,"click",this.saveToGallery_),this.safeAddEventListener_(this.saveDesktopButton,"click",this.saveToDesktop_),this.safeAddEventListener_(this.saveDesktopAsNewButton,"click",this.saveToDesktopAsNew_),this.safeAddEventListener_(this.saveFileDownloadButton,"click",this.saveToFileDownload_),this.addEventListener(this.saveForm,"submit",this.onSaveFormSubmit_),pskl.app.storageService.isSaving()&&this.disableSaveButtons_(),this.updateSaveToGalleryMessage_(),$.subscribe(Events.BEFORE_SAVING_PISKEL,this.disableSaveButtons_.bind(this)),$.subscribe(Events.AFTER_SAVING_PISKEL,this.enableSaveButtons_.bind(this))},e.SaveController.prototype.updateSaveToGalleryMessage_=function(e){var t,r=document.querySelector(".save-online-status");r&&pskl.app.performanceReportService.hasProblem()&&(t=pskl.utils.Template.get("save-gallery-warning-partial"),r.innerHTML=t)},e.SaveController.prototype.insertSavePartials_=function(){this.getPartials_().forEach(function(e){this.saveForm.insertAdjacentHTML("beforeend",pskl.utils.Template.get(e))}.bind(this))},e.SaveController.prototype.getPartials_=function(){return pskl.utils.Environment.detectNodeWebkit()?[t,n,i]:pskl.app.isLoggedIn()?[r,n,o]:[o,n,i]},e.SaveController.prototype.updateDescriptorInputs_=function(e){var t=this.piskelController.getPiskel().getDescriptor();this.descriptionInput.value=t.description,this.nameInput.value=t.name,t.isPublic&&this.isPublicCheckbox.setAttribute("checked",!0),pskl.app.isLoggedIn()||(document.querySelector(".save-public-section").style.display="none")},e.SaveController.prototype.onSaveFormSubmit_=function(e){e.preventDefault(),e.stopPropagation(),pskl.app.isLoggedIn()?this.saveToGallery_():this.saveToIndexedDb_()},e.SaveController.prototype.saveToFileDownload_=function(){this.saveTo_("saveToFileDownload",!1)},e.SaveController.prototype.saveToGallery_=function(){this.saveTo_("saveToGallery",!1)},e.SaveController.prototype.saveToIndexedDb_=function(){this.saveTo_("saveToIndexedDb",!1)},e.SaveController.prototype.saveToDesktop_=function(){this.saveTo_("saveToDesktop",!1)},e.SaveController.prototype.saveToDesktopAsNew_=function(){this.saveTo_("saveToDesktop",!0)},e.SaveController.prototype.saveTo_=function(e,t){var r=this.piskelController.getPiskel();r.setDescriptor(this.getDescriptor_()),pskl.app.storageService[e](r,!!t).then(this.onSaveSuccess_)},e.SaveController.prototype.getDescriptor_=function(){var e=this.nameInput.value,t=this.descriptionInput.value;return new pskl.model.piskel.Descriptor(e,t,this.isPublic_())},e.SaveController.prototype.isPublic_=function(){return!this.isPublicCheckbox||!!this.isPublicCheckbox.checked},e.SaveController.prototype.onSaveSuccess_=function(){$.publish(Events.CLOSE_SETTINGS_DRAWER)},e.SaveController.prototype.disableSaveButtons_=function(){this.setDisabled_(this.saveLocalStorageButton,!0),this.setDisabled_(this.saveGalleryButton,!0),this.setDisabled_(this.saveDesktopButton,!0),this.setDisabled_(this.saveDesktopAsNewButton,!0),this.setDisabled_(this.saveFileDownloadButton,!0)},e.SaveController.prototype.enableSaveButtons_=function(){this.setDisabled_(this.saveLocalStorageButton,!1),this.setDisabled_(this.saveGalleryButton,!1),this.setDisabled_(this.saveDesktopButton,!1),this.setDisabled_(this.saveDesktopAsNewButton,!1),this.setDisabled_(this.saveFileDownloadButton,!1)},e.SaveController.prototype.setDisabled_=function(e,t){e&&(t?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled"))},e.SaveController.prototype.safeAddEventListener_=function(e,t,r){e&&this.addEventListener(e,t,r)}})(),(()=>{var e=$.namespace("pskl.controller.settings");e.ImportController=function(e){this.piskelController=e},pskl.utils.inherit(e.ImportController,pskl.controller.settings.AbstractSettingController),e.ImportController.prototype.init=function(){this.hiddenFileInput=document.querySelector('[name="file-upload-input"]'),this.addEventListener(this.hiddenFileInput,"change",this.onFileUploadChange_),this.hiddenOpenPiskelInput=document.querySelector('[name="open-piskel-input"]'),this.addEventListener(".browse-local-button","click",this.onBrowseLocalClick_),this.addEventListener(".browse-backups-button","click",this.onBrowseBackupsClick_),this.addEventListener(".file-input-button","click",this.onFileInputClick_),pskl.utils.Environment.detectNodeWebkit()?this.addEventListener(".open-piskel-button","click",this.openPiskelDesktop_):(this.addEventListener(this.hiddenOpenPiskelInput,"change",this.onOpenPiskelChange_),this.addEventListener(".open-piskel-button","click",this.onOpenPiskelClick_))},e.ImportController.prototype.closeDrawer_=function(){$.publish(Events.CLOSE_SETTINGS_DRAWER)},e.ImportController.prototype.onFileUploadChange_=function(e){this.importPictureFromFile_()},e.ImportController.prototype.onFileInputClick_=function(e){this.hiddenFileInput.click()},e.ImportController.prototype.onOpenPiskelChange_=function(e){var t=this.hiddenOpenPiskelInput.files;1==t.length&&this.openPiskelFile_(t[0])},e.ImportController.prototype.openPiskelDesktop_=function(e){this.closeDrawer_(),pskl.app.desktopStorageService.openPiskel()},e.ImportController.prototype.onOpenPiskelClick_=function(e){this.hiddenOpenPiskelInput.click()},e.ImportController.prototype.onBrowseLocalClick_=function(e){$.publish(Events.DIALOG_SHOW,{dialogId:"browse-local"}),this.closeDrawer_()},e.ImportController.prototype.onBrowseBackupsClick_=function(e){$.publish(Events.DIALOG_SHOW,{dialogId:"browse-backups"}),this.closeDrawer_()},e.ImportController.prototype.openPiskelFile_=function(e){this.isPiskel_(e)?($.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:[e]}}),this.closeDrawer_()):(this.closeDrawer_(),console.error("The selected file is not a piskel file"))},e.ImportController.prototype.importPictureFromFile_=function(){var e=this.hiddenFileInput.files;Array.prototype.every.call(e,function(e){return 0===e.type.indexOf("image")})?($.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:e}}),this.closeDrawer_()):(this.closeDrawer_(),console.error("Some files are not images"))},e.ImportController.prototype.isPiskel_=function(e){return/\.piskel$/.test(e.name)},e.ImportController.prototype.onRestorePreviousSessionClick_=function(){window.confirm("This will erase your current workspace. Continue ?")&&(pskl.app.backupService.load(),$.publish(Events.CLOSE_SETTINGS_DRAWER))}})(),(()=>{var e=$.namespace("pskl.controller.settings"),t={user:{template:"templates/settings/preferences.html",controller:e.PreferencesController},resize:{template:"templates/settings/resize.html",controller:e.resize.ResizeController},export:{template:"templates/settings/export.html",controller:e.exportimage.ExportController},import:{template:"templates/settings/import.html",controller:e.ImportController},localstorage:{template:"templates/settings/localstorage.html",controller:e.LocalStorageController},save:{template:"templates/settings/save.html",controller:e.SaveController}},r="has-expanded-drawer";e.SettingsController=function(e){this.piskelController=e,this.closeDrawerShortcut=pskl.service.keyboard.Shortcuts.MISC.CLOSE_POPUP,this.settingsContainer=document.querySelector("[data-pskl-controller=settings]"),this.drawerContainer=document.getElementById("drawer-container"),this.isExpanded=!1,this.currentSetting=null},e.SettingsController.prototype.init=function(){pskl.utils.Event.addEventListener(this.settingsContainer,"click",this.onSettingsContainerClick_,this),pskl.utils.Event.addEventListener(document.body,"click",this.onBodyClick_,this),$.subscribe(Events.CLOSE_SETTINGS_DRAWER,this.closeDrawer_.bind(this))},e.SettingsController.prototype.onSettingsContainerClick_=function(e){var t=pskl.utils.Dom.getData(e.target,"setting");t&&(this.currentSetting!=t?this.loadSetting_(t):this.closeDrawer_(),e.stopPropagation(),e.preventDefault())},e.SettingsController.prototype.onBodyClick_=function(e){var e=e.target,t=pskl.utils.Dom.isParent(e,this.drawerContainer),e=e.dataset.setting;this.isExpanded&&!(t||e)&&this.closeDrawer_()},e.SettingsController.prototype.loadSetting_=function(e){this.drawerContainer.innerHTML=pskl.utils.Template.get(t[e].template),this.destroyCurrentController_(),this.currentSetting=e,this.currentController=new t[e].controller(this.piskelController),this.currentController.init(),pskl.app.shortcutService.registerShortcut(this.closeDrawerShortcut,this.closeDrawer_.bind(this)),pskl.utils.Dom.removeClass(r);e=document.querySelector("[data-setting="+e+"]");e&&e.classList.add(r),this.settingsContainer.classList.add("expanded"),this.isExpanded=!0},e.SettingsController.prototype.closeDrawer_=function(){pskl.utils.Dom.removeClass(r),this.settingsContainer.classList.remove("expanded"),this.isExpanded=!1,this.currentSetting=null,document.activeElement.blur(),this.destroyCurrentController_()},e.SettingsController.prototype.destroyCurrentController_=function(){this.currentController&&(pskl.app.shortcutService.unregisterShortcut(this.closeDrawerShortcut),this.currentController.destroy)&&(this.currentController.destroy(),this.currentController=null)}})(),(()=>{var e=$.namespace("pskl.controller.dialogs");e.AbstractDialogController=function(){},e.AbstractDialogController.prototype.init=function(){var e=document.querySelector(".dialog-close");this.addEventListener(e,"click",this.closeDialog)},e.AbstractDialogController.prototype.addEventListener=function(e,t,r){pskl.utils.Event.addEventListener(e,t,r,this)},e.AbstractDialogController.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.AbstractDialogController.prototype.closeDialog=function(){$.publish(Events.DIALOG_HIDE)},e.AbstractDialogController.prototype.setTitle=function(e){var t=document.querySelector(".dialog-title");t&&(t.innerText=e)}})(),(()=>{var e=$.namespace("pskl.controller.dialogs");e.CreatePaletteController=function(e){this.paletteService=pskl.app.paletteService,this.paletteImportService=pskl.app.paletteImportService},pskl.utils.inherit(e.CreatePaletteController,e.AbstractDialogController),e.CreatePaletteController.prototype.init=function(e){this.superclass.init.call(this),this.hiddenFileInput=document.querySelector(".create-palette-import-input"),this.nameInput=document.querySelector('input[name="palette-name"]');var t=document.querySelector(".create-palette-actions"),r=document.querySelector(".create-palette-delete"),i=document.querySelector(".create-palette-download-button"),n=document.querySelector(".create-palette-import-button"),t=(this.addEventListener(this.nameInput,"input",this.onNameInputChange_),this.addEventListener(this.hiddenFileInput,"change",this.onFileInputChange_),this.addEventListener(t,"click",this.onButtonClick_),this.addEventListener(i,"click",this.onDownloadButtonClick_),this.addEventListener(n,"click",this.onImportFileButtonClick_),document.querySelector(".colors-container")),t=(this.colorsListWidget=new pskl.widgets.ColorsList(t),e==Constants.CURRENT_COLORS_PALETTE_ID||e==Constants.CURRENT_FRAME_COLORS_PALETTE_ID);i=e&&!t?(n.style.display="none",this.setTitle("Edit Palette"),t=this.paletteService.getPaletteById(e),pskl.model.Palette.fromObject(t)):(i.style.display="none",r.style.display="none",this.setTitle("Create Palette"),n=pskl.utils.Uuid.generate(),e==Constants.CURRENT_COLORS_PALETTE_ID?new pskl.model.Palette(n,"File colors copy",this.getCurrentColors_()):e==Constants.CURRENT_FRAME_COLORS_PALETTE_ID?(t=pskl.app.piskelController.getCurrentFrameIndex()+1,new pskl.model.Palette(n,"frame:"+t+" colors copy",this.getCurrentFrameColors_())):new pskl.model.Palette(n,"New palette",[])),this.setPalette_(i)},e.CreatePaletteController.prototype.getCurrentColors_=function(){return this.paletteService.getPaletteById(Constants.CURRENT_COLORS_PALETTE_ID).getColors()},e.CreatePaletteController.prototype.getCurrentFrameColors_=function(){return this.paletteService.getPaletteById(Constants.CURRENT_FRAME_COLORS_PALETTE_ID).getColors()},e.CreatePaletteController.prototype.setPalette_=function(e){this.palette=e,this.nameInput.value=pskl.utils.unescapeHtml(e.name),this.colorsListWidget.setColors(e.getColors())},e.CreatePaletteController.prototype.destroy=function(){this.colorsListWidget.destroy(),this.superclass.destroy.call(this),this.nameInput=null,this.hiddenFileInput=null},e.CreatePaletteController.prototype.onButtonClick_=function(e){e=e.target;"submit"===e.dataset.action?this.saveAndSelectPalette_():"cancel"===e.dataset.action?this.closeDialog():"delete"===e.dataset.action&&this.deletePalette_()},e.CreatePaletteController.prototype.saveAndSelectPalette_=function(){this.palette.setColors(this.colorsListWidget.getColors()),this.paletteService.savePalette(this.palette),pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,this.palette.id),this.closeDialog()},e.CreatePaletteController.prototype.deletePalette_=function(){window.confirm("Are you sure you want to delete palette "+this.palette.name)&&(this.paletteService.deletePaletteById(this.palette.id),pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,Constants.CURRENT_COLORS_PALETTE_ID),this.closeDialog())},e.CreatePaletteController.prototype.onDownloadButtonClick_=function(){var e=new pskl.service.palette.PaletteGplWriter(this.palette).write();pskl.utils.BlobUtils.stringToBlob(e,function(e){pskl.utils.FileUtils.downloadAsFile(e,this.palette.name+".gpl")}.bind(this),"application/json")},e.CreatePaletteController.prototype.onImportFileButtonClick_=function(){this.hiddenFileInput.click()},e.CreatePaletteController.prototype.onFileInputChange_=function(e){var t=this.hiddenFileInput.files;1==t.length&&this.paletteImportService.read(t[0],this.setPalette_.bind(this),this.displayErrorMessage_.bind(this))},e.CreatePaletteController.prototype.displayErrorMessage_=function(e){e="Could not import palette : "+e,$.publish(Events.SHOW_NOTIFICATION,[{content:e}]),window.setTimeout($.publish.bind($,Events.HIDE_NOTIFICATION),2e3)},e.CreatePaletteController.prototype.onNameInputChange_=function(e){this.palette.name=pskl.utils.escapeHtml(this.nameInput.value)}})(),(()=>{var e=$.namespace("pskl.controller.dialogs");e.BrowseLocalController=function(e){},pskl.utils.inherit(e.BrowseLocalController,e.AbstractDialogController),e.BrowseLocalController.prototype.init=function(){this.superclass.init.call(this),this.localStorageItemTemplate_=pskl.utils.Template.get("local-storage-item-template"),this.service_=pskl.app.indexedDbStorageService,this.piskelList=document.querySelector(".local-piskel-list"),this.fillLocalPiskelsList_(),this.piskelList.addEventListener("click",this.onPiskelsListClick_.bind(this))},e.BrowseLocalController.prototype.onPiskelsListClick_=function(e){var t=e.target.getAttribute("data-action"),e=e.target.getAttribute("data-name");"load"===t?window.confirm("This will erase your current piskel. Continue ?")&&(this.service_.load(e),this.closeDialog()):"delete"===t&&window.confirm("This will permanently DELETE this piskel from your computer. Continue ?")&&(this.service_.remove(e),this.fillLocalPiskelsList_())},e.BrowseLocalController.prototype.fillLocalPiskelsList_=function(){this.service_.getKeys().then(function(e){var r="";e.sort(function(e,t){return e.date<t.date?1:t.date<e.date?-1:0}),e.forEach(function(e){var t=pskl.utils.DateUtils.format(e.date,"{{Y}}/{{M}}/{{D}} {{H}}:{{m}}");r+=pskl.utils.Template.replace(this.localStorageItemTemplate_,{name:e.name,date:t})}.bind(this)),this.piskelList.tBodies[0].innerHTML=r}.bind(this))}})(),(()=>{var e=$.namespace("pskl.controller.dialogs"),n="cheatsheet-shortcut-editing";e.CheatsheetController=function(){},pskl.utils.inherit(e.CheatsheetController,e.AbstractDialogController),e.CheatsheetController.prototype.init=function(){this.superclass.init.call(this),this.cheatsheetEl=document.getElementById("cheatsheetContainer"),this.eventTrapInput=document.getElementById("cheatsheetEventTrap"),this.addEventListener(".cheatsheet-restore-defaults","click",this.onRestoreDefaultsClick_),this.addEventListener(this.cheatsheetEl,"click",this.onCheatsheetClick_),this.addEventListener(this.eventTrapInput,"keydown",this.onEventTrapKeydown_),this.onShortcutsChanged_=this.onShortcutsChanged_.bind(this),$.subscribe(Events.SHORTCUTS_CHANGED,this.onShortcutsChanged_),this.initMarkup_(),document.querySelector(".cheatsheet-helptext").setAttribute("title",this.getHelptextTitle_())},e.CheatsheetController.prototype.destroy=function(){this.eventTrapInput.blur(),$.unsubscribe(Events.SHORTCUTS_CHANGED,this.onShortcutsChanged_),this.cheatsheetEl=null,this.superclass.destroy.call(this)},e.CheatsheetController.prototype.onRestoreDefaultsClick_=function(){window.confirm("Replace all custom shortcuts by the default Piskel shortcuts ?")&&pskl.app.shortcutService.restoreDefaultShortcuts()},e.CheatsheetController.prototype.onShortcutsChanged_=function(){this.initMarkup_()},e.CheatsheetController.prototype.onCheatsheetClick_=function(e){var t,e=pskl.utils.Dom.getParentWithData(e.target,"shortcutId");e?(t=e.dataset.shortcutId,t=pskl.app.shortcutService.getShortcutById(t),e.classList.contains(n)?(pskl.utils.Dom.removeClass(n),this.eventTrapInput.blur()):t.isEditable()&&(pskl.utils.Dom.removeClass(n),e.classList.add(n),this.eventTrapInput.focus())):pskl.utils.Dom.removeClass(n)},e.CheatsheetController.prototype.onEventTrapKeydown_=function(e){var t,r,i=document.querySelector("."+n);i&&(t=pskl.service.keyboard.KeyUtils.createKeyFromEvent(e))&&(t=pskl.service.keyboard.KeyUtils.stringify(t),r=i.dataset.shortcutId,r=pskl.app.shortcutService.getShortcutById(r),pskl.app.shortcutService.updateShortcut(r,t),i.classList.remove(n),this.eventTrapInput.blur(),e.preventDefault())},e.CheatsheetController.prototype.initMarkup_=function(){this.initMarkupForCategory_("TOOL",".cheatsheet-tool-shortcuts",this.getToolIconClass_),this.initMarkupForCategory_("MISC",".cheatsheet-misc-shortcuts"),this.initMarkupForCategory_("COLOR",".cheatsheet-color-shortcuts"),this.initMarkupForCategory_("SELECTION",".cheatsheet-selection-shortcuts"),this.initMarkupForCategory_("STORAGE",".cheatsheet-storage-shortcuts")},e.CheatsheetController.prototype.getToolIconClass_=function(e){return"tool-icon cheatsheet-icon-"+e.getId()},e.CheatsheetController.prototype.initMarkupForCategory_=function(e,t,r){var i=pskl.service.keyboard.Shortcuts[e],e=Object.keys(i).map(function(e){return this.toDescriptor_(i[e],r)}.bind(this));this.initMarkupForDescriptors_(e,t)},e.CheatsheetController.prototype.toDescriptor_=function(e,t){return{shortcut:e,iconClass:"function"==typeof t?t(e):""}},e.CheatsheetController.prototype.initMarkupForDescriptors_=function(e,t){t=document.querySelector(t);t&&(e=e.map(this.getMarkupForDescriptor_.bind(this)),t.innerHTML=e.join(""))},e.CheatsheetController.prototype.getMarkupForDescriptor_=function(e){var t=pskl.utils.Template.get("cheatsheet-shortcut-template"),r=e.shortcut,i=r.isCustom()?r.getDescription()+" *":r.getDescription(),n=[],o=(r.isUndefined()&&n.push("cheatsheet-shortcut-undefined"),r.isEditable()&&n.push("cheatsheet-shortcut-editable"),r.isEditable()?"Click to edit the key":"Shortcut cannot be remapped");return pskl.utils.Template.replace(t,{id:r.getId(),title:o,icon:e.iconClass,description:i,"!key!":this.formatKey_(r.getDisplayKey()),className:n.join(" ")})},e.CheatsheetController.prototype.formatKey_=function(e){return e=(e=(e=(e=(e=(e=(e=(e=pskl.utils.UserAgent.isMac?(e=e.replace("ctrl","cmd")).replace("alt","option"):e).replace(/left/i,"&larr;")).replace(/up/i,"&uarr;")).replace(/right/i,"&rarr;")).replace(/down/i,"&darr;")).replace(/>/g,"&gt;")).replace(/</g,"&lt;")).replace(/([^ ])\+([^ ])/g,"$1 + $2")},e.CheatsheetController.prototype.getHelptextTitle_=function(){return'<div class="cheatsheet-helptext-tooltip">'+["Click on a shortcut to change the key.","When the shortcut blinks, press the key on your keyboard to assign it.","White shortcuts can not be edited.","Click on 'Restore default shortcuts' to erase all custom shortcuts."].reduce(function(e,t){return e+'<div class="cheatsheet-helptext-tooltip-item">'+t+"</div>"},"")+"</div>"}})(),(()=>{var e=$.namespace("pskl.controller.dialogs.backups.steps");e.SelectSession=function(e,t,r){this.piskelController=e,this.backupsController=t,this.container=r},e.SelectSession.prototype.addEventListener=function(e,t,r){pskl.utils.Event.addEventListener(e,t,r,this)},e.SelectSession.prototype.init=function(){this.addEventListener(this.container,"click",this.onContainerClick_)},e.SelectSession.prototype.onShow=function(){this.update()},e.SelectSession.prototype.update=function(){pskl.app.backupService.list().then(function(e){e=this.getMarkupForSessions_(e);this.container.querySelector(".session-list").innerHTML=e}.bind(this)).catch(function(){var e=pskl.utils.Template.get("session-list-error");this.container.querySelector(".session-list").innerHTML=e}.bind(this))},e.SelectSession.prototype.getMarkupForSessions_=function(e){var r;return 0===e.length?pskl.utils.Template.get("session-list-empty"):(r=pskl.utils.Template.get("session-list-item"),e.reduce(function(e,t){return t.id===pskl.app.sessionId?e:(t={id:t.id,name:t.name,description:t.description?"- "+t.description:"",date:pskl.utils.DateUtils.format(t.endDate,"the {{Y}}/{{M}}/{{D}} at {{H}}:{{m}}"),count:1===t.count?"1 snapshot":t.count+" snapshots"},e+pskl.utils.Template.replace(r,t))},""))},e.SelectSession.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.SelectSession.prototype.onContainerClick_=function(e){var t,r,i=e.target.dataset.sessionId;i&&("view"==(t=e.target.dataset.action)?(this.backupsController.backupsData.selectedSession=i,this.backupsController.next()):"delete"==t&&window.confirm("Are you sure you want to delete this session?")&&(e.target.closest(".session-item").classList.add("deleting"),Q.all([pskl.app.backupService.deleteSession(i),(t=500,r=Q.defer(),setTimeout(function(){r.resolve()},t),r.promise)]).then(function(){this.update()}.bind(this))))}})(),(()=>{var e=$.namespace("pskl.controller.dialogs.backups.steps");e.SessionDetails=function(e,t,r){this.piskelController=e,this.backupsController=t,this.container=r},e.SessionDetails.prototype.init=function(){this.backButton=this.container.querySelector(".back-button"),this.addEventListener(this.backButton,"click",this.onBackClick_),this.addEventListener(this.container,"click",this.onContainerClick_)},e.SessionDetails.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.SessionDetails.prototype.addEventListener=function(e,t,r){pskl.utils.Event.addEventListener(e,t,r,this)},e.SessionDetails.prototype.onShow=function(){var e=this.backupsController.backupsData.selectedSession;pskl.app.backupService.getSnapshotsBySessionId(e).then(function(e){var t=this.getMarkupForSnapshots_(e);this.container.querySelector(".snapshot-list").innerHTML=t,e.forEach(function(e){this.updateSnapshotPreview_(e)}.bind(this))}.bind(this)).catch(function(){var e=pskl.utils.Template.get("snapshot-list-error");this.container.querySelector(".snapshot-list").innerHTML=e}.bind(this))},e.SessionDetails.prototype.getMarkupForSnapshots_=function(e){var r;return 0===e.length?(console.warn("Could not retrieve snapshots for a session"),pskl.utils.Template.get("snapshot-list-empty")):(r=pskl.utils.Template.get("snapshot-list-item"),e.reduce(function(e,t){t={id:t.id,name:t.name,description:t.description?"- "+t.description:"",date:pskl.utils.DateUtils.format(t.date,"the {{Y}}/{{M}}/{{D}} at {{H}}:{{m}}"),frames:1===t.frames?"1 frame":t.frames+" frames",resolution:pskl.utils.StringUtils.formatSize(t.width,t.height),fps:t.fps};return e+pskl.utils.Template.replace(r,t)},""))},e.SessionDetails.prototype.updateSnapshotPreview_=function(r){pskl.utils.serialization.Deserializer.deserialize(JSON.parse(r.serialized),function(e){var t='.snapshot-item[data-snapshot-id="'+r.id+'"] .snapshot-preview',t=this.container.querySelector(t);t&&(e=this.getFirstFrameAsImage_(e),t.appendChild(e))}.bind(this))},e.SessionDetails.prototype.getFirstFrameAsImage_=function(e){var t=pskl.utils.LayerUtils.mergeFrameAt(e.getLayers(),0),r=60/e.width,e=Math.min(60/e.height,r);return pskl.utils.FrameUtils.toImage(t,e)},e.SessionDetails.prototype.onBackClick_=function(){this.backupsController.back(this)},e.SessionDetails.prototype.onContainerClick_=function(e){"load"==e.target.dataset.action&&window.confirm(Constants.CONFIRM_OVERWRITE)&&(e=+e.target.dataset.snapshotId,pskl.app.backupService.loadSnapshotById(e).then(function(){$.publish(Events.DIALOG_HIDE)}))}})(),(()=>{var e=$.namespace("pskl.controller.dialogs.backups"),n={SELECT_SESSION:{controller:e.steps.SelectSession,template:"backups-select-session"},SESSION_DETAILS:{controller:e.steps.SessionDetails,template:"backups-session-details"}};e.BrowseBackups=function(e,t){this.piskelController=e,this.backupsData={sessions:[],selectedSession:null}},pskl.utils.inherit(e.BrowseBackups,pskl.controller.dialogs.AbstractDialogController),e.BrowseBackups.prototype.init=function(){this.superclass.init.call(this),this.steps=this.createSteps_();var e=document.querySelector(".backups-wizard-container");this.wizard=new pskl.widgets.Wizard(this.steps,e),this.wizard.init(),this.wizard.goTo("SELECT_SESSION")},e.BrowseBackups.prototype.back=function(){this.wizard.back(),this.wizard.getCurrentStep().instance.onShow()},e.BrowseBackups.prototype.next=function(){"SELECT_SESSION"===this.wizard.getCurrentStep().name&&this.wizard.goTo("SESSION_DETAILS")},e.BrowseBackups.prototype.destroy=function(e){Object.keys(this.steps).forEach(function(e){e=this.steps[e];e.instance.destroy(),e.instance=null,e.el=null}.bind(this)),this.superclass.destroy.call(this)},e.BrowseBackups.prototype.createSteps_=function(){var i={};return Object.keys(n).forEach(function(e){var t=n[e],r=pskl.utils.Template.getAsHTML(t.template),t=new t.controller(this.piskelController,this,r);t.init(),i[e]={name:e,el:r,instance:t}}.bind(this)),i}})(),(()=>{var e=$.namespace("pskl.controller.dialogs.importwizard.steps");e.AbstractImportStep=function(e,t,r){this.piskelController=e,this.container=r,this.importController=t,this.mergeData=this.importController.mergeData},e.AbstractImportStep.prototype.init=function(){this.nextButton=this.container.querySelector(".import-next-button"),this.backButton=this.container.querySelector(".import-back-button"),this.addEventListener(this.nextButton,"click",this.onNextClick),this.addEventListener(this.backButton,"click",this.onBackClick)},e.AbstractImportStep.prototype.addEventListener=function(e,t,r){pskl.utils.Event.addEventListener(e,t,r,this)},e.AbstractImportStep.prototype.destroy=function(){this.framePickerWidget&&this.framePickerWidget.destroy(),pskl.utils.Event.removeAllEventListeners(this)},e.AbstractImportStep.prototype.onNextClick=function(){this.importController.next(this)},e.AbstractImportStep.prototype.onBackClick=function(){this.importController.back(this)},e.AbstractImportStep.prototype.onShow=function(){var e,t=this.mergeData.mergePiskel;t&&(this.framePickerWidget?this.framePickerWidget.piskel!=t&&(this.framePickerWidget.piskel=t,this.framePickerWidget.setFrameIndex(1)):(e=this.container.querySelector(".import-preview"),this.framePickerWidget=new pskl.widgets.FramePicker(t,e),this.framePickerWidget.init()),e=pskl.utils.Template.getAndReplace("import-meta-content",{name:t.getDescriptor().name,dimensions:pskl.utils.StringUtils.formatSize(t.getWidth(),t.getHeight()),frames:t.getFrameCount(),layers:t.getLayers().length}),this.container.querySelector(".import-meta").innerHTML=e)}})(),(()=>{var n=$.namespace("pskl.controller.dialogs.importwizard.steps");n.AdjustSize=function(e,t,r){this.superclass.constructor.apply(this,arguments)},n.AdjustSize.OPTIONS={KEEP:"keep",EXPAND:"expand"},pskl.utils.inherit(n.AdjustSize,n.AbstractImportStep),n.AdjustSize.prototype.init=function(){this.superclass.init.call(this);var e=this.container.querySelector(".import-resize-anchor-container");this.anchorWidget=new pskl.widgets.AnchorWidget(e,this.onAnchorChange_.bind(this)),this.anchorWidget.setOrigin("TOPLEFT"),this.resizeInfoContainer=this.container.querySelector(".import-resize-info"),this.addEventListener(this.resizeInfoContainer,"change",this.onResizeOptionChange_),this.mergeData.resize=n.AdjustSize.OPTIONS.EXPAND},n.AdjustSize.prototype.destroy=function(){this.anchorWidget.destroy(),this.superclass.destroy.call(this)},n.AdjustSize.prototype.onShow=function(){this.refresh_(),this.superclass.onShow.call(this)},n.AdjustSize.prototype.refresh_=function(){var e=this.isImportedPiskelBigger_(),t=this.mergeData.resize===n.AdjustSize.OPTIONS.KEEP,r=this.formatPiskelSize_(this.piskelController.getPiskel()),i=this.formatPiskelSize_(this.mergeData.mergePiskel),r=e?pskl.utils.Template.getAndReplace("import-resize-bigger-partial",{size:r,newSize:i,keepChecked:t?'checked="checked"':"",expandChecked:t?"":'checked="checked"'}):pskl.utils.Template.getAndReplace("import-resize-smaller-partial",{size:r,newSize:i}),i=(this.resizeInfoContainer.innerHTML=r,this.mergeData.origin&&this.anchorWidget.setOrigin(this.mergeData.origin),this.container.querySelector(".import-resize-anchor-info"));i.innerHTML=e&&t?['<div class="import-resize-warning">',"  Imported content will be cropped!","</div>","Select crop anchor:"].join(""):e?"Select resize anchor:":"Select position anchor:"},n.AdjustSize.prototype.onAnchorChange_=function(e){this.mergeData.origin=e},n.AdjustSize.prototype.onResizeOptionChange_=function(){var e=this.resizeInfoContainer.querySelector(":checked").value;this.mergeData.resize!=e&&(this.mergeData.resize=e,this.refresh_())},n.AdjustSize.prototype.isImportedPiskelBigger_=function(){var e=this.mergeData.mergePiskel;return!!e&&(e.width>this.piskelController.getWidth()||e.height>this.piskelController.getHeight())},n.AdjustSize.prototype.formatPiskelSize_=function(e){return pskl.utils.StringUtils.formatSize(e.width,e.height)}})(),(()=>{var e=$.namespace("pskl.controller.dialogs.importwizard.steps");e.ImageImport=function(e,t,r){this.superclass.constructor.apply(this,arguments),this.importedImage_=null,this.file_=null},pskl.utils.inherit(e.ImageImport,e.AbstractImportStep),e.ImageImport.prototype.init=function(e){this.superclass.init.call(this),this.file_=this.mergeData.rawFiles[0],this.importPreview=this.container.querySelector(".import-section-preview"),this.fileNameContainer=this.container.querySelector(".import-image-file-name"),this.singleImportType=this.container.querySelector("[name=import-type][value=single]"),this.sheetImportType=this.container.querySelector("[name=import-type][value=sheet]"),this.resizeWidth=this.container.querySelector("[name=resize-width]"),this.resizeHeight=this.container.querySelector("[name=resize-height]"),this.smoothResize=this.container.querySelector("[name=smooth-resize-checkbox]"),this.frameSizeX=this.container.querySelector("[name=frame-size-x]"),this.frameSizeY=this.container.querySelector("[name=frame-size-y]"),this.frameOffsetX=this.container.querySelector("[name=frame-offset-x]"),this.frameOffsetY=this.container.querySelector("[name=frame-offset-y]"),this.addEventListener(this.singleImportType,"change",this.onImportTypeChange_),this.addEventListener(this.sheetImportType,"change",this.onImportTypeChange_),this.addEventListener(this.resizeWidth,"keyup",this.onResizeInputKeyUp_),this.addEventListener(this.resizeHeight,"keyup",this.onResizeInputKeyUp_),this.addEventListener(this.frameSizeX,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameSizeY,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameOffsetX,"keyup",this.onFrameInputKeyUp_),this.addEventListener(this.frameOffsetY,"keyup",this.onFrameInputKeyUp_),pskl.utils.FileUtils.readImageFile(this.file_,this.onImageLoaded_.bind(this)),this.piskelController.isEmpty()&&(this.nextButton.textContent="import")},e.ImageImport.prototype.onNextClick=function(){this.container.classList.add("import-image-loading"),this.createPiskelFromImage().then(function(e){this.mergeData.mergePiskel=e,this.container.classList.remove("import-image-loading"),this.superclass.onNextClick.call(this)}.bind(this)).catch(function(e){console.error(e)})},e.ImageImport.prototype.onShow=function(){this.container.classList.remove("import-image-loading")},e.ImageImport.prototype.createPiskelFromImage=function(){var e=(e=this.extractFileNameFromPath_(this.file_.name)).replace(/\.[a-zA-Z]+$/,""),t=Q.defer();return pskl.app.importService.newPiskelFromImage(this.importedImage_,{importType:this.getImportType_(),frameSizeX:"single"===this.getImportType_()?this.resizeWidth.value:this.sanitizeInputValue_(this.frameSizeX,1),frameSizeY:"single"===this.getImportType_()?this.resizeHeight.value:this.sanitizeInputValue_(this.frameSizeY,1),frameOffsetX:this.sanitizeInputValue_(this.frameOffsetX,0),frameOffsetY:this.sanitizeInputValue_(this.frameOffsetY,0),smoothing:!!this.smoothResize.checked,name:e},t.resolve),t.promise},e.ImageImport.prototype.onImportTypeChange_=function(e){var t,r,i,n;"single"===this.getImportType_()?this.hideFrameGrid_():(t=this.sanitizeInputValue_(this.frameOffsetX,0),r=this.sanitizeInputValue_(this.frameOffsetY,0),i=this.sanitizeInputValue_(this.frameSizeX,1),n=this.sanitizeInputValue_(this.frameSizeY,1),this.drawFrameGrid_(t,r,i,n))},e.ImageImport.prototype.onResizeInputKeyUp_=function(e){var t=e.target.getAttribute("name");this.importedImage_&&this.synchronizeResizeFields_(e.target.value,t)},e.ImageImport.prototype.onFrameInputKeyUp_=function(e){this.importedImage_&&this.synchronizeFrameFields_(e.target.value)},e.ImageImport.prototype.synchronizeResizeFields_=function(e,t){e=parseInt(e,10),isNaN(e)&&(e=0);var r=this.importedImage_.height,i=this.importedImage_.width;this.singleImportType.checked=!0,"resize-width"===t?this.resizeHeight.value=Math.round(e*r/i):this.resizeWidth.value=Math.round(e*i/r)},e.ImageImport.prototype.synchronizeFrameFields_=function(e){e=parseInt(e,10),isNaN(e)&&(e=0);var e=this.sanitizeInputValue_(this.frameSizeX,1),t=this.sanitizeInputValue_(this.frameSizeY,1),r=this.sanitizeInputValue_(this.frameOffsetX,0),i=this.sanitizeInputValue_(this.frameOffsetY,0);this.sheetImportType.checked=!0,this.drawFrameGrid_(r,i,e,t)},e.ImageImport.prototype.sanitizeInputValue_=function(e,t){var r=parseInt(e.value,10);return r=r<=t||isNaN(r)?e.value=t:r},e.ImageImport.prototype.getImportType_=function(){if(this.singleImportType.checked)return this.singleImportType.value;if(this.sheetImportType.checked)return this.sheetImportType.value;throw"Could not find the currently selected import type"},e.ImageImport.prototype.onImageLoaded_=function(e){this.importedImage_=e;var e=this.importedImage_.width,t=this.importedImage_.height,r=(this.importedImage_.onload=function(){},this.extractFileNameFromPath_(this.file_.name));this.fileNameContainer.textContent=r,this.fileNameContainer.setAttribute("title",r),this.resizeWidth.value=e,this.resizeHeight.value=t,this.frameSizeX.value=e,this.frameSizeY.value=t,this.frameOffsetX.value=0,this.frameOffsetY.value=0,this.importPreview.innerHTML="",this.importPreview.appendChild(this.createImagePreview_())},e.ImageImport.prototype.createImagePreview_=function(){var e=document.createElement("IMG");return e.src=this.importedImage_.src,e},e.ImageImport.prototype.extractFileNameFromPath_=function(e){var t=[];return(t=-1!==e.indexOf("/")?e.split("/"):-1!==e.indexOf("\\")?e.split("\\"):[e])[t.length-1]},e.ImageImport.prototype.drawFrameGrid_=function(e,t,r,i){if(this.importedImage_){var n=this.importedImage_.width,o=this.importedImage_.height,s=this.importPreview.querySelector("img"),a=s.offsetWidth,s=s.offsetHeight,l=this.importPreview.querySelector("canvas"),c=(l||(l=pskl.utils.CanvasUtils.createCanvas(a+1,s+1),this.importPreview.appendChild(l)),l.getContext("2d")),p=(c.clearRect(0,0,l.width,l.height),c.beginPath(),Math.floor((n-e)/r)),h=Math.floor((o-t)/i);if(0<p&&0<h){for(var u=a/n,d=s/o,f=p*r+e,g=h*i+t,m=e+.5;m<f+1&&m<n+1;m+=r)c.moveTo(m*u,t*d),c.lineTo(m*u,g*d);for(var y=t+.5;y<g+1&&y<o+1;y+=i)c.moveTo(e*u,y*d),c.lineTo(f*u,y*d);c.lineWidth=1,c.strokeStyle="gold",c.stroke(),l.style.display="block"}else this.hideFrameGrid_()}},e.ImageImport.prototype.hideFrameGrid_=function(){var e=this.importPreview.querySelector("canvas");e&&(e.style.display="none")}})(),(()=>{var t=$.namespace("pskl.controller.dialogs.importwizard.steps");t.InsertLocation=function(){this.superclass.constructor.apply(this,arguments)},t.InsertLocation.MODES={ADD:"add",INSERT:"insert"},pskl.utils.inherit(t.InsertLocation,t.AbstractImportStep),t.InsertLocation.prototype.init=function(){this.superclass.init.call(this),this.framePreview=this.container.querySelector(".insert-frame-preview"),this.currentPiskelFramePickerWidget=new pskl.widgets.FramePicker(this.piskelController.getPiskel(),this.framePreview),this.insertModeContainer=this.container.querySelector(".insert-mode-container"),this.addEventListener(this.insertModeContainer,"change",this.onInsertModeChange_),this.mergeData.insertMode=t.InsertLocation.MODES.ADD},t.InsertLocation.prototype.onInsertModeChange_=function(){var e=this.insertModeContainer.querySelector(":checked").value;this.mergeData.insertMode=e,this.mergeData.insertMode===t.InsertLocation.MODES.ADD?this.currentPiskelFramePickerWidget.setFirstFrameIndex(0):this.currentPiskelFramePickerWidget.setFirstFrameIndex(1)},t.InsertLocation.prototype.onShow=function(){this.currentPiskelFramePickerWidget.init();var e=this.piskelController.getCurrentFrameIndex();this.currentPiskelFramePickerWidget.setFrameIndex(e+1),this.currentPiskelFramePickerWidget.setFirstFrameIndex(0),this.superclass.onShow.call(this)},t.InsertLocation.prototype.onNextClick=function(){var e=this.currentPiskelFramePickerWidget.getFrameIndex();this.mergeData.insertIndex=e,this.superclass.onNextClick.call(this)},t.InsertLocation.prototype.destroy=function(){this.currentPiskelFramePickerWidget.destroy(),this.superclass.destroy.call(this)}})(),(()=>{var e=$.namespace("pskl.controller.dialogs.importwizard.steps");e.SelectMode=function(e,t,r){this.superclass.constructor.apply(this,arguments)},e.SelectMode.MODES={REPLACE:"replace",MERGE:"merge"},pskl.utils.inherit(e.SelectMode,e.AbstractImportStep),e.SelectMode.prototype.init=function(){this.superclass.init.call(this);var e=this.container.querySelector(".import-mode-replace-button"),t=this.container.querySelector(".import-mode-merge-button");this.addEventListener(e,"click",this.onReplaceButtonClick_),this.addEventListener(t,"click",this.onMergeButtonClick_)},e.SelectMode.prototype.onShow=function(){this.superclass.onShow.call(this)},e.SelectMode.prototype.destroy=function(){this.superclass.destroy.call(this)},e.SelectMode.prototype.onReplaceButtonClick_=function(){this.mergeData.importMode=e.SelectMode.MODES.REPLACE,this.onNextClick()},e.SelectMode.prototype.onMergeButtonClick_=function(){this.mergeData.importMode=e.SelectMode.MODES.MERGE,this.onNextClick()}})(),(()=>{var r=$.namespace("pskl.controller.dialogs.importwizard"),o={IMAGE_IMPORT:{controller:r.steps.ImageImport,template:"import-image-import"},ADJUST_SIZE:{controller:r.steps.AdjustSize,template:"import-adjust-size"},INSERT_LOCATION:{controller:r.steps.InsertLocation,template:"import-insert-location"},SELECT_MODE:{controller:r.steps.SelectMode,template:"import-select-mode"}};r.ImportWizard=function(e,t){this.piskelController=e,this.mergeData={rawFiles:[],mergePiskel:null,origin:null,resize:null,insertIndex:null,insertMode:null}},pskl.utils.inherit(r.ImportWizard,pskl.controller.dialogs.AbstractDialogController),r.ImportWizard.prototype.init=function(e){this.superclass.init.call(this),this.mergeData.rawFiles=e.rawFiles,this.steps=this.createSteps_();e=document.querySelector(".import-wizard-container");this.wizard=new pskl.widgets.Wizard(this.steps,e),this.wizard.init(),this.hasSingleImage_()?this.wizard.goTo("IMAGE_IMPORT"):this.hasSinglePiskelFile_()?pskl.utils.PiskelFileUtils.loadFromFile(this.mergeData.rawFiles[0],function(e){this.mergeData.mergePiskel=e,this.wizard.goTo("SELECT_MODE")}.bind(this),function(e){this.closeDialog(),$.publish(Events.PISKEL_FILE_IMPORT_FAILED,[e])}.bind(this)):(console.error("Unsupported import. Only single piskel or single image are supported at the moment."),this.closeDialog())},r.ImportWizard.prototype.back=function(){this.wizard.back(),this.wizard.getCurrentStep().instance.onShow()},r.ImportWizard.prototype.next=function(){var e=this.wizard.getCurrentStep();"IMAGE_IMPORT"===e.name?this.piskelController.isEmpty()?(this.mergeData.importMode=r.steps.SelectMode.MODES.REPLACE,this.finalizeImport_()):this.wizard.goTo("SELECT_MODE"):"SELECT_MODE"===e.name?this.mergeData.importMode===r.steps.SelectMode.MODES.REPLACE?this.finalizeImport_():this.hasSameSize_()?this.wizard.goTo("INSERT_LOCATION"):this.wizard.goTo("ADJUST_SIZE"):"ADJUST_SIZE"===e.name?this.wizard.goTo("INSERT_LOCATION"):"INSERT_LOCATION"===e.name&&this.finalizeImport_()},r.ImportWizard.prototype.destroy=function(e){Object.keys(this.steps).forEach(function(e){e=this.steps[e];e.instance.destroy(),e.instance=null,e.el=null}.bind(this)),this.superclass.destroy.call(this)},r.ImportWizard.prototype.createSteps_=function(){var i=this.hasSingleImage_(),n={};return Object.keys(o).forEach(function(e){var t,r;"IMAGE_IMPORT"===e&&!i||(r=o[e],t=pskl.utils.Template.getAsHTML(r.template),(r=new r.controller(this.piskelController,this,t)).init(),n[e]={name:e,el:t,instance:r})}.bind(this)),(i?n.IMAGE_IMPORT:n.SELECT_MODE).el.classList.add("import-first-step"),n},r.ImportWizard.prototype.finalizeImport_=function(){var e=this.mergeData.mergePiskel,t=this.mergeData.importMode;t===r.steps.SelectMode.MODES.REPLACE?window.confirm(Constants.CONFIRM_OVERWRITE)&&(this.piskelController.setPiskel(e),this.closeDialog()):t===r.steps.SelectMode.MODES.MERGE&&(t=pskl.utils.MergeUtils.merge(this.piskelController.getPiskel(),e,{insertIndex:this.mergeData.insertIndex,insertMode:this.mergeData.insertMode,origin:this.mergeData.origin,resize:this.mergeData.resize}),this.piskelController.setPiskel(t),t=e.getLayers().length,e=this.piskelController.getLayers().length,this.piskelController.setCurrentLayerIndex(e-t),this.closeDialog())},r.ImportWizard.prototype.hasSameSize_=function(){var e=this.mergeData.mergePiskel;return!!e&&e.width===this.piskelController.getWidth()&&e.height===this.piskelController.getHeight()},r.ImportWizard.prototype.hasSingleImage_=function(){return 1===this.mergeData.rawFiles.length&&0===this.mergeData.rawFiles[0].type.indexOf("image")},r.ImportWizard.prototype.hasSinglePiskelFile_=function(){var e;return 1===this.mergeData.rawFiles.length&&(e=this.mergeData.rawFiles[0],/\.piskel$/.test(e.name))}})(),(()=>{var e=$.namespace("pskl.controller.dialogs");e.PerformanceInfoController=function(){},pskl.utils.inherit(e.PerformanceInfoController,e.AbstractDialogController),e.PerformanceInfoController.prototype.init=function(){this.superclass.init.call(this)}})(),(()=>{var e=$.namespace("pskl.controller.dialogs");e.UnsupportedBrowserController=function(){},pskl.utils.inherit(e.UnsupportedBrowserController,e.AbstractDialogController),e.UnsupportedBrowserController.prototype.init=function(){this.superclass.init.call(this),document.querySelector("#current-user-agent").innerText=pskl.utils.UserAgent.getDisplayName()}})(),(()=>{var e=$.namespace("pskl.controller.dialogs"),i={cheatsheet:{template:"templates/dialogs/cheatsheet.html",controller:e.CheatsheetController},"create-palette":{template:"templates/dialogs/create-palette.html",controller:e.CreatePaletteController},"browse-local":{template:"templates/dialogs/browse-local.html",controller:e.BrowseLocalController},import:{template:"templates/dialogs/import.html",controller:e.importwizard.ImportWizard},"performance-info":{template:"templates/dialogs/performance-info.html",controller:e.PerformanceInfoController},"unsupported-browser":{template:"templates/dialogs/unsupported-browser.html",controller:e.UnsupportedBrowserController},"browse-backups":{template:"templates/dialogs/browse-backups.html",controller:e.backups.BrowseBackups}};e.DialogsController=function(e){this.piskelController=e,this.closePopupShortcut=pskl.service.keyboard.Shortcuts.MISC.CLOSE_POPUP,this.currentDialog_=null},e.DialogsController.prototype.init=function(){this.dialogContainer_=document.getElementById("dialog-container"),this.dialogWrapper_=document.getElementById("dialog-container-wrapper"),$.subscribe(Events.DIALOG_SHOW,this.onDialogDisplayEvent_.bind(this)),$.subscribe(Events.DIALOG_HIDE,this.hideDialog.bind(this));var e=pskl.service.keyboard.Shortcuts.COLOR.CREATE_PALETTE,e=(pskl.app.shortcutService.registerShortcut(e,this.onCreatePaletteShortcut_.bind(this)),pskl.service.keyboard.Shortcuts.MISC.CHEATSHEET);pskl.app.shortcutService.registerShortcut(e,this.onCheatsheetShortcut_.bind(this)),pskl.utils.Event.addEventListener(".cheatsheet-link","click",this.onCheatsheetShortcut_,this),this.dialogWrapper_.classList.add("animated"),pskl.utils.Event.addEventListener(this.dialogWrapper_,"click",this.onWrapperClicked_,this)},e.DialogsController.prototype.onCreatePaletteShortcut_=function(){this.toggleDialog_("create-palette")},e.DialogsController.prototype.onCheatsheetShortcut_=function(){this.toggleDialog_("cheatsheet")},e.DialogsController.prototype.toggleDialog_=function(e){this.isDisplayingDialog_()?this.getCurrentDialogId_()===e&&this.hideDialog():this.showDialog(e)},e.DialogsController.prototype.onDialogDisplayEvent_=function(e,t){this.showDialog(t.dialogId,t.initArgs)},e.DialogsController.prototype.onWrapperClicked_=function(e){e.target===this.dialogWrapper_&&this.hideDialog()},e.DialogsController.prototype.showDialog=function(e,t){var r;this.isDisplayingDialog_()||((r=i[e])?(this.dialogContainer_.classList.add(e),this.dialogContainer_.innerHTML=pskl.utils.Template.get(r.template),(r=new r.controller(this.piskelController)).init(t),this.currentDialog_={id:e,controller:r},pskl.app.shortcutService.registerShortcut(this.closePopupShortcut,this.hideDialog.bind(this)),this.dialogWrapper_.classList.add("show")):console.error("Could not find dialog configuration for dialogId : "+e))},e.DialogsController.prototype.hideDialog=function(){!this.isHiding_&&this.isDisplayingDialog_()&&(pskl.app.shortcutService.unregisterShortcut(this.closePopupShortcut),this.dialogWrapper_.classList.remove("show"),window.setTimeout(this.cleanupDialogContainer_.bind(this),500),this.isHiding_=!0)},e.DialogsController.prototype.cleanupDialogContainer_=function(){this.dialogContainer_.classList.remove(this.currentDialog_.id),this.currentDialog_.controller.destroy(),this.currentDialog_=null,this.dialogContainer_.innerHTML="",this.isHiding_=!1},e.DialogsController.prototype.isDisplayingDialog_=function(){return null!==this.currentDialog_},e.DialogsController.prototype.getCurrentDialogId_=function(){return this.currentDialog_?this.currentDialog_.id:null}})(),(()=>{var t=$.namespace("pskl.widgets"),i="anchor-option";t.AnchorWidget=function(e,t){this.onChangeCallback=t,this.wrapper=document.createElement("div"),this.wrapper.classList.add("anchor-wrapper"),this.wrapper.innerHTML='<div class="anchor-option"  title="top left"      data-origin="TOPLEFT"></div><div class="anchor-option"  title="top"           data-origin="TOP"></div><div class="anchor-option"  title="top right"     data-origin="TOPRIGHT"></div><div class="anchor-option"  title="middle left"   data-origin="MIDDLELEFT"></div><div class="anchor-option"  title="middle"        data-origin="MIDDLE"></div><div class="anchor-option"  title="middle right"  data-origin="MIDDLERIGHT"></div><div class="anchor-option"  title="bottom left"   data-origin="BOTTOMLEFT"></div><div class="anchor-option"  title="bottom"        data-origin="BOTTOM"></div><div class="anchor-option"  title="bottom right"  data-origin="BOTTOMRIGHT"></div>',e.innerHTML="",e.appendChild(this.wrapper),this.disabled=!1,pskl.utils.Event.addEventListener(this.wrapper,"click",this.onResizeOriginClick_,this)},t.AnchorWidget.ORIGIN={TOPLEFT:"TOPLEFT",TOP:"TOP",TOPRIGHT:"TOPRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLE:"MIDDLE",MIDDLERIGHT:"MIDDLERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOM:"BOTTOM",BOTTOMRIGHT:"BOTTOMRIGHT"},t.AnchorWidget.prototype.destroy=function(e){pskl.utils.Event.removeAllEventListeners(this),this.wrapper=null},t.AnchorWidget.prototype.onResizeOriginClick_=function(e){e=e.target.dataset.origin;e&&t.AnchorWidget.ORIGIN[e]&&!this.disabled&&this.setOrigin(e)},t.AnchorWidget.prototype.setOrigin=function(e){this.origin=e;var t=this.wrapper.querySelector("."+i+".selected"),t=(t&&t.classList.remove("selected"),this.wrapper.querySelector("."+i+'[data-origin="'+e+'"]'));t&&(t.classList.add("selected"),this.refreshNeighbors_(t)),"function"==typeof this.onChangeCallback&&this.onChangeCallback(e)},t.AnchorWidget.prototype.getOrigin=function(){return this.origin},t.AnchorWidget.prototype.disable=function(){this.disabled=!0,this.wrapper.classList.add("transition"),this.wrapper.classList.add("disabled")},t.AnchorWidget.prototype.enable=function(){this.disabled=!1,this.wrapper.classList.remove("disabled"),window.setTimeout(this.wrapper.classList.remove.bind(this.wrapper.classList,"transition"),250)},t.AnchorWidget.prototype.refreshNeighbors_=function(e){for(var t=this.wrapper.querySelectorAll("."+i),r=0;r<t.length;r++)t[r].removeAttribute("data-neighbor");e=Array.prototype.indexOf.call(t,e);this.setNeighborhood_(t[e-1],"left"),this.setNeighborhood_(t[e+1],"right"),this.setNeighborhood_(t[e-3],"top"),this.setNeighborhood_(t[e+3],"bottom")},t.AnchorWidget.prototype.setNeighborhood_=function(e,t){-1===this.origin.toLowerCase().indexOf(t)&&e.setAttribute("data-neighbor",t)}})(),(()=>{var e=$.namespace("pskl.widgets");e.ColorsList=function(e){this.selectedIndex=-1,this.palette=new pskl.model.Palette("tmp","tmp",[]),this.container=e,this.colorsList=this.container.querySelector(".colors-list"),this.colorPreviewEl=this.container.querySelector(".color-preview"),$(e).sortable({placeholder:"colors-list-drop-proxy",update:this.onColorDrop_.bind(this),items:".create-palette-color"}),pskl.utils.Event.addEventListener(this.colorsList,"click",this.onColorContainerClick_,this);e=e.querySelector(".color-picker-container");this.hslRgbColorPicker=new pskl.widgets.HslRgbColorPicker(e,this.onColorUpdated_.bind(this)),this.hslRgbColorPicker.init()},e.ColorsList.prototype.setColors=function(e){0===e.length&&e.push("#000000"),this.palette.setColors(e),this.selectColor_(0),this.refresh_()},e.ColorsList.prototype.getColors=function(){return this.palette.getColors()},e.ColorsList.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),$(this.container).sortable("destroy"),this.hslRgbColorPicker.destroy(),this.container=null,this.colorsList=null,this.colorPreviewEl=null},e.ColorsList.prototype.refreshColorElement_=function(e){var t=this.palette.get(this.selectedIndex),e=document.querySelector('[data-palette-index="'+e+'"]');e&&(e.style.background=t,e.classList.toggle("light-color",this.isLight_(t)))},e.ColorsList.prototype.onColorContainerClick_=function(e){var t=e.target;t.classList.contains("create-palette-color")?this.onPaletteColorClick_(e,t):t.classList.contains("create-palette-new-color")?this.onNewColorClick_(e,t):t.classList.contains("create-palette-remove-color")&&this.onRemoveColorClick_(e,t),this.refresh_()},e.ColorsList.prototype.onColorUpdated_=function(e){e=e.toHexString();this.colorPreviewEl.style.background=e,this.palette&&(this.palette.set(this.selectedIndex,e),this.refreshColorElement_(this.selectedIndex))},e.ColorsList.prototype.onPaletteColorClick_=function(e,t){t=parseInt(t.dataset.paletteIndex,10);this.selectColor_(t)},e.ColorsList.prototype.onRemoveColorClick_=function(e,t){t=t.parentNode,t=parseInt(t.dataset.paletteIndex,10);this.removeColor_(t)},e.ColorsList.prototype.onNewColorClick_=function(e,t){var r=this.palette.get(this.selectedIndex)||"#000000";this.palette.add(r),this.selectColor_(this.palette.size()-1)},e.ColorsList.prototype.refresh_=function(){var i="",n=pskl.utils.Template.get("create-palette-color-template");this.palette.getColors().forEach(function(e,t){var r=t===this.selectedIndex;i+=pskl.utils.Template.replace(n,{color:e,index:t,":selected":r,":light-color":this.isLight_(e)})}.bind(this)),i+='<li class="create-palette-new-color">+</li>',this.colorsList.innerHTML=i},e.ColorsList.prototype.selectColor_=function(e){this.selectedIndex=e,this.hslRgbColorPicker.setColor(this.palette.get(e))},e.ColorsList.prototype.removeColor_=function(e){this.palette.removeAt(e),this.refresh_()},e.ColorsList.prototype.isLight_=function(e){e=window.tinycolor(e).toRgb();return 384<e.r+e.b+e.g},e.ColorsList.prototype.onColorDrop_=function(e,t){var t=t.item.get(0),r=parseInt(t.dataset.paletteIndex,10),i=document.querySelectorAll(".create-palette-color"),i=Array.prototype.indexOf.call(i,t);this.palette.move(r,i),this.selectedIndex=i,this.refresh_()}})(),(()=>{var e=$.namespace("pskl.widgets");e.FramePicker=function(e,t){this.piskel=e,this.container=t,this.firstFrameIndex=1,this.wrapper=document.createElement("div"),this.wrapper.innerHTML='<div class="frame-viewer"></div><div class="frame-nav"><button class="button frame-nav-first">&lt;&lt;</button><button class="button frame-nav-previous">&lt;</button><input class="textfield frame-nav-input" type="text"><button class="button frame-nav-next">&gt;</button><button class="button frame-nav-last">&gt;&gt;</button></div>',this.wrapper.classList.add("frame-picker-wrapper"),this.frameViewer=this.wrapper.querySelector(".frame-viewer"),this.firstButton=this.wrapper.querySelector(".frame-nav-first"),this.previousButton=this.wrapper.querySelector(".frame-nav-previous"),this.nextButton=this.wrapper.querySelector(".frame-nav-next"),this.lastButton=this.wrapper.querySelector(".frame-nav-last"),this.input=this.wrapper.querySelector(".frame-nav-input")},e.FramePicker.prototype.init=function(){this.container.appendChild(this.wrapper),this.addEventListener(this.firstButton,"click",this.onFirstClicked_),this.addEventListener(this.previousButton,"click",this.onPreviousClicked_),this.addEventListener(this.nextButton,"click",this.onNextClicked_),this.addEventListener(this.lastButton,"click",this.onLastClicked_),this.addEventListener(this.input,"change",this.onInputChange_),this.setFrameIndex(1)},e.FramePicker.prototype.setFirstFrameIndex=function(e){this.firstFrameIndex=e,this.setFrameIndex(this.currentFrameIndex)},e.FramePicker.prototype.destroy=function(){this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),pskl.utils.Event.removeAllEventListeners(this)},e.FramePicker.prototype.onFirstClicked_=function(){this.setFrameIndex(this.firstFrameIndex)},e.FramePicker.prototype.onPreviousClicked_=function(){this.setFrameIndex(this.currentFrameIndex-1)},e.FramePicker.prototype.onNextClicked_=function(){this.setFrameIndex(this.currentFrameIndex+1)},e.FramePicker.prototype.onLastClicked_=function(){this.setFrameIndex(this.piskel.getFrameCount())},e.FramePicker.prototype.onInputChange_=function(){var e=parseInt(this.input.value,10);isNaN(e)?this.input.value=1:(e=Math.max(this.firstFrameIndex,e),(e=Math.min(this.getFrameCount_(),e))!==this.currentFrameIndex&&this.setFrameIndex(e))},e.FramePicker.prototype.getFrameCount_=function(){return this.piskel.getLayerAt(0).getFrames().length},e.FramePicker.prototype.addEventListener=function(e,t,r){pskl.utils.Event.addEventListener(e,t,r,this)},e.FramePicker.prototype.getFrameIndex=function(){return this.currentFrameIndex},e.FramePicker.prototype.setFrameIndex=function(e){e=Math.max(this.firstFrameIndex,e),e=Math.min(this.getFrameCount_(),e),this.currentFrameIndex=e,this.input.value=e;var t=this.getFrameAsImage_(e),t=(t.classList.add("canvas-background"),this.frameViewer.innerHTML="",this.frameViewer.appendChild(t),this.getFrameCount_());this.setEnabled_(this.firstButton,e!==this.firstFrameIndex),this.setEnabled_(this.previousButton,e!==this.firstFrameIndex),this.setEnabled_(this.nextButton,e!==t),this.setEnabled_(this.lastButton,e!==t),0===e&&(this.previousButton.setAttribute("disabled",!0),this.firstButton.setAttribute("disabled",!0))},e.FramePicker.prototype.getFrameAsImage_=function(e){var t;return 0===e?new Image:(e=pskl.utils.LayerUtils.mergeFrameAt(this.piskel.getLayers(),e-1),t=this.getZoomLevel_(),pskl.utils.FrameUtils.toImage(e,t))},e.FramePicker.prototype.getZoomLevel_=function(){var e=this.frameViewer.offsetWidth,t=this.frameViewer.offsetHeight,e=e/this.piskel.width,t=t/this.piskel.height;return Math.min(t,e)},e.FramePicker.prototype.setEnabled_=function(e,t){t?e.removeAttribute("disabled"):e.setAttribute("disabled",!0)}})(),(()=>{var e=$.namespace("pskl.widgets");e.HslRgbColorPicker=function(e,t){this.container=e,this.colorUpdatedCallback=t,this.tinyColor=null,this.hsvColor=null,this.rgbColor=null,this.lastInputTimestamp_=0},e.HslRgbColorPicker.prototype.init=function(){var e=pskl.utils.UserAgent.isFirefox,t=pskl.utils.UserAgent.isChrome;pskl.utils.Event.addEventListener(this.container,t||e?"input":"change",this.onPickerChange_,this),pskl.utils.Event.addEventListener(this.container,"keydown",this.onPickerChange_,this),this.onBlur_=this.onBlur_.bind(this),this.container.addEventListener("blur",this.onBlur_,!0),this.spectrumEl=this.container.querySelector(".color-picker-spectrum"),$(this.spectrumEl).spectrum({flat:!0,showButtons:!1,move:this.setColor.bind(this),change:this.setColor.bind(this)}),this.setColor("#000000")},e.HslRgbColorPicker.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.container.removeEventListener("blur",this.onBlur_,!0),$(this.spectrumEl).spectrum("destroy"),this.container=null,this.spectrumEl=null},e.HslRgbColorPicker.prototype.onPickerChange_=function(e){var t,r,e=e.target;e.dataset.dimension&&(t=e.dataset.model,r=e.dataset.dimension,e=e.value,this.updateColor_(e,t,r))},e.HslRgbColorPicker.prototype.onKeydown_=function(e){var t,r,i=e.target;"text"!==i.getAttribute("type").toLowerCase()||!i.dataset.dimension||"rgb"!==(t=i.dataset.model)&&"hsv"!==t||(e=this.getIncrement_(e))&&(r=i.dataset.dimension,i=parseInt(i.value,10),this.updateColor_(i+e,t,r))},e.HslRgbColorPicker.prototype.getIncrement_=function(e){var t=0,r=pskl.service.keyboard.KeycodeTranslator.toChar(e.keyCode);return"up"===r?t=1:"down"===r&&(t=-1),e.shiftKey&&(t*=5),t},e.HslRgbColorPicker.prototype.updateColor_=function(e,t,r){var i,e=this.toModelValue_(e,t,r);"hsv"===t||"rgb"===t?isNaN(e)||((i=this.getColor_(t))[r]=this.normalizeDimension_(e,r),this.setColor(i)):"hex"===t&&/^#([a-f0-9]{3}){1,2}$/i.test(e)&&this.setColor(e)},e.HslRgbColorPicker.prototype.onBlur_=function(e){var t,r,e=e.target;"text"===e.getAttribute("type").toLowerCase()&&e.dataset.dimension&&(t=e.dataset.model,r=e.dataset.dimension,e.value=this.toInputValue_(t,r))},e.HslRgbColorPicker.prototype.setColor=function(e){this.unplugged||(this.unplugged=!0,this.hsvColor=this.toHsvColor_(e),this.tinyColor=this.toTinyColor_(e),this.rgbColor=this.tinyColor.toRgb(),this.updateInputs(),$(".color-picker-spectrum").spectrum("set",this.tinyColor),this.colorUpdatedCallback(this.tinyColor),this.unplugged=!1)},e.HslRgbColorPicker.prototype.updateInputs=function(){for(var e=this.container.querySelectorAll("input"),t=0;t<e.length;t++){var r=e[t],i=r.dataset.dimension,n=r.dataset.model,n=this.toInputValue_(n,i);r.value!=n&&(r.value=n),"range"===r.getAttribute("type")&&this.updateSliderBackground(r)}},e.HslRgbColorPicker.prototype.toInputValue_=function(e,t){var r;return"rgb"===e||"hsv"===e?(r=this.getColor_(e)[t],"v"!==t&&"s"!==t||(r*=100),r=Math.round(r)):"hex"===e&&(r=this.tinyColor.toHexString(!0)),r},e.HslRgbColorPicker.prototype.toModelValue_=function(e,t,r){var i;return"rgb"===t||"hsv"===t?(i=parseInt(e,10),"v"!==r&&"s"!==r||(i/=100)):"hex"===t&&(i=e),i},e.HslRgbColorPicker.prototype.toTinyColor_=function(e){return"object"==typeof e&&e.hasOwnProperty("_tc_id")?e:window.tinycolor(pskl.utils.copy(e))},e.HslRgbColorPicker.prototype.toHsvColor_=function(e){return["h","s","v"].every(e.hasOwnProperty.bind(e))?{h:this.normalizeDimension_(e.h,"h"),s:this.normalizeDimension_(e.s,"s"),v:this.normalizeDimension_(e.v,"v")}:this.toTinyColor_(e).toHsv()},e.HslRgbColorPicker.prototype.normalizeDimension_=function(e,t){t=this.getDimensionRange_(t);return Math.max(t[0],Math.min(t[1],e))},e.HslRgbColorPicker.prototype.updateSliderBackground=function(e){var t=e.dataset.dimension,r=e.dataset.model;"h"!==t&&(r=this.getSliderBackgroundColors_(r,t),e.style.backgroundImage="linear-gradient(to right, "+r.start+" 0, "+r.end+" 100%)")},e.HslRgbColorPicker.prototype.getSliderBackgroundColors_=function(e,t){var e=this.getColor_(e),r=pskl.utils.copy(e),e=pskl.utils.copy(e),i=this.getDimensionRange_(t);return r[t]=i[0],e[t]=i[1],{start:window.tinycolor(r).toRgbString(),end:window.tinycolor(e).toRgbString()}},e.HslRgbColorPicker.prototype.getDimensionRange_=function(e){return"h"===e?[0,359]:"s"===e||"v"===e?[0,1]:"r"===e||"g"===e||"b"===e?[0,255]:void 0},e.HslRgbColorPicker.prototype.getColor_=function(e){var t;return"hsv"===e?t=this.hsvColor:"rgb"===e&&(t=this.rgbColor),t}})(),(()=>{var t=$.namespace("pskl.widgets");t.SizeInput=function(e){this.widthInput=e.widthInput,this.heightInput=e.heightInput,this.initWidth=e.initWidth,this.initHeight=e.initHeight,this.onChange=e.onChange,this.synchronizedInputs=new t.SynchronizedInputs({leftInput:this.widthInput,rightInput:this.heightInput,synchronize:this.synchronize_.bind(this)}),this.disableSync=this.synchronizedInputs.disableSync.bind(this.synchronizedInputs),this.enableSync=this.synchronizedInputs.enableSync.bind(this.synchronizedInputs),this.widthInput.value=this.initWidth,this.heightInput.value=this.initHeight},t.SizeInput.prototype.destroy=function(){this.synchronizedInputs.destroy(),this.widthInput=null,this.heightInput=null},t.SizeInput.prototype.setWidth=function(e){this.widthInput.value=e,this.synchronize_(this.widthInput)},t.SizeInput.prototype.setHeight=function(e){this.heightInput.value=e,this.synchronize_(this.heightInput)},t.SizeInput.prototype.synchronize_=function(e){var t=parseInt(e.value,10);isNaN(t)&&(t=0),e===this.widthInput?this.heightInput.value=Math.round(t*this.initHeight/this.initWidth):e===this.heightInput&&(this.widthInput.value=Math.round(t*this.initWidth/this.initHeight)),this.onChange&&this.onChange()}})(),(()=>{var e=$.namespace("pskl.widgets");e.SizePicker=function(e){this.onChange=e},e.SizePicker.prototype.init=function(e){this.container=e,pskl.utils.Event.addEventListener(this.container,"click",this.onSizeOptionClick_,this)},e.SizePicker.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this)},e.SizePicker.prototype.getSize=function(){var e=this.container.querySelector(".selected");return e?e.dataset.size:null},e.SizePicker.prototype.setSize=function(e){var t;this.getSize()!==e&&(pskl.utils.Dom.removeClass("labeled",this.container),pskl.utils.Dom.removeClass("selected",this.container),(t=this.container.querySelector('[data-size="'+e+'"]'))||((t=this.container.querySelector("[data-size]:last-child")).classList.add("labeled"),t.setAttribute("real-size",e)),t)&&t.classList.add("selected")},e.SizePicker.prototype.onSizeOptionClick_=function(e){e=e.target.dataset.size;isNaN(e)||(e=parseInt(e,10),this.onChange(e),this.setSize(e))}})(),(()=>{var e=$.namespace("pskl.widgets");e.SynchronizedInputs=function(e){this.leftInput=e.leftInput,this.rightInput=e.rightInput,this.synchronize=e.synchronize,this.syncEnabled=!0,this.lastInput=this.leftInput,pskl.utils.Event.addEventListener(this.leftInput,"input",this.onInput_,this),pskl.utils.Event.addEventListener(this.rightInput,"input",this.onInput_,this)},e.SynchronizedInputs.prototype.destroy=function(){pskl.utils.Event.removeAllEventListeners(this),this.leftInput=null,this.rightInput=null,this.lastInput=null},e.SynchronizedInputs.prototype.enableSync=function(){this.syncEnabled=!0,this.synchronize(this.lastInput)},e.SynchronizedInputs.prototype.disableSync=function(){this.syncEnabled=!1},e.SynchronizedInputs.prototype.onInput_=function(e){e=e.target;this.syncEnabled&&this.synchronize(e),this.lastInput=e}})(),(()=>{var e=$.namespace("pskl.widgets");e.Tabs=function(e,t,r){this.tabs=e,this.parentController=t,this.settingsName=r,this.currentTab=null,this.currentController=null},e.Tabs.prototype.init=function(e){this.tabListEl=e.querySelector(".tab-list"),this.tabContentlEl=e.querySelector(".tab-content"),pskl.utils.Event.addEventListener(this.tabListEl,"click",this.onTabsClicked_,this);e=pskl.UserSettings.get(this.settingsName);e&&this.selectTab(e)},e.Tabs.prototype.destroy=function(){this.currentController&&this.currentController.destroy(),pskl.utils.Event.removeAllEventListeners(this)},e.Tabs.prototype.selectTab=function(e){var t;this.tabs[e]&&this.currentTab!=e&&(this.currentController&&this.currentController.destroy(),this.tabContentlEl.innerHTML=pskl.utils.Template.get(this.tabs[e].template),this.currentController=new this.tabs[e].controller(pskl.app.piskelController,this.parentController),this.currentController.init(),this.currentTab=e,pskl.UserSettings.set(this.settingsName,e),(t=this.tabListEl.querySelector(".selected"))&&t.classList.remove("selected"),this.tabListEl.querySelector('[data-tab-id="'+e+'"]').classList.add("selected"))},e.Tabs.prototype.onTabsClicked_=function(e){e=pskl.utils.Dom.getData(e.target,"tabId");this.selectTab(e)}})(),(()=>{var e=$.namespace("pskl.widgets");e.Wizard=function(e,t){this.steps=e,this.container=t,this.wrapper=document.createElement("div"),this.wrapper.classList.add("wizard-wrapper"),this.currentStep=null,this.previousSteps=[]},e.Wizard.prototype.init=function(){Object.keys(this.steps).forEach(function(e){e=this.steps[e];e.el.classList.add("wizard-step"),this.wrapper.appendChild(e.el)}.bind(this)),this.container.appendChild(this.wrapper)},e.Wizard.prototype.getStep=function(e){return this.steps[e]},e.Wizard.prototype.getCurrentStep=function(){return this.currentStep},e.Wizard.prototype.goTo=function(e){var t,r=this.steps[e];r?(t=this.currentStep,this.currentStep=r,this.currentStep.instance.onShow(),t?(this.previousSteps.push(t),this.currentStep.el.classList.add("current-step-in"),window.setTimeout(function(){this.currentStep.el.classList.remove("current-step-in"),t.el.classList.remove("current-step"),this.currentStep.el.classList.add("current-step")}.bind(this),200)):this.currentStep.el.classList.add("current-step")):console.error("Wizard could not go to unknown step: "+e)},e.Wizard.prototype.back=function(){var e,t=this.previousSteps.pop();t?((e=this.currentStep)||console.error("Wizard is in an invalid state"),this.currentStep=t,e.el.classList.add("current-step-out"),e.el.classList.remove("current-step"),this.currentStep.el.classList.add("current-step"),window.setTimeout(function(){e.el.classList.remove("current-step-out")}.bind(this),200)):console.error("Wizard has no previous step to go to.")}})(),(()=>{var e=$.namespace("pskl.service.storage");e.StorageService=function(e){this.piskelController=e,this.savingFlag_=!1,this.onSaveSuccess_=this.onSaveSuccess_.bind(this),this.onSaveError_=this.onSaveError_.bind(this)},e.StorageService.prototype.init=function(){var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.STORAGE.OPEN,this.onOpenKey_.bind(this)),pskl.app.shortcutService.registerShortcut(e.STORAGE.SAVE,this.onSaveKey_.bind(this)),pskl.app.shortcutService.registerShortcut(e.STORAGE.SAVE_AS,this.onSaveAsKey_.bind(this)),$.subscribe(Events.BEFORE_SAVING_PISKEL,this.setSavingFlag_.bind(this,!0)),$.subscribe(Events.AFTER_SAVING_PISKEL,this.setSavingFlag_.bind(this,!1))},e.StorageService.prototype.isSaving=function(){return this.savingFlag_},e.StorageService.prototype.saveToGallery=function(e){return this.delegateSave_(pskl.app.galleryStorageService,e)},e.StorageService.prototype.saveToLocalStorage=function(e){return this.delegateSave_(pskl.app.localStorageService,e)},e.StorageService.prototype.saveToIndexedDb=function(e){return this.delegateSave_(pskl.app.indexedDbStorageService,e)},e.StorageService.prototype.saveToFileDownload=function(e){return this.delegateSave_(pskl.app.fileDownloadStorageService,e)},e.StorageService.prototype.saveToDesktop=function(e,t){return this.delegateSave_(pskl.app.desktopStorageService,e,t)},e.StorageService.prototype.delegateSave_=function(e,t,r){return this.savingFlag_?Q.reject("Already saving"):($.publish(Events.BEFORE_SAVING_PISKEL),e.save(t,r).then(this.onSaveSuccess_,this.onSaveError_))},e.StorageService.prototype.onOpenKey_=function(){pskl.utils.Environment.detectNodeWebkit()&&pskl.app.desktopStorageService.openPiskel()},e.StorageService.prototype.onSaveKey_=function(e){this.piskelController.getPiskel();pskl.app.isLoggedIn()?this.saveToGallery(this.piskelController.getPiskel()):pskl.utils.Environment.detectNodeWebkit()?this.saveToDesktop(this.piskelController.getPiskel()):window.setTimeout(function(){this.saveToIndexedDb(this.piskelController.getPiskel())}.bind(this),0)},e.StorageService.prototype.onSaveAsKey_=function(){pskl.utils.Environment.detectNodeWebkit()&&this.saveToDesktop(this.piskelController.getPiskel(),!0)},e.StorageService.prototype.onSaveSuccess_=function(){$.publish(Events.SHOW_NOTIFICATION,[{content:"Successfully saved !",hideDelay:3e3}]),$.publish(Events.PISKEL_SAVED),this.afterSaving_()},e.StorageService.prototype.onSaveError_=function(e){var t="Saving failed";return e&&(t+=" : "+e),$.publish(Events.SHOW_NOTIFICATION,[{content:t,hideDelay:1e4}]),this.afterSaving_(),Q.reject(e)},e.StorageService.prototype.afterSaving_=function(){$.publish(Events.AFTER_SAVING_PISKEL)},e.StorageService.prototype.setSavingFlag_=function(e){this.savingFlag_=e}})(),(()=>{var e=$.namespace("pskl.service.storage");e.FileDownloadStorageService=function(){},e.FileDownloadStorageService.prototype.init=function(){},e.FileDownloadStorageService.prototype.save=function(r){var e=pskl.utils.serialization.Serializer.serialize(r),i=Q.defer();return pskl.utils.BlobUtils.stringToBlob(e,function(e){var t=r.getDescriptor().name+"-"+pskl.utils.DateUtils.format(new Date,"{{Y}}{{M}}{{D}}-{{H}}{{m}}{{s}}")+".piskel";try{pskl.utils.FileUtils.downloadAsFile(e,t),i.resolve()}catch(e){i.reject(e.message)}}.bind(this),"application/piskel+json"),i.promise}})(),(()=>{var e=$.namespace("pskl.service.storage");e.IndexedDbStorageService=function(e){this.piskelController=e,this.piskelDatabase=new pskl.database.PiskelDatabase},e.IndexedDbStorageService.prototype.init=function(){this.piskelDatabase.init().catch(function(e){console.log("Failed to initialize PiskelDatabase, local browser saves will be unavailable.")})},e.IndexedDbStorageService.prototype.save=function(e){var t=e.getDescriptor().name,r=e.getDescriptor().description,i=Date.now(),e=pskl.utils.serialization.Serializer.serialize(e);return this.save_(t,r,i,e)},e.IndexedDbStorageService.prototype.save_=function(t,r,i,n){return this.piskelDatabase.get(t).then(function(e){return void 0!==e?this.piskelDatabase.update(t,r,i,n):this.piskelDatabase.create(t,r,i,n)}.bind(this))},e.IndexedDbStorageService.prototype.load=function(t){return this.piskelDatabase.get(t).then(function(e){void 0!==e?(e=e.serialized,pskl.utils.serialization.Deserializer.deserialize(JSON.parse(e),function(e){pskl.app.piskelController.setPiskel(e)})):console.log("no local browser save found for name: "+t)})},e.IndexedDbStorageService.prototype.remove=function(e){return this.piskelDatabase.delete(e)},e.IndexedDbStorageService.prototype.getKeys=function(){return this.piskelDatabase.list()}})(),(()=>{var e=$.namespace("pskl.service.storage");e.LocalStorageService=function(e){if(void 0===e)throw"Bad LocalStorageService initialization: <undefined piskelController>";this.piskelController=e},e.LocalStorageService.prototype.init=function(){},e.LocalStorageService.prototype.save=function(e){var t=e.getDescriptor().name,r=e.getDescriptor().description,e=pskl.utils.serialization.Serializer.serialize(e);if(pskl.app.localStorageService.getPiskel(t)&&!window.confirm("There is already a piskel saved as "+t+". Overwrite ?"))return Q.reject('Cancelled by user, "'+t+'" already exists');try{return this.removeFromKeys_(t),this.addToKeys_(t,r,Date.now()),window.localStorage.setItem("piskel."+t,e),Q.resolve()}catch(e){return Q.reject(e.message)}},e.LocalStorageService.prototype.load=function(e){var t=this.getPiskel(e);this.getKey_(e);pskl.utils.serialization.Deserializer.deserialize(JSON.parse(t),function(e){pskl.app.piskelController.setPiskel(e)})},e.LocalStorageService.prototype.remove=function(e){this.removeFromKeys_(e),window.localStorage.removeItem("piskel."+e)},e.LocalStorageService.prototype.saveKeys_=function(e){window.localStorage.setItem("piskel.keys",JSON.stringify(e))},e.LocalStorageService.prototype.removeFromKeys_=function(t){var e=this.getKeys().filter(function(e){return e.name!==t});this.saveKeys_(e)},e.LocalStorageService.prototype.getKey_=function(t){var e=this.getKeys().filter(function(e){return e.name===t});return 0<e.length?e[0]:null},e.LocalStorageService.prototype.addToKeys_=function(e,t,r){var i=this.getKeys();i.push({name:e,description:t,date:r}),this.saveKeys_(i)},e.LocalStorageService.prototype.getPiskel=function(e){return window.localStorage.getItem("piskel."+e)},e.LocalStorageService.prototype.getKeys=function(e){var t=window.localStorage.getItem("piskel.keys");return JSON.parse(t)||[]}})(),(()=>{var e=$.namespace("pskl.service.storage");e.GalleryStorageService=function(e){this.piskelController=e},e.GalleryStorageService.prototype.init=function(){},e.GalleryStorageService.prototype.save=function(e){var t=e.getDescriptor(),r=Q.defer(),e=pskl.utils.serialization.Serializer.serialize(e),i={framesheet:e,fps:this.piskelController.getFPS(),name:t.name,description:t.description,frames:this.piskelController.getFrameCount(),first_frame_as_png:pskl.app.getFirstFrameAsPng(),framesheet_as_png:pskl.app.getFramesheetAsPng()};e.length>Constants.APPENGINE_SAVE_LIMIT&&r.reject("This sprite is too big to be saved on the gallery. Try saving it as a .piskel file."),t.isPublic&&(i.public=!0);return pskl.utils.Xhr.post(Constants.APPENGINE_SAVE_URL,i,function(e){r.resolve()},function(e){r.reject(this.getErrorMessage_(e))}.bind(this)),r.promise},e.GalleryStorageService.prototype.getErrorMessage_=function(e){return 401===e.status?"Session expired, please log in again.":403===e.status?"Unauthorized action, this sprite belongs to another account.":500===e.status?"Unexpected server error, please contact us on Github (piskel) or Twitter (@piskelapp)":"Unknown error"}})(),(()=>{var e=$.namespace("pskl.service.storage"),r=".piskel";e.DesktopStorageService=function(e){this.piskelController=e||pskl.app.piskelController,this.hideNotificationTimeoutID=0},e.DesktopStorageService.prototype.init=function(){},e.DesktopStorageService.prototype.save=function(e,t){return e.savePath&&!t?this.saveAtPath_(e,e.savePath):(t=e.getDescriptor().name,pskl.utils.FileUtilsDesktop.chooseFilenameDialog(t,r).then(this.saveAtPath_.bind(this,e)))},e.DesktopStorageService.prototype.saveAtPath_=function(e,t){var r;return t?(r=pskl.utils.serialization.Serializer.serialize(e),t=this.addExtensionIfNeeded_(t),e.savePath=t,e.setName(this.extractFilename_(t)),pskl.utils.FileUtilsDesktop.saveToFile(r,t)):Q.reject("Invalid file name")},e.DesktopStorageService.prototype.openPiskel=function(){return pskl.utils.FileUtilsDesktop.chooseFilenameDialog().then(this.load)},e.DesktopStorageService.prototype.load=function(t){pskl.utils.FileUtilsDesktop.readFile(t).then(function(e){pskl.utils.PiskelFileUtils.decodePiskelFile(e,function(e){e.savePath=t,pskl.app.piskelController.setPiskel(e)})})},e.DesktopStorageService.prototype.addExtensionIfNeeded_=function(e){return e.substr(-r.length)===r?e:e+r},e.DesktopStorageService.prototype.extractFilename_=function(e){e=/[\/\\]([^\/\\]*)\.piskel$/gi.exec(e);if(e&&e[1])return e[1]}})(),(()=>{var e=$.namespace("pskl.service");e.BackupService=function(e,t){this.piskelController=e,this.lastHash=this.piskelController.getPiskel().getHash(),this.nextSnapshotDate=-1,this.backupDatabase=t||new pskl.database.BackupDatabase},e.BackupService.prototype.init=function(){this.backupDatabase.init().then(function(){window.setInterval(this.backup.bind(this),6e4)}.bind(this))},e.BackupService.prototype.currentDate_=function(){return Date.now()},e.BackupService.prototype.backup=function(){var e=this.piskelController.getPiskel(),t=e.getHash();if(t===this.lastHash)return Q.resolve();this.lastHash=t;var t=e.getDescriptor(),r=this.currentDate_(),i={session_id:pskl.app.sessionId,date:r,name:t.name,description:t.description,frames:e.getFrameCount(),width:e.getWidth(),height:e.getHeight(),fps:e.getFPS(),serialized:pskl.utils.serialization.Serializer.serialize(e)};return this.getSnapshotsBySessionId(pskl.app.sessionId).then(function(e){var t=e[0];return t&&r<this.nextSnapshotDate?(i.id=t.id,this.backupDatabase.updateSnapshot(i)):(this.nextSnapshotDate=r+3e5,this.backupDatabase.createSnapshot(i).then(function(){if(12<=e.length)return this.backupDatabase.deleteSnapshot(e[e.length-1])}.bind(this)).then(function(){if(!t)return this.backupDatabase.getSessions().then(function(e){if(!(e.length<=10))return e=e.sort(function(e,t){return e.startDate-t.startDate}).map(function(e){return e.id}).slice(0,e.length-10),Q.all(e.map(function(e){return this.deleteSession(e)}.bind(this)))}.bind(this))}.bind(this)))}.bind(this)).catch(function(e){console.error(e)})},e.BackupService.prototype.getSnapshotsBySessionId=function(e){return this.backupDatabase.getSnapshotsBySessionId(e)},e.BackupService.prototype.deleteSession=function(e){return this.backupDatabase.deleteSnapshotsForSession(e)},e.BackupService.prototype.getPreviousPiskelInfo=function(){return this.backupDatabase.findLastSnapshot(function(e){return e.session_id!==pskl.app.sessionId})},e.BackupService.prototype.list=function(){return this.backupDatabase.getSessions()},e.BackupService.prototype.loadSnapshotById=function(e){var t=Q.defer();return this.backupDatabase.getSnapshot(e).then(function(e){pskl.utils.serialization.Deserializer.deserialize(JSON.parse(e.serialized),function(e){pskl.app.piskelController.setPiskel(e),t.resolve()})}),t.promise},e.BackupService.prototype.load=function(){var t=Q.defer();return this.getPreviousPiskelInfo().then(function(e){pskl.utils.serialization.Deserializer.deserialize(JSON.parse(e.serialized),function(e){pskl.app.piskelController.setPiskel(e),t.resolve()})}),t.promise}})(),(()=>{var e=$.namespace("pskl.service");e.BeforeUnloadService=function(e){this.piskelController=e},e.BeforeUnloadService.prototype.init=function(){var e;pskl.utils.Environment.detectNodeWebkit()&&(e=require("nw.gui").Window.get()).on("close",this.onNwWindowClose.bind(this,e)),window.addEventListener("beforeunload",this.onBeforeUnload.bind(this))},e.BeforeUnloadService.prototype.onNwWindowClose=function(e){var t=this.onBeforeUnload();if(t&&!window.confirm(t))return!1;e.close(!0)},e.BeforeUnloadService.prototype.onBeforeUnload=function(e){var t;if(pskl.app.backupService.backup(),pskl.app.savedStatusService.isDirty())return t="Your current sprite has unsaved changes. Are you sure you want to quit?",(e=e||window.event)&&(e.returnValue=t),t}})(),(()=>{var i=$.namespace("pskl.service");i.HistoryService=function(e,t,r,i){this.piskelController=e.getWrappedPiskelController(),this.shortcutService=t||pskl.app.shortcutService,this.deserializer=r||pskl.utils.serialization.arraybuffer.ArrayBufferDeserializer,this.serializer=i||pskl.utils.serialization.arraybuffer.ArrayBufferSerializer,this.stateQueue=[],this.currentIndex=-1,this.lastLoadState=-1},i.HistoryService.SNAPSHOT="SNAPSHOT",i.HistoryService.REPLAY="REPLAY",i.HistoryService.SNAPSHOT_PERIOD=50,i.HistoryService.LOAD_STATE_INTERVAL=50,i.HistoryService.MAX_SAVED_STATES=500,i.HistoryService.prototype.init=function(){$.subscribe(Events.PISKEL_SAVE_STATE,this.onSaveStateEvent.bind(this));var e=pskl.service.keyboard.Shortcuts;this.shortcutService.registerShortcut(e.MISC.UNDO,this.undo.bind(this)),this.shortcutService.registerShortcut(e.MISC.REDO,this.redo.bind(this)),this.saveState({type:i.HistoryService.SNAPSHOT})},i.HistoryService.prototype.onSaveStateEvent=function(e,t){this.saveState(t)},i.HistoryService.prototype.saveState=function(e){this.stateQueue=this.stateQueue.slice(0,this.currentIndex+1),this.currentIndex=this.currentIndex+1;var t={action:e,frameIndex:e.state?e.state.frameIndex:this.piskelController.currentFrameIndex,layerIndex:e.state?e.state.layerIndex:this.piskelController.currentLayerIndex,fps:this.piskelController.getFPS(),uuid:pskl.utils.Uuid.generate()},e=e.type===i.HistoryService.SNAPSHOT,r=this.currentIndex%i.HistoryService.SNAPSHOT_PERIOD==0;(e||r)&&(e=this.piskelController.getPiskel(),t.piskel=this.serializer.serialize(e)),this.stateQueue.length>i.HistoryService.MAX_SAVED_STATES&&(r=this.getNextSnapshotIndex_(1),this.stateQueue.splice(0,r),this.currentIndex=this.currentIndex-r),this.stateQueue.push(t),$.publish(Events.HISTORY_STATE_SAVED)},i.HistoryService.prototype.getCurrentStateId=function(){var e=this.stateQueue[this.currentIndex];return!!e&&e.uuid},i.HistoryService.prototype.undo=function(){this.loadState(this.currentIndex-1)},i.HistoryService.prototype.redo=function(){this.loadState(this.currentIndex+1)},i.HistoryService.prototype.isLoadStateAllowed_=function(e){var t=Date.now()-this.lastLoadState>i.HistoryService.LOAD_STATE_INTERVAL,e=0<=e&&e<this.stateQueue.length;return t&&e},i.HistoryService.prototype.getPreviousSnapshotIndex_=function(e){for(;this.stateQueue[e]&&!this.stateQueue[e].piskel;)e-=1;return e},i.HistoryService.prototype.getNextSnapshotIndex_=function(e){for(;this.stateQueue[e]&&!this.stateQueue[e].piskel;)e+=1;return e},i.HistoryService.prototype.loadState=function(e){try{if(this.isLoadStateAllowed_(e)){this.lastLoadState=Date.now();var t=this.getPreviousSnapshotIndex_(e);if(t<0)throw"Could not find previous SNAPSHOT saved in history stateQueue";var r=this.getSnapshotFromState_(t),i=this.onPiskelLoaded_.bind(this,e,t);this.deserializer.deserialize(r,i)}}catch(e){console.error("[CRITICAL ERROR] : Unable to load a history state."),this.logError_(e),this.stateQueue=[],this.currentIndex=-1}},i.HistoryService.prototype.logError_=function(e){"string"==typeof e?console.error(e):(console.error(e.message),console.error(e.stack))},i.HistoryService.prototype.getSnapshotFromState_=function(e){var e=this.stateQueue[e],t=e.piskel;return e.piskel=t},i.HistoryService.prototype.onPiskelLoaded_=function(e,t,r){var i=this.getPiskelSize_();r.setDescriptor(this.piskelController.piskel.getDescriptor()),r.savePath=this.piskelController.piskel.savePath,this.piskelController.setPiskel(r);for(var n=t+1;n<=e;n++){var o=this.stateQueue[n];this.setupState(o),this.replayState(o)}r=this.stateQueue[e+1];r&&this.setupState(r),this.currentIndex=e,$.publish(Events.PISKEL_RESET),$.publish(Events.HISTORY_STATE_LOADED),i!==this.getPiskelSize_()&&$.publish(Events.FRAME_SIZE_CHANGED)},i.HistoryService.prototype.getPiskelSize_=function(){return this.piskelController.getWidth()+"x"+this.piskelController.getHeight()},i.HistoryService.prototype.setupState=function(e){this.piskelController.setCurrentFrameIndex(e.frameIndex),this.piskelController.setCurrentLayerIndex(e.layerIndex),this.piskelController.setFPS(e.fps)},i.HistoryService.prototype.replayState=function(e){var t=e.action,e=(t.type,this.piskelController.getLayerAt(e.layerIndex).getFrameAt(e.frameIndex));t.scope.replay(e,t.replay)}})(),(()=>{for(var e=$.namespace("pskl.service.color"),s=[],t=0;t<10;t++)s.push(36*t);e.ColorSorter=function(){this.colorsHslMap_={}},e.ColorSorter.prototype.sort=function(e){this.colorsHslMap_={},e.forEach(function(e){this.colorsHslMap_[e]=window.tinycolor(e).toHsl()}.bind(this));var t=e.filter(function(e){return this.colorsHslMap_[e].l<=.1}.bind(this)),r=e.filter(function(e){return.9<=this.colorsHslMap_[e].l}.bind(this)),i=e.filter(function(e){return-1===r.indexOf(e)&&-1===t.indexOf(e)}).filter(function(e){return this.colorsHslMap_[e].s<=.1}.bind(this)),t=this.sortOnHslProperty_(t,"l"),r=this.sortOnHslProperty_(r,"l"),i=this.sortOnHslProperty_(i,"h"),n=t.concat(r,i),o=e.filter(function(e){return-1===n.indexOf(e)}),i=s.map(function(t){var e=o.filter(function(e){e=this.colorsHslMap_[e];return e.h>=t&&e.h<t+36}.bind(this));return this.sortRegularColors_(e)}.bind(this));return Array.prototype.concat.apply(n,i)},e.ColorSorter.prototype.sortRegularColors_=function(e){return e.sort(function(e,t){var e=this.colorsHslMap_[e],t=this.colorsHslMap_[t],r=Math.abs(e.h-t.h),i=Math.abs(e.s-t.s),n=Math.abs(e.l-t.l);return r<10?n<i?this.compareValues_(e.s,t.s):this.compareValues_(e.l,t.l):this.compareValues_(e.h,t.h)}.bind(this))},e.ColorSorter.prototype.sortOnHslProperty_=function(e,r){return e.sort(function(e,t){e=this.colorsHslMap_[e],t=this.colorsHslMap_[t];return this.compareValues_(e[r],t[r])}.bind(this))},e.ColorSorter.prototype.compareValues_=function(e,t){return t<e?1:e<t?-1:0}})(),(()=>{var e=$.namespace("pskl.service.palette");e.CurrentColorsPalette=function(){this.name="* Current File *",this.id=Constants.CURRENT_COLORS_PALETTE_ID,this.colorSorter=new pskl.service.color.ColorSorter},e.CurrentColorsPalette.prototype.getColors=function(){var e=(e=pskl.app.currentColorsService.getCurrentColors()).slice(0,Constants.MAX_PALETTE_COLORS);return this.colorSorter.sort(e)}})(),(()=>{var e=$.namespace("pskl.service.palette");e.CurrentFrameColorsPalette=function(){this.name="- Current Frame -",this.id=Constants.CURRENT_FRAME_COLORS_PALETTE_ID,this.colorSorter=new pskl.service.color.ColorSorter},e.CurrentFrameColorsPalette.prototype.getColors=function(){return pskl.app.currentColorsService.getCurrentFrameColors().slice(0,Constants.MAX_PALETTE_COLORS)}})(),(()=>{var e=$.namespace("pskl.service.palette");e.PaletteService=function(){this.dynamicPalettes=[],this.localStorageGlobal=window.localStorage},e.PaletteService.prototype.getPalettes=function(){var e=this.localStorageGlobal.getItem("piskel.palettes"),e=(e=JSON.parse(e)||[]).map(function(e){return pskl.model.Palette.fromObject(e)});return this.dynamicPalettes.concat(e)},e.PaletteService.prototype.getPaletteById=function(e){var t=this.getPalettes();return this.findPaletteInArray_(e,t)},e.PaletteService.prototype.savePalette=function(e){var t=this.getPalettes(),r=this.findPaletteInArray_(e.id,t);r?(r=t.indexOf(r),t.splice(r,1,e)):t.push(e),this.savePalettes_(t),$.publish(Events.SHOW_NOTIFICATION,[{content:"Palette "+e.name+" successfully saved !"}]),window.setTimeout($.publish.bind($,Events.HIDE_NOTIFICATION),2e3)},e.PaletteService.prototype.addDynamicPalette=function(e){this.dynamicPalettes.push(e)},e.PaletteService.prototype.deletePaletteById=function(t){var e=this.getPalettes().filter(function(e){return e.id!==t});this.savePalettes_(e)},e.PaletteService.prototype.savePalettes_=function(e){e=e.filter(function(e){return-1===this.dynamicPalettes.indexOf(e)}.bind(this)),this.localStorageGlobal.setItem("piskel.palettes",JSON.stringify(e)),$.publish(Events.PALETTE_LIST_UPDATED)},e.PaletteService.prototype.findPaletteInArray_=function(t,e){var r=null;return e.forEach(function(e){e.id===t&&(r=e)}),r}})(),(()=>{var e=$.namespace("pskl.service.palette");e.PaletteGplWriter=function(e){this.palette=e},e.PaletteGplWriter.prototype.write=function(){var t=[];return t.push("GIMP Palette"),t.push("Name: "+this.palette.name),t.push("Columns: 0"),t.push("#"),this.palette.getColors().forEach(function(e){t.push(this.writeColorLine(e))}.bind(this)),t.push("\r\n"),t.join("\r\n")},e.PaletteGplWriter.prototype.writeColorLine=function(e){var e=window.tinycolor(e).toRgb(),t=[];return t.push(this.padString(e.r,3)),t.push(this.padString(e.g,3)),t.push(this.padString(e.b,3)),t.push("Untitled"),t.join(" ")},e.PaletteGplWriter.prototype.padString=function(e,t){return e=e.toString(),new Array(1+t-e.length).join(" ")+e}})(),(()=>{var e=$.namespace("pskl.service.palette.reader");e.AbstractPaletteFileReader=function(e,t,r,i){this.file=e,this.onSuccess=t,this.onError=r,this.colorLineRegexp=i},e.AbstractPaletteFileReader.prototype.extractColorFromLine=Constants.ABSTRACT_FUNCTION,e.AbstractPaletteFileReader.prototype.read=function(){pskl.utils.FileUtils.readFile(this.file,this.onFileLoaded_.bind(this))},e.AbstractPaletteFileReader.prototype.onFileLoaded_=function(e){var t,e=pskl.utils.Base64.toText(e).match(/[^\r\n]+/g).filter(function(e){return this.colorLineRegexp.test(e)}.bind(this)).map(this.extractColorFromLine.bind(this));e.length?(t=pskl.utils.Uuid.generate(),t=new pskl.model.Palette(t,this.file.name,e),this.onSuccess(t)):this.onError()}})(),(()=>{var e=$.namespace("pskl.service.palette.reader"),i=/^(\s*\d{1,3})(\s*\d{1,3})(\s*\d{1,3})/;e.PaletteGplReader=function(e,t,r){this.superclass.constructor.call(this,e,t,r,i)},pskl.utils.inherit(e.PaletteGplReader,e.AbstractPaletteFileReader),e.PaletteGplReader.prototype.extractColorFromLine=function(e){e=e.match(i);return window.tinycolor({r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}).toHexString()}})(),(()=>{var e=$.namespace("pskl.service.palette.reader");e.PaletteImageReader=function(e,t,r){this.file=e,this.onSuccess=t,this.onError=r,this.colorSorter_=new pskl.service.color.ColorSorter},e.PaletteImageReader.prototype.read=function(){pskl.utils.FileUtils.readImageFile(this.file,this.onImageLoaded_.bind(this))},e.PaletteImageReader.prototype.onImageLoaded_=function(e){e=new pskl.worker.imageprocessor.ImageProcessor(e,this.onWorkerSuccess_.bind(this),this.onWorkerStep_.bind(this),this.onWorkerError_.bind(this));$.publish(Events.SHOW_PROGRESS,[{name:"Processing image colors ..."}]),e.process()},e.PaletteImageReader.prototype.onWorkerSuccess_=function(e){var t,e=e.data.colorsMap,e=Object.keys(e);e.length>Constants.MAX_PALETTE_COLORS?this.onError("Too many colors : "+e.length):(t=pskl.utils.Uuid.generate(),e=this.colorSorter_.sort(e),t=new pskl.model.Palette(t,this.file.name+" palette",e),this.onSuccess(t)),$.publish(Events.HIDE_PROGRESS)},e.PaletteImageReader.prototype.onWorkerStep_=function(e){e=e.data.progress;$.publish(Events.UPDATE_PROGRESS,[{progress:e}])},e.PaletteImageReader.prototype.onWorkerError_=function(e){$.publish(Events.HIDE_PROGRESS),this.onError("Unable to process the image : "+e.data.message)}})(),(()=>{var e=$.namespace("pskl.service.palette.reader"),i=/^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})/;e.PalettePalReader=function(e,t,r){this.superclass.constructor.call(this,e,t,r,i)},pskl.utils.inherit(e.PalettePalReader,e.AbstractPaletteFileReader),e.PalettePalReader.prototype.extractColorFromLine=function(e){e=e.match(i),e="rgb("+e[1]+","+e[2]+","+e[3]+")";return window.tinycolor(e).toHexString()}})(),(()=>{var e=$.namespace("pskl.service.palette.reader"),i=/^[A-F0-9]{2}([A-F0-9]{2})([A-F0-9]{2})([A-F0-9]{2})/;e.PaletteTxtReader=function(e,t,r){this.superclass.constructor.call(this,e,t,r,i)},pskl.utils.inherit(e.PaletteTxtReader,e.AbstractPaletteFileReader),e.PaletteTxtReader.prototype.extractColorFromLine=function(e){e=e.match(i);return("#"+e[1]+e[2]+e[3]).toLowerCase()}})(),(()=>{var e=$.namespace("pskl.service.palette"),t={gpl:e.reader.PaletteGplReader,pal:e.reader.PalettePalReader,txt:e.reader.PaletteTxtReader,img:e.reader.PaletteImageReader};e.PaletteImportService=function(){},e.PaletteImportService.prototype.init=function(){},e.PaletteImportService.prototype.read=function(e,t,r){t=this.getReader_(e,t,r);t?t.read():console.error("Could not find reader for file : %s",e.name)},e.PaletteImportService.prototype.isImage_=function(e){return 0===e.type.indexOf("image")},e.PaletteImportService.prototype.getReader_=function(e,t,r){var i=this.getReaderClass_(e);return i?new i(e,t,r):null},e.PaletteImportService.prototype.getReaderClass_=function(e){return this.isImage_(e)?t.img:(e=this.getExtension_(e),t[e])},e.PaletteImportService.prototype.getExtension_=function(e){e=e.name.split(".");return e[e.length-1].toLowerCase()}})(),(()=>{var e=$.namespace("pskl.service.pensize");e.PenSizeService=function(){this.size=1},e.PenSizeService.prototype.init=function(){this.size=pskl.UserSettings.get(pskl.UserSettings.PEN_SIZE);var e=pskl.service.keyboard.Shortcuts;pskl.app.shortcutService.registerShortcut(e.MISC.INCREASE_PENSIZE,this.increasePenSize_.bind(this)),pskl.app.shortcutService.registerShortcut(e.MISC.DECREASE_PENSIZE,this.decreasePenSize_.bind(this))},e.PenSizeService.prototype.increasePenSize_=function(){this.setPenSize(this.size+1)},e.PenSizeService.prototype.decreasePenSize_=function(){this.setPenSize(this.size-1)},e.PenSizeService.prototype.getPenSize=function(){return this.size},e.PenSizeService.prototype.setPenSize=function(e){this.isPenSizeValid_(e)&&e!=this.size&&(this.size=e,pskl.UserSettings.set(pskl.UserSettings.PEN_SIZE,e),$.publish(Events.PEN_SIZE_CHANGED))},e.PenSizeService.prototype.isPenSizeValid_=function(e){return!isNaN(e)&&1<=e&&e<=32}})(),(()=>{var e=$.namespace("pskl.service");e.SavedStatusService=function(e,t){this.piskelController=e,this.historyService=t,this.lastSavedStateIndex="",this.publishStatusUpdateEvent_=this.publishStatusUpdateEvent_.bind(this)},e.SavedStatusService.prototype.init=function(){$.subscribe(Events.TOOL_RELEASED,this.publishStatusUpdateEvent_),$.subscribe(Events.PISKEL_RESET,this.publishStatusUpdateEvent_),$.subscribe(Events.PISKEL_SAVED,this.onPiskelSaved.bind(this)),this.lastSavedStateIndex=this.historyService.getCurrentStateId()},e.SavedStatusService.prototype.onPiskelSaved=function(){this.lastSavedStateIndex=this.historyService.getCurrentStateId(),this.publishStatusUpdateEvent_()},e.SavedStatusService.prototype.publishStatusUpdateEvent_=function(){$.publish(Events.PISKEL_SAVED_STATUS_UPDATE)},e.SavedStatusService.prototype.isDirty=function(){return this.lastSavedStateIndex!=this.historyService.getCurrentStateId()}})(),(()=>{var t={8:"back",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",189:"-",109:"-",173:"-",187:"+",107:"+",61:"+",188:"<",190:">",191:"?",219:"[",221:"]"};$.namespace("pskl.service.keyboard").KeycodeTranslator={toChar:function(e){return 48<=e&&e<=57?e-48+"":96<=e&&e<=105?e-96+"":65<=e&&e<=90?(e-65+10).toString(36):t[e]}}})(),(()=>{var r=$.namespace("pskl.service.keyboard");r.KeyUtils={createKeyFromString:function(e){var t={alt:-1!=(e=e.toLowerCase()).indexOf("alt+"),shift:-1!=e.indexOf("shift+"),ctrl:-1!=e.indexOf("ctrl+")},e=e.split(/\+(?!$)/);return{key:e[e.length-1].toUpperCase(),modifiers:t}},createKeyFromEvent:function(e){var t=e.which,t=r.KeycodeTranslator.toChar(t);return t?{key:t.toUpperCase(),modifiers:{alt:e.altKey,shift:e.shiftKey,ctrl:r.KeyUtils.isCtrlKeyPressed_(e)}}:null},equals:function(e,t){return e="string"==typeof e?r.KeyUtils.createKeyFromString(e):e,t="string"==typeof t?r.KeyUtils.createKeyFromString(t):t,e.key===t.key&&e.modifiers.alt===t.modifiers.alt&&e.modifiers.shift===t.modifiers.shift&&e.modifiers.ctrl===t.modifiers.ctrl},stringify:function(e){var t=r.KeyUtils.getModifiersString(e.modifiers);return t?t+"+"+e.key:e.key},getModifiersString:function(e){var t=[];return e.alt&&t.push("alt"),e.ctrl&&t.push("ctrl"),e.shift&&t.push("shift"),t.join("+")},isCtrlKeyPressed_:function(e){return pskl.utils.UserAgent.isMac?e.metaKey:e.ctrlKey}}})(),(()=>{var i=$.namespace("pskl.service.keyboard");i.Shortcut=function(e,t,r,i){this.id_=e,this.description_=t,this.defaultKeys_=r="string"==typeof r?[r]:r,this.displayKey_=i},i.Shortcut.USER_SETTINGS_PREFIX="shortcut.",i.Shortcut.prototype.getId=function(){return this.id_},i.Shortcut.prototype.getDescription=function(){return this.description_},i.Shortcut.prototype.getKeys=function(){var e=pskl.UserSettings.get(this.getLocalStorageKey_())||this.defaultKeys_;return"string"==typeof e?[e]:Array.isArray(e)?e:[]},i.Shortcut.prototype.isEditable=function(){return 0===this.getKeys().length||1===this.getKeys().length&&-1===i.Shortcuts.FORBIDDEN_KEYS.indexOf(this.getKeys()[0])},i.Shortcut.prototype.isCustom=function(){var e=this.getKeys();return e.length!==this.defaultKeys_.length||this.defaultKeys_.some(function(t){return!e.some(function(e){return i.KeyUtils.equals(e,t)})})},i.Shortcut.prototype.isUndefined=function(){return 0===this.getKeys().length},i.Shortcut.prototype.getDisplayKey=function(){return this.isUndefined()?"???":this.displayKey_||this.getKeys()[0]},i.Shortcut.prototype.restoreDefault=function(e){pskl.UserSettings.set(this.getLocalStorageKey_(),"")},i.Shortcut.prototype.updateKeys=function(e){pskl.UserSettings.set(this.getLocalStorageKey_(),e)},i.Shortcut.prototype.removeKeys=function(e){var t,r;if(this.isEditable())return(r=(t=this.getKeys()).filter(function(t){return!e.some(function(e){return i.KeyUtils.equals(t,e)})})).length!==t.length&&(this.updateKeys(r),!0)},i.Shortcut.prototype.getLocalStorageKey_=function(){return i.Shortcut.USER_SETTINGS_PREFIX+this.id_}})(),(()=>{function e(e,t,r,i){return new n.Shortcut(e,t,r,i)}var n=$.namespace("pskl.service.keyboard");n.Shortcuts={FORBIDDEN_KEYS:["1","2","3","4","5","6","7","8","9","?","shift+?","DEL","BACK","ENTER","ctrl+Y","ctrl+shift+Z"],TOOL:{PEN:e("tool-pen","Pen tool","P"),MIRROR_PEN:e("tool-vertical-mirror-pen","Vertical mirror pen tool","V"),PAINT_BUCKET:e("tool-paint-bucket","Paint bucket tool","B"),COLORSWAP:e("tool-colorswap","Magic bucket tool","A"),ERASER:e("tool-eraser","Eraser pen tool","E"),STROKE:e("tool-stroke","Stroke tool","L"),RECTANGLE:e("tool-rectangle","Rectangle tool","R"),CIRCLE:e("tool-circle","Circle tool","C"),MOVE:e("tool-move","Move tool","M"),SHAPE_SELECT:e("tool-shape-select","Shape selection","Z"),RECTANGLE_SELECT:e("tool-rectangle-select","Rectangle selection","S"),LASSO_SELECT:e("tool-lasso-select","Lasso selection","H"),LIGHTEN:e("tool-lighten","Lighten tool","U"),SHIFT_INDEX:e("tool-shift-index","Shift Color Index tool","P"),DITHERING:e("tool-dithering","Dithering tool","T"),COLORPICKER:e("tool-colorpicker","Color picker","O")},SELECTION:{CUT:e("selection-cut","Cut selection","ctrl+X"),COPY:e("selection-copy","Copy selection","ctrl+C"),PASTE:e("selection-paste","Paste selection","ctrl+V"),DELETE:e("selection-delete","Delete selection",["DEL","BACK"]),COMMIT:e("selection-commit","Commit selection",["ENTER"])},MISC:{RESET_ZOOM:e("reset-zoom","Reset zoom level","0"),INCREASE_ZOOM:e("increase-zoom","Increase zoom level","+"),DECREASE_ZOOM:e("decrease-zoom","Decrease zoom level","-"),INCREASE_PENSIZE:e("increase-pensize","Increase pen size","]"),DECREASE_PENSIZE:e("decrease-pensize","Decrease pen size","["),UNDO:e("undo","Undo","ctrl+Z"),REDO:e("redo","Redo",["ctrl+Y","ctrl+shift+Z"]),PREVIOUS_FRAME:e("previous-frame","Select previous frame","up"),NEXT_FRAME:e("next-frame","Select next frame","down"),NEW_FRAME:e("new-frame","Create new empty frame","N"),DUPLICATE_FRAME:e("duplicate-frame","Duplicate selected frame","shift+N"),CHEATSHEET:e("cheatsheet","Open the keyboard shortcut cheatsheet",["?","shift+?"]),X1_PREVIEW:e("x1-preview","Select original size preview","alt+1"),BEST_PREVIEW:e("best-preview","Select best size preview","alt+2"),FULL_PREVIEW:e("full-preview","Select full size preview","alt+3"),ONION_SKIN:e("onion-skin","Toggle onion skin","alt+O"),TOGGLE_GRID:e("toggle-grid","Show/Hide grid","alt+G"),LAYER_PREVIEW:e("layer-preview","Toggle layer preview","alt+L"),MERGE_ANIMATION:e("import-animation","Open merge animation popup","ctrl+shift+M"),CLOSE_POPUP:e("close-popup","Close an opened popup","ESC"),OFFSET_UP:e("move-up","Move viewport up","shift+up"),OFFSET_RIGHT:e("move-right","Move viewport right","shift+right"),OFFSET_DOWN:e("move-down","Move viewport down","shift+down"),OFFSET_LEFT:e("move-left","Move viewport left","shift+left")},STORAGE:{SAVE:e("save","Save the current sprite","ctrl+S"),OPEN:e("open","(desktop) Open a .piskel file","ctrl+O"),SAVE_AS:e("save-as","(desktop) Save as new","ctrl+shift+S")},COLOR:{SWAP:e("swap-colors","Swap primary/secondary colors","X"),RESET:e("reset-colors","Reset default colors","D"),CREATE_PALETTE:e("create-palette","Open the palette creation popup","alt+P"),PREVIOUS_COLOR:e("previous-color","Select the previous color in the current palette","<"),NEXT_COLOR:e("next-color","Select the next color in the current palette",">"),SELECT_COLOR:e("select-color","Select a palette color in the current palette","123456789".split(""),"1 to 9")},DEBUG:{RELOAD_STYLES:e("move-left","Move viewport left","ctrl+alt+R")},CATEGORIES:["TOOL","SELECTION","MISC","STORAGE","COLOR"]}})(),(()=>{var n=$.namespace("pskl.service.keyboard");n.ShortcutService=function(){this.shortcuts_=[]},n.ShortcutService.prototype.init=function(){document.body.addEventListener("keydown",this.onKeyDown_.bind(this))},n.ShortcutService.prototype.registerShortcut=function(e,t){if(!(e instanceof n.Shortcut))throw"Invalid shortcut argument, please use instances of pskl.service.keyboard.Shortcut";if("function"!=typeof t)throw"Invalid callback argument, please provide a function";this.shortcuts_.push({shortcut:e,callback:t})},n.ShortcutService.prototype.unregisterShortcut=function(r){var i=-1;this.shortcuts_.forEach(function(e,t){e.shortcut===r&&(i=t)}),-1!=i&&this.shortcuts_.splice(i,1)},n.ShortcutService.prototype.onKeyDown_=function(r){var i=n.KeyUtils.createKeyFromEvent(r);!this.isInInput_(r)&&i&&this.shortcuts_.forEach(function(t){t.shortcut.getKeys().forEach(function(e){n.KeyUtils.equals(e,i)&&(!0!==t.callback(i.key)&&r.preventDefault(),$.publish(Events.KEYBOARD_EVENT,[r]))}.bind(this))}.bind(this))},n.ShortcutService.prototype.isInInput_=function(e){e=e.target.nodeName.toUpperCase();return"INPUT"===e||"TEXTAREA"===e},n.ShortcutService.prototype.getShortcutById=function(t){return pskl.utils.Array.find(this.getShortcuts(),function(e){return e.getId()===t})},n.ShortcutService.prototype.getShortcuts=function(){var r=[];return n.Shortcuts.CATEGORIES.forEach(function(e){var t=n.Shortcuts[e];Object.keys(t).forEach(function(e){r.push(t[e])})}),r},n.ShortcutService.prototype.updateShortcut=function(e,t){var r=t.replace(/\s/g,"");-1!=n.Shortcuts.FORBIDDEN_KEYS.indexOf(r)?$.publish(Events.SHOW_NOTIFICATION,[{content:"Key cannot be remapped ("+t+")",hideDelay:5e3}]):(this.removeKeyFromAllShortcuts_(r),e.updateKeys([r]),$.publish(Events.SHORTCUTS_CHANGED))},n.ShortcutService.prototype.removeKeyFromAllShortcuts_=function(t){this.getShortcuts().forEach(function(e){e.removeKeys([t])&&$.publish(Events.SHOW_NOTIFICATION,[{content:"Shortcut key removed for "+e.getId(),hideDelay:5e3}])})},n.ShortcutService.prototype.restoreDefaultShortcuts=function(){this.getShortcuts().forEach(function(e){e.restoreDefault()}),$.publish(Events.SHORTCUTS_CHANGED)}})(),(()=>{var e=$.namespace("pskl.service");e.ImportService=function(e){this.piskelController_=e},e.ImportService.prototype.init=function(){$.subscribe(Events.PISKEL_FILE_IMPORT_FAILED,this.onPiskelFileImportFailed_)},e.ImportService.prototype.onPiskelFileImportFailed_=function(e,t){$.publish(Events.SHOW_NOTIFICATION,[{content:"Piskel file import failed ("+t+")",hideDelay:1e4}])},e.ImportService.prototype.newPiskelFromImage=function(t,e,r){r=r||Constants.EMPTY_FUNCTION;var i=e.importType,n=e.name,o=e.smoothing,s=e.frameSizeX,a=e.frameSizeY,l=e.frameOffsetX,c=e.frameOffsetY,p=new window.SuperGif({gif:t});p.load({success:function(){var e=p.getFrames().map(function(e){return pskl.utils.CanvasUtils.createFromImageData(e.data)});e="single"===i||1<e.length?this.createPiskelFromImages_(e,n,s,a,o):(e=this.createImagesFromSheet_(e[0],s,a,l,c),this.createPiskelFromImages_(e,n,s,a,o)),r(e)}.bind(this),error:function(){var e;e="single"===i?this.createPiskelFromImages_([t],n,s,a,o):(e=this.createImagesFromSheet_(t,s,a,l,c),this.createPiskelFromImages_(e,n,s,a,o)),r(e)}.bind(this)})},e.ImportService.prototype.createImagesFromSheet_=function(e,t,r,i,n){return pskl.utils.CanvasUtils.createFramesFromImage(e,i,n,t,r,!0,!0)},e.ImportService.prototype.createPiskelFromImages_=function(e,t,r,i,n){t=t||"Imported piskel";e=this.createFramesFromImages_(e,r,i,n),r=pskl.model.Layer.fromFrames("Layer 1",e),i=new pskl.model.piskel.Descriptor(t,"");return pskl.model.Piskel.fromLayers([r],Constants.DEFAULT.FPS,i)},e.ImportService.prototype.createFramesFromImages_=function(e,t,r,i){return e.map(function(e){e=pskl.utils.ImageResizer.resize(e,t,r,i);return pskl.utils.FrameUtils.createFromImage(e)})}})(),(()=>{var e=$.namespace("pskl.service");e.ImageUploadService=function(){},e.ImageUploadService.prototype.init=function(){},e.ImageUploadService.prototype.upload=function(e,r,t){var e={data:e},i=pskl.utils.Environment.isHttps()?"https":"http",n=pskl.utils.Template.replace(Constants.IMAGE_SERVICE_UPLOAD_URL,{protocol:i});pskl.utils.Xhr.post(n,e,function(e){var t=pskl.utils.Template.replace(Constants.IMAGE_SERVICE_GET_URL,{protocol:i});r(t+e.responseText)},t)}})(),(()=>{var e=$.namespace("pskl.service");e.ClipboardService=function(e){this.piskelController=e},e.ClipboardService.prototype.init=function(){window.addEventListener("copy",this._onCopy.bind(this),!0),window.addEventListener("cut",this._onCut.bind(this),!0),window.addEventListener("paste",this._onPaste.bind(this),!0)},e.ClipboardService.prototype._onCut=function(e){$.publish(Events.CLIPBOARD_CUT,e)},e.ClipboardService.prototype._onCopy=function(e){$.publish(Events.CLIPBOARD_COPY,e)},e.ClipboardService.prototype._onPaste=function(e){$.publish(Events.CLIPBOARD_PASTE,e)}})(),(()=>{var e=$.namespace("pskl.service");e.CurrentColorsService=function(e){this.piskelController=e,this.cache={},this.currentColors=[],this.currentFrameColors=[],this.cachedFrameProcessor=new pskl.model.frame.AsyncCachedFrameProcessor,this.cachedFrameProcessor.setFrameProcessor(this.getFrameColors_.bind(this)),this.throttledUpdateCurrentColors_=pskl.utils.FunctionUtils.throttle(this.updateCurrentColors_.bind(this),1e3),this.throttledLoadColorsFromCache=pskl.utils.FunctionUtils.throttle(this.loadColorsFromCache_.bind(this),1e3),this.paletteService=pskl.app.paletteService},e.CurrentColorsService.prototype.init=function(){$.subscribe(Events.HISTORY_STATE_SAVED,this.throttledUpdateCurrentColors_),$.subscribe(Events.HISTORY_STATE_LOADED,this.throttledLoadColorsFromCache.bind(this)),$.subscribe(Events.CURRENT_FRAME_CHANGED,this.throttledUpdateCurrentColors_.bind(this)),$.subscribe(Events.CURRENT_LAYER_CHANGED,this.throttledUpdateCurrentColors_.bind(this)),$.subscribe(Events.CURRENT_PALETTE_CHANGED,this.throttledUpdateCurrentColors_.bind(this))},e.CurrentColorsService.prototype.getCurrentColors=function(){return this.currentColors},e.CurrentColorsService.prototype.getCurrentFrameColors=function(){return this.currentFrameColors},e.CurrentColorsService.prototype.setCurrentColors=function(e){var t=pskl.app.historyService.currentIndex;(this.cache[t]=e).join("")!==this.currentColors.join("")&&(this.currentColors=e,$.publish(Events.CURRENT_COLORS_UPDATED))},e.CurrentColorsService.prototype.updateCurrentFrameColors=function(e){var t=pskl.app.piskelController.getCurrentFrameIndex(),e=pskl.app.piskelController.getCurrentLayer().getFrameAt(t);this.updateFrameColors(e),$.publish(Events.CURRENT_COLORS_UPDATED)},e.CurrentColorsService.prototype.updateFrameColors=function(e){e.colorPalette=[],e.forEachPixel(function(e,t,r,i){0===e||i.colorPalette.includes(e)||i.colorPalette.push(e)}),this.currentFrameColors=e.colorPalette.map(function(e){return pskl.utils.intToHex(e)})},e.CurrentColorsService.prototype.applyCurrentPaletteToIndexedPixels=function(e,t,r){this.updateFrameColors(t),e.forEach(function(n,o){t.forEachPixel(function(e,t,r,i){0!==e&&i.colorPalette.indexOf(e)===o&&i.setPixel(t,r,n)})})},e.CurrentColorsService.prototype.isCurrentColorsPaletteSelected_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE);return this.paletteService.getPaletteById(e).id===Constants.CURRENT_COLORS_PALETTE_ID},e.CurrentColorsService.prototype.updateCurrentColors_=function(){((e,r)=>{var t=[];for(e=e.slice(0);e.length;)t.push(e.splice(0,10));var i=Q([]);return t.forEach(function(e){i=i.then(function(t){return Q.all(e.map(r)).then(function(e){return t.concat(e)})})}),i})(this.piskelController.getLayers().map(function(e){return e.getFrames()}).reduce(function(e,t){return e.concat(t)}),function(e){return this.cachedFrameProcessor.get(e)}.bind(this)).then(function(e){var t={},e=(e.forEach(function(e){Object.keys(e).forEach(function(e){t[e]=!0})}),delete t[pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)],Object.keys(t).map(function(e){return pskl.utils.intToHex(e)}));this.setCurrentColors(e),this.updateCurrentFrameColors()}.bind(this))},e.CurrentColorsService.prototype.isCurrentColorsPaletteSelected_=function(){var e=pskl.UserSettings.get(pskl.UserSettings.SELECTED_PALETTE),e=this.paletteService.getPaletteById(e);return e&&e.id===Constants.CURRENT_COLORS_PALETTE_ID},e.CurrentColorsService.prototype.loadColorsFromCache_=function(){var e=pskl.app.historyService.currentIndex,e=this.cache[e];e&&(this.setCurrentColors(e),this.updateCurrentColors_())},e.CurrentColorsService.prototype.getFrameColors_=function(e,t){new pskl.worker.framecolors.FrameColors(e,function(e){t(e.data.colors)},function(){},function(e){t({})}).process()}})(),(()=>{var e=$.namespace("pskl.service");e.FileDropperService=function(e){this.piskelController=e,this.dropPosition_=null},e.FileDropperService.prototype.init=function(){document.body.addEventListener("drop",this.onFileDrop.bind(this),!1),document.body.addEventListener("dragover",this.onFileDragOver.bind(this),!1)},e.FileDropperService.prototype.onFileDragOver=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},e.FileDropperService.prototype.onFileDrop=function(e){e.preventDefault(),e.stopPropagation(),this.dropPosition_={x:e.clientX,y:e.clientY};var t=e.dataTransfer.files;this.isMultipleFiles_=1<t.length;for(var r=0;r<t.length;r++){var i=t[r],n=0===i.type.indexOf("image"),o=/\.piskel$/i.test(i.name),s=/\.(gpl|txt|pal)$/i.test(i.name);n?pskl.utils.FileUtils.readImageFile(i,function(e){this.onImageLoaded_(e,i)}.bind(this)):o?pskl.utils.PiskelFileUtils.loadFromFile(i,this.onPiskelFileLoaded_,this.onPiskelFileError_):s&&pskl.app.paletteImportService.read(i,this.onPaletteLoaded_.bind(this))}},e.FileDropperService.prototype.onPaletteLoaded_=function(e){pskl.app.paletteService.savePalette(e),pskl.UserSettings.set(pskl.UserSettings.SELECTED_PALETTE,e.id)},e.FileDropperService.prototype.onPiskelFileLoaded_=function(e){window.confirm(Constants.CONFIRM_OVERWRITE)&&pskl.app.piskelController.setPiskel(e)},e.FileDropperService.prototype.onPiskelFileError_=function(e){$.publish(Events.PISKEL_FILE_IMPORT_FAILED,[e])},e.FileDropperService.prototype.onImageLoaded_=function(e,t){var r=pskl.app.piskelController.getWidth(),i=pskl.app.piskelController.getHeight();if(this.isMultipleFiles_)this.piskelController.addFrameAtCurrentIndex(),this.piskelController.selectNextFrame();else if(e.width>r||e.height>i)return void $.publish(Events.DIALOG_SHOW,{dialogId:"import",initArgs:{rawFiles:[t]}});r=this.piskelController.getCurrentFrame(),i=pskl.app.drawingController.getSpriteCoordinates(this.dropPosition_.x,this.dropPosition_.y),t=i.x;pskl.utils.FrameUtils.addImageToFrame(r,e,t,i.y),$.publish(Events.PISKEL_RESET),$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.SNAPSHOT})}})(),(()=>{var e=$.namespace("pskl.service");e.SelectedColorsService=function(){this.primaryColor_=Constants.DEFAULT_PEN_COLOR,this.secondaryColor_=Constants.TRANSPARENT_COLOR},e.SelectedColorsService.prototype.init=function(){$.subscribe(Events.PRIMARY_COLOR_SELECTED,this.onPrimaryColorUpdate_.bind(this)),$.subscribe(Events.SECONDARY_COLOR_SELECTED,this.onSecondaryColorUpdate_.bind(this))},e.SelectedColorsService.prototype.getPrimaryColor=function(){return this.primaryColor_},e.SelectedColorsService.prototype.getSecondaryColor=function(){return this.secondaryColor_},e.SelectedColorsService.prototype.onPrimaryColorUpdate_=function(e,t){this.primaryColor_=t},e.SelectedColorsService.prototype.onSecondaryColorUpdate_=function(e,t){this.secondaryColor_=t}})(),(()=>{var e=$.namespace("pskl.service");e.MouseStateService=function(){this.lastButtonPressed_=null},e.MouseStateService.prototype.init=function(){$.subscribe(Events.MOUSE_EVENT,this.onMouseEvent_.bind(this))},e.MouseStateService.prototype.isLeftButtonPressed=function(){return this.isMouseButtonPressed_(Constants.LEFT_BUTTON)},e.MouseStateService.prototype.isRightButtonPressed=function(){return this.isMouseButtonPressed_(Constants.RIGHT_BUTTON)},e.MouseStateService.prototype.isMiddleButtonPressed=function(){return this.isMouseButtonPressed_(Constants.MIDDLE_BUTTON)},e.MouseStateService.prototype.isMouseButtonPressed_=function(e){return null!=this.lastButtonPressed_&&this.lastButtonPressed_==e},e.MouseStateService.prototype.onMouseEvent_=function(e,t){"mousedown"==t.type?this.lastButtonPressed_=t.button:"mouseup"==t.type&&(this.lastButtonPressed_=null)}})(),(()=>{var t=$.namespace("pskl.service.performance");t.PerformanceReport=function(e,t){var r=e.getWidth()*e.getHeight(),i=(this.resolution=262144<r,e.getLayers().length),e=(this.layers=25<i,e.getLayerAt(0).size()),r=(this.frames=100<e,this.colors=256<=t,r/2620+4*i+e+100*t/256);this.overall=200<r},t.PerformanceReport.prototype.equals=function(e){return e instanceof t.PerformanceReport&&this.resolution==e.resolution&&this.layers==e.layers&&this.frames==e.frames&&this.colors==e.colors&&this.overall==e.overall},t.PerformanceReport.prototype.hasProblem=function(){return this.resolution||this.layers||this.frames||this.colors||this.overall}})(),(()=>{var t=$.namespace("pskl.service.performance");t.PerformanceReportService=function(e,t){this.piskelController=e,this.currentColorsService=t,this.currentReport=null},t.PerformanceReportService.prototype.init=function(){$.subscribe(Events.HISTORY_STATE_SAVED,this.createReport_.bind(this))},t.PerformanceReportService.prototype.createReport_=function(){var e=new t.PerformanceReport(this.piskelController.getPiskel(),this.currentColorsService.getCurrentColors().length);e.equals(this.currentReport)||($.publish(Events.PERFORMANCE_REPORT_CHANGED,[e]),this.currentReport=e)},t.PerformanceReportService.prototype.hasProblem=function(){return this.currentReport&&this.currentReport.hasProblem()}})(),$.namespace("pskl.tools"));ns.ToolsHelper={getTargetFrames:function(e,r){var i=pskl.app.piskelController.getCurrentFrameIndex();return(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).reduce(function(e,t){t=r?t.getFrames():[t.getFrameAt(i)];return e.concat(t)},[])}},(()=>{var e=$.namespace("pskl.tools");e.Tool=function(){this.toolId="tool",this.helpText="Abstract tool",this.tooltipDescriptors=[]},e.Tool.prototype.getHelpText=function(){return this.helpText},e.Tool.prototype.getId=function(){return this.toolId},e.Tool.prototype.raiseSaveStateEvent=function(e){$.publish(Events.PISKEL_SAVE_STATE,{type:pskl.service.HistoryService.REPLAY,scope:this,replay:e})}})(),(()=>{var e=$.namespace("pskl.tools");e.ToolIconBuilder=function(){},e.ToolIconBuilder.prototype.createIcon=function(e,t){t=t||"right";var r=pskl.utils.Template.get("drawingTool-item-template");return pskl.utils.Template.replace(r,{cssclass:["tool-icon","icon-"+e.toolId].join(" "),toolid:e.toolId,title:this.getTooltipText(e),tooltipposition:t})},e.ToolIconBuilder.prototype.getTooltipText=function(e){var t=e.tooltipDescriptors;return pskl.utils.TooltipFormatter.format(e.getHelpText(),e.shortcut,t)}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.BaseTool=function(){pskl.tool.Tool.call(this),this.toolId="tool-base"},pskl.utils.inherit(e.BaseTool,pskl.tools.Tool),e.BaseTool.prototype.applyToolAt=function(e,t,r,i,n){},e.BaseTool.prototype.moveToolAt=function(e,t,r,i,n){},e.BaseTool.prototype.replay=Constants.ABSTRACT_FUNCTION,e.BaseTool.prototype.supportsDynamicPenSize=function(){return!1},e.BaseTool.prototype.getToolColor=function(){return pskl.app.mouseStateService.isRightButtonPressed()?pskl.app.selectedColorsService.getSecondaryColor():pskl.app.selectedColorsService.getPrimaryColor()},e.BaseTool.prototype.moveUnactiveToolAt=function(e,t,r,i,n){i.containsPixel(e,t)?this.updateHighlightedPixel(r,i,e,t):this.hideHighlightedPixel(i)},e.BaseTool.prototype.updateHighlightedPixel=function(e,t,r,i){isNaN(this.highlightedPixelCol)||isNaN(this.highlightedPixelRow)||this.highlightedPixelRow==i&&this.highlightedPixelCol==r||t.clear();var e=pskl.utils.intToColor(e.getPixel(r,i)),n=this.getHighlightColor_(e),e=this.supportsDynamicPenSize()?pskl.app.penSizeService.getPenSize():1;pskl.PixelUtils.resizePixel(r,i,e).forEach(function(e){t.setPixel(e[0],e[1],n)}),this.highlightedPixelCol=r,this.highlightedPixelRow=i},e.BaseTool.prototype.getHighlightColor_=function(e){return!e||.5<window.tinycolor(e).toHsl().l?Constants.TOOL_HIGHLIGHT_COLOR_DARK:Constants.TOOL_HIGHLIGHT_COLOR_LIGHT},e.BaseTool.prototype.hideHighlightedPixel=function(e){null!==this.highlightedPixelRow&&null!==this.highlightedPixelCol&&(e.clear(),this.highlightedPixelRow=null,this.highlightedPixelCol=null)},e.BaseTool.prototype.releaseToolAt=function(e,t,r,i,n){},e.BaseTool.prototype.supportsAlt=function(){return!1}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.ShapeTool=function(){this.startCol=null,this.startRow=null,this.tooltipDescriptors=[{key:"shift",description:"Keep 1 to 1 ratio"}]},pskl.utils.inherit(e.ShapeTool,e.BaseTool),e.ShapeTool.prototype.supportsDynamicPenSize=function(){return!0},e.ShapeTool.prototype.applyToolAt=function(e,t,r,i,n){$.publish(Events.DRAG_START,[e,t]),this.startCol=e,this.startRow=t;var o=pskl.app.penSizeService.getPenSize();this.draw(e,t,this.getToolColor(),i,o)},e.ShapeTool.prototype.moveToolAt=function(e,t,r,i,n){e=this.getCoordinates_(e,t,n),$.publish(Events.CURSOR_MOVED,[e.col,e.row]),i.clear(),t=this.getToolColor(),t==Constants.TRANSPARENT_COLOR&&(t=Constants.SELECTION_TRANSPARENT_COLOR),n=pskl.app.penSizeService.getPenSize();this.draw(e.col,e.row,t,i,n)},e.ShapeTool.prototype.releaseToolAt=function(e,t,r,i,n){i.clear();i=this.getCoordinates_(e,t,n),e=this.getToolColor(),t=pskl.app.penSizeService.getPenSize();this.draw(i.col,i.row,e,r,t),$.publish(Events.DRAG_END),this.raiseSaveStateEvent({col:i.col,row:i.row,startCol:this.startCol,startRow:this.startRow,color:e,penSize:t})},e.ShapeTool.prototype.replay=function(e,t){this.startCol=t.startCol,this.startRow=t.startRow,this.draw(t.col,t.row,t.color,e,t.penSize)},e.ShapeTool.prototype.getCoordinates_=function(e,t,r){return r.shiftKey?this.getScaledCoordinates_(e,t):{col:e,row:t}},e.ShapeTool.prototype.getScaledCoordinates_=function(e,t){var r=this.startCol-e,i=Math.abs(r),n=this.startRow-t,o=Math.abs(n),s=Math.min(i,o);return t=this.startRow-n/o*s,{col:e=this.startCol-r/i*s,row:t}},e.ShapeTool.prototype.draw=Constants.ABSTRACT_FUNCTION})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.SimplePen=function(){this.toolId="tool-pen",this.helpText="Pen tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.PEN,this.previousCol=null,this.previousRow=null,this.pixels=[]},pskl.utils.inherit(e.SimplePen,e.BaseTool),e.SimplePen.prototype.supportsDynamicPenSize=function(){return!0},e.SimplePen.prototype.applyToolAt=function(e,t,r,i,n){this.previousCol=e,this.previousRow=t;var o=this.getToolColor();this.drawUsingPenSize(o,e,t,r,i)},e.SimplePen.prototype.drawUsingPenSize=function(t,e,r,i,n){var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,r,o).forEach(function(e){this.draw(t,e[0],e[1],i,n)}.bind(this))},e.SimplePen.prototype.draw=function(e,t,r,i,n){n.setPixel(t,r,e),e===Constants.TRANSPARENT_COLOR&&i.setPixel(t,r,e),this.pixels.push({col:t,row:r,color:e})},e.SimplePen.prototype.moveToolAt=function(e,t,r,i,n){if(1<Math.abs(e-this.previousCol)||1<Math.abs(t-this.previousRow))for(var o=pskl.PixelUtils.getLinePixels(e,this.previousCol,t,this.previousRow),s=0,a=o.length;s<a;s++){var l=o[s];this.applyToolAt(l.col,l.row,r,i,n)}else this.applyToolAt(e,t,r,i,n);this.previousCol=e,this.previousRow=t},e.SimplePen.prototype.releaseToolAt=function(e,t,r,i,n){this.setPixelsToFrame_(r,this.pixels),this.raiseSaveStateEvent({pixels:this.pixels.slice(0),color:this.getToolColor()}),this.resetUsedPixels_()},e.SimplePen.prototype.replay=function(e,t){this.setPixelsToFrame_(e,t.pixels,t.color)},e.SimplePen.prototype.setPixelsToFrame_=function(t,e,r){e.forEach(function(e){t.setPixel(e.col,e.row,e.color)})},e.SimplePen.prototype.resetUsedPixels_=function(){this.pixels=[]}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.Lighten=function(){this.superclass.constructor.call(this),this.toolId="tool-lighten",this.helpText="Lighten",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.LIGHTEN,this.tooltipDescriptors=[{key:"ctrl",description:"Darken"},{key:"shift",description:"Apply only once per pixel"}]},pskl.utils.inherit(e.Lighten,e.SimplePen),e.Lighten.prototype.applyToolAt=function(e,t,r,i,n){this.previousCol=e,this.previousRow=t;var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,t,o).forEach(function(e){var t=this.getModifiedColor_(e[0],e[1],r,i,n);this.draw(t,e[0],e[1],r,i)}.bind(this))},e.Lighten.prototype.getModifiedColor_=function(e,t,r,i,n){var i=i.getPixel(e,t),r=r.getPixel(e,t),e=i!==pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),t=e?i:r;return t===pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)?Constants.TRANSPARENT_COLOR:(i=n.shiftKey)&&e?t:(r=i?6:3,((pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey)?window.tinycolor.darken(pskl.utils.intToColor(t),r):window.tinycolor.lighten(pskl.utils.intToColor(t),r)).toHexString())}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.ShiftIndex=function(){this.superclass.constructor.call(this),this.toolId="tool-shift-index",this.helpText="ShiftIndex",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.SHIFT_INDEX,this.tooltipDescriptors=[{key:"ctrl",description:"Shift Index backwards"}]},pskl.utils.inherit(e.ShiftIndex,e.SimplePen),e.ShiftIndex.prototype.applyToolAt=function(e,t,r,i,n){var o;t===this.previousRow&&e===this.previousCol||(o=pskl.app.penSizeService.getPenSize(),pskl.PixelUtils.resizePixel(e,t,o).forEach(function(e){var t=this.getModifiedColor_(e[0],e[1],r,i,n);this.draw(t,e[0],e[1],r,i)}.bind(this))),this.previousCol=e,this.previousRow=t},e.ShiftIndex.prototype.getModifiedColor_=function(e,t,r,i,n){var o,i=i.getPixel(e,t),r=r.getPixel(e,t),e=i!==pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),t=e?i:r;return t===pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR)?Constants.TRANSPARENT_COLOR:e?t:(i=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey,r=pskl.utils.intToHex(t),n=(e=pskl.app.palettesListController.getSelectedPaletteColors_()).indexOf(pskl.app.selectedColorsService.getPrimaryColor()),e.splice(0,n),t=e.indexOf(r),o=e.indexOf(pskl.app.selectedColorsService.getSecondaryColor())+1,-1!==(t=(e=e.slice(n=t-t%o,n+o)).indexOf(r))&&(i?--t:t+=1,t<0?t=0:t>e.length-1&&(t=e.length-1),r=e[t]),r)}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.VerticalMirrorPen=function(){this.superclass.constructor.call(this),this.toolId="tool-vertical-mirror-pen",this.helpText="Vertical Mirror pen",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.MIRROR_PEN,this.tooltipDescriptors=[{key:"ctrl",description:"Use horizontal axis"},{key:"shift",description:"Use horizontal and vertical axis"}]},pskl.utils.inherit(e.VerticalMirrorPen,e.SimplePen),e.VerticalMirrorPen.prototype.applyToolAt=function(e,t,r,i,n){var o=this.getToolColor(),s=(this.drawUsingPenSize(o,e,t,r,i),this.getSymmetricCol_(e,r)),a=this.getSymmetricRow_(t,r),l=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey;l||this.drawUsingPenSize(o,s,t,r,i),(n.shiftKey||l)&&this.drawUsingPenSize(o,e,a,r,i),n.shiftKey&&this.drawUsingPenSize(o,s,a,r,i),this.previousCol=e,this.previousRow=t},e.VerticalMirrorPen.prototype.getSymmetricCol_=function(e,t){return t.getWidth()-e-this.getPenSizeOffset_()},e.VerticalMirrorPen.prototype.getSymmetricRow_=function(e,t){return t.getHeight()-e-this.getPenSizeOffset_()},e.VerticalMirrorPen.prototype.getPenSizeOffset_=function(e,t){return pskl.app.penSizeService.getPenSize()%2}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.Eraser=function(){this.superclass.constructor.call(this),this.toolId="tool-eraser",this.helpText="Eraser tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.ERASER},pskl.utils.inherit(e.Eraser,e.SimplePen),e.Eraser.prototype.getToolColor=function(){return Constants.TRANSPARENT_COLOR}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.Stroke=function(){this.toolId="tool-stroke",this.helpText="Stroke tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.STROKE,this.tooltipDescriptors=[{key:"shift",description:"Hold shift to draw straight lines"}],this.startCol=null,this.startRow=null},pskl.utils.inherit(e.Stroke,e.BaseTool),e.Stroke.prototype.supportsDynamicPenSize=function(){return!0},e.Stroke.prototype.applyToolAt=function(e,t,r,i,n){this.startCol=e,this.startRow=t,i.setPixel(e,t,this.getToolColor())},e.Stroke.prototype.moveToolAt=function(e,t,r,i,n){i.clear();var o=pskl.app.penSizeService.getPenSize(),n=n.shiftKey,s=this.getToolColor();s==Constants.TRANSPARENT_COLOR&&(s=Constants.SELECTION_TRANSPARENT_COLOR),this.draw_(e,t,s,i,o,n)},e.Stroke.prototype.releaseToolAt=function(e,t,r,i,n){var o=pskl.app.penSizeService.getPenSize(),n=n.shiftKey,s=this.getToolColor();this.draw_(e,t,s,r,o,n),i.clear(),this.raiseSaveStateEvent({col:e,row:t,startCol:this.startCol,startRow:this.startRow,color:s,penSize:o,isStraight:n})},e.Stroke.prototype.draw_=function(e,t,r,i,n,o){o=o?pskl.PixelUtils.getUniformLinePixels(this.startCol,e,this.startRow,t):pskl.PixelUtils.getLinePixels(e,this.startCol,t,this.startRow);pskl.PixelUtils.resizePixel(o[0].col,o[0].row,n).forEach(function(e){i.setPixel(e[0],e[1],r)}),pskl.PixelUtils.resizePixel(o[o.length-1].col,o[o.length-1].row,n).forEach(function(e){i.setPixel(e[0],e[1],r)}),o.forEach(function(e){for(var t=0;t<n;t++)i.setPixel(e.col-Math.floor(n/2)+t,e.row-Math.floor(n/2)+t,r),i.setPixel(e.col-Math.floor(n/2)+t,e.row+Math.ceil(n/2)-t-1,r),0!==t&&(i.setPixel(e.col-Math.floor(n/2)+t,e.row-Math.floor(n/2)+t-1,r),i.setPixel(e.col-Math.floor(n/2)+t,e.row+Math.ceil(n/2)-t,r))})},e.Stroke.prototype.replay=function(e,t){this.startCol=t.startCol,this.startRow=t.startRow,this.draw_(t.col,t.row,t.color,e,t.penSize,t.isStraight)}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.PaintBucket=function(){this.toolId="tool-paint-bucket",this.helpText="Paint bucket tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.PAINT_BUCKET,this.tooltipDescriptors=[{key:"ctrl",description:"Source only current layer"}]},pskl.utils.inherit(e.PaintBucket,e.BaseTool),e.PaintBucket.prototype.applyToolAt=function(e,t,r,i,n){var o=this.getToolColor(),s=r;(pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey)||(n=pskl.app.piskelController.getCurrentFrameIndex(),s=pskl.utils.LayerUtils.mergeFrameAt(pskl.app.piskelController.getLayers(),n)),pskl.PixelUtils.paintSimilarConnectedPixelsFromFrame(s,r,e,t,o),this.raiseSaveStateEvent({col:e,row:t,color:o})},e.PaintBucket.prototype.replay=function(e,t){pskl.PixelUtils.paintSimilarConnectedPixelsFromFrame(e,e,t.col,t.row,t.color)}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.Rectangle=function(){e.ShapeTool.call(this),this.toolId="tool-rectangle",this.helpText="Rectangle tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.RECTANGLE},pskl.utils.inherit(e.Rectangle,e.ShapeTool),e.Rectangle.prototype.draw=function(e,t,r,i,n){for(var o=pskl.PixelUtils.getOrderedRectangleCoordinates(this.startCol,this.startRow,e,t),s=o.x0;s<=o.x1;s++)for(var a=o.y0;a<=o.y1;a++)(s>o.x1-n||s<o.x0+n||a>o.y1-n||a<o.y0+n)&&i.setPixel(s,a,r)}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.Circle=function(){e.ShapeTool.call(this),this.toolId="tool-circle",this.helpText="Circle tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.CIRCLE},pskl.utils.inherit(e.Circle,e.ShapeTool),e.Circle.prototype.draw=function(e,t,r,i,n){this.getCirclePixels_(this.startCol,this.startRow,e,t,n).forEach(function(e){i.setPixel(e[0],e[1],r)})},e.Circle.prototype.getCirclePixels_=function(e,t,r,i,n){var o,s,a,l,e=pskl.PixelUtils.getOrderedRectangleCoordinates(e,t,r,i),c=[],p=Math.round((e.x0+e.x1)/2),h=Math.round((e.y0+e.y1)/2),u=(e.x0+e.x1)%2,d=(e.y0+e.y1)%2,f=e.x1-p,g=e.y1-h;if(1==n){for(o=e.x0;o<=p;o++)a=Math.acos((o-p)/f),s=Math.round(g*Math.sin(a)+h),c.push([o-u,s]),c.push([o-u,2*h-s-d]),c.push([2*p-o,s]),c.push([2*p-o,2*h-s-d]);for(s=e.y0;s<=h;s++)a=Math.asin((s-h)/g),o=Math.round(f*Math.cos(a)+p),c.push([o,s-d]),c.push([2*p-o-u,s-d]),c.push([o,2*h-s]),c.push([2*p-o-u,2*h-s])}else{var m=f-n,y=g-n;for(m<0&&(m=0),y<0&&(y=0),o=0;o<=f;o++)for(s=0;s<=g;s++)a=Math.atan(s/o),l=Math.sqrt(o*o+s*s),(f<=n||g<=n||l>m*y/Math.sqrt(y*y*Math.pow(Math.cos(a),2)+m*m*Math.pow(Math.sin(a),2))+.5)&&l<f*g/Math.sqrt(g*g*Math.pow(Math.cos(a),2)+f*f*Math.pow(Math.sin(a),2))+.5&&(c.push([p+o,h+s]),c.push([p-o-u,h+s]),c.push([p+o,h-s-d]),c.push([p-o-u,h-s-d]))}return c}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.Move=function(){this.toolId=e.Move.TOOL_ID,this.helpText="Move tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.MOVE,this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"},{key:"alt",description:"Wrap canvas borders"}],this.startCol=null,this.startRow=null},e.Move.TOOL_ID="tool-move",pskl.utils.inherit(e.Move,e.BaseTool),e.Move.prototype.applyToolAt=function(e,t,r,i,n){this.startCol=e,this.startRow=t,this.currentFrame=r,this.currentFrameClone=r.clone()},e.Move.prototype.moveToolAt=function(e,t,r,i,n){e-=this.startCol,t-=this.startRow;this.shiftFrame(e,t,r,this.currentFrameClone,n)},e.Move.prototype.shiftFrame=function(e,t,r,i,n){for(var o=r.getWidth(),s=r.getHeight(),a=0;a<o;a++)for(var l=0;l<s;l++){var c=a-e,p=l-t;n.altKey&&(c=(c+o)%o,p=(p+s)%s),c=i.containsPixel(c,p)?i.getPixel(c,p):Constants.TRANSPARENT_COLOR,r.setPixel(a,l,c)}},e.Move.prototype.releaseToolAt=function(e,t,r,i,n){var o=e-this.startCol,s=t-this.startRow,e=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey;pskl.tools.ToolsHelper.getTargetFrames(e,n.shiftKey).forEach(function(e){var t=this.currentFrame==e?this.currentFrameClone:e.clone();this.shiftFrame(o,s,e,t,n)}.bind(this)),this.raiseSaveStateEvent({colDiff:o,rowDiff:s,ctrlKey:e,altKey:n.altKey,shiftKey:n.shiftKey})},e.Move.prototype.replay=function(e,t){var r={shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.ctrlKey};pskl.tools.ToolsHelper.getTargetFrames(r.ctrlKey,r.shiftKey).forEach(function(e){this.shiftFrame(t.colDiff,t.rowDiff,e,e.clone(),r)}.bind(this))},e.Move.prototype.supportsAlt=function(){return!0}})(),(()=>{var e=$.namespace("pskl.tools.drawing.selection");e.BaseSelect=function(){this.secondaryToolId=pskl.tools.drawing.Move.TOOL_ID,this.startCol=null,this.startRow=null,this.lastMoveCol=null,this.lastMoveRow=null,this.selection=null,this.hasSelection=!1,this.tooltipDescriptors=[{description:"Drag the selection to move it. You may switch to other layers and frames."},{key:"ctrl+c",description:"Copy the selected area"},{key:"ctrl+v",description:"Paste the copied area"},{key:"shift",description:"Hold to move the content"}],$.subscribe(Events.SELECTION_DISMISSED,this.onSelectionDismissed_.bind(this))},pskl.utils.inherit(e.BaseSelect,pskl.tools.drawing.BaseTool),e.BaseSelect.prototype.applyToolAt=function(e,t,r,i,n){this.startCol=e,this.startRow=t,this.lastMoveCol=e,this.lastMoveRow=t,this.isInSelection(e,t)?(this.mode="moveSelection",n.shiftKey&&!this.isMovingContent_&&(this.isMovingContent_=!0,$.publish(Events.CLIPBOARD_CUT),this.drawSelectionOnOverlay_(i)),this.onSelectionMoveStart_(e,t,r,i)):(this.mode="select",this.onSelectStart_(e,t,r,i))},e.BaseSelect.prototype.moveToolAt=function(e,t,r,i,n){"select"==this.mode?this.onSelect_(e,t,r,i):"moveSelection"==this.mode&&this.onSelectionMove_(e,t,r,i)},e.BaseSelect.prototype.releaseToolAt=function(e,t,r,i,n){"select"==this.mode?this.onSelectEnd_(e,t,r,i):"moveSelection"==this.mode&&this.onSelectionMoveEnd_(e,t,r,i)},e.BaseSelect.prototype.moveUnactiveToolAt=function(e,t,r,i,n){i.containsPixel(e,t)&&(this.isInSelection(e,t)?(document.body.classList.add(this.secondaryToolId),document.body.classList.remove(this.toolId)):(document.body.classList.add(this.toolId),document.body.classList.remove(this.secondaryToolId))),this.hasSelection||pskl.tools.drawing.BaseTool.prototype.moveUnactiveToolAt.apply(this,arguments)},e.BaseSelect.prototype.isInSelection=function(t,r){return this.selection&&this.selection.pixels.some(function(e){return e.col===t&&e.row===r})},e.BaseSelect.prototype.commitSelection=function(){this.isMovingContent_&&($.publish(Events.CLIPBOARD_PASTE),this.isMovingContent_=!1),$.publish(Events.SELECTION_DISMISSED)},e.BaseSelect.prototype.onSelectionDismissed_=function(){pskl.app.drawingController.overlayFrame.clear(),this.hasSelection=!1},e.BaseSelect.prototype.drawSelectionOnOverlay_=function(e){for(var t=this.selection.pixels,r=0,i=t.length;r<i;r++){var n=t[r],n=n.color&&n.color!==Constants.TRANSPARENT_COLOR?this.getTransparentVariant_(n.color):Constants.SELECTION_TRANSPARENT_COLOR;e.setPixel(t[r].col,t[r].row,n)}},e.BaseSelect.prototype.getTransparentVariant_=pskl.utils.FunctionUtils.memo(function(e){e=window.tinycolor(e);return(e=window.tinycolor.lighten(e,10)).setAlpha(.5),e.toRgbString()},{}),e.BaseSelect.prototype.onSelectStart_=function(e,t,r,i){},e.BaseSelect.prototype.onSelect_=function(e,t,r,i){},e.BaseSelect.prototype.onSelectEnd_=function(e,t,r,i){},e.BaseSelect.prototype.onSelectionMoveStart_=function(e,t,r,i){},e.BaseSelect.prototype.onSelectionMove_=function(e,t,r,i){var n=e-this.lastMoveCol,o=t-this.lastMoveRow;this.startCol,this.startRow;this.selection.move(n,o),i.clear(),this.drawSelectionOnOverlay_(i),this.lastMoveCol=e,this.lastMoveRow=t},e.BaseSelect.prototype.onSelectionMoveEnd_=function(e,t,r,i){this.onSelectionMove_(e,t,r,i)}})(),(()=>{var e=$.namespace("pskl.tools.drawing.selection");e.AbstractDragSelect=function(){e.BaseSelect.call(this)},pskl.utils.inherit(e.AbstractDragSelect,e.BaseSelect),e.AbstractDragSelect.prototype.onSelectStart_=function(e,t,r,i){this.hasSelection?(this.hasSelection=!1,this.commitSelection()):(this.hasSelection=!0,this.onDragSelectStart_(e,t),i.setPixel(e,t,this.getTransparentVariant_(Constants.SELECTION_TRANSPARENT_COLOR)))},e.AbstractDragSelect.prototype.onSelect_=function(e,t,r,i){this.hasSelection||this.startCol===e&&this.startRow===t||(this.hasSelection=!0,this.onDragSelectStart_(e,t)),this.hasSelection&&this.onDragSelect_(e,t,r,i)},e.AbstractDragSelect.prototype.onSelectEnd_=function(e,t,r,i){this.hasSelection&&this.onDragSelectEnd_(e,t,r,i)},e.AbstractDragSelect.prototype.startDragSelection_=function(e,t,r){this.hasSelection=!0,this.onDragSelectStart_(e,t),r.setPixel(e,t,this.getTransparentVariant_(Constants.SELECTION_TRANSPARENT_COLOR))},e.AbstractDragSelect.prototype.onDragSelectStart_=function(e,t,r,i){},e.AbstractDragSelect.prototype.onDragSelect_=function(e,t,r,i){},e.AbstractDragSelect.prototype.onDragSelectEnd_=function(e,t,r,i){}})(),(()=>{var e=$.namespace("pskl.tools.drawing.selection");e.LassoSelect=function(){e.AbstractDragSelect.call(this),this.toolId="tool-lasso-select",this.helpText="Lasso selection",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.LASSO_SELECT},pskl.utils.inherit(e.LassoSelect,e.AbstractDragSelect),e.LassoSelect.prototype.onDragSelectStart_=function(e,t){this.pixels=[{col:e,row:t}],this.startCol=e,this.startRow=t,this.previousCol=e,this.previousRow=t,$.publish(Events.DRAG_START,[e,t])},e.LassoSelect.prototype.onDragSelect_=function(e,t,r,i){this.addPixel_(e,t,r);e=new pskl.selection.ShapeSelection(this.getLassoPixels_());this.setSelection_(e,i)},e.LassoSelect.prototype.onDragSelectEnd_=function(e,t,r,i){this.addPixel_(e,t,r);e=new pskl.selection.LassoSelection(this.getLassoPixels_(),r);this.setSelection_(e,i),$.publish(Events.DRAG_END)},e.LassoSelect.prototype.getLassoPixels_=function(){var e=pskl.PixelUtils.getLinePixels(this.previousCol,this.startCol,this.previousRow,this.startRow);return this.pixels.concat(e)},e.LassoSelect.prototype.addPixel_=function(e,t,r){e=pskl.utils.Math.minmax(e,0,r.getWidth()-1),t=pskl.utils.Math.minmax(t,0,r.getHeight()-1);r=pskl.PixelUtils.getLinePixels(e,this.previousCol,t,this.previousRow);this.pixels=this.pixels.concat(r),this.previousCol=e,this.previousRow=t},e.LassoSelect.prototype.setSelection_=function(e,t){this.selection=e,$.publish(Events.SELECTION_CREATED,[this.selection]),t.clear(),this.drawSelectionOnOverlay_(t)}})(),(()=>{var e=$.namespace("pskl.tools.drawing.selection");e.RectangleSelect=function(){e.AbstractDragSelect.call(this),this.toolId="tool-rectangle-select",this.helpText="Rectangle selection",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.RECTANGLE_SELECT},pskl.utils.inherit(e.RectangleSelect,e.AbstractDragSelect),e.RectangleSelect.prototype.onDragSelectStart_=function(e,t){$.publish(Events.DRAG_START,[e,t])},e.RectangleSelect.prototype.onDragSelect_=function(e,t,r,i){i.clear(),this.selection=new pskl.selection.RectangularSelection(this.startCol,this.startRow,e,t),$.publish(Events.SELECTION_CREATED,[this.selection]),this.drawSelectionOnOverlay_(i)},e.RectangleSelect.prototype.onDragSelectEnd_=function(e,t,r,i){this.onSelect_(e,t,r,i),$.publish(Events.DRAG_END)}})(),(()=>{var e=$.namespace("pskl.tools.drawing.selection");e.ShapeSelect=function(){e.BaseSelect.call(this),this.toolId="tool-shape-select",this.helpText="Shape selection",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.SHAPE_SELECT},pskl.utils.inherit(e.ShapeSelect,e.BaseSelect),e.ShapeSelect.prototype.onSelectStart_=function(e,t,r,i){this.hasSelection?(this.hasSelection=!1,this.commitSelection()):(this.hasSelection=!0,r=pskl.PixelUtils.getSimilarConnectedPixelsFromFrame(r,e,t),this.selection=new pskl.selection.ShapeSelection(r),$.publish(Events.SELECTION_CREATED,[this.selection]),this.drawSelectionOnOverlay_(i))}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.ColorPicker=function(){this.toolId="tool-colorpicker",this.helpText="Color picker",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.COLORPICKER},pskl.utils.inherit(e.ColorPicker,e.BaseTool),e.ColorPicker.prototype.applyToolAt=function(e,t,r,i,n){r.containsPixel(e,t)&&(r=pskl.utils.intToColor(r.getPixel(e,t)),pskl.app.mouseStateService.isLeftButtonPressed()?$.publish(Events.SELECT_PRIMARY_COLOR,[r]):pskl.app.mouseStateService.isRightButtonPressed()&&$.publish(Events.SELECT_SECONDARY_COLOR,[r]))}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.ColorSwap=function(){this.toolId="tool-colorswap",this.helpText="Paint all pixels of the same color",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.COLORSWAP,this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(e.ColorSwap,e.BaseTool),e.ColorSwap.prototype.applyToolAt=function(e,t,r,i,n){r.containsPixel(e,t)&&(r=r.getPixel(e,t),e=this.getToolColor(),t=pskl.utils.UserAgent.isMac?n.metaKey:n.ctrlKey,n=n.shiftKey,this.swapColors_(r,e,t,n),this.raiseSaveStateEvent({allLayers:t,allFrames:n,oldColor:r,newColor:e}))},e.ColorSwap.prototype.replay=function(e,t){this.swapColors_(t.oldColor,t.newColor,t.allLayers,t.allFrames)},e.ColorSwap.prototype.swapColors_=function(t,r,e,i){var n=pskl.app.piskelController.getCurrentFrameIndex();(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).forEach(function(e){(i?e.getFrames():[e.getFrameAt(n)]).forEach(function(e){this.applyToolOnFrame_(e,t,r)}.bind(this))}.bind(this))},e.ColorSwap.prototype.applyToolOnFrame_=function(i,n,o){n=pskl.utils.colorToInt(n),o=pskl.utils.colorToInt(o),i.forEachPixel(function(e,t,r){null!==e&&e==n&&i.setPixel(t,r,o)})}})(),(()=>{var e=$.namespace("pskl.tools.drawing");e.DitheringTool=function(){e.SimplePen.call(this),this.toolId="tool-dithering",this.helpText="Dithering tool",this.shortcut=pskl.service.keyboard.Shortcuts.TOOL.DITHERING},pskl.utils.inherit(e.DitheringTool,e.SimplePen),e.DitheringTool.prototype.supportsDynamicPenSize=function(){return!0},e.DitheringTool.prototype.applyToolAt=function(e,t,r,i,n){this.previousCol=e,this.previousRow=t;var o=pskl.app.penSizeService.getPenSize();pskl.PixelUtils.resizePixel(e,t,o).forEach(function(e){this.applyToolOnPixel(e[0],e[1],r,i,n)}.bind(this))},e.DitheringTool.prototype.applyToolOnPixel=function(e,t,r,i,n){var o=(e+t)%2,o=(o=pskl.app.mouseStateService.isRightButtonPressed()?!o:o)?pskl.app.selectedColorsService.getPrimaryColor():pskl.app.selectedColorsService.getSecondaryColor();this.draw(o,e,t,r,i)}})(),(()=>{var e=$.namespace("pskl.tools.transform");e.AbstractTransformTool=function(){},pskl.utils.inherit(e.AbstractTransformTool,pskl.tools.Tool),e.AbstractTransformTool.prototype.applyTransformation=function(e){var t=e.shiftKey,r=pskl.utils.UserAgent.isMac?e.metaKey:e.ctrlKey;this.applyTool_(e.altKey,t,r),$.publish(Events.PISKEL_RESET),this.raiseSaveStateEvent({altKey:e.altKey,allFrames:t,allLayers:r})},e.AbstractTransformTool.prototype.applyTool_=function(t,r,e){var i=pskl.app.piskelController.getCurrentFrameIndex();(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).forEach(function(e){(r?e.getFrames():[e.getFrameAt(i)]).forEach(function(e){this.applyToolOnFrame_(e,t)}.bind(this))}.bind(this))},e.AbstractTransformTool.prototype.replay=function(e,t){this.applyTool_(t.altKey,t.allFrames,t.allLayers)}})(),(()=>{var t=$.namespace("pskl.tools.transform");t.Center=function(){this.toolId="tool-center",this.helpText="Align image to the center",this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(t.Center,t.AbstractTransformTool),t.Center.prototype.applyToolOnFrame_=function(e){t.TransformUtils.center(e)}})(),(()=>{var e=$.namespace("pskl.tools.transform");e.Clone=function(){this.toolId="tool-clone",this.helpText="Clone current layer to all frames",this.tooltipDescriptors=[]},pskl.utils.inherit(e.Clone,e.AbstractTransformTool),e.Clone.prototype.applyTool_=function(e,t,r){var i=pskl.app.piskelController.getCurrentFrame();pskl.app.piskelController.getCurrentLayer().getFrames().forEach(function(e){e!==i&&e.setPixels(i.getPixels())})}})(),(()=>{var e=$.namespace("pskl.tools.transform");e.Crop=function(){this.toolId="tool-crop",this.helpText="Crop the sprite",this.tooltipDescriptors=[{description:"Crop to fit the content or the selection. Applies to all frames and layers!"}]},pskl.utils.inherit(e.Crop,pskl.tools.Tool),e.Crop.prototype.applyTransformation=function(e){var t=this.getFrames_(),r=pskl.app.selectionManager.currentSelection?this.getBoundariesForSelection_():pskl.tools.transform.TransformUtils.getBoundaries(t);this.applyTool_(t,r)&&this.raiseSaveStateEvent({boundaries:r})},e.Crop.prototype.replay=function(e,t){var r=this.getFrames_();this.applyTool_(r,t.boundaries)},e.Crop.prototype.applyTool_=function(e,t){if(t.minx>=t.maxx)return!1;var r=pskl.app.piskelController.getPiskel(),i=1+t.maxx-t.minx,n=1+t.maxy-t.miny;if(i===r.getWidth()&&n===r.getHeight())return!1;e.forEach(function(e){pskl.tools.transform.TransformUtils.moveFramePixels(e,-t.minx,-t.miny)});i=pskl.utils.ResizeUtils.resizePiskel(r,{width:1+t.maxx-t.minx,height:1+t.maxy-t.miny,origin:"TOP-LEFT",resizeContent:!1});return $.publish(Events.SELECTION_DISMISSED),pskl.app.piskelController.setPiskel(i,{preserveState:!0,noSnapshot:!0}),!0},e.Crop.prototype.getFrames_=function(){return pskl.app.piskelController.getPiskel().getLayers().map(function(e){return e.getFrames()}).reduce(function(e,t){return e.concat(t)})},e.Crop.prototype.getBoundariesForSelection_=function(){var i=pskl.app.selectionManager.currentSelection.pixels,n=pskl.app.piskelController.getPiskel().getLayerAt(0).getFrameAt(0);return pskl.tools.transform.TransformUtils.getBoundaries([{forEachPixel:function(e){for(var t=0;t<i.length;t++){var r=i[t];n.containsPixel(r.col,r.row)&&e(1,r.col,r.row)}}}])}})(),(()=>{var r=$.namespace("pskl.tools.transform");r.Flip=function(){this.toolId="tool-flip",this.helpText="Flip horizontally",this.tooltipDescriptors=[{key:"alt",description:"Flip vertically"},{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(r.Flip,r.AbstractTransformTool),r.Flip.prototype.applyToolOnFrame_=function(e,t){t=t?r.TransformUtils.HORIZONTAL:r.TransformUtils.VERTICAL;r.TransformUtils.flip(e,t)}})(),(()=>{var r=$.namespace("pskl.tools.transform");r.Rotate=function(){this.toolId="tool-rotate",this.helpText="Counter-clockwise rotation",this.tooltipDescriptors=[{key:"alt",description:"Clockwise rotation"},{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(r.Rotate,r.AbstractTransformTool),r.Rotate.prototype.applyToolOnFrame_=function(e,t){t=t?r.TransformUtils.CLOCKWISE:r.TransformUtils.COUNTERCLOCKWISE;r.TransformUtils.rotate(e,t)}})(),(()=>{var e=$.namespace("pskl.tools.transform");e.PaletteApply=function(){this.toolId="tool-colorswap",this.helpText="Apply the currently selected palette's colors to a frame via their index numbers",this.tooltipDescriptors=[{key:"ctrl",description:"Apply to all layers"},{key:"shift",description:"Apply to all frames"}]},pskl.utils.inherit(e.PaletteApply,e.AbstractTransformTool),e.PaletteApply.prototype.applyToolOnFrame_=function(e,t){var r=pskl.utils.UserAgent.isMac?event.metaKey:event.ctrlKey,i=event.shiftKey,n=pskl.app.palettesListController.getSelectedPaletteColors_();this.swapColors_(n,r,i)},e.PaletteApply.prototype.swapColors_=function(t,e,r){var i=pskl.app.piskelController.getCurrentFrameIndex();(e?pskl.app.piskelController.getLayers():[pskl.app.piskelController.getCurrentLayer()]).forEach(function(e){(r?e.getFrames():[e.getFrameAt(i)]).forEach(function(e){pskl.app.currentColorsService.applyCurrentPaletteToIndexedPixels(t,e,!0)}.bind(this))}.bind(this))}})(),(()=>{var d=$.namespace("pskl.tools.transform");d.TransformUtils={VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL",flip:function(i,n){var e=i.clone(),o=i.getWidth(),s=i.getHeight();return e.forEachPixel(function(e,t,r){n===d.TransformUtils.VERTICAL?t=o-t-1:n===d.TransformUtils.HORIZONTAL&&(r=s-r-1),i.setPixel(t,r,e)}),i},CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise",rotate:function(a,l){var c=a.clone(),e=a.getWidth(),t=a.getHeight(),p=Math.max(e,t),h=Math.ceil((p-e)/2),u=Math.ceil((p-t)/2);return a.forEachPixel(function(e,t,r){var i=t,n=r,o=t+=h,s=r+=u;l===d.TransformUtils.CLOCKWISE?(t=s,r=p-1-o):l===d.TransformUtils.COUNTERCLOCKWISE&&(r=o,t=p-1-s),c.containsPixel(t-=h,r-=u)?a.setPixel(i,n,c.getPixel(t,r)):a.setPixel(i,n,Constants.TRANSPARENT_COLOR)}),a},getBoundaries:function(e){var i=1/0,n=1/0,o=0,s=0,a=pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR);return e.forEach(function(e){e.forEachPixel(function(e,t,r){e!==a&&(i=Math.min(i,t),o=Math.max(o,t),n=Math.min(n,r),s=Math.max(s,r))})}),{minx:i,maxx:o,miny:n,maxy:s}},moveFramePixels:function(o,s,a){var l=o.clone();o.forEachPixel(function(e,t,r){var i=t,n=r;l.containsPixel(t-=s,r-=a)?o.setPixel(i,n,l.getPixel(t,r)):o.setPixel(i,n,Constants.TRANSPARENT_COLOR)})},center:function(e){var t=d.TransformUtils.getBoundaries([e]),r=(t.maxx-t.minx+1)/2,i=(t.maxy-t.miny+1)/2,n=e.width/2,o=e.height/2,n=Math.floor(n-r-t.minx),r=Math.floor(o-i-t.miny);return d.TransformUtils.moveFramePixels(e,n,r),e}}})(),(()=>{var e=$.namespace("pskl.worker.framecolors");if("rgba(0, 0, 0, 0)"!==Constants.TRANSPARENT_COLOR)throw"Constants.TRANSPARENT_COLOR, please update FrameColorsWorker";e.FrameColorsWorker=function(){this.onmessage=function(e){try{this.TRANSPARENT_COLOR=e.data[0],this.MAX_WORKER_COLORS=e.data[1];var t=function(e){for(var t={},r=this.TRANSPARENT_COLOR,i=0,n=0,o=e.length;n<o&&i<this.MAX_WORKER_COLORS;n++){var s=e[n];s===r||t[s]||(t[s]=!0,i++)}return t}(e.data[2]);this.postMessage({type:"SUCCESS",colors:t})}catch(e){this.postMessage({type:"ERROR",message:e.message})}}}})(),(()=>{var n=$.namespace("pskl.worker.framecolors");n.FrameColors=function(e,t,r,i){this.pixels=e.pixels,this.onStep=r,this.onSuccess=t,this.onError=i,this.worker=pskl.utils.WorkerUtils.createWorker(n.FrameColorsWorker,"frame-colors"),this.worker.onmessage=this.onWorkerMessage.bind(this)},n.FrameColors.prototype.process=function(){this.worker.postMessage([pskl.utils.colorToInt(Constants.TRANSPARENT_COLOR),Constants.MAX_WORKER_COLORS,this.pixels])},n.FrameColors.prototype.onWorkerMessage=function(e){"STEP"===e.data.type?this.onStep(e):"SUCCESS"===e.data.type?(this.onSuccess(e),this.worker.terminate()):"ERROR"===e.data.type&&(this.onError(e),this.worker.terminate())}})(),$.namespace("pskl.worker.hash").HashWorker=function(){this.onmessage=function(e){try{var t=(e=>{var t=0;if(0!==e.length)for(var r=0,i=e.length;r<i;r++){t=(t<<5)-t+e.charCodeAt(r);t|=0}return t})(e.data.str);this.postMessage({type:"SUCCESS",hash:t})}catch(e){this.postMessage({type:"ERROR",message:e.message})}}},(()=>{var n=$.namespace("pskl.worker.hash");n.Hash=function(e,t,r,i){this.str=e,this.onStep=r,this.onSuccess=t,this.onError=i,this.worker=pskl.utils.WorkerUtils.createWorker(n.HashWorker,"hash"),this.worker.onmessage=this.onWorkerMessage.bind(this)},n.Hash.prototype.process=function(){this.worker.postMessage({str:this.str})},n.Hash.prototype.onWorkerMessage=function(e){"STEP"===e.data.type?this.onStep(e):"SUCCESS"===e.data.type?(this.onSuccess(e),this.worker.terminate()):"ERROR"===e.data.type&&(this.onError(e),this.worker.terminate())}})(),$.namespace("pskl.worker.imageprocessor").ImageProcessorWorker=function(){function n(e,t,r){for(var i=((e,t,r,i)=>{for(var n=[],o=0;o<t;o++){n[o]=[],c();for(var s=0;s<r;s++){var a=4*(s*t+o),l=e[a];n[o][s]=e[3+a]<125?i:p(l,e[1+a],e[2+a])}}return n})(e,t,r,"transparent"),n={},o=0;o<i.length;o++){c();for(var s=0;s<i[o].length;s++){var a=i[o][s];"transparent"!=a&&(n[a]=!0)}}return n}var o,s,a,c=function(){var e=((o+=1)/a*100).toFixed(1);e!=s&&(s=e,this.postMessage({type:"STEP",progress:s,currentStep:o,total:a}))},i=function(e){e=e.toString(16);return 1==e.length?"0"+e:e},p=function(e,t,r){return"#"+i(e)+i(t)+i(r)};this.onmessage=function(e){try{var t=e.data,r=(i=2*t.width,s=o=0,a=i,n(t.imageData,t.width,t.height));this.postMessage({type:"SUCCESS",colorsMap:r})}catch(e){this.postMessage({type:"ERROR",message:e.message})}var i}},(()=>{var n=$.namespace("pskl.worker.imageprocessor");n.ImageProcessor=function(e,t,r,i){this.image=e,this.onStep=r,this.onSuccess=t,this.onError=i,this.worker=pskl.utils.WorkerUtils.createWorker(n.ImageProcessorWorker,"image-colors-processor"),this.worker.onmessage=this.onWorkerMessage.bind(this)},n.ImageProcessor.prototype.process=function(){var e=pskl.utils.CanvasUtils.createFromImage(this.image),e=pskl.utils.CanvasUtils.getImageDataFromCanvas(e);this.worker.postMessage({imageData:e,width:this.image.width,height:this.image.height})},n.ImageProcessor.prototype.onWorkerMessage=function(e){"STEP"===e.data.type?this.onStep(e):"SUCCESS"===e.data.type?(this.onSuccess(e),this.worker.terminate()):"ERROR"===e.data.type&&(this.onError(e),this.worker.terminate())}})(),$.namespace("pskl").app={init:function(){this.isAppEngineVersion=!!pskl.appEngineToken_,this.sessionId=pskl.utils.Uuid.generate(),this.shortcutService=new pskl.service.keyboard.ShortcutService,this.shortcutService.init();var e=pskl.UserSettings.get(pskl.UserSettings.DEFAULT_SIZE),t=Constants.DEFAULT.FPS,r=new pskl.model.piskel.Descriptor("New Piskel",""),t=new pskl.model.Piskel(e.width,e.height,t,r),r=new pskl.model.Layer("Layer 1"),e=new pskl.model.Frame(e.width,e.height),e=(r.addFrame(e),t.addLayer(r),this.corePiskelController=new pskl.controller.piskel.PiskelController(t),this.corePiskelController.init(),this.piskelController=new pskl.controller.piskel.PublicPiskelController(this.corePiskelController),this.piskelController.init(),this.paletteImportService=new pskl.service.palette.PaletteImportService,this.paletteImportService.init(),this.paletteService=new pskl.service.palette.PaletteService,this.paletteService.addDynamicPalette(new pskl.service.palette.CurrentColorsPalette),this.paletteService.addDynamicPalette(new pskl.service.palette.CurrentFrameColorsPalette),this.selectedColorsService=new pskl.service.SelectedColorsService,this.selectedColorsService.init(),this.mouseStateService=new pskl.service.MouseStateService,this.mouseStateService.init(),this.paletteController=new pskl.controller.PaletteController,this.paletteController.init(),this.currentColorsService=new pskl.service.CurrentColorsService(this.piskelController),this.currentColorsService.init(),this.palettesListController=new pskl.controller.PalettesListController(this.currentColorsService),this.palettesListController.init(),this.cursorCoordinatesController=new pskl.controller.CursorCoordinatesController(this.piskelController),this.cursorCoordinatesController.init(),this.drawingController=new pskl.controller.DrawingController(this.piskelController,document.querySelector("#drawing-canvas-container")),this.drawingController.init(),this.previewController=new pskl.controller.preview.PreviewController(this.piskelController,document.querySelector("#animated-preview-canvas-container")),this.previewController.init(),this.minimapController=new pskl.controller.MinimapController(this.piskelController,this.previewController,this.drawingController,document.querySelector(".minimap-container")),this.minimapController.init(),this.framesListController=new pskl.controller.FramesListController(this.piskelController,document.querySelector("#preview-list-wrapper")),this.framesListController.init(),this.layersListController=new pskl.controller.LayersListController(this.piskelController),this.layersListController.init(),this.settingsController=new pskl.controller.settings.SettingsController(this.piskelController),this.settingsController.init(),this.dialogsController=new pskl.controller.dialogs.DialogsController(this.piskelController),this.dialogsController.init(),this.toolController=new pskl.controller.ToolController,this.toolController.init(),this.selectionManager=new pskl.selection.SelectionManager(this.piskelController),this.selectionManager.init(),this.historyService=new pskl.service.HistoryService(this.piskelController),this.historyService.init(),this.notificationController=new pskl.controller.NotificationController,this.notificationController.init(),this.transformationsController=new pskl.controller.TransformationsController,this.transformationsController.init(),this.progressBarController=new pskl.controller.ProgressBarController,this.progressBarController.init(),this.canvasBackgroundController=new pskl.controller.CanvasBackgroundController,this.canvasBackgroundController.init(),this.indexedDbStorageService=new pskl.service.storage.IndexedDbStorageService(this.piskelController),this.indexedDbStorageService.init(),this.localStorageService=new pskl.service.storage.LocalStorageService(this.piskelController),this.localStorageService.init(),this.fileDownloadStorageService=new pskl.service.storage.FileDownloadStorageService(this.piskelController),this.fileDownloadStorageService.init(),this.desktopStorageService=new pskl.service.storage.DesktopStorageService(this.piskelController),this.desktopStorageService.init(),this.galleryStorageService=new pskl.service.storage.GalleryStorageService(this.piskelController),this.galleryStorageService.init(),this.storageService=new pskl.service.storage.StorageService(this.piskelController),this.storageService.init(),this.importService=new pskl.service.ImportService(this.piskelController),this.importService.init(),this.imageUploadService=new pskl.service.ImageUploadService,this.imageUploadService.init(),this.savedStatusService=new pskl.service.SavedStatusService(this.piskelController,this.historyService),this.savedStatusService.init(),this.backupService=new pskl.service.BackupService(this.piskelController),this.backupService.init(),this.beforeUnloadService=new pskl.service.BeforeUnloadService(this.piskelController),this.beforeUnloadService.init(),this.headerController=new pskl.controller.HeaderController(this.piskelController,this.savedStatusService),this.headerController.init(),this.penSizeService=new pskl.service.pensize.PenSizeService,this.penSizeService.init(),this.penSizeController=new pskl.controller.PenSizeController,this.penSizeController.init(),this.fileDropperService=new pskl.service.FileDropperService(this.piskelController),this.fileDropperService.init(),this.userWarningController=new pskl.controller.UserWarningController(this.piskelController),this.userWarningController.init(),this.performanceReportService=new pskl.service.performance.PerformanceReportService(this.piskelController,this.currentColorsService),this.performanceReportService.init(),this.clipboardService=new pskl.service.ClipboardService(this.piskelController),this.clipboardService.init(),this.drawingLoop=new pskl.rendering.DrawingLoop,this.drawingLoop.addCallback(this.render,this),this.drawingLoop.start(),this.initTooltips_(),this.getPiskelInitData_());e&&e.piskel&&this.loadPiskel_(e),pskl.devtools&&pskl.devtools.init(),pskl.utils.Environment.detectNodeWebkit()&&pskl.utils.UserAgent.isMac&&((t=new(r=require("nw.gui")).Menu({type:"menubar"})).createMacBuiltin("Piskel"),r.Window.get().menu=t),!pskl.utils.Environment.isIntegrationTest()&&pskl.utils.UserAgent.isUnsupported()&&$.publish(Events.DIALOG_SHOW,{dialogId:"unsupported-browser"}),pskl.utils.Environment.isDebug()&&pskl.app.shortcutService.registerShortcut(pskl.service.keyboard.Shortcuts.DEBUG.RELOAD_STYLES,window.reloadStyles)},loadPiskel_:function(t){var e=t.piskel;pskl.utils.serialization.Deserializer.deserialize(e,function(e){pskl.app.piskelController.setPiskel(e),$.publish(Events.PISKEL_SAVED),t.descriptor&&e.setDescriptor(t.descriptor)})},getPiskelInitData_:function(){return pskl.appEnginePiskelData_},isLoggedIn:function(){var e=this.getPiskelInitData_();return e&&e.isLoggedIn},initTooltips_:function(){$("body").tooltip({selector:"[rel=tooltip]"})},render:function(e){this.drawingController.render(e),this.previewController.render(e),this.framesListController.render(e)},getFirstFrameAsPng:function(){var e=pskl.utils.LayerUtils.mergeFrameAt(this.piskelController.getLayers(),0),e=e instanceof pskl.model.frame.RenderedFrame?pskl.utils.CanvasUtils.createFromImage(e.getRenderedFrame()):pskl.utils.FrameUtils.toImage(e);return e.toDataURL("image/png")},getFramesheetAsPng:function(){return new pskl.rendering.PiskelRenderer(this.piskelController).renderAsCanvas().toDataURL("image/png")}};