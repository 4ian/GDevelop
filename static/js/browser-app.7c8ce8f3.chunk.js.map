{"version":3,"file":"static/js/browser-app.7c8ce8f3.chunk.js","mappings":"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","sources":["ResourcesList/BrowserResourceSources.js","Utils/BrowserExternalWindowUtils.js","ResourcesList/BrowserResourceExternalEditors.js","ExportAndShare/BrowserExporters/BrowserPreview/BrowserPreviewErrorDialog.js","ExportAndShare/BrowserExporters/BrowserSWPreviewLauncher/BrowserSWPreviewIndexedDB.js","ExportAndShare/BrowserExporters/BrowserSWFileSystem.js","GameEngineFinder/BrowserS3GDJSFinder.js","ExportAndShare/BrowserExporters/BrowserPreview/BrowserPreviewDebuggerServer.js","ExportAndShare/BrowserExporters/BrowserPreview/BrowserPreviewWindow.js","ExportAndShare/BrowserExporters/BrowserSWPreviewLauncher/index.js","Utils/GDevelopServices/Preview.js","ExportAndShare/BrowserExporters/BrowserS3FileSystem.js","ExportAndShare/BrowserExporters/BrowserS3PreviewLauncher/index.js","ExportAndShare/BrowserExporters/BrowserFileSystem.js","ExportAndShare/BrowserExporters/BrowserOnlineCordovaExport.js","ExportAndShare/BrowserExporters/BrowserOnlineCordovaIosExport.js","ExportAndShare/BrowserExporters/BrowserOnlineElectronExport.js","ExportAndShare/BrowserExporters/BrowserOnlineWebExport.js","ExportAndShare/BrowserExporters/BrowserHTML5Export.js","ExportAndShare/BrowserExporters/BrowserCordovaExport.js","ExportAndShare/BrowserExporters/BrowserElectronExport.js","ExportAndShare/BrowserExporters/BrowserFacebookInstantGamesExport.js","ExportAndShare/BrowserExporters/index.js","JsExtensionsLoader/BrowserJsExtensionsLoader.js","EventsFunctionsExtensionsLoader/CodeWriters/BrowserSWEventsFunctionCodeWriter.js","EventsFunctionsExtensionsLoader/CodeWriters/BrowserS3EventsFunctionCodeWriter.js","ProjectsStorage/DownloadFileStorageProvider/DownloadFileSaveAsDialog.js","ProjectsStorage/DownloadFileStorageProvider/index.js","ProjectsStorage/ResourceMover/BrowserResourceMover.js","ProjectsStorage/ResourceFetcher/BrowserResourceFetcher.js","EventsFunctionsExtensionsLoader/Storage/BrowserEventsFunctionsExtensionOpener.js","EventsFunctionsExtensionsLoader/Storage/BrowserEventsFunctionsExtensionWriter.js","LoginProvider/BrowserLoginProvider.js","BrowserApp.js"],"sourcesContent":["// @flow\nimport { t, Trans } from '@lingui/macro';\nimport * as React from 'react';\nimport {\n  type ResourceSourceComponentProps,\n  type ResourceSourceComponentPrimaryActionProps,\n  type ResourceSource,\n  type ResourceStoreChooserProps,\n  allResourceKindsAndMetadata,\n  resourcesKindSupportedByResourceStore,\n} from './ResourceSource';\nimport { ResourceStore } from '../AssetStore/ResourceStore';\nimport path from 'path-browserify';\nimport { Line } from '../UI/Grid';\nimport { ColumnStackLayout, TextFieldWithButtonLayout } from '../UI/Layout';\nimport RaisedButton from '../UI/RaisedButton';\nimport SemiControlledTextField from '../UI/SemiControlledTextField';\nimport { useDebounce } from '../Utils/UseDebounce';\nimport axios from 'axios';\nimport AlertMessage from '../UI/AlertMessage';\nimport { FileToCloudProjectResourceUploader } from './FileToCloudProjectResourceUploader';\nimport {\n  extractDecodedFilenameWithExtensionFromPublicAssetResourceUrl,\n  isPublicAssetResourceUrl,\n} from '../Utils/GDevelopServices/Asset';\nimport { DialogPrimaryButton } from '../UI/Dialog';\nimport ProjectResourcesChooser from './ProjectResources/ProjectResourcesChooser';\n\nconst ResourceStoreChooser = ({\n  options,\n  selectedResourceIndex,\n  onSelectResource,\n}: ResourceStoreChooserProps) => {\n  if (!onSelectResource) return null;\n  const { resourceKind } = options;\n  if (!resourcesKindSupportedByResourceStore.includes(resourceKind)) {\n    return null;\n  }\n\n  return (\n    <ResourceStore\n      selectedResourceIndex={selectedResourceIndex}\n      onSelectResource={onSelectResource}\n      resourceKind={\n        // $FlowIgnore - Flow does not understand the check above restricts the resource kind.\n        resourceKind\n      }\n    />\n  );\n};\n\nexport const UrlChooser = ({\n  options,\n  onChooseResources,\n  createNewResource,\n}: ResourceStoreChooserProps) => {\n  const [inputValue, setInputValue] = React.useState('');\n  const [error, setError] = React.useState<?Error>(null);\n  const [urlsErroredBooleanArray, setUrlsErroredBooleanArray] = React.useState<\n    boolean[]\n  >([]);\n  const hasErroredUrls = !!urlsErroredBooleanArray.filter(Boolean).length;\n\n  const validateInputValue = useDebounce(async (inputValue: string) => {\n    const urls = options.multiSelection\n      ? inputValue.split('\\n').filter(Boolean)\n      : [inputValue];\n    setError(null);\n    setUrlsErroredBooleanArray([]);\n\n    try {\n      const responses = await Promise.all(\n        urls.map(async url => {\n          return await axios.get(url, {\n            timeout: 1000,\n            validateStatus: status => true,\n          });\n        })\n      );\n\n      setUrlsErroredBooleanArray(\n        responses.map(\n          response => !(response.status >= 200 && response.status < 400)\n        )\n      );\n    } catch (error) {\n      setError(error);\n    }\n  }, 500);\n\n  React.useEffect(\n    () => {\n      validateInputValue(inputValue);\n    },\n    [inputValue, validateInputValue]\n  );\n\n  return (\n    <ColumnStackLayout noMargin expand>\n      <Line noMargin>\n        <TextFieldWithButtonLayout\n          renderButton={style => (\n            <RaisedButton\n              onClick={() => {\n                if (!onChooseResources || !createNewResource) return;\n                const urls = options.multiSelection\n                  ? inputValue.split('\\n').filter(Boolean)\n                  : [inputValue];\n\n                onChooseResources(\n                  urls.map(url => {\n                    const newResource = createNewResource();\n                    newResource.setFile(url);\n                    newResource.setName(path.basename(url));\n                    newResource.setOrigin('url', url);\n\n                    return newResource;\n                  })\n                );\n              }}\n              primary\n              label={<Trans>Choose</Trans>}\n              style={style}\n              disabled={!!error || hasErroredUrls}\n            />\n          )}\n          renderTextField={() => (\n            <SemiControlledTextField\n              floatingLabelText={\n                options.multiSelection ? (\n                  <Trans>Resource(s) URL(s) (one per line)</Trans>\n                ) : (\n                  <Trans>Resource URL</Trans>\n                )\n              }\n              value={inputValue}\n              onChange={setInputValue}\n              multiline={options.multiSelection}\n              rows={1}\n              rowsMax={5}\n              fullWidth\n              errorText={\n                error ? (\n                  <Trans>\n                    There was an error verifying the URL(s). Please check they\n                    are correct.\n                  </Trans>\n                ) : hasErroredUrls ? (\n                  <Trans>\n                    Unable to verify URLs{' '}\n                    {urlsErroredBooleanArray\n                      .map((isErrored, index) => {\n                        if (isErrored) return '#' + (index + 1);\n                        return null;\n                      })\n                      .filter(Boolean)\n                      .join(', ')}\n                    . Please check they are correct.\n                  </Trans>\n                ) : null\n              }\n            />\n          )}\n        />\n      </Line>\n      <AlertMessage kind=\"warning\">\n        <Trans>\n          The URLs must be public and stay accessible while you work on this\n          project - they won't be stored inside the project file. When exporting\n          a game, the resources pointed by these URLs will be downloaded and\n          stored inside the game.\n        </Trans>\n      </AlertMessage>\n    </ColumnStackLayout>\n  );\n};\n\nconst browserResourceSources: Array<ResourceSource> = [\n  ...allResourceKindsAndMetadata.map(({ kind, createNewResource }) => {\n    const sourceName = `upload-${kind}`;\n    return {\n      name: sourceName,\n      displayName: t`File(s) from your device`,\n      displayTab: 'import',\n      shouldCreateResource: true,\n      shouldGuessAnimationsFromName: true,\n      kind,\n      renderComponent: (props: ResourceSourceComponentProps) => (\n        <FileToCloudProjectResourceUploader\n          createNewResource={createNewResource}\n          onChooseResources={(resources: Array<gdResource>) =>\n            props.onChooseResources({\n              selectedResources: resources,\n              selectedSourceName: sourceName,\n            })\n          }\n          options={props.options}\n          fileMetadata={props.fileMetadata}\n          getStorageProvider={props.getStorageProvider}\n          key={`url-chooser-${kind}`}\n          automaticallyOpenInput={!!props.automaticallyOpenIfPossible}\n        />\n      ),\n    };\n  }),\n  ...resourcesKindSupportedByResourceStore\n    .map(kind => {\n      const source = allResourceKindsAndMetadata.find(\n        resourceSource => resourceSource.kind === kind\n      );\n      if (!source) return null;\n      const sourceName = `resource-store-${kind}`;\n      return {\n        name: sourceName,\n        displayName: t`Choose from asset store`,\n        displayTab: 'standalone',\n        shouldCreateResource: true,\n        shouldGuessAnimationsFromName: false,\n        kind,\n        renderComponent: (props: ResourceSourceComponentProps) => (\n          <ResourceStoreChooser\n            selectedResourceIndex={props.selectedResourceIndex}\n            onSelectResource={props.onSelectResource}\n            options={props.options}\n            key={`resource-store-${kind}`}\n          />\n        ),\n        renderPrimaryAction: ({\n          resource,\n          onChooseResources,\n        }: ResourceSourceComponentPrimaryActionProps) => (\n          <DialogPrimaryButton\n            primary\n            key=\"add-resource\"\n            label={\n              kind === 'font' ? (\n                <Trans>Install font</Trans>\n              ) : (\n                <Trans>Add to project</Trans>\n              )\n            }\n            disabled={!resource}\n            onClick={() => {\n              if (!resource) return;\n              const chosenResourceUrl = resource.url;\n              const newResource = source.createNewResource();\n              newResource.setFile(chosenResourceUrl);\n              const resourceCleanedName = isPublicAssetResourceUrl(\n                chosenResourceUrl\n              )\n                ? extractDecodedFilenameWithExtensionFromPublicAssetResourceUrl(\n                    chosenResourceUrl\n                  )\n                : path.basename(chosenResourceUrl);\n              newResource.setName(resourceCleanedName);\n              newResource.setOrigin('gdevelop-asset-store', chosenResourceUrl);\n\n              onChooseResources({\n                selectedResources: [newResource],\n                selectedSourceName: sourceName,\n              });\n            }}\n          />\n        ),\n      };\n    })\n    .filter(Boolean),\n  ...allResourceKindsAndMetadata.map(({ kind, createNewResource }) => {\n    const sourceName = `project-resources-${kind}`;\n    return {\n      name: sourceName,\n      displayName: t`Project resources`,\n      displayTab: 'standalone',\n      shouldCreateResource: false,\n      shouldGuessAnimationsFromName: false,\n      hideInResourceEditor: true,\n      kind,\n      renderComponent: (props: ResourceSourceComponentProps) => (\n        <ProjectResourcesChooser\n          project={props.project}\n          onResourcesSelected={props.onResourcesSelected}\n          resourceKind={kind}\n          key={`project-resources-${kind}`}\n          multiSelection={props.options.multiSelection}\n        />\n      ),\n      renderPrimaryAction: ({\n        selectedResources,\n        onChooseResources,\n      }: ResourceSourceComponentPrimaryActionProps) => (\n        <DialogPrimaryButton\n          primary\n          key=\"select-resources\"\n          label={\n            !selectedResources ||\n            !selectedResources.length ||\n            selectedResources.length === 1 ? (\n              <Trans>Select resource</Trans>\n            ) : (\n              <Trans>Select {selectedResources.length} resources</Trans>\n            )\n          }\n          disabled={!selectedResources || !selectedResources.length}\n          onClick={() => {\n            if (!selectedResources || !selectedResources.length) return;\n            onChooseResources({\n              selectedResources,\n              selectedSourceName: sourceName,\n            });\n          }}\n        />\n      ),\n    };\n  }),\n  ...allResourceKindsAndMetadata.map(({ kind, createNewResource }) => {\n    const sourceName = `url-chooser-${kind}`;\n    return {\n      name: sourceName,\n      displayName: t`Use a public URL`,\n      displayTab: 'import-advanced',\n      shouldCreateResource: true,\n      shouldGuessAnimationsFromName: false,\n      kind,\n      renderComponent: (props: ResourceSourceComponentProps) => (\n        <UrlChooser\n          createNewResource={createNewResource}\n          onChooseResources={(resources: Array<gdResource>) =>\n            props.onChooseResources({\n              selectedResources: resources,\n              selectedSourceName: sourceName,\n            })\n          }\n          options={props.options}\n          key={`url-chooser-${kind}`}\n        />\n      ),\n    };\n  }),\n];\n\nexport default browserResourceSources;\n","// @flow\nconst spinnerImgSrc = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CjxjaXJjbGUgb3BhY2l0eT0nMC4yNScgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iNCI+PC9jaXJjbGU+CjxwYXRoIG9wYWNpdHk9JzAuNzUnIGZpbGw9IiNGRkZGRkYiIGQ9Ik00IDEyYTggOCAwIDAxOC04VjBDNS4zNzMgMCAwIDUuMzczIDAgMTJoNHptMiA1LjI5MUE3Ljk2MiA3Ljk2MiAwIDAxNCAxMkgwYzAgMy4wNDIgMS4xMzUgNS44MjQgMyA3LjkzOGwzLTIuNjQ3eiI+PC9wYXRoPgo8L3N2Zz4=`;\n\nexport const displayBlackLoadingScreenOrThrow = (\n  externalWindow: WindowProxy\n) => {\n  externalWindow.document.write(\n    `<html>\n  <head>\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n        background-color: #000000;\n        overflow: hidden;\n        height: 100vh;\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n      }\n      @keyframes spin {\n        100% {\n          transform:rotate(360deg);\n        }\n      }\n      .spinning-loader {\n        animation: spin 3s linear infinite;\n      }\n    </style>\n  </head>\n  <body>\n      <img class=\"spinning-loader\" width=\"50\" alt=\"Loading...\" src=\"${spinnerImgSrc}\">\n  </body>\n</html>`\n  );\n};\n","// @flow\nimport {\n  type ResourceExternalEditor,\n  type ExternalEditorInput,\n  type ExternalEditorOutput,\n  type ExternalEditorBase64Resource,\n  type EditWithExternalEditorOptions,\n  saveBlobUrlsFromExternalEditorBase64Resources,\n  freeBlobsAndUpdateMetadata,\n  patchExternalEditorMetadataWithResourcesNamesIfNecessary,\n  readMetadata,\n} from './ResourceExternalEditor';\nimport { sendExternalEditorOpened } from '../Utils/Analytics/EventSender';\nimport { t } from '@lingui/macro';\nimport { isBlobURL, isURL } from './ResourceUtils';\nimport { type ResourceKind } from './ResourceSource';\nimport {\n  convertBlobToDataURL,\n  downloadUrlsToBlobs,\n  type ItemResult,\n} from '../Utils/BlobDownloader';\nimport { showWarningBox } from '../UI/Messages/MessageBox';\nimport { displayBlackLoadingScreenOrThrow } from '../Utils/BrowserExternalWindowUtils';\nimport { UserCancellationError } from '../LoginProvider/Utils';\nlet nextExternalEditorWindowId = 0;\n\nconst externalEditorIndexHtml: { ['piskel' | 'yarn' | 'jfxr']: string } = {\n  piskel: 'external/piskel/piskel-index.html',\n  yarn: 'external/yarn/yarn-index.html',\n  jfxr: 'external/jfxr/jfxr-index.html',\n};\n\nconst openAndWaitForExternalEditorWindow = async ({\n  externalEditorWindow,\n  externalEditorName,\n  externalEditorInput,\n  signal,\n}: {|\n  externalEditorWindow: any,\n  externalEditorName: 'piskel' | 'yarn' | 'jfxr',\n  externalEditorInput: ExternalEditorInput,\n  signal: AbortSignal,\n|}): Promise<?ExternalEditorOutput> => {\n  if (signal.aborted) {\n    return Promise.reject(new UserCancellationError(''));\n  }\n  return new Promise((resolve, reject) => {\n    let externalEditorLoaded = false;\n    let externalEditorClosed = false;\n    let externalEditorOutput: ?ExternalEditorOutput = null;\n\n    const onMessageEvent = (event: MessageEvent) => {\n      if (event.source !== externalEditorWindow) {\n        return;\n      }\n\n      if (!event.data || typeof event.data !== 'object') {\n        console.warn(\n          'Ignoring malformed message data from the external editor window.'\n        );\n        return;\n      }\n\n      const { id, payload } = event.data;\n      if (id === `external-editor-ready`) {\n        console.info(`External editor \"${externalEditorName}\" ready.`);\n\n        // Some browsers like Safari might not trigger the \"load\" event, but now we can\n        // be sure the editor is loaded: the proof being that we received this message.\n        // Mark the editor as loaded and re-attach a unload listener to be safe.\n        externalEditorLoaded = true;\n        externalEditorWindow.addEventListener('unload', () => {\n          onExternalEditorWindowClosed();\n        });\n\n        // Now that the external editor is loaded and ready, we can ask it to open the resources.\n        externalEditorWindow.postMessage(\n          {\n            id: 'open-external-editor-input',\n            payload: externalEditorInput,\n          },\n          // Ensure only external editors hosted on the same server as the GDevelop editor\n          // can receive the message:\n          window.location.origin\n        );\n      } else if (id === `save-external-editor-output`) {\n        console.info(\n          `Received data from external editor \"${externalEditorName}.\"`\n        );\n        // $FlowFixMe - assuming the typing is good.\n        externalEditorOutput = payload;\n      } else if (event.data.id === 'close') {\n        externalEditorWindow.close();\n        onExternalEditorWindowClosed();\n      }\n    };\n    window.addEventListener('message', onMessageEvent);\n\n    const onExternalEditorWindowClosed = () => {\n      if (externalEditorClosed) {\n        // Somehow this editor was already closed.\n        return;\n      }\n      externalEditorClosed = true;\n      console.info(`External editor \"${externalEditorName}\" closed.`);\n      window.removeEventListener('message', onMessageEvent);\n      resolve(externalEditorOutput);\n    };\n\n    signal.addEventListener('abort', () => {\n      reject(new UserCancellationError(''));\n      if (externalEditorClosed) return;\n      externalEditorWindow.close();\n      onExternalEditorWindowClosed();\n    });\n\n    externalEditorWindow.addEventListener('load', () => {\n      console.info(`External editor \"${externalEditorName}\" loaded.`);\n      externalEditorLoaded = true;\n\n      externalEditorWindow.addEventListener('unload', () => {\n        onExternalEditorWindowClosed();\n      });\n    });\n\n    // Change the HTML file displayed by the window so that it starts loading\n    // the editor.\n    // The browser will load the editor HTML/CSS/JS, then will fire the `load` event\n    // (though not on Safari), then the editor will send a `external-editor-ready` event\n    // (on all browsers), after which we will then be ready to have it open the resources.\n    // (see `open-external-editor-input`).\n    externalEditorWindow.location = externalEditorIndexHtml[externalEditorName];\n\n    // If the editor is not ready after 10 seconds and not closed, force it to be closed.\n    // Something wrong is going on and we don't want to block the user.\n    setTimeout(() => {\n      if (externalEditorLoaded || externalEditorClosed) return;\n      console.info(\n        `External editor \"${externalEditorName} not loaded after 10 seconds - closing its window.\"`\n      );\n\n      // The external editor is not loaded after 10 seconds, abort.\n      externalEditorWindow.close();\n      onExternalEditorWindowClosed();\n    }, 10000);\n  });\n};\n\n/**\n * Download (or read locally) resources and prepare them to be edited\n * by an external editor.\n */\nexport const downloadAndPrepareExternalEditorBase64Resources = async ({\n  project,\n  resourceNames,\n}: {|\n  project: gdProject,\n  resourceNames: Array<string>,\n|}): Promise<Array<ExternalEditorBase64Resource>> => {\n  type ResourceToDownload = {|\n    resourceName: string,\n    url: string,\n  |};\n\n  const urlsToDownload: Array<ResourceToDownload> = [];\n  const resourcesManager = project.getResourcesManager();\n  resourceNames.forEach(resourceName => {\n    if (!resourcesManager.hasResource(resourceName)) return;\n\n    const resource = resourcesManager.getResource(resourceName);\n    const url = resource.getFile();\n    if (isURL(url)) {\n      if (isBlobURL(url)) {\n        console.error('Unsupported blob URL for a resource - ignoring it.');\n      } else {\n        urlsToDownload.push({\n          url,\n          resourceName,\n        });\n      }\n    } else {\n      console.error('Unsupported local file for a resource - ignoring it.');\n    }\n  });\n\n  const downloadedBlobs: Array<\n    ItemResult<ResourceToDownload>\n  > = await downloadUrlsToBlobs({\n    urlContainers: urlsToDownload,\n    onProgress: (count, total) => {},\n  });\n\n  const resourcesToDataUrl = new Map<\n    string,\n    {|\n      dataUrl: string,\n      localFilePath?: string,\n    |}\n  >();\n  await Promise.all(\n    downloadedBlobs.map(async ({ error, blob, item }) => {\n      if (blob) {\n        try {\n          resourcesToDataUrl.set(item.resourceName, {\n            dataUrl: await convertBlobToDataURL(blob),\n          });\n        } catch (error) {\n          console.error(\n            `Unable to read data from resource \"${\n              item.resourceName\n            }\" - ignoring it.`,\n            error\n          );\n        }\n      }\n    })\n  );\n\n  return resourceNames.map(resourceName => {\n    const resourceData = resourcesToDataUrl.get(resourceName);\n    if (!resourceData)\n      return {\n        name: resourceName,\n        dataUrl: '',\n      };\n\n    const { localFilePath, dataUrl } = resourceData;\n    return {\n      name: resourceName,\n      dataUrl,\n      localFilePath,\n    };\n  });\n};\n\n/**\n * Edit one or more resources with the specified external editor.\n */\nconst editWithBrowserExternalEditor = async ({\n  externalEditorName,\n  externalEditorWindow,\n  defaultName,\n  metadataKey,\n  resourceKind,\n  options,\n}: {|\n  externalEditorName: 'piskel' | 'yarn' | 'jfxr',\n  externalEditorWindow: any,\n  defaultName: string,\n  metadataKey: string,\n  resourceKind: ResourceKind,\n  options: EditWithExternalEditorOptions,\n|}) => {\n  const { project, resourceNames, resourceManagementProps, signal } = options;\n\n  // Fetch all edited resources as base64 encoded \"data urls\" (`data:...`).\n  const resources = await downloadAndPrepareExternalEditorBase64Resources({\n    project,\n    resourceNames,\n  });\n\n  const externalEditorInput: ExternalEditorInput = {\n    singleFrame: options.extraOptions.singleFrame,\n    externalEditorData: readMetadata(\n      metadataKey,\n      options.extraOptions.existingMetadata\n    ),\n    fps: options.extraOptions.fps,\n    isLooping: options.extraOptions.isLooping,\n    name: options.extraOptions.name || resourceNames[0] || defaultName,\n    resources,\n  };\n\n  sendExternalEditorOpened(externalEditorName);\n  const externalEditorOutput: ?ExternalEditorOutput = await openAndWaitForExternalEditorWindow(\n    { externalEditorWindow, externalEditorName, externalEditorInput, signal }\n  );\n  if (!externalEditorOutput) return null; // Changes cancelled.\n\n  // Save the edited files back to the GDevelop resources, as \"blob urls\" (blob:...)\n  // which can then uploaded or saved locally.\n  const modifiedResources = await saveBlobUrlsFromExternalEditorBase64Resources(\n    {\n      baseNameForNewResources: externalEditorOutput.baseNameForNewResources,\n      project,\n      resources: externalEditorOutput.resources,\n      resourceKind,\n    }\n  );\n\n  // Ask the project to persist the resources (\"blob urls\" will be either uploaded\n  // or saved locally).\n  try {\n    await resourceManagementProps.onFetchNewlyAddedResources();\n  } catch (error) {\n    console.error(\n      'An error happened while fetching the newly added resources:',\n      error\n    );\n  }\n\n  // Free the \"blob urls\" so that blobs don't stay in memory! They are only temporarily\n  // useful while waiting for an upload/local file save.\n  freeBlobsAndUpdateMetadata({\n    modifiedResources,\n    metadataKey,\n    metadata: options.extraOptions.singleFrame\n      ? externalEditorOutput.externalEditorData\n      : null,\n  });\n\n  const hasCreatedAnyResource = externalEditorOutput.resources.some(\n    resource => !resource.name\n  );\n  if (hasCreatedAnyResource) {\n    resourceManagementProps.onNewResourcesAdded();\n  }\n\n  // Some editors (Piskel) need to have resource names persisted.\n  patchExternalEditorMetadataWithResourcesNamesIfNecessary(\n    modifiedResources.map(({ resource }) => resource.getName()),\n    externalEditorOutput.externalEditorData\n  );\n\n  return {\n    resources: modifiedResources.map(({ resource, originalIndex }) => ({\n      name: resource.getName(),\n      originalIndex,\n    })),\n    newName: externalEditorOutput.baseNameForNewResources,\n    newMetadata: { [metadataKey]: externalEditorOutput.externalEditorData },\n  };\n};\n\nconst cloudProjectWarning = t`You need to save this project as a cloud project to install this asset. Please save your project and try again.`;\n\n/**\n * Open a window showing a black \"loading...\" screen. It's important this is done\n * NOT in an asynchronous way but JUST after a click. Otherwise, browsers like Safari\n * will block the window opening.\n */\nconst immediatelyOpenLoadingWindowForExternalEditor = () => {\n  const targetId = 'GDevelopExternalEditor' + nextExternalEditorWindowId++;\n  const width = 800;\n  const height = 600;\n  const left = window.screenX + window.innerWidth / 2 - width / 2;\n  const top = window.screenY + window.innerHeight / 2 - height / 2;\n\n  const externalEditorWindow = window.open(\n    'about:blank',\n    targetId,\n    `width=${width},height=${height},left=${left},top=${top}`\n  );\n  if (!externalEditorWindow) {\n    throw new Error(\n      \"Can't open the external editor because of browser restrictions.\"\n    );\n  }\n\n  displayBlackLoadingScreenOrThrow(externalEditorWindow);\n\n  return externalEditorWindow;\n};\n\n/**\n * This is the list of editors that can be used to edit resources\n * when running in a browser.\n */\nconst editors: Array<ResourceExternalEditor> = [\n  {\n    name: 'piskel-app',\n    createDisplayName: t`Create with Piskel`,\n    editDisplayName: t`Edit with Piskel`,\n    kind: 'image',\n    edit: async options => {\n      if (options.getStorageProvider().internalName !== 'Cloud') {\n        const { i18n } = options;\n        showWarningBox(i18n._(cloudProjectWarning), {\n          delayToNextTick: true,\n        });\n        return null;\n      }\n\n      const externalEditorWindow = immediatelyOpenLoadingWindowForExternalEditor();\n      return await editWithBrowserExternalEditor({\n        options,\n        externalEditorWindow,\n        externalEditorName: 'piskel',\n        defaultName: 'New image',\n        metadataKey: 'pskl',\n        resourceKind: 'image',\n      });\n    },\n  },\n  {\n    name: 'jfxr-app',\n    createDisplayName: t`Create with Jfxr`,\n    editDisplayName: t`Edit with Jfxr`,\n    kind: 'audio',\n    edit: async options => {\n      if (options.getStorageProvider().internalName !== 'Cloud') {\n        const { i18n } = options;\n        showWarningBox(i18n._(cloudProjectWarning), {\n          delayToNextTick: true,\n        });\n        return null;\n      }\n\n      const externalEditorWindow = immediatelyOpenLoadingWindowForExternalEditor();\n      return await editWithBrowserExternalEditor({\n        options,\n        externalEditorWindow,\n        externalEditorName: 'jfxr',\n        defaultName: 'New sound effect',\n        metadataKey: 'jfxr',\n        resourceKind: 'audio',\n      });\n    },\n  },\n  {\n    name: 'yarn-app',\n    createDisplayName: t`Create with Yarn`,\n    editDisplayName: t`Edit with Yarn`,\n    kind: 'json',\n    edit: async options => {\n      if (options.getStorageProvider().internalName !== 'Cloud') {\n        const { i18n } = options;\n        showWarningBox(i18n._(cloudProjectWarning), {\n          delayToNextTick: true,\n        });\n        return null;\n      }\n\n      const externalEditorWindow = immediatelyOpenLoadingWindowForExternalEditor();\n      return await editWithBrowserExternalEditor({\n        options,\n        externalEditorWindow,\n        externalEditorName: 'yarn',\n        defaultName: 'New dialogue tree',\n        metadataKey: 'yarn',\n        resourceKind: 'json',\n      });\n    },\n  },\n];\n\nexport default editors;\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport { I18n } from '@lingui/react';\nimport React, { Component } from 'react';\nimport Dialog from '../../../UI/Dialog';\nimport FlatButton from '../../../UI/FlatButton';\nimport { Column, Line } from '../../../UI/Grid';\nimport Text from '../../../UI/Text';\n\ntype Props = {|\n  error: Error,\n  onClose: () => void,\n|};\n\nexport default class BrowserPreviewErrorDialog extends Component<Props> {\n  render() {\n    const { error, onClose } = this.props;\n\n    return (\n      <I18n>\n        {({ i18n }) => (\n          <Dialog\n            title={<Trans>Could not launch the preview</Trans>}\n            actions={[\n              <FlatButton\n                key=\"close\"\n                label={<Trans>Close</Trans>}\n                onClick={onClose}\n              />,\n            ]}\n            onRequestClose={onClose}\n            open\n          >\n            <Line>\n              <Column noMargin>\n                <Text>\n                  {// $FlowFixMe - AWS returned errors can have extra fields\n                  error.code === 'NetworkingError' ? (\n                    <Trans>\n                      The preview could not be launched because you're offline.\n                    </Trans>\n                  ) : (\n                    <Trans>\n                      The preview could not be launched because an error\n                      happened: {error.message}.\n                    </Trans>\n                  )}\n                </Text>\n              </Column>\n            </Line>\n            <Line>\n              <Column noMargin>\n                <Text>\n                  <Trans>\n                    Make sure you're online, have a proper internet connection\n                    and try again. If you download and use GDevelop desktop\n                    application, you can also run previews without any internet\n                    connection.\n                  </Trans>\n                </Text>\n              </Column>\n            </Line>\n          </Dialog>\n        )}\n      </I18n>\n    );\n  }\n}\n","// @flow\n\n// If updated, also update the service worker template.\nconst DB_NAME = 'gdevelop-browser-sw-preview';\nconst STORE_NAME = 'files';\nconst INSTANCES_STORE_NAME = 'instances';\nconst DB_VERSION = 2;\n\nconst INSTANCE_CLEANUP_THRESHOLD_MS = 6 * 60 * 60 * 1000; // 6 hours.\nconst INSTANCE_HEARTBEAT_INTERVAL_MS = 60 * 1000; // 1 minute.\n\ntype FileRecord = {|\n  bytes: ArrayBuffer,\n  contentType: string,\n|};\n\nlet dbInstance: ?IDBDatabase = null;\nlet currentInstanceId: ?string = null;\nlet initializationPromise: ?Promise<void> = null;\nlet heartbeatIntervalId: ?IntervalID = null;\n\nconst requestToPromise = (request: IDBRequest): Promise<any> => {\n  return new Promise((resolve, reject) => {\n    request.onsuccess = () => resolve(request.result);\n    request.onerror = () => {\n      const error = request.error || new Error('Request failed');\n      reject(error);\n    };\n  });\n};\n\nconst transactionToPromise = (transaction: IDBTransaction): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => {\n      const error = transaction.error || new Error('Transaction failed');\n      reject(error);\n    };\n    transaction.onabort = () => {\n      const error = transaction.error || new Error('Transaction aborted');\n      reject(error);\n    };\n  });\n};\n\nexport const getBrowserSWPreviewRootUrl = (): string => {\n  const origin = window.location.origin;\n  return `${origin}/browser_sw_preview`;\n};\n\n/**\n * Gets the base URL for browser service worker previews.\n * This URL should be handled by the service worker to serve files from IndexedDB.\n */\nexport const getBrowserSWPreviewBaseUrl = (): string => {\n  if (!currentInstanceId) {\n    throw new Error(\n      'Browser SW preview instance not initialised. Call ensureBrowserSWPreviewSession() first.'\n    );\n  }\n\n  return `${getBrowserSWPreviewRootUrl()}/${currentInstanceId}`;\n};\n\n/**\n * Opens or returns the existing IndexedDB database connection.\n * Handles database upgrades and version management.\n */\nconst openBrowserSWPreviewIndexedDB = (): Promise<IDBDatabase> => {\n  if (dbInstance && dbInstance.version === DB_VERSION) {\n    return Promise.resolve(dbInstance);\n  }\n\n  return new Promise((resolve, reject) => {\n    try {\n      // $FlowFixMe - indexedDB is available in all browsers\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n      request.onerror = () => {\n        const error = request.error || new Error('Failed to open IndexedDB');\n        console.error('[BrowserSWIndexedDB] Error opening database:', error);\n        reject(error);\n      };\n\n      request.onsuccess = () => {\n        dbInstance = request.result;\n        console.log('[BrowserSWIndexedDB] Database opened successfully');\n\n        // Handle unexpected close\n        dbInstance.onclose = () => {\n          console.warn(\n            '[BrowserSWIndexedDB] Database connection closed unexpectedly'\n          );\n          dbInstance = null;\n        };\n\n        // Handle version change (e.g., if another tab upgrades the DB)\n        dbInstance.onversionchange = () => {\n          console.warn(\n            '[BrowserSWIndexedDB] Database version changed, closing connection'\n          );\n          if (dbInstance) {\n            dbInstance.close();\n            dbInstance = null;\n          }\n        };\n\n        resolve(dbInstance);\n      };\n\n      request.onupgradeneeded = _event => {\n        console.log('[BrowserSWIndexedDB] Upgrading database schema...');\n        const db = request.result;\n\n        if (!db.objectStoreNames.contains(STORE_NAME)) {\n          db.createObjectStore(STORE_NAME);\n          console.log('[BrowserSWIndexedDB] Created object store:', STORE_NAME);\n        }\n\n        if (!db.objectStoreNames.contains(INSTANCES_STORE_NAME)) {\n          db.createObjectStore(INSTANCES_STORE_NAME);\n          console.log(\n            '[BrowserSWIndexedDB] Created object store:',\n            INSTANCES_STORE_NAME\n          );\n        }\n      };\n\n      request.onblocked = () => {\n        console.warn(\n          '[BrowserSWIndexedDB] Database upgrade blocked by another connection'\n        );\n        reject(\n          new Error(\n            'Database upgrade blocked. Please close other tabs using this application.'\n          )\n        );\n      };\n    } catch (error) {\n      console.error(\n        '[BrowserSWIndexedDB] Exception while opening database:',\n        error\n      );\n      reject(error);\n    }\n  });\n};\n\n/**\n * Stores a \"file\" in IndexedDB.\n */\nexport const putFile = async (\n  path: string,\n  bytes: ArrayBuffer,\n  contentType: string\n): Promise<void> => {\n  try {\n    const db = await openBrowserSWPreviewIndexedDB();\n\n    return new Promise((resolve, reject) => {\n      try {\n        const transaction = db.transaction(STORE_NAME, 'readwrite');\n\n        transaction.onerror = () => {\n          const error = transaction.error || new Error('Transaction failed');\n          console.error(\n            '[BrowserSWIndexedDB] Transaction error while putting file:',\n            path,\n            error\n          );\n          reject(error);\n        };\n\n        transaction.onabort = () => {\n          const error = transaction.error || new Error('Transaction aborted');\n          console.error(\n            '[BrowserSWIndexedDB] Transaction aborted while putting file:',\n            path,\n            error\n          );\n          reject(error);\n        };\n\n        transaction.oncomplete = () => {\n          resolve();\n        };\n\n        const objectStore = transaction.objectStore(STORE_NAME);\n        const record: FileRecord = { bytes, contentType };\n\n        const request = objectStore.put(record, path);\n\n        request.onerror = () => {\n          const error = request.error || new Error('Put operation failed');\n          console.error(\n            '[BrowserSWIndexedDB] Error storing file:',\n            path,\n            error\n          );\n          reject(error);\n        };\n      } catch (error) {\n        console.error(\n          '[BrowserSWIndexedDB] Exception during put operation:',\n          path,\n          error\n        );\n        reject(error);\n      }\n    });\n  } catch (error) {\n    console.error('[BrowserSWIndexedDB] Failed to put file:', path, error);\n    throw error;\n  }\n};\n\n/**\n * Deletes all \"files\" stored in IndexedDB with a given path prefix.\n *\n * @param pathPrefix - The path prefix to match.\n */\nexport const deleteFilesWithPrefix = async (\n  pathPrefix: string\n): Promise<number> => {\n  try {\n    const db = await openBrowserSWPreviewIndexedDB();\n\n    return new Promise((resolve, reject) => {\n      try {\n        const transaction = db.transaction(STORE_NAME, 'readwrite');\n        let deletedCount = 0;\n\n        transaction.onerror = () => {\n          const error = transaction.error || new Error('Transaction failed');\n          console.error(\n            '[BrowserSWIndexedDB] Transaction error while deleting files with prefix:',\n            pathPrefix,\n            error\n          );\n          reject(error);\n        };\n\n        transaction.oncomplete = () => {\n          resolve(deletedCount);\n        };\n\n        const objectStore = transaction.objectStore(STORE_NAME);\n        const request = objectStore.openCursor();\n\n        request.onsuccess = event => {\n          const cursor = event.target.result;\n          if (cursor) {\n            const key = cursor.key;\n            if (typeof key === 'string' && key.startsWith(pathPrefix)) {\n              cursor.delete();\n              deletedCount++;\n            }\n            cursor.continue();\n          }\n        };\n\n        request.onerror = () => {\n          const error = request.error || new Error('Cursor operation failed');\n          console.error(\n            '[BrowserSWIndexedDB] Error during cursor operation:',\n            error\n          );\n          reject(error);\n        };\n      } catch (error) {\n        console.error(\n          '[BrowserSWIndexedDB] Exception during delete with prefix:',\n          pathPrefix,\n          error\n        );\n        reject(error);\n      }\n    });\n  } catch (error) {\n    console.error(\n      '[BrowserSWIndexedDB] Failed to delete files with prefix:',\n      pathPrefix,\n      error\n    );\n    throw error;\n  }\n};\n\nconst findUnusedInstanceId = (usedIds: Array<number>): number => {\n  const usedIdsSet = new Set(usedIds);\n  let candidate = 1;\n\n  while (usedIdsSet.has(candidate)) {\n    candidate++;\n  }\n\n  return candidate;\n};\n\nconst acquireInstanceIdAndCleanup = async (\n  cleanInstanceRelatedFiles: (instanceId: string) => Promise<void>\n) => {\n  const db = await openBrowserSWPreviewIndexedDB();\n  const now = Date.now();\n  const expiredInstanceIds: Array<string> = [];\n  let acquiredInstanceId: ?string = null;\n\n  // First transaction: identify expired instances and acquire new ID\n  const transaction = db.transaction(INSTANCES_STORE_NAME, 'readwrite');\n  const store = transaction.objectStore(INSTANCES_STORE_NAME);\n\n  const [keys, records] = await Promise.all([\n    // $FlowFixMe - outdated Flow types.\n    requestToPromise(store.getAllKeys()),\n    // $FlowFixMe - outdated Flow types.\n    requestToPromise(store.getAll()),\n  ]);\n\n  const usedIds: Array<number> = [];\n\n  keys.forEach((key, index) => {\n    if (typeof key !== 'string') return;\n    const record = records[index];\n    const lastUsed =\n      record && typeof record.lastUsed === 'number' ? record.lastUsed : 0;\n\n    if (now - lastUsed > INSTANCE_CLEANUP_THRESHOLD_MS) {\n      expiredInstanceIds.push(key);\n      return;\n    }\n\n    const parsedId = parseInt(key, 10);\n    if (!isNaN(parsedId)) {\n      usedIds.push(parsedId);\n    }\n  });\n\n  const newId = findUnusedInstanceId(usedIds);\n  acquiredInstanceId = String(newId);\n  store.put({ lastUsed: now }, acquiredInstanceId);\n\n  await transactionToPromise(transaction);\n\n  // Clean up expired instances one by one: only delete instance record if cleanup succeeds\n  for (const expiredId of expiredInstanceIds) {\n    try {\n      console.log(\n        `[BrowserSWIndexedDB] Cleaning up expired instance #${expiredId} files...`\n      );\n      await cleanInstanceRelatedFiles(expiredId);\n\n      // Only delete the instance record if the cleanup succeeds.\n      const cleanupTransaction = db.transaction(\n        INSTANCES_STORE_NAME,\n        'readwrite'\n      );\n      const cleanupStore = cleanupTransaction.objectStore(INSTANCES_STORE_NAME);\n      cleanupStore.delete(expiredId);\n      await transactionToPromise(cleanupTransaction);\n    } catch (error) {\n      console.error(\n        '[BrowserSWIndexedDB] Failed to clean up expired instance, keeping instance record:',\n        expiredId,\n        error\n      );\n      // Continue with next instance - we still want to clean up what we can\n    }\n  }\n\n  return acquiredInstanceId;\n};\n\nconst updateInstanceLastUsed = async (instanceId: string) => {\n  try {\n    const db = await openBrowserSWPreviewIndexedDB();\n    const transaction = db.transaction(INSTANCES_STORE_NAME, 'readwrite');\n    const store = transaction.objectStore(INSTANCES_STORE_NAME);\n    store.put({ lastUsed: Date.now() }, instanceId);\n    await transactionToPromise(transaction);\n  } catch (error) {\n    console.error(\n      '[BrowserSWIndexedDB] Failed to update instance heartbeat:',\n      instanceId,\n      error\n    );\n  }\n};\n\nconst startHeartbeat = (instanceId: string) => {\n  if (heartbeatIntervalId) {\n    clearInterval(heartbeatIntervalId);\n  }\n\n  const runHeartbeat = () => {\n    updateInstanceLastUsed(instanceId);\n  };\n\n  heartbeatIntervalId = setInterval(\n    runHeartbeat,\n    INSTANCE_HEARTBEAT_INTERVAL_MS\n  );\n};\n\nexport const ensureBrowserSWPreviewSession = async (): Promise<void> => {\n  if (currentInstanceId) {\n    return;\n  }\n\n  if (initializationPromise) {\n    return initializationPromise;\n  }\n\n  console.info(\n    '[BrowserSWIndexedDB] Acquiring a Browser SW preview instance...'\n  );\n  initializationPromise = (async () => {\n    try {\n      const acquiredInstanceId = await acquireInstanceIdAndCleanup(\n        async (expiredId: string) => {\n          await deleteFilesWithPrefix(`/${expiredId}/`);\n        }\n      );\n\n      if (!acquiredInstanceId) {\n        throw new Error(\n          'Unable to acquire a Browser SW preview instance identifier'\n        );\n      }\n\n      console.info(\n        `This session is now using the Browser SW preview instance #${acquiredInstanceId}.`\n      );\n      currentInstanceId = acquiredInstanceId;\n\n      startHeartbeat(acquiredInstanceId);\n    } catch (error) {\n      currentInstanceId = null;\n      console.error(\n        '[BrowserSWIndexedDB] Failed to initialise Browser SW preview session:',\n        error\n      );\n      throw error;\n    } finally {\n      initializationPromise = null;\n    }\n  })();\n\n  return initializationPromise;\n};\n","// @flow\nimport path from 'path-browserify';\nimport {\n  deleteFilesWithPrefix,\n  putFile,\n} from './BrowserSWPreviewLauncher/BrowserSWPreviewIndexedDB';\nconst gd: libGDevelop = global.gd;\n\nexport type TextFileDescriptor = {|\n  filePath: string,\n  text: string,\n|};\n\ntype ConstructorArgs = {|\n  filesContent: Array<TextFileDescriptor>,\n  rootUrl: string,\n|};\n\nconst isURL = (filename: string) => {\n  return (\n    filename.startsWith('http://') ||\n    filename.startsWith('https://') ||\n    filename.startsWith('ftp://') ||\n    filename.startsWith('blob:') ||\n    filename.startsWith('data:')\n  );\n};\n\n/**\n * Determines the content type based on file extension.\n */\nconst getContentType = (filePath: string): string => {\n  const ext = path.extname(filePath).toLowerCase();\n  const mimeTypes = {\n    '.html': 'text/html; charset=utf-8',\n    '.js': 'text/javascript; charset=utf-8',\n    '.mjs': 'text/javascript; charset=utf-8',\n    '.css': 'text/css; charset=utf-8',\n    '.json': 'application/json; charset=utf-8',\n    '.wasm': 'application/wasm',\n    '.png': 'image/png',\n    '.jpg': 'image/jpeg',\n    '.jpeg': 'image/jpeg',\n    '.gif': 'image/gif',\n    '.svg': 'image/svg+xml',\n    '.txt': 'text/plain; charset=utf-8',\n  };\n  return mimeTypes[ext] || 'application/octet-stream';\n};\n\n/**\n * An in-memory \"file system\" that stores files in IndexedDB\n * and serves them via a service worker for GDevelop previews.\n */\nexport default class BrowserSWFileSystem {\n  rootUrl: string;\n\n  // Store the content of some files.\n  _indexedFilesContent: { [string]: TextFileDescriptor };\n\n  // Store all the files that should be written to IndexedDB.\n  _pendingFiles: Array<{|\n    path: string,\n    content: string,\n    contentType: string,\n  |}> = [];\n\n  _pendingDeleteOperations: Array<Promise<any>> = [];\n\n  // Store a set of all external URLs copied so that we can simulate\n  // readDir result.\n  _allCopiedExternalUrls = new Set<string>();\n\n  constructor({ filesContent, rootUrl }: ConstructorArgs) {\n    this.rootUrl = rootUrl;\n\n    this._indexedFilesContent = {};\n    filesContent.forEach(textFileDescriptor => {\n      this._indexedFilesContent[\n        textFileDescriptor.filePath\n      ] = textFileDescriptor;\n    });\n  }\n\n  /**\n   * Uploads all pending files to IndexedDB.\n   */\n  applyPendingOperations = async () => {\n    try {\n      await Promise.all(this._pendingDeleteOperations);\n    } catch (error) {\n      console.error(\n        '[BrowserSWFileSystem] Error while deleting files in IndexedDB. Ignoring.',\n        error\n      );\n    }\n\n    try {\n      console.log(\n        `[BrowserSWFileSystem] Storing ${\n          this._pendingFiles.length\n        } files in IndexedDB for preview...`\n      );\n\n      let totalBytes = 0;\n      const uploadPromises = this._pendingFiles.map(async file => {\n        const fullPath = `/${file.path}`;\n        const encoder = new TextEncoder();\n        const bytes = encoder.encode(file.content).buffer;\n\n        totalBytes += bytes.byteLength;\n\n        await putFile(fullPath, bytes, file.contentType);\n      });\n\n      await Promise.all(uploadPromises);\n\n      console.log(\n        `[BrowserSWFileSystem] Successfully stored all ${\n          this._pendingFiles.length\n        } preview files in IndexedDB (${Math.ceil(totalBytes / 1000)} kB).`\n      );\n    } catch (error) {\n      console.error(\n        \"[BrowserSWFileSystem] Can't store all files in IndexedDB:\",\n        error\n      );\n      throw error;\n    }\n  };\n\n  mkDir = (path: string) => {\n    // Assume required directories always exist in a virtual file system.\n  };\n\n  dirExists = (path: string) => {\n    // Assume required directories always exist.\n    return true;\n  };\n\n  clearDir = (path: string) => {\n    console.info(`[BrowserSWFileSystem] Clearing directory: ${path}...`);\n    const relativePath = path.replace(this.rootUrl, '');\n    const normalizedPrefix = relativePath.startsWith('/')\n      ? relativePath\n      : `/${relativePath}`;\n    const prefixWithTrailingSlash = normalizedPrefix.endsWith('/')\n      ? normalizedPrefix\n      : `${normalizedPrefix}/`;\n    this._pendingDeleteOperations.push(\n      deleteFilesWithPrefix(prefixWithTrailingSlash)\n    );\n  };\n\n  getTempDir = () => {\n    return '/virtual-unused-tmp-dir';\n  };\n\n  fileNameFrom = (fullpath: string) => {\n    if (isURL(fullpath)) return fullpath;\n    return path.basename(fullpath);\n  };\n\n  dirNameFrom = (fullpath: string) => {\n    if (isURL(fullpath)) return '';\n    return path.dirname(fullpath);\n  };\n\n  makeAbsolute = (filename: string, baseDirectory: string) => {\n    if (isURL(filename)) return filename;\n\n    if (!this.isAbsolute(baseDirectory))\n      baseDirectory = path.resolve(baseDirectory);\n\n    if (isURL(baseDirectory)) {\n      return baseDirectory + '/' + filename;\n    }\n\n    return path.resolve(baseDirectory, path.normalize(filename));\n  };\n\n  makeRelative = (filename: string, baseDirectory: string) => {\n    if (isURL(filename)) return filename;\n    return path.relative(baseDirectory, path.normalize(filename));\n  };\n\n  isAbsolute = (fullpath: string) => {\n    if (isURL(fullpath)) return true;\n    if (fullpath.length === 0) return true;\n    return (\n      (fullpath.length > 0 && fullpath.charAt(0) === '/') ||\n      (fullpath.length > 1 && fullpath.charAt(1) === ':')\n    );\n  };\n\n  copyFile = (source: string, dest: string) => {\n    // URLs are not copied, just tracked.\n    if (isURL(source)) {\n      this._allCopiedExternalUrls.add(source);\n      return true;\n    }\n\n    console.warn(\n      '[BrowserSWFileSystem] Copy not done from',\n      source,\n      'to',\n      dest\n    );\n    return true;\n  };\n\n  writeToFile = (fullPath: string, contents: string) => {\n    // Remove the base URL to get the relative path\n    const relativePath = fullPath.replace(this.rootUrl, '');\n    const contentType = getContentType(fullPath);\n\n    // Queue the file to be written to IndexedDB\n    this._pendingFiles.push({\n      path: relativePath,\n      content: contents,\n      contentType,\n    });\n\n    return true;\n  };\n\n  readFile = (file: string) => {\n    if (!!this._indexedFilesContent[file])\n      return this._indexedFilesContent[file].text;\n\n    console.error(\n      `[BrowserSWFileSystem] Unknown file ${file}, returning an empty string`\n    );\n    return '';\n  };\n\n  readDir = (path: string, ext: string) => {\n    ext = ext.toUpperCase();\n    var output = new gd.VectorString();\n\n    // Simulate ReadDir by returning all external URLs\n    // with the filename matching the extension.\n    this._allCopiedExternalUrls.forEach(url => {\n      const upperCaseUrl = url.toUpperCase();\n      if (upperCaseUrl.indexOf(ext) === upperCaseUrl.length - ext.length) {\n        output.push_back(url);\n      }\n    });\n\n    return output;\n  };\n\n  fileExists = (filename: string) => {\n    if (isURL(filename)) return true;\n\n    // Assume all files asked for exist.\n    return true;\n  };\n}\n","// @flow\nimport Window from '../Utils/Window';\nimport { getIDEVersionWithHash } from '../Version';\n\ntype FileSet =\n  | 'preview'\n  | 'cordova'\n  | 'electron'\n  | 'web'\n  | 'cocos2d-js'\n  | 'facebook-instant-games';\n\nconst filesToDownload: { [FileSet]: Array<string> } = {\n  preview: ['/Runtime/index.html'],\n  web: ['/Runtime/index.html', '/Runtime/Electron/LICENSE.GDevelop.txt'],\n  'cocos2d-js': [\n    '/Runtime/Cocos2d/cocos2d-js-v3.10.js',\n    '/Runtime/Cocos2d/index.html',\n    '/Runtime/Cocos2d/main.js',\n    '/Runtime/Cocos2d/project.json',\n  ],\n  'facebook-instant-games': [\n    '/Runtime/FacebookInstantGames/fbapp-config.json',\n    '/Runtime/FacebookInstantGames/index.html',\n  ],\n  cordova: [\n    '/Runtime/Cordova/www/index.html',\n    '/Runtime/Cordova/www/LICENSE.GDevelop.txt',\n    '/Runtime/Cordova/config.xml',\n    '/Runtime/Cordova/package.json',\n  ],\n  electron: [\n    '/Runtime/index.html',\n    '/Runtime/Electron/main.js',\n    '/Runtime/Electron/package.json',\n    '/Runtime/Electron/LICENSE.GDevelop.txt',\n  ],\n};\n\nexport type TextFileDescriptor = {| text: string, filePath: string |};\n\nexport const findGDJS = (\n  fileSet: FileSet\n): Promise<{|\n  gdjsRoot: string,\n  filesContent: Array<TextFileDescriptor>,\n|}> => {\n  // Get GDJS for this version. If you updated the version,\n  // run `newIDE/web-app/scripts/deploy-GDJS-Runtime` script.\n  let gdjsRoot = `https://resources.gdevelop-app.com/GDJS-${getIDEVersionWithHash()}`;\n\n  if (Window.isDev()) {\n    gdjsRoot = `http://localhost:5002`;\n  }\n\n  return Promise.all(\n    filesToDownload[fileSet].map(relativeFilePath => {\n      const url = gdjsRoot + relativeFilePath;\n\n      // Don't do any caching, rely on the browser cache only.\n      return fetch(url).then(response => {\n        if (!response.ok) {\n          console.error(`Error while downloading \"${url}\"`, response);\n          throw new Error(\n            `Error while downloading \"${url}\" (status: ${response.status})`\n          );\n        }\n        return response.text().then(text => ({\n          filePath: url,\n          text,\n        }));\n      });\n    })\n  ).then(filesContent => {\n    return {\n      gdjsRoot,\n      filesContent,\n    };\n  });\n};\n","// @flow\nimport {\n  type PreviewDebuggerServerCallbacks,\n  type PreviewDebuggerServer,\n  type DebuggerId,\n} from '../../PreviewLauncher.flow';\n\nlet debuggerServerState: 'started' | 'stopped' = 'stopped';\nconst callbacksList: Array<PreviewDebuggerServerCallbacks> = [];\n\nlet nextDebuggerId = 0;\n\nconst responseCallbacks = new Map<number, (value: Object) => void>();\nlet nextMessageWithResponseId = 1;\n\nconst existingPreviewWindows: {\n  [DebuggerId]: WindowProxy,\n} = {};\n\nlet embbededGameFrameWindow: WindowProxy | null = null;\n\nconst getExistingDebuggerIds = (): Array<DebuggerId> => [\n  ...getExistingEmbeddedGameFrameDebuggerIds(),\n  ...getExistingPreviewDebuggerIds(),\n];\n\nconst getExistingEmbeddedGameFrameDebuggerIds = (): Array<DebuggerId> =>\n  embbededGameFrameWindow ? ['embedded-game-frame'] : [];\n\nconst getExistingPreviewDebuggerIds = (): Array<DebuggerId> =>\n  Object.keys(existingPreviewWindows).map(key => key);\n\nconst getDebuggerIdForPreviewWindow = (\n  previewWindow: any\n): DebuggerId | null => {\n  if (embbededGameFrameWindow && embbededGameFrameWindow === previewWindow) {\n    return 'embedded-game-frame';\n  }\n\n  for (const id in existingPreviewWindows) {\n    if (existingPreviewWindows[id] === previewWindow) {\n      return id;\n    }\n  }\n  return null;\n};\n\nlet windowClosedPollingIntervalId = null;\n\nconst stopWindowClosedPolling = () => {\n  if (windowClosedPollingIntervalId === null) return;\n\n  clearInterval(windowClosedPollingIntervalId);\n  windowClosedPollingIntervalId = null;\n};\n\nconst notifyConnectionClosed = (id: DebuggerId) => {\n  callbacksList.forEach(({ onConnectionClosed }) =>\n    onConnectionClosed({\n      id,\n      debuggerIds: getExistingDebuggerIds(),\n    })\n  );\n};\n\n/**\n * Listen to window closing so that we can notify the debuggers\n * when a preview window is closed.\n * Polling seems the only option to do so.\n */\nconst setupWindowClosedPolling = () => {\n  if (windowClosedPollingIntervalId !== null) return;\n\n  windowClosedPollingIntervalId = setInterval(() => {\n    for (const id in existingPreviewWindows) {\n      const previewWindow = existingPreviewWindows[id];\n      if (previewWindow.closed) {\n        console.info('A preview window was closed, with debugger id:', id);\n        delete existingPreviewWindows[id];\n        notifyConnectionClosed(id);\n        if (!Object.keys(existingPreviewWindows).length) {\n          stopWindowClosedPolling();\n        }\n      }\n    }\n  }, 1000);\n};\n\nlet previewOrigin = null;\n\n/**\n * A debugger server implemented using the ability to send/receive messages\n * from popup windows in the browser.\n */\nclass BrowserPreviewDebuggerServer {\n  async startServer({ origin }) {\n    if (debuggerServerState === 'started') return;\n    debuggerServerState = 'started';\n\n    previewOrigin = origin;\n\n    window.addEventListener('message', event => {\n      if (event.origin !== previewOrigin) return;\n\n      const id = getDebuggerIdForPreviewWindow(event.source);\n      if (id === null) {\n        return; // Could not find the id of this preview window.\n      }\n\n      try {\n        const parsedMessage = JSON.parse(event.data);\n        const answerCallback = responseCallbacks.get(parsedMessage.messageId);\n        if (answerCallback) {\n          answerCallback(parsedMessage);\n          responseCallbacks.delete(parsedMessage.messageId);\n        }\n        callbacksList.forEach(({ onHandleParsedMessage }) =>\n          onHandleParsedMessage({ id, parsedMessage })\n        );\n      } catch (error) {\n        console.error(\n          'Error while parsing messages coming from a preview:',\n          error\n        );\n      }\n    });\n\n    setupWindowClosedPolling();\n\n    callbacksList.forEach(({ onServerStateChanged }) => onServerStateChanged());\n  }\n  sendMessage(id: DebuggerId, message: Object) {\n    const theWindow =\n      id === 'embedded-game-frame'\n        ? embbededGameFrameWindow\n        : existingPreviewWindows[id];\n    if (!theWindow) return;\n\n    try {\n      theWindow.postMessage(message, previewOrigin);\n    } catch (error) {\n      console.error(\n        `Unable to send a message to the preview window with id \"${id}\":`,\n        error\n      );\n    }\n  }\n  sendMessageWithResponse(message: Object): Promise<Object> {\n    const messageId = nextMessageWithResponseId;\n    nextMessageWithResponseId++;\n    for (const id of getExistingDebuggerIds()) {\n      this.sendMessage(id, { ...message, messageId });\n    }\n\n    const timeout = 1000;\n    const promise = new Promise<Object>((resolve, reject) => {\n      responseCallbacks.set(messageId, resolve);\n      setTimeout(() => {\n        reject(\n          new Error(\n            `Timeout while waiting for response from the debugger(s) for message with id ${messageId}.`\n          )\n        );\n        responseCallbacks.delete(messageId);\n      }, timeout);\n    });\n    return promise;\n  }\n  getServerState() {\n    return debuggerServerState;\n  }\n  getExistingDebuggerIds() {\n    return getExistingDebuggerIds();\n  }\n  getExistingEmbeddedGameFrameDebuggerIds() {\n    return getExistingEmbeddedGameFrameDebuggerIds();\n  }\n  getExistingPreviewDebuggerIds() {\n    return getExistingPreviewDebuggerIds();\n  }\n  registerCallbacks(callbacks: PreviewDebuggerServerCallbacks) {\n    callbacksList.push(callbacks);\n\n    return () => {\n      const callbacksIndex = callbacksList.indexOf(callbacks);\n      if (callbacksIndex !== -1) callbacksList.splice(callbacksIndex, 1);\n    };\n  }\n  registerEmbeddedGameFrame(window: WindowProxy) {\n    if (window === embbededGameFrameWindow) return;\n\n    console.info(\n      'Registered the embedded game frame window in the debugger server.'\n    );\n    embbededGameFrameWindow = window;\n  }\n  unregisterEmbeddedGameFrame(window: WindowProxy) {\n    if (embbededGameFrameWindow !== window) {\n      if (!!embbededGameFrameWindow) {\n        console.warn(\n          'The embedded game frame window to unregister is not the same as the one registered. Ignoring the unregistration.'\n        );\n      }\n      return;\n    }\n\n    console.info(\n      'Unregistered the embedded game frame window in the debugger server.'\n    );\n    embbededGameFrameWindow = null;\n    notifyConnectionClosed('embedded-game-frame');\n  }\n  closeAllConnections() {\n    console.info(\n      'Closing all connections (i.e: windows and the embedded game frame) to the debugger server.'\n    );\n    Object.keys(existingPreviewWindows).forEach(id => {\n      const previewWindow = existingPreviewWindows[id];\n      delete existingPreviewWindows[id];\n\n      try {\n        if (previewWindow && !previewWindow.closed) previewWindow.close();\n      } catch (error) {\n        console.info(\n          'Unable to close a preview window - ignoring the error as the project is closing:',\n          error\n        );\n      }\n\n      notifyConnectionClosed(id);\n    });\n\n    stopWindowClosedPolling();\n\n    if (embbededGameFrameWindow) {\n      embbededGameFrameWindow = null;\n      notifyConnectionClosed('embedded-game-frame');\n    }\n\n    responseCallbacks.clear();\n  }\n}\nexport const browserPreviewDebuggerServer: PreviewDebuggerServer = new BrowserPreviewDebuggerServer();\n\nexport const registerNewPreviewWindow = (\n  previewWindow: WindowProxy\n): DebuggerId => {\n  const existingId = getDebuggerIdForPreviewWindow(previewWindow);\n  if (existingId) {\n    console.warn(\n      'A preview window was already registered. It has this id:',\n      existingId\n    );\n    return existingId;\n  }\n\n  // Associate this window with a new debugger id.\n  const id = 'preview-window-' + nextDebuggerId++;\n  existingPreviewWindows[id] = previewWindow;\n\n  setupWindowClosedPolling();\n\n  // Notify the debuggers that a new preview was opened.\n  callbacksList.forEach(({ onConnectionOpened }) =>\n    onConnectionOpened({\n      id,\n      debuggerIds: getExistingDebuggerIds(),\n    })\n  );\n\n  return id;\n};\n\nexport const getExistingPreviewWindowForDebuggerId = (\n  id: ?DebuggerId\n): ?WindowProxy => {\n  if (id == null) return null;\n\n  return existingPreviewWindows[id] || null;\n};\n","// @flow\nimport { displayBlackLoadingScreenOrThrow } from '../../../Utils/BrowserExternalWindowUtils';\n\nlet nextPreviewWindowId = 0;\n\n/**\n * Open a window showing a black \"loading...\" screen. It's important this is done\n * NOT in an asynchronous way but JUST after a click. Otherwise, browsers like Safari\n * will block the window opening.\n */\nexport const immediatelyOpenNewPreviewWindow = (\n  project: gdProject\n): WindowProxy => {\n  const width = project.getGameResolutionWidth();\n  const height = project.getGameResolutionHeight();\n  const left = window.screenX + window.innerWidth / 2 - width / 2;\n  const top = window.screenY + window.innerHeight / 2 - height / 2;\n\n  const targetId = 'GDevelopPreview' + nextPreviewWindowId++;\n  const previewWindow = window.open(\n    'about:blank',\n    targetId,\n    `width=${width},height=${height},left=${left},top=${top}`\n  );\n  if (!previewWindow) {\n    throw new Error(\n      \"Can't open the preview window because of browser restrictions.\"\n    );\n  }\n\n  displayBlackLoadingScreenOrThrow(previewWindow);\n\n  return previewWindow;\n};\n","// @flow\nimport * as React from 'react';\nimport BrowserPreviewErrorDialog from '../BrowserPreview/BrowserPreviewErrorDialog';\nimport BrowserSWFileSystem from '../BrowserSWFileSystem';\nimport { findGDJS } from '../../../GameEngineFinder/BrowserS3GDJSFinder';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type PreviewOptions,\n  type PreparePreviewWindowsOptions,\n  type PreviewLauncherProps,\n} from '../../PreviewLauncher.flow';\nimport {\n  browserPreviewDebuggerServer,\n  registerNewPreviewWindow,\n} from '../BrowserPreview/BrowserPreviewDebuggerServer';\nimport Window from '../../../Utils/Window';\nimport { getGDevelopResourceJwtToken } from '../../../Utils/GDevelopServices/Project';\nimport { isNativeMobileApp } from '../../../Utils/Platform';\nimport { getIDEVersionWithHash } from '../../../Version';\nimport {\n  getBrowserSWPreviewBaseUrl,\n  getBrowserSWPreviewRootUrl,\n} from './BrowserSWPreviewIndexedDB';\nimport { setEmbeddedGameFramePreviewLocation } from '../../../EmbeddedGame/EmbeddedGameFrame';\nimport { immediatelyOpenNewPreviewWindow } from '../BrowserPreview/BrowserPreviewWindow';\nconst gd: libGDevelop = global.gd;\n\nlet nextPreviewId = 1;\n\nconst prepareExporter = async ({\n  isForInGameEdition,\n}: {\n  isForInGameEdition: boolean,\n}): Promise<{|\n  outputDir: string,\n  exporter: gdjsExporter,\n  browserSWFileSystem: BrowserSWFileSystem,\n|}> => {\n  const { gdjsRoot, filesContent } = await findGDJS('preview');\n  console.info('[BrowserSWPreviewLauncher] GDJS found in', gdjsRoot);\n\n  const baseUrl = getBrowserSWPreviewBaseUrl();\n  const rootUrl = getBrowserSWPreviewRootUrl();\n  const outputDir = `${baseUrl}/${\n    isForInGameEdition ? 'in-game-editor-preview' : 'preview'\n  }`;\n\n  console.log(\n    '[BrowserSWPreviewLauncher] Preview will be served from:',\n    outputDir\n  );\n\n  const browserSWFileSystem = new BrowserSWFileSystem({\n    filesContent,\n    rootUrl: `${rootUrl}/`,\n  });\n  const fileSystem = assignIn(\n    new gd.AbstractFileSystemJS(),\n    browserSWFileSystem\n  );\n  const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n  exporter.setCodeOutputDirectory(outputDir);\n\n  return {\n    exporter,\n    outputDir,\n    browserSWFileSystem,\n  };\n};\n\ntype State = {|\n  error: ?Error,\n|};\n\nexport default class BrowserSWPreviewLauncher extends React.Component<\n  PreviewLauncherProps,\n  State\n> {\n  canDoNetworkPreview = () => false;\n\n  state = {\n    error: null,\n  };\n\n  closeAllPreviews = () => {\n    // This will also close the preview windows themselves.\n    browserPreviewDebuggerServer.closeAllConnections();\n  };\n\n  immediatelyPreparePreviewWindows = (\n    options: PreparePreviewWindowsOptions\n  ) => {\n    const debuggerIds = options.isForInGameEdition\n      ? this.getPreviewDebuggerServer().getExistingEmbeddedGameFrameDebuggerIds()\n      : this.getPreviewDebuggerServer().getExistingPreviewDebuggerIds();\n    const shouldHotReload = options.hotReload && !!debuggerIds.length;\n\n    // Immediately open windows (otherwise Safari will block the window opening if done after\n    // an asynchronous operation).\n    const previewWindows =\n      shouldHotReload || options.isForInGameEdition\n        ? []\n        : Array.from({ length: options.numberOfWindows }, () => {\n            try {\n              return immediatelyOpenNewPreviewWindow(options.project);\n            } catch (error) {\n              console.error(\n                '[BrowserSWPreviewLauncher] Unable to open a new preview window - this window will be ignored:',\n                error\n              );\n              return null;\n            }\n          }).filter(Boolean);\n\n    return previewWindows;\n  };\n\n  launchPreview = async (previewOptions: PreviewOptions): Promise<any> => {\n    const {\n      project,\n      sceneName,\n      externalLayoutName,\n      eventsBasedObjectType,\n      eventsBasedObjectVariantName,\n      previewWindows,\n    } = previewOptions;\n    const previewStartTime = Date.now();\n    this.setState({\n      error: null,\n    });\n\n    const previewId = nextPreviewId++;\n    console.log(\n      `[BrowserSWPreviewLauncher] Launching preview #${previewId} with options:`,\n      previewOptions\n    );\n\n    const debuggerIds = this.getPreviewDebuggerServer().getExistingDebuggerIds();\n    const shouldHotReload = previewOptions.hotReload && !!debuggerIds.length;\n\n    try {\n      await this.getPreviewDebuggerServer().startServer({\n        origin: new URL(getBrowserSWPreviewBaseUrl()).origin,\n      });\n    } catch (err) {\n      // Ignore any error when running the debugger server - the preview\n      // can still work without it.\n      console.error(\n        '[BrowserSWPreviewLauncher] Unable to start the Debugger Server for the preview:',\n        err\n      );\n    }\n\n    try {\n      const {\n        exporter,\n        outputDir,\n        browserSWFileSystem,\n      } = await prepareExporter({\n        isForInGameEdition: previewOptions.isForInGameEdition,\n      });\n\n      const previewExportOptions = new gd.PreviewExportOptions(\n        project,\n        outputDir\n      );\n      previewExportOptions.setLayoutName(sceneName);\n      previewExportOptions.setIsDevelopmentEnvironment(Window.isDev());\n      previewExportOptions.setIsInGameEdition(\n        previewOptions.isForInGameEdition\n      );\n      previewExportOptions.setEditorId(previewOptions.editorId || '');\n      if (externalLayoutName) {\n        previewExportOptions.setExternalLayoutName(externalLayoutName);\n      }\n      if (eventsBasedObjectType) {\n        previewExportOptions.setEventsBasedObjectType(eventsBasedObjectType);\n        previewExportOptions.setEventsBasedObjectVariantName(\n          eventsBasedObjectVariantName || ''\n        );\n      }\n\n      previewExportOptions.useWindowMessageDebuggerClient();\n\n      const includeFileHashs = this.props.getIncludeFileHashs();\n      for (const includeFile in includeFileHashs) {\n        const hash = includeFileHashs[includeFile];\n        previewExportOptions.setIncludeFileHash(includeFile, hash);\n      }\n\n      // TODO Filter according to isForInGameEdition because the first game preview\n      // won't necessarily be the first debugger.\n      // It doesn't have any side effect because when it wont actually do an hot-reload\n      // since the game preview doesn't exist yet.\n      if (shouldHotReload) {\n        previewExportOptions.setShouldClearExportFolder(\n          previewOptions.shouldHardReload\n        );\n        // At hot-reload, the ProjectData are passed into the message.\n        // It means that we don't need to write them in a file.\n        previewExportOptions.setShouldReloadProjectData(false);\n        previewExportOptions.setShouldReloadLibraries(\n          previewOptions.shouldReloadLibraries ||\n            previewOptions.shouldGenerateScenesEventsCode\n        );\n        previewExportOptions.setShouldGenerateScenesEventsCode(\n          previewOptions.shouldGenerateScenesEventsCode\n        );\n      }\n\n      previewExportOptions.setFullLoadingScreen(\n        previewOptions.fullLoadingScreen\n      );\n\n      previewExportOptions.setNativeMobileApp(isNativeMobileApp());\n      previewExportOptions.setGDevelopVersionWithHash(getIDEVersionWithHash());\n      previewExportOptions.setCrashReportUploadLevel(\n        this.props.crashReportUploadLevel\n      );\n      previewExportOptions.setPreviewContext(this.props.previewContext);\n      previewExportOptions.setProjectTemplateSlug(project.getTemplateSlug());\n      previewExportOptions.setSourceGameId(this.props.sourceGameId);\n\n      if (previewOptions.inAppTutorialMessageInPreview) {\n        previewExportOptions.setInAppTutorialMessageInPreview(\n          previewOptions.inAppTutorialMessageInPreview,\n          previewOptions.inAppTutorialMessagePositionInPreview\n        );\n      }\n\n      if (previewOptions.fallbackAuthor) {\n        previewExportOptions.setFallbackAuthor(\n          previewOptions.fallbackAuthor.id,\n          previewOptions.fallbackAuthor.username\n        );\n      }\n      if (previewOptions.authenticatedPlayer) {\n        previewExportOptions.setAuthenticatedPlayer(\n          previewOptions.authenticatedPlayer.playerId,\n          previewOptions.authenticatedPlayer.playerUsername,\n          previewOptions.authenticatedPlayer.playerToken\n        );\n      }\n      if (\n        previewOptions.captureOptions &&\n        previewOptions.captureOptions.screenshots\n      ) {\n        previewOptions.captureOptions.screenshots.forEach(screenshot => {\n          previewExportOptions.addScreenshotCapture(\n            screenshot.delayTimeInSeconds,\n            screenshot.signedUrl,\n            screenshot.publicUrl\n          );\n        });\n      }\n      if (previewOptions.editorCameraState3D) {\n        previewExportOptions.setEditorCameraState3D(\n          previewOptions.editorCameraState3D.cameraMode,\n          previewOptions.editorCameraState3D.positionX,\n          previewOptions.editorCameraState3D.positionY,\n          previewOptions.editorCameraState3D.positionZ,\n          previewOptions.editorCameraState3D.rotationAngle,\n          previewOptions.editorCameraState3D.elevationAngle,\n          previewOptions.editorCameraState3D.distance\n        );\n      }\n      if (previewOptions.inGameEditorSettings) {\n        previewExportOptions.setInGameEditorSettingsJson(\n          JSON.stringify(previewOptions.inGameEditorSettings)\n        );\n      }\n\n      // The token, if any, to be used to read resources on GDevelop Cloud buckets.\n      const gdevelopResourceToken = getGDevelopResourceJwtToken();\n      if (gdevelopResourceToken)\n        previewExportOptions.setGDevelopResourceToken(gdevelopResourceToken);\n\n      console.log(\n        `[BrowserSWPreviewLauncher] Exporting project for preview #${previewId}...`\n      );\n      exporter.exportProjectForPixiPreview(previewExportOptions);\n\n      console.log(\n        `[BrowserSWPreviewLauncher] Storing preview files in IndexedDB for preview #${previewId}...`\n      );\n      await browserSWFileSystem.applyPendingOperations();\n\n      if (previewOptions.isForInGameEdition) {\n        setEmbeddedGameFramePreviewLocation({\n          previewIndexHtmlLocation: outputDir + '/index.html',\n        });\n      }\n\n      if (shouldHotReload) {\n        const projectDataElement = new gd.SerializerElement();\n        exporter.serializeProjectData(\n          project,\n          previewExportOptions,\n          projectDataElement\n        );\n        const projectData = JSON.parse(\n          gd.Serializer.toJSON(projectDataElement)\n        );\n        projectDataElement.delete();\n\n        const runtimeGameOptionsElement = new gd.SerializerElement();\n        exporter.serializeRuntimeGameOptions(\n          previewExportOptions,\n          runtimeGameOptionsElement\n        );\n        const runtimeGameOptions = JSON.parse(\n          gd.Serializer.toJSON(runtimeGameOptionsElement)\n        );\n        runtimeGameOptionsElement.delete();\n\n        if (previewOptions.shouldHardReload) {\n          console.log(\n            `[BrowserSWPreviewLauncher] Triggering hard reload for preview #${previewId}...`\n          );\n          debuggerIds.forEach(debuggerId => {\n            this.getPreviewDebuggerServer().sendMessage(debuggerId, {\n              command: 'hardReload',\n            });\n          });\n        } else {\n          console.log(\n            `[BrowserSWPreviewLauncher] Triggering hot reload for preview #${previewId}...`\n          );\n          debuggerIds.forEach(debuggerId => {\n            this.getPreviewDebuggerServer().sendMessage(debuggerId, {\n              command: 'hotReload',\n              payload: {\n                shouldReloadResources: previewOptions.shouldReloadResources,\n                projectData,\n                runtimeGameOptions,\n              },\n            });\n          });\n        }\n      } else if (previewWindows) {\n        if (previewOptions.isForInGameEdition) {\n          setEmbeddedGameFramePreviewLocation({\n            previewIndexHtmlLocation: outputDir + '/index.html',\n          });\n        }\n\n        console.log(\n          '[BrowserSWPreviewLauncher] Opening new preview window(s)...'\n        );\n        previewWindows.forEach((previewWindow: WindowProxy) => {\n          // Change the HTML file displayed by the preview window so that it starts loading\n          // the game.\n          previewWindow.location = outputDir + '/index.html';\n          try {\n            previewWindow.focus();\n          } catch (e) {}\n\n          // Register the window so that it can be accessed\n          // by the debugger and for the captures to be detected when it closes.\n          const debuggerId = registerNewPreviewWindow(previewWindow);\n          browserPreviewDebuggerServer.registerCallbacks({\n            onErrorReceived: () => {},\n            onServerStateChanged: () => {},\n            onConnectionClosed: async ({ id }) => {\n              if (id !== debuggerId) {\n                return;\n              }\n\n              if (previewOptions.captureOptions) {\n                await this.props.onCaptureFinished(\n                  previewOptions.captureOptions\n                );\n              }\n            },\n            onConnectionOpened: () => {},\n            onConnectionErrored: () => {},\n            onHandleParsedMessage: () => {},\n          });\n        });\n      } else {\n        throw new Error(\n          'Internal error: no preview windows to open and no hot reload to trigger.'\n        );\n      }\n\n      previewExportOptions.delete();\n      exporter.delete();\n\n      console.log(\n        `[BrowserSWPreviewLauncher] Preview ${previewId} launched successfully in ${Math.ceil(\n          Date.now() - previewStartTime\n        )}ms.`\n      );\n    } catch (error) {\n      console.error(\n        `[BrowserSWPreviewLauncher] Error launching preview ${previewId}:`,\n        error\n      );\n      this.setState({\n        error,\n      });\n    }\n  };\n\n  getPreviewDebuggerServer() {\n    return browserPreviewDebuggerServer;\n  }\n\n  render() {\n    const { error } = this.state;\n\n    if (error) {\n      return (\n        <BrowserPreviewErrorDialog\n          error={error}\n          onClose={() =>\n            this.setState({\n              error: null,\n            })\n          }\n        />\n      );\n    }\n\n    return null;\n  }\n}\n","// @flow\nimport axios from 'axios';\nimport { GDevelopGamePreviews } from './ApiConfigs';\nimport { getSignedUrls } from './Usage';\n\nexport type UploadedObject = {|\n  Key: string,\n  Body: string,\n  ContentType: 'text/javascript' | 'text/html',\n|};\n\nexport const uploadObjects = async (\n  uploadedObjects: Array<UploadedObject>\n): Promise<void> => {\n  const { signedUrls } = await getSignedUrls({\n    uploadType: 'preview',\n    files: uploadedObjects.map(params => ({\n      key: params.Key,\n      contentType: params.ContentType,\n    })),\n  });\n\n  if (signedUrls.length !== uploadedObjects.length) {\n    throw new Error(\n      'Unexpected response from the API (signed urls count is not the same as uploaded objects count).'\n    );\n  }\n\n  await Promise.all(\n    uploadedObjects.map((params, index) =>\n      axios.put(signedUrls[index], params.Body, {\n        headers: {\n          'Content-Type': params.ContentType,\n        },\n      })\n    )\n  );\n};\n\nexport const getBaseUrl = () => {\n  return GDevelopGamePreviews.baseUrl;\n};\n","// @flow\nimport path from 'path-browserify';\nimport { uploadObjects } from '../../Utils/GDevelopServices/Preview';\nconst gd: libGDevelop = global.gd;\n\nexport type TextFileDescriptor = {|\n  filePath: string,\n  text: string,\n|};\n\ntype PendingUploadFileDescriptor = {|\n  Key: string,\n  Body: string,\n  ContentType: 'text/javascript' | 'text/html',\n|};\n\ntype ConstructorArgs = {|\n  filesContent: Array<TextFileDescriptor>,\n  prefix: string,\n  bucketBaseUrl: string,\n|};\n\nconst isURL = (filename: string) => {\n  return (\n    filename.startsWith('http://') ||\n    filename.startsWith('https://') ||\n    filename.startsWith('ftp://') ||\n    filename.startsWith('blob:') ||\n    filename.startsWith('data:')\n  );\n};\n\n/**\n * An in-memory \"file system\" that can be used for GDevelop previews.\n */\nexport default class BrowserS3FileSystem {\n  prefix: string;\n  bucketBaseUrl: string;\n\n  // Store the content of some files.\n  _indexedFilesContent: { [string]: TextFileDescriptor };\n\n  // Store all the objects that should be written on the S3 bucket.\n  // Call uploadPendingObjects to send them\n  _pendingUploadObjects: Array<PendingUploadFileDescriptor> = [];\n\n  // Store a set of all external URLs copied so that we can simulate\n  // readDir result.\n  _allCopiedExternalUrls = new Set<string>();\n\n  constructor({ filesContent, prefix, bucketBaseUrl }: ConstructorArgs) {\n    this.prefix = prefix;\n    this.bucketBaseUrl = bucketBaseUrl;\n\n    this._indexedFilesContent = {};\n    filesContent.forEach(textFileDescriptor => {\n      this._indexedFilesContent[\n        textFileDescriptor.filePath\n      ] = textFileDescriptor;\n    });\n  }\n\n  uploadPendingObjects = async () => {\n    try {\n      console.log(\n        `Uploading ${this._pendingUploadObjects.length} files for preview...`\n      );\n      await uploadObjects(this._pendingUploadObjects);\n      console.log(\n        `Uploaded all ${this._pendingUploadObjects.length} preview files.`\n      );\n    } catch (error) {\n      console.error(\"Can't upload all objects:\", error);\n      throw error;\n    }\n  };\n\n  mkDir = (path: string) => {\n    // Assume required directories always exist.\n  };\n  dirExists = (path: string) => {\n    // Assume required directories always exist.\n    return true;\n  };\n  clearDir = (path: string) => {\n    // Assume path is cleared.\n  };\n  getTempDir = () => {\n    return '/virtual-unused-tmp-dir';\n  };\n  fileNameFrom = (fullpath: string) => {\n    if (isURL(fullpath)) return fullpath;\n\n    return path.basename(fullpath);\n  };\n  dirNameFrom = (fullpath: string) => {\n    if (isURL(fullpath)) return '';\n\n    return path.dirname(fullpath);\n  };\n  makeAbsolute = (filename: string, baseDirectory: string) => {\n    if (isURL(filename)) return filename;\n\n    if (!this.isAbsolute(baseDirectory))\n      baseDirectory = path.resolve(baseDirectory);\n\n    if (isURL(baseDirectory)) {\n      return baseDirectory + '/' + filename;\n    }\n\n    return path.resolve(baseDirectory, path.normalize(filename));\n  };\n  makeRelative = (filename: string, baseDirectory: string) => {\n    if (isURL(filename)) return filename;\n\n    return path.relative(baseDirectory, path.normalize(filename));\n  };\n  isAbsolute = (fullpath: string) => {\n    if (isURL(fullpath)) return true;\n\n    if (fullpath.length === 0) return true;\n    return (\n      (fullpath.length > 0 && fullpath.charAt(0) === '/') ||\n      (fullpath.length > 1 && fullpath.charAt(1) === ':')\n    );\n  };\n  copyFile = (source: string, dest: string) => {\n    //URL are not copied.\n    if (isURL(source)) {\n      this._allCopiedExternalUrls.add(source);\n      return true;\n    }\n\n    console.warn('Copy not done from', source, 'to', dest);\n    return true;\n  };\n  writeToFile = (fullPath: string, contents: string) => {\n    const key = fullPath.replace(this.bucketBaseUrl, '');\n    const mime = {\n      '.js': 'text/javascript',\n      '.html': 'text/html',\n    };\n    const fileExtension = path.extname(fullPath);\n\n    // Defer real upload until it's triggered by calling\n    // uploadPendingObjects.\n    this._pendingUploadObjects.push({\n      Key: key,\n      Body: contents,\n      ContentType: mime[fileExtension],\n    });\n    return true;\n  };\n\n  readFile = (file: string) => {\n    if (!!this._indexedFilesContent[file])\n      return this._indexedFilesContent[file].text;\n\n    console.error(`Unknown file ${file}, returning an empty string`);\n    return '';\n  };\n\n  readDir = (path: string, ext: string) => {\n    ext = ext.toUpperCase();\n    var output = new gd.VectorString();\n\n    // Simulate ReadDir by returning all external URLs\n    // with the filename matching the extension.\n    this._allCopiedExternalUrls.forEach(url => {\n      const upperCaseUrl = url.toUpperCase();\n      if (upperCaseUrl.indexOf(ext) === upperCaseUrl.length - ext.length) {\n        output.push_back(url);\n      }\n    });\n\n    return output;\n  };\n\n  fileExists = (filename: string) => {\n    if (isURL(filename)) return true;\n\n    // Assume all files asked for exists.\n    return true;\n  };\n}\n","// @flow\nimport * as React from 'react';\nimport BrowserPreviewErrorDialog from '../BrowserPreview/BrowserPreviewErrorDialog';\nimport BrowserS3FileSystem from '../BrowserS3FileSystem';\nimport { findGDJS } from '../../../GameEngineFinder/BrowserS3GDJSFinder';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type PreviewOptions,\n  type PreviewLauncherProps,\n} from '../../PreviewLauncher.flow';\nimport { getBaseUrl } from '../../../Utils/GDevelopServices/Preview';\nimport { makeTimestampedId } from '../../../Utils/TimestampedId';\nimport {\n  browserPreviewDebuggerServer,\n  getExistingPreviewWindowForDebuggerId,\n  registerNewPreviewWindow,\n} from '../BrowserPreview/BrowserPreviewDebuggerServer';\nimport Window from '../../../Utils/Window';\nimport { getGDevelopResourceJwtToken } from '../../../Utils/GDevelopServices/Project';\nimport { isNativeMobileApp } from '../../../Utils/Platform';\nimport { getIDEVersionWithHash } from '../../../Version';\nimport { setEmbeddedGameFramePreviewLocation } from '../../../EmbeddedGame/EmbeddedGameFrame';\nimport { immediatelyOpenNewPreviewWindow } from '../BrowserPreview/BrowserPreviewWindow';\nconst gd: libGDevelop = global.gd;\n\ntype State = {|\n  error: ?Error,\n|};\n\nexport default class BrowserS3PreviewLauncher extends React.Component<\n  PreviewLauncherProps,\n  State\n> {\n  canDoNetworkPreview = () => false;\n\n  state = {\n    error: null,\n  };\n\n  _prepareExporter = (): Promise<{|\n    outputDir: string,\n    exporter: gdjsExporter,\n    browserS3FileSystem: BrowserS3FileSystem,\n  |}> => {\n    return findGDJS('preview').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const prefix = makeTimestampedId();\n\n      const outputDir = getBaseUrl() + prefix;\n      const browserS3FileSystem = new BrowserS3FileSystem({\n        filesContent,\n        bucketBaseUrl: getBaseUrl(),\n        prefix,\n      });\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        browserS3FileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n      exporter.setCodeOutputDirectory(outputDir);\n\n      return {\n        exporter,\n        outputDir,\n        browserS3FileSystem,\n      };\n    });\n  };\n\n  launchPreview = async (previewOptions: PreviewOptions): Promise<any> => {\n    const {\n      project,\n      sceneName,\n      externalLayoutName,\n      eventsBasedObjectType,\n      eventsBasedObjectVariantName,\n      numberOfWindows,\n    } = previewOptions;\n    this.setState({\n      error: null,\n    });\n\n    const debuggerIds = previewOptions.isForInGameEdition\n      ? this.getPreviewDebuggerServer().getExistingEmbeddedGameFrameDebuggerIds()\n      : this.getPreviewDebuggerServer().getExistingPreviewDebuggerIds();\n    const lastDebuggerId = debuggerIds.length\n      ? debuggerIds[debuggerIds.length - 1]\n      : null;\n    const shouldHotReload = previewOptions.hotReload && lastDebuggerId !== null;\n\n    // We abuse the \"hot reload\" to choose if we open a new window or replace\n    // the content of an existing one. But hot reload is NOT implemented (yet -\n    // it would need to generate the preview in the same place and trigger a reload\n    // of the scripts).\n    const existingPreviewWindow = shouldHotReload\n      ? getExistingPreviewWindowForDebuggerId(lastDebuggerId)\n      : null;\n\n    const previewWindows = existingPreviewWindow\n      ? [existingPreviewWindow]\n      : Array.from({ length: numberOfWindows }, () => {\n          try {\n            return immediatelyOpenNewPreviewWindow(project);\n          } catch (error) {\n            console.error(\n              'Unable to open a new preview window - this window will be ignored:',\n              error\n            );\n            return null;\n          }\n        }).filter(Boolean);\n\n    try {\n      await this.getPreviewDebuggerServer().startServer({\n        origin: new URL(getBaseUrl()).origin,\n      });\n    } catch (err) {\n      // Ignore any error when running the debugger server - the preview\n      // can still work without it.\n      console.error(\n        'Unable to start the Debugger Server for the preview:',\n        err\n      );\n    }\n\n    try {\n      const {\n        exporter,\n        outputDir,\n        browserS3FileSystem,\n      } = await this._prepareExporter();\n\n      const previewExportOptions = new gd.PreviewExportOptions(\n        project,\n        outputDir\n      );\n      previewExportOptions.setLayoutName(sceneName);\n      previewExportOptions.setIsDevelopmentEnvironment(Window.isDev());\n      previewExportOptions.setIsInGameEdition(\n        previewOptions.isForInGameEdition\n      );\n      previewExportOptions.setEditorId(previewOptions.editorId || '');\n      if (externalLayoutName) {\n        previewExportOptions.setExternalLayoutName(externalLayoutName);\n      }\n      if (eventsBasedObjectType) {\n        previewExportOptions.setEventsBasedObjectType(eventsBasedObjectType);\n        previewExportOptions.setEventsBasedObjectVariantName(\n          eventsBasedObjectVariantName || ''\n        );\n      }\n\n      if (isNativeMobileApp()) {\n        previewExportOptions.useMinimalDebuggerClient();\n      } else {\n        previewExportOptions.useWindowMessageDebuggerClient();\n      }\n\n      // Scripts generated from extensions keep the same URL even after being modified.\n      // Use a cache bursting parameter to force the browser to reload them.\n      previewExportOptions.setNonRuntimeScriptsCacheBurst(Date.now());\n\n      previewExportOptions.setFullLoadingScreen(\n        previewOptions.fullLoadingScreen\n      );\n\n      previewExportOptions.setNativeMobileApp(isNativeMobileApp());\n      previewExportOptions.setGDevelopVersionWithHash(getIDEVersionWithHash());\n      previewExportOptions.setCrashReportUploadLevel(\n        this.props.crashReportUploadLevel\n      );\n      previewExportOptions.setPreviewContext(this.props.previewContext);\n      previewExportOptions.setProjectTemplateSlug(project.getTemplateSlug());\n      previewExportOptions.setSourceGameId(this.props.sourceGameId);\n\n      if (previewOptions.inAppTutorialMessageInPreview) {\n        previewExportOptions.setInAppTutorialMessageInPreview(\n          previewOptions.inAppTutorialMessageInPreview,\n          previewOptions.inAppTutorialMessagePositionInPreview\n        );\n      }\n\n      if (previewOptions.fallbackAuthor) {\n        previewExportOptions.setFallbackAuthor(\n          previewOptions.fallbackAuthor.id,\n          previewOptions.fallbackAuthor.username\n        );\n      }\n      if (previewOptions.authenticatedPlayer) {\n        previewExportOptions.setAuthenticatedPlayer(\n          previewOptions.authenticatedPlayer.playerId,\n          previewOptions.authenticatedPlayer.playerUsername,\n          previewOptions.authenticatedPlayer.playerToken\n        );\n      }\n      if (\n        previewOptions.captureOptions &&\n        previewOptions.captureOptions.screenshots\n      ) {\n        previewOptions.captureOptions.screenshots.forEach(screenshot => {\n          previewExportOptions.addScreenshotCapture(\n            screenshot.delayTimeInSeconds,\n            screenshot.signedUrl,\n            screenshot.publicUrl\n          );\n        });\n      }\n      if (previewOptions.editorCameraState3D) {\n        previewExportOptions.setEditorCameraState3D(\n          previewOptions.editorCameraState3D.cameraMode,\n          previewOptions.editorCameraState3D.positionX,\n          previewOptions.editorCameraState3D.positionY,\n          previewOptions.editorCameraState3D.positionZ,\n          previewOptions.editorCameraState3D.rotationAngle,\n          previewOptions.editorCameraState3D.elevationAngle,\n          previewOptions.editorCameraState3D.distance\n        );\n      }\n      if (previewOptions.inGameEditorSettings) {\n        previewExportOptions.setInGameEditorSettingsJson(\n          JSON.stringify(previewOptions.inGameEditorSettings)\n        );\n      }\n\n      // The token, if any, to be used to read resources on GDevelop Cloud buckets.\n      const gdevelopResourceToken = getGDevelopResourceJwtToken();\n      if (gdevelopResourceToken)\n        previewExportOptions.setGDevelopResourceToken(gdevelopResourceToken);\n\n      exporter.exportProjectForPixiPreview(previewExportOptions);\n      previewExportOptions.delete();\n      exporter.delete();\n\n      // Upload any file that must be exported for the preview.\n      await browserS3FileSystem.uploadPendingObjects();\n\n      if (previewOptions.isForInGameEdition) {\n        setEmbeddedGameFramePreviewLocation({\n          previewIndexHtmlLocation: outputDir + '/index.html',\n        });\n      }\n\n      // Change the HTML file displayed by the preview window so that it starts loading\n      // the game.\n      previewWindows.forEach((previewWindow: WindowProxy) => {\n        previewWindow.location = outputDir + '/index.html';\n        try {\n          previewWindow.focus();\n        } catch (e) {}\n      });\n\n      // If the preview windows are new, register them so that they can be accessed\n      // by the debugger and for the captures to be detected when they close.\n      if (!existingPreviewWindow) {\n        previewWindows.forEach((previewWindow: WindowProxy) => {\n          const debuggerId = registerNewPreviewWindow(previewWindow);\n          browserPreviewDebuggerServer.registerCallbacks({\n            onErrorReceived: () => {},\n            onServerStateChanged: () => {},\n            onConnectionClosed: async ({ id }) => {\n              if (id !== debuggerId) {\n                return;\n              }\n\n              if (previewOptions.captureOptions) {\n                await this.props.onCaptureFinished(\n                  previewOptions.captureOptions\n                );\n              }\n            },\n            onConnectionOpened: () => {},\n            onConnectionErrored: () => {},\n            onHandleParsedMessage: () => {},\n          });\n        });\n      }\n    } catch (error) {\n      this.setState({\n        error,\n      });\n    }\n  };\n\n  getPreviewDebuggerServer() {\n    return browserPreviewDebuggerServer;\n  }\n\n  render() {\n    const { error } = this.state;\n\n    if (error) {\n      return (\n        <BrowserPreviewErrorDialog\n          error={error}\n          onClose={() =>\n            this.setState({\n              error: null,\n            })\n          }\n        />\n      );\n    }\n\n    return null;\n  }\n}\n","// @flow\nimport path from 'path-browserify';\nconst gd: libGDevelop = global.gd;\n\nexport type BlobFileDescriptor = {|\n  filePath: string,\n  blob: Blob,\n|};\n\nexport type TextFileDescriptor = {|\n  filePath: string,\n  text: string,\n|};\n\nexport type UrlFileDescriptor = {|\n  filePath: string,\n  url: string,\n|};\n\ntype ConstructorArgs = {|\n  textFiles: Array<TextFileDescriptor>,\n|};\n\nconst isURL = (filename: string) => {\n  return (\n    filename.startsWith('http://') ||\n    filename.startsWith('https://') ||\n    filename.startsWith('ftp://') ||\n    filename.startsWith('blob:') ||\n    filename.startsWith('data:')\n  );\n};\n\n// For some reason, `path.posix` is undefined when packaged\n// with webpack, so we're using `path` directly. As it's for the web-app,\n// it should always be the posix version. In tests on Windows,\n// it's necessary to use path.posix.\n// Search for \"pathPosix\" in the codebase for other places where this is used.\nconst pathPosix = path.posix || path;\n\n/**\n * An in-memory \"file system\" that can be used for GDevelop exports.\n */\nexport default class BrowserFileSystem {\n  // The representation of the \"file system\":\n\n  /**\n   * Store all the text files (filepath => content)\n   * @private\n   */\n  _textFiles: { [string]: string } = {};\n\n  /**\n   * Store all the files that should be downloaded (filepath => url)\n   * @private\n   */\n  _filesToDownload: { [string]: string } = {};\n\n  /**\n   * Create a new in-memory file system.\n   */\n  constructor({ textFiles }: ConstructorArgs) {\n    textFiles.forEach(textFileDescriptor => {\n      this._textFiles[textFileDescriptor.filePath] = textFileDescriptor.text;\n    });\n  }\n\n  /**\n   * Returns all the in memory text files with the specified path prefix.\n   */\n  getAllTextFilesIn = (pathPrefix: string): Array<TextFileDescriptor> => {\n    return Object.keys(this._textFiles)\n      .filter(filePath => filePath.indexOf(pathPrefix) === 0)\n      .map(filePath => ({\n        filePath,\n        text: this._textFiles[filePath],\n      }));\n  };\n\n  /**\n   * Returns all the files that should be downloaded from a URL, with the specified destination path prefix.\n   */\n  getAllUrlFilesIn = (pathPrefix: string): Array<UrlFileDescriptor> => {\n    return Object.keys(this._filesToDownload)\n      .filter(filePath => filePath.indexOf(pathPrefix) === 0)\n      .map(filePath => ({\n        filePath,\n        url: this._filesToDownload[filePath],\n      }));\n  };\n\n  mkDir = (path: string) => {\n    // \"Directories\" are assumed to exist.\n    return true;\n  };\n  dirExists = (path: string) => {\n    // TODO: To be changed to be EnsureDirExists.\n    // \"Directories\" are assumed to exist.\n    return true;\n  };\n  clearDir = (path: string) => {\n    // Clear the files to be written in the specified directory.\n    const filePaths = Object.keys(this._textFiles);\n    filePaths.forEach(filePath => {\n      if (filePath.indexOf(path) === 0) {\n        delete this._textFiles[filePath];\n      }\n    });\n\n    return true;\n  };\n  getTempDir = () => {\n    return '/browser-file-system-tmp-dir';\n  };\n  fileNameFrom = (fullpath: string) => {\n    return pathPosix.basename(fullpath);\n  };\n  dirNameFrom = (fullpath: string) => {\n    return pathPosix.dirname(fullpath);\n  };\n  makeAbsolute = (filePathOrURL: string, baseDirectoryOrURL: string) => {\n    // URLs are always absolute\n    if (isURL(filePathOrURL)) return filePathOrURL;\n\n    if (!this.isAbsolute(baseDirectoryOrURL))\n      baseDirectoryOrURL = pathPosix.resolve(baseDirectoryOrURL);\n\n    if (isURL(baseDirectoryOrURL)) {\n      return baseDirectoryOrURL + '/' + filePathOrURL;\n    }\n\n    return pathPosix.resolve(\n      baseDirectoryOrURL,\n      pathPosix.normalize(filePathOrURL)\n    );\n  };\n  makeRelative = (filePathOrURL: string, baseDirectoryOrURL: string) => {\n    if (isURL(filePathOrURL)) {\n      // Cutting the start if the URL is relative to the base URL\n      if (filePathOrURL.indexOf(baseDirectoryOrURL) === 0) {\n        return filePathOrURL.substring(baseDirectoryOrURL.length);\n      }\n\n      // Keep the URL \"absolute\" if on different domains.\n      console.warn(\n        `${filePathOrURL} cannot be made relative to ${baseDirectoryOrURL}, please double check this behavior is correct.`\n      );\n      return filePathOrURL;\n    }\n\n    // Paths are treated as usual paths.\n    return pathPosix.relative(\n      baseDirectoryOrURL,\n      pathPosix.normalize(filePathOrURL)\n    );\n  };\n  isAbsolute = (fullpath: string) => {\n    // URLs are always absolute\n    if (isURL(fullpath)) return true;\n\n    // Paths are absolute if starting from the root\n    return fullpath.length > 0 && fullpath.charAt(0) === '/';\n  };\n\n  copyFile = (source: string, dest: string) => {\n    // URLs are not copied, but marked as to be downloaded.\n    if (isURL(source)) {\n      if (isURL(dest)) {\n        console.error(\n          `Destination can't be a URL in copyFile (from ${source} to ${dest}).`\n        );\n        return false;\n      }\n\n      this._filesToDownload[pathPosix.normalize(dest)] = source;\n      return true;\n    }\n\n    // If this is a file that we have already in memory,\n    // copy its path.\n    if (!!this._textFiles[source]) {\n      this._textFiles[pathPosix.normalize(dest)] = this._textFiles[source];\n      return true;\n    }\n\n    // If this is a file that we have to download,\n    // consider the file copied by getting it to be downloaded in the new destination\n    const existingDestToDownload = Object.keys(this._filesToDownload).find(\n      filePath => filePath === source\n    );\n    if (existingDestToDownload) {\n      const existingSourceToDownload = this._filesToDownload[\n        existingDestToDownload\n      ];\n      this._filesToDownload[\n        pathPosix.normalize(dest)\n      ] = existingSourceToDownload;\n      return true;\n    }\n\n    console.error(`File not found in copyFile (from ${source} to ${dest}).`);\n    return false;\n  };\n\n  writeToFile = (filePath: string, content: string) => {\n    this._textFiles[pathPosix.normalize(filePath)] = content;\n    return true;\n  };\n\n  readFile = (file: string): string => {\n    if (this._textFiles[file]) return this._textFiles[file];\n\n    console.error(`Unknown file ${file}, returning an empty string`);\n    return '';\n  };\n\n  readDir = (path: string, ext: string) => {\n    ext = ext.toUpperCase();\n    var output = new gd.VectorString();\n\n    // Simulate ReadDir by returning all external URLs\n    // with the filename matching the extension.\n    Object.keys(this._filesToDownload).forEach(filePath => {\n      const upperCaseFilePath = filePath.toUpperCase();\n      if (\n        upperCaseFilePath.indexOf(ext) ===\n        upperCaseFilePath.length - ext.length\n      ) {\n        output.push_back(filePath);\n      }\n    });\n\n    return output;\n  };\n\n  fileExists = (filePath: string) => {\n    if (isURL(filePath)) return true;\n\n    const normalizedFilePath = pathPosix.normalize(filePath);\n    return (\n      !!this._textFiles[normalizedFilePath] ||\n      !!this._filesToDownload[normalizedFilePath]\n    );\n  };\n}\n","// @flow\nimport * as React from 'react';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildCordovaAndroid,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { uploadBlobFile } from './BrowserFileUploader';\nimport { type AuthenticatedUser } from '../../Profile/AuthenticatedUserContext';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport {\n  type ExportState,\n  SetupExportHeader,\n  ExportFlow,\n} from '../GenericExporters/OnlineCordovaExport';\n\nconst gd: libGDevelop = global.gd;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-online-cordova';\n\nexport const browserOnlineCordovaExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n  onlineBuildType: 'cordova-build',\n  limitedBuilds: true,\n  packageNameWarningType: 'mobile',\n\n  getInitialExportState: () => ({\n    targets: ['androidApk'],\n    keystore: 'new',\n    signingDialogOpen: false,\n  }),\n\n  // Build can be launched only if just opened the dialog or build errored.\n  canLaunchBuild: (exportState, errored, exportStep) =>\n    errored || exportStep === '',\n\n  // Navigation is enabled when the build is errored or whilst uploading.\n  isNavigationDisabled: (exportStep, errored) =>\n    !errored &&\n    ['register', 'export', 'resources-download', 'compress', 'upload'].includes(\n      exportStep\n    ),\n\n  renderHeader: props => <SetupExportHeader {...props} />,\n\n  shouldSuggestBumpingVersionNumber: () => true,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('cordova').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    exportOptions.setTarget('cordova');\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    blobFile: Blob\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadBlobFile(\n        blobFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    authenticatedUser: AuthenticatedUser,\n    uploadBucketKey: string,\n    gameId: string,\n    options: {|\n      gameName: string,\n      gameVersion: string,\n    |},\n    payWithCredits: boolean\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, firebaseUser } = authenticatedUser;\n    if (!firebaseUser)\n      return Promise.reject(new Error('User is not authenticated'));\n\n    return buildCordovaAndroid(\n      getAuthorizationHeader,\n      firebaseUser.uid,\n      uploadBucketKey,\n      exportState.targets,\n      exportState.keystore,\n      gameId,\n      options,\n      payWithCredits\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildCordovaIos,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { uploadBlobFile } from './BrowserFileUploader';\nimport { type AuthenticatedUser } from '../../Profile/AuthenticatedUserContext';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport {\n  type ExportState,\n  SetupExportHeader,\n  ExportFlow,\n} from '../GenericExporters/OnlineCordovaIosExport';\n\nconst gd: libGDevelop = global.gd;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-online-cordova-ios';\n\nexport const browserOnlineCordovaIosExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n  onlineBuildType: 'cordova-ios-build',\n  limitedBuilds: true,\n  packageNameWarningType: 'mobile',\n\n  getInitialExportState: () => ({\n    targets: ['iosAppStore'],\n    signing: null,\n  }),\n\n  // Build can be launched only if just opened the dialog or build errored.\n  canLaunchBuild: (exportState, errored, exportStep) =>\n    (errored || exportStep === '') && !!exportState.signing,\n\n  // Navigation is enabled when the build is errored or whilst uploading.\n  isNavigationDisabled: (exportStep, errored) =>\n    !errored &&\n    ['register', 'export', 'resources-download', 'compress', 'upload'].includes(\n      exportStep\n    ),\n\n  renderHeader: props => <SetupExportHeader {...props} />,\n\n  shouldSuggestBumpingVersionNumber: () => true,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('cordova').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    exportOptions.setTarget('cordova');\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    blobFile: Blob\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadBlobFile(\n        blobFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    authenticatedUser: AuthenticatedUser,\n    uploadBucketKey: string,\n    gameId: string,\n    options: {|\n      gameName: string,\n      gameVersion: string,\n    |},\n    payWithCredits: boolean\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, profile } = authenticatedUser;\n    if (!profile) return Promise.reject(new Error('User is not authenticated'));\n    if (!exportState.signing)\n      return Promise.reject(new Error('Signing options not set up'));\n\n    return buildCordovaIos(\n      getAuthorizationHeader,\n      profile.id,\n      uploadBucketKey,\n      exportState.targets,\n      exportState.signing,\n      gameId,\n      options,\n      payWithCredits\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildElectron,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { uploadBlobFile } from './BrowserFileUploader';\nimport { type AuthenticatedUser } from '../../Profile/AuthenticatedUserContext';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport {\n  type ExportState,\n  SetupExportHeader,\n  ExportFlow,\n} from '../GenericExporters/OnlineElectronExport';\n\nconst gd: libGDevelop = global.gd;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-online-electron';\n\nexport const browserOnlineElectronExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n  onlineBuildType: 'electron-build',\n  limitedBuilds: true,\n  packageNameWarningType: 'desktop',\n\n  getInitialExportState: () => ({\n    targets: ['winExe'],\n  }),\n\n  // Build can be launched only if just opened the dialog or build errored.\n  canLaunchBuild: (exportState, errored, exportStep) =>\n    !!exportState.targets.length && (errored || exportStep === ''),\n\n  // Navigation is enabled when the build is errored or whilst uploading.\n  isNavigationDisabled: (exportStep, errored) =>\n    !errored &&\n    ['register', 'export', 'resources-download', 'compress', 'upload'].includes(\n      exportStep\n    ),\n\n  renderHeader: props => <SetupExportHeader {...props} />,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('electron').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    exportOptions.setTarget('electron');\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    blobFile: Blob\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadBlobFile(\n        blobFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    authenticatedUser: AuthenticatedUser,\n    uploadBucketKey: string,\n    gameId: string,\n    options: {|\n      gameName: string,\n      gameVersion: string,\n    |},\n    payWithCredits: boolean\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, firebaseUser } = authenticatedUser;\n    if (!firebaseUser)\n      return Promise.reject(new Error('User is not authenticated'));\n\n    return buildElectron(\n      getAuthorizationHeader,\n      firebaseUser.uid,\n      uploadBucketKey,\n      exportState.targets,\n      gameId,\n      options,\n      payWithCredits\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport assignIn from 'lodash/assignIn';\nimport {\n  type Build,\n  buildWeb,\n  getBuildFileUploadOptions,\n} from '../../Utils/GDevelopServices/Build';\nimport { uploadBlobFile } from './BrowserFileUploader';\nimport { type AuthenticatedUser } from '../../Profile/AuthenticatedUserContext';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportPipeline,\n  type ExportPipelineContext,\n  type ExportFlowProps,\n} from '../ExportPipeline.flow';\nimport { ExplanationHeader } from '../GenericExporters/OnlineWebExport';\nimport OnlineWebExportFlow from '../GenericExporters/OnlineWebExport/OnlineWebExportFlow';\n\nconst gd: libGDevelop = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-online-web';\n\nexport const browserOnlineWebExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n  onlineBuildType: 'web-build',\n\n  getInitialExportState: () => null,\n\n  // Build can be launched if just opened the dialog or build errored, re-enabled when done.\n  canLaunchBuild: (exportState, errored, exportStep) =>\n    errored || exportStep === '' || exportStep === 'done',\n\n  // Navigation is enabled when the build is errored or if the build is not done.\n  isNavigationDisabled: (exportStep, errored) =>\n    !errored && !['', 'done'].includes(exportStep),\n\n  renderHeader: ({ uiMode }) => <ExplanationHeader uiMode={uiMode} />,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <OnlineWebExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('web').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n      sizeLimit: 250 * 1000 * 1000,\n    });\n  },\n\n  launchUpload: (\n    context: ExportPipelineContext<ExportState>,\n    blobFile: Blob\n  ): Promise<string> => {\n    return getBuildFileUploadOptions().then(uploadOptions => {\n      return uploadBlobFile(\n        blobFile,\n        uploadOptions,\n        context.updateStepProgress\n      ).then(() => uploadOptions.key);\n    });\n  },\n\n  launchOnlineBuild: (\n    exportState: ExportState,\n    authenticatedUser: AuthenticatedUser,\n    uploadBucketKey: string,\n    gameId: string,\n    options: {|\n      gameName: string,\n      gameVersion: string,\n    |},\n    payWithCredits: boolean\n  ): Promise<Build> => {\n    const { getAuthorizationHeader, firebaseUser } = authenticatedUser;\n    if (!firebaseUser)\n      return Promise.reject(new Error('User is not authenticated'));\n\n    return buildWeb(\n      getAuthorizationHeader,\n      firebaseUser.uid,\n      uploadBucketKey,\n      gameId,\n      options,\n      payWithCredits\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport RaisedButton from '../../UI/RaisedButton';\nimport {\n  BlobDownloadUrlHolder,\n  openBlobDownloadUrl,\n} from '../../Utils/BlobDownloadUrlHolder';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n  ExportFlow,\n} from '../GenericExporters/HTML5Export';\n\nconst gd: libGDevelop = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-html5';\n\nexport const browserHTML5ExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n\n  getInitialExportState: () => null,\n\n  canLaunchBuild: () => true,\n\n  isNavigationDisabled: () => false,\n\n  renderHeader: () => <ExplanationHeader />,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('web').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  renderDoneFooter: ({ compressionOutput, exportState }) => {\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <BlobDownloadUrlHolder blob={compressionOutput}>\n            {blobDownloadUrl => (\n              <RaisedButton\n                primary\n                onClick={() => openBlobDownloadUrl(blobDownloadUrl, 'game.zip')}\n                label={<Trans>Download the exported game</Trans>}\n              />\n            )}\n          </BlobDownloadUrlHolder>\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport RaisedButton from '../../UI/RaisedButton';\nimport {\n  BlobDownloadUrlHolder,\n  openBlobDownloadUrl,\n} from '../../Utils/BlobDownloadUrlHolder';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n  ExportFlow,\n} from '../GenericExporters/CordovaExport';\n\nconst gd: libGDevelop = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-cordova';\n\nexport const browserCordovaExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n  packageNameWarningType: 'mobile',\n\n  getInitialExportState: () => null,\n\n  canLaunchBuild: () => true,\n\n  isNavigationDisabled: () => false,\n\n  renderHeader: () => <ExplanationHeader />,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('cordova').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    exportOptions.setTarget('cordova');\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  renderDoneFooter: ({ compressionOutput, exportState }) => {\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <BlobDownloadUrlHolder blob={compressionOutput}>\n            {blobDownloadUrl => (\n              <RaisedButton\n                primary\n                onClick={() => openBlobDownloadUrl(blobDownloadUrl, 'game.zip')}\n                label={<Trans>Download the exported game</Trans>}\n              />\n            )}\n          </BlobDownloadUrlHolder>\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport RaisedButton from '../../UI/RaisedButton';\nimport {\n  BlobDownloadUrlHolder,\n  openBlobDownloadUrl,\n} from '../../Utils/BlobDownloadUrlHolder';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n  ExportFlow,\n} from '../GenericExporters/ElectronExport';\n\nconst gd: libGDevelop = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-electron';\n\nexport const browserElectronExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n  packageNameWarningType: 'desktop',\n\n  getInitialExportState: () => null,\n\n  canLaunchBuild: () => true,\n\n  isNavigationDisabled: () => false,\n\n  renderHeader: () => <ExplanationHeader />,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('electron').then(({ gdjsRoot, filesContent }) => {\n      console.info('GDJS found in ', gdjsRoot);\n\n      const outputDir = '/export/';\n      const abstractFileSystem = new BrowserFileSystem({\n        textFiles: filesContent,\n      });\n      // TODO: Memory leak? Check for other exporters too.\n      const fileSystem = assignIn(\n        new gd.AbstractFileSystemJS(),\n        abstractFileSystem\n      );\n      const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n      return {\n        exporter,\n        outputDir,\n        abstractFileSystem,\n      };\n    });\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    exportOptions.setTarget('electron');\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  renderDoneFooter: ({ compressionOutput, exportState }) => {\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <BlobDownloadUrlHolder blob={compressionOutput}>\n            {blobDownloadUrl => (\n              <RaisedButton\n                primary\n                onClick={() => openBlobDownloadUrl(blobDownloadUrl, 'game.zip')}\n                label={<Trans>Download the exported game</Trans>}\n              />\n            )}\n          </BlobDownloadUrlHolder>\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport * as React from 'react';\nimport { Trans } from '@lingui/macro';\nimport assignIn from 'lodash/assignIn';\nimport { findGDJS } from '../../GameEngineFinder/BrowserS3GDJSFinder';\nimport BrowserFileSystem from './BrowserFileSystem';\nimport {\n  type UrlFileDescriptor,\n  type TextFileDescriptor,\n  type BlobFileDescriptor,\n  downloadUrlFilesToBlobFiles,\n  archiveFiles,\n} from '../../Utils/BrowserArchiver';\nimport {\n  type ExportFlowProps,\n  type ExportPipeline,\n  type ExportPipelineContext,\n} from '../ExportPipeline.flow';\nimport RaisedButton from '../../UI/RaisedButton';\nimport {\n  BlobDownloadUrlHolder,\n  openBlobDownloadUrl,\n} from '../../Utils/BlobDownloadUrlHolder';\nimport {\n  ExplanationHeader,\n  DoneFooter,\n  ExportFlow,\n} from '../GenericExporters/FacebookInstantGamesExport';\n\nconst gd: libGDevelop = global.gd;\n\ntype ExportState = null;\n\ntype PreparedExporter = {|\n  exporter: gdjsExporter,\n  abstractFileSystem: BrowserFileSystem,\n  outputDir: string,\n|};\n\ntype ExportOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  urlFiles: Array<UrlFileDescriptor>,\n|};\n\ntype ResourcesDownloadOutput = {|\n  textFiles: Array<TextFileDescriptor>,\n  blobFiles: Array<BlobFileDescriptor>,\n|};\n\ntype CompressionOutput = Blob;\n\nconst exportPipelineName = 'browser-facebook-instant-games';\n\nexport const browserFacebookInstantGamesExportPipeline: ExportPipeline<\n  ExportState,\n  PreparedExporter,\n  ExportOutput,\n  ResourcesDownloadOutput,\n  CompressionOutput\n> = {\n  name: exportPipelineName,\n\n  getInitialExportState: () => null,\n\n  canLaunchBuild: () => true,\n\n  isNavigationDisabled: () => false,\n\n  renderHeader: () => <ExplanationHeader />,\n\n  renderExportFlow: (props: ExportFlowProps) => (\n    <ExportFlow {...props} exportPipelineName={exportPipelineName} />\n  ),\n\n  prepareExporter: (\n    context: ExportPipelineContext<ExportState>\n  ): Promise<PreparedExporter> => {\n    return findGDJS('facebook-instant-games').then(\n      ({ gdjsRoot, filesContent }) => {\n        console.info('GDJS found in ', gdjsRoot);\n\n        const outputDir = '/export/';\n        const abstractFileSystem = new BrowserFileSystem({\n          textFiles: filesContent,\n        });\n        // TODO: Memory leak? Check for other exporters too.\n        const fileSystem = assignIn(\n          new gd.AbstractFileSystemJS(),\n          abstractFileSystem\n        );\n        const exporter = new gd.Exporter(fileSystem, gdjsRoot);\n\n        return {\n          exporter,\n          outputDir,\n          abstractFileSystem,\n        };\n      }\n    );\n  },\n\n  launchExport: (\n    context: ExportPipelineContext<ExportState>,\n    { exporter, outputDir, abstractFileSystem }: PreparedExporter,\n    fallbackAuthor: ?{ id: string, username: string }\n  ): Promise<ExportOutput> => {\n    const { project } = context;\n    const exportOptions = new gd.ExportOptions(project, outputDir);\n    exportOptions.setTarget('facebookInstantGames');\n    if (fallbackAuthor) {\n      exportOptions.setFallbackAuthor(\n        fallbackAuthor.id,\n        fallbackAuthor.username\n      );\n    }\n    exporter.exportWholePixiProject(exportOptions);\n    exportOptions.delete();\n    exporter.delete();\n\n    return Promise.resolve({\n      textFiles: abstractFileSystem.getAllTextFilesIn(outputDir),\n      urlFiles: abstractFileSystem.getAllUrlFilesIn(outputDir),\n    });\n  },\n\n  launchResourcesDownload: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, urlFiles }: ExportOutput\n  ): Promise<ResourcesDownloadOutput> => {\n    return downloadUrlFilesToBlobFiles({\n      urlFiles,\n      onProgress: context.updateStepProgress,\n    }).then(blobFiles => ({\n      blobFiles,\n      textFiles,\n    }));\n  },\n\n  launchCompression: (\n    context: ExportPipelineContext<ExportState>,\n    { textFiles, blobFiles }: ResourcesDownloadOutput\n  ): Promise<Blob> => {\n    return archiveFiles({\n      blobFiles,\n      textFiles,\n      basePath: '/export/',\n      onProgress: context.updateStepProgress,\n    });\n  },\n\n  renderDoneFooter: ({ compressionOutput, exportState }) => {\n    return (\n      <DoneFooter\n        renderGameButton={() => (\n          <BlobDownloadUrlHolder blob={compressionOutput}>\n            {blobDownloadUrl => (\n              <RaisedButton\n                primary\n                onClick={() =>\n                  openBlobDownloadUrl(blobDownloadUrl, 'fb-instant-game.zip')\n                }\n                label={<Trans>Download the Instant Game archive</Trans>}\n              />\n            )}\n          </BlobDownloadUrlHolder>\n        )}\n      />\n    );\n  },\n};\n","// @flow\nimport { type Exporter } from '../ShareDialog';\nimport { browserOnlineCordovaExportPipeline } from './BrowserOnlineCordovaExport';\nimport { browserOnlineCordovaIosExportPipeline } from './BrowserOnlineCordovaIosExport';\nimport { browserOnlineElectronExportPipeline } from './BrowserOnlineElectronExport';\nimport { browserOnlineWebExportPipeline } from './BrowserOnlineWebExport';\nimport { browserHTML5ExportPipeline } from './BrowserHTML5Export';\nimport { browserCordovaExportPipeline } from './BrowserCordovaExport';\nimport { browserElectronExportPipeline } from './BrowserElectronExport';\nimport { browserFacebookInstantGamesExportPipeline } from './BrowserFacebookInstantGamesExport';\nimport { cordovaExporter } from '../GenericExporters/CordovaExport';\nimport { onlineWebExporter } from '../GenericExporters/OnlineWebExport';\nimport { html5Exporter } from '../GenericExporters/HTML5Export';\nimport { facebookInstantGamesExporter } from '../GenericExporters/FacebookInstantGamesExport';\nimport { onlineCordovaExporter } from '../GenericExporters/OnlineCordovaExport';\nimport { onlineCordovaIosExporter } from '../GenericExporters/OnlineCordovaIosExport';\nimport { onlineElectronExporter } from '../GenericExporters/OnlineElectronExport';\nimport { electronExporter } from '../GenericExporters/ElectronExport';\n\nexport const browserOnlineWebExporter: Exporter = {\n  ...onlineWebExporter,\n  exportPipeline: browserOnlineWebExportPipeline,\n};\n\nexport const browserAutomatedExporters: Array<Exporter> = [\n  {\n    ...html5Exporter,\n    exportPipeline: browserHTML5ExportPipeline,\n  },\n  {\n    ...onlineCordovaExporter,\n    exportPipeline: browserOnlineCordovaExportPipeline,\n  },\n  {\n    ...onlineCordovaIosExporter,\n    exportPipeline: browserOnlineCordovaIosExportPipeline,\n  },\n  {\n    ...onlineElectronExporter,\n    exportPipeline: browserOnlineElectronExportPipeline,\n  },\n  {\n    ...facebookInstantGamesExporter,\n    exportPipeline: browserFacebookInstantGamesExportPipeline,\n  },\n];\n\nexport const browserManualExporters: Array<Exporter> = [\n  {\n    ...html5Exporter,\n    exportPipeline: browserHTML5ExportPipeline,\n  },\n  {\n    ...cordovaExporter,\n    exportPipeline: browserCordovaExportPipeline,\n  },\n  {\n    ...electronExporter,\n    exportPipeline: browserElectronExportPipeline,\n  },\n];\n","// @flow\nimport {\n  type JsExtensionsLoader,\n  type ExtensionLoadingResult,\n  type TranslationFunction,\n  loadExtension,\n} from '.';\nimport ObjectsEditorService from '../ObjectEditor/ObjectsEditorService';\nimport ObjectsRenderingService from '../ObjectsRendering/ObjectsRenderingService';\nconst gd: libGDevelop = global.gd;\n\n// The list of \"JsExtension.js\" files to be bundled in the webapp, keyed by their extension name.\nconst jsExtensions = [\n  {\n    name: 'AdMob',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/AdMob/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'AdvancedWindow',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/AdvancedWindow/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'FacebookInstantGames',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/FacebookInstantGames/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'DeviceSensors',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/DeviceSensors/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'DeviceVibration',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/DeviceVibration/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'SaveState',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/SaveState/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'DebuggerTools',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/DebuggerTools/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Physics2',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Physics2Behavior/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Physics3D',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Physics3DBehavior/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'ExampleJsExtension',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/ExampleJsExtension/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Tween',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/TweenBehavior/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Video',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Video/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'FileSystem',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/FileSystem/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Firebase',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Firebase/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Leaderboards',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Leaderboards/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'PlayerAuthentication',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/PlayerAuthentication/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Multiplayer',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Multiplayer/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'DialogueTree',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/DialogueTree/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'BBText',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/BBText/JsExtension.js'),\n    objectsRenderingServiceModules: {\n      // $FlowExpectedError - this path is ignored for Flow.\n      'pixi-multistyle-text/dist/pixi-multistyle-text.umd': require('GDJS-for-web-app-only/Runtime/Extensions/BBText/pixi-multistyle-text/dist/pixi-multistyle-text.umd'),\n    },\n  },\n  {\n    name: 'TileMap',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/TileMap/JsExtension.js'),\n    objectsRenderingServiceModules: {\n      // $FlowExpectedError - this path is ignored for Flow.\n      'pixi-tilemap/dist/pixi-tilemap.umd': require('GDJS-for-web-app-only/Runtime/Extensions/TileMap/pixi-tilemap/dist/pixi-tilemap.umd'),\n      // $FlowExpectedError - this path is ignored for Flow.\n      'helper/TileMapHelper': require('GDJS-for-web-app-only/Runtime/Extensions/TileMap/helper/TileMapHelper.js'),\n      // $FlowExpectedError - this path is ignored for Flow.\n      'pako/dist/pako.min': require('GDJS-for-web-app-only/Runtime/Extensions/TileMap/pako/dist/pako.min'),\n    },\n  },\n  {\n    name: 'Effects',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Effects/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'P2P',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/P2P/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Lighting',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Lighting/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'SpatialSound',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/SpatialSound/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'BitmapText',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/BitmapText/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Screenshot',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Screenshot/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'TextInput',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/TextInput/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'Scene3D',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/3D/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n  {\n    name: 'SpineObject',\n    // $FlowExpectedError - this path is ignored for Flow.\n    extensionModule: require('GDJS-for-web-app-only/Runtime/Extensions/Spine/JsExtension.js'),\n    objectsRenderingServiceModules: {},\n  },\n];\n\nconst getExpectedNumberOfJSExtensionModules = ({\n  filterExamples,\n}: {|\n  filterExamples: boolean,\n|}): number => {\n  return jsExtensions.filter(\n    ({ name }) => !filterExamples || !name.includes('Example')\n  ).length;\n};\n\ntype MakeExtensionsLoaderArguments = {|\n  objectsEditorService: typeof ObjectsEditorService,\n  objectsRenderingService: typeof ObjectsRenderingService,\n  filterExamples: boolean,\n|};\n\n/**\n * Loader that load all JS extensions required in this file.\n * Extensions are usually auto-discovered when declared in Extensions/xxx/JsExtension.js, but not\n * for the web-app where everything must be bundled.\n */\nexport default function makeExtensionsLoader({\n  objectsEditorService,\n  objectsRenderingService,\n  filterExamples,\n}: MakeExtensionsLoaderArguments): JsExtensionsLoader {\n  return {\n    loadAllExtensions(\n      _: TranslationFunction\n    ): Promise<{|\n      results: Array<{|\n        extensionModulePath: string,\n        result: ExtensionLoadingResult,\n      |}>,\n      expectedNumberOfJSExtensionModulesLoaded: number,\n    |}> {\n      const results = jsExtensions\n        .filter(({ name }) => !filterExamples || !name.includes('Example'))\n        .map(({ name, extensionModule, objectsRenderingServiceModules }) => {\n          if (\n            objectsEditorService &&\n            extensionModule.registerEditorConfigurations\n          ) {\n            extensionModule.registerEditorConfigurations(objectsEditorService);\n          }\n\n          if (objectsRenderingService) {\n            if (objectsRenderingServiceModules) {\n              for (const requirePath in objectsRenderingServiceModules) {\n                objectsRenderingService.registerModule(\n                  requirePath,\n                  objectsRenderingServiceModules[requirePath]\n                );\n              }\n            }\n            if (extensionModule.registerInstanceRenderers) {\n              extensionModule.registerInstanceRenderers(\n                objectsRenderingService\n              );\n            }\n            if (extensionModule.registerClearCache) {\n              extensionModule.registerClearCache(objectsRenderingService);\n            }\n          }\n\n          return {\n            extensionModulePath: 'internal-extension://' + name,\n            result: loadExtension(_, gd, gd.JsPlatform.get(), extensionModule),\n          };\n        });\n      const expectedNumberOfJSExtensionModulesLoaded = getExpectedNumberOfJSExtensionModules(\n        {\n          filterExamples,\n        }\n      );\n\n      return Promise.resolve({\n        results,\n        expectedNumberOfJSExtensionModulesLoaded,\n      });\n    },\n  };\n}\n","// @flow\nimport {\n  type EventsFunctionCodeWriter,\n  type EventsFunctionCodeWriterCallbacks,\n} from '..';\nimport {\n  putFile,\n  getBrowserSWPreviewBaseUrl,\n  getBrowserSWPreviewRootUrl,\n} from '../../ExportAndShare/BrowserExporters/BrowserSWPreviewLauncher/BrowserSWPreviewIndexedDB';\nimport slugs from 'slugs';\nimport debounce from 'lodash/debounce';\n\nlet batchedWrites: Array<{\n  path: string,\n  content: string,\n  onSuccess: () => void,\n  onError: (error: Error) => void,\n}> = [];\n\nconst flushBatchedWrites = debounce(async () => {\n  const writes = [...batchedWrites];\n  console.info(\n    `[BrowserSWEventsFunctionCodeWriter] Storing a batch of ${\n      writes.length\n    } extension generated files in IndexedDB...`\n  );\n\n  batchedWrites = [];\n\n  // Write all files to IndexedDB in parallel\n  const results = await Promise.allSettled(\n    writes.map(async write => {\n      const encoder = new TextEncoder();\n      const bytes = encoder.encode(write.content).buffer;\n      await putFile(write.path, bytes, 'text/javascript; charset=utf-8');\n      return write;\n    })\n  );\n\n  // Process results and call callbacks\n  results.forEach((result, index) => {\n    const write = writes[index];\n    if (result.status === 'fulfilled') {\n      write.onSuccess();\n    } else {\n      console.error(\n        `[BrowserSWEventsFunctionCodeWriter] Failed to store: ${write.path}`,\n        result.reason\n      );\n      write.onError(result.reason);\n    }\n  });\n}, 10); // Wait for up to 10ms, to avoid adding more latency to extension generation.\n\n/**\n * Write a file by batching it with other files that are being written.\n *\n * Extension generated files are written in batches to avoid making a *lot* of IndexedDB transactions\n * (games can have from dozens to **hundreds** of extensions and generated files).\n */\nconst writeFileInNextBatch = (path: string, content: string) => {\n  return new Promise((resolve, reject) => {\n    batchedWrites.push({\n      path,\n      content,\n      onSuccess: resolve,\n      onError: reject,\n    });\n    flushBatchedWrites();\n  });\n};\n\n/**\n * Create the EventsFunctionCodeWriter that writes generated code for events functions\n * to IndexedDB for service worker serving.\n */\nexport const makeBrowserSWEventsFunctionCodeWriter = ({\n  onWriteFile,\n}: EventsFunctionCodeWriterCallbacks): EventsFunctionCodeWriter => {\n  const rootUrl = getBrowserSWPreviewRootUrl();\n\n  const getPathFor = (codeNamespace: string) => {\n    // Note: don't call getBrowserSWPreviewBaseUrl because it might not be available yet.\n    const baseUrl = getBrowserSWPreviewBaseUrl();\n    const extensionsCodeUrl = baseUrl + '/extensions-code';\n    return `${extensionsCodeUrl}/${slugs(codeNamespace)}.js`;\n  };\n\n  return {\n    getIncludeFileFor: (codeNamespace: string) => getPathFor(codeNamespace),\n\n    writeFunctionCode: (\n      functionCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      const path = getPathFor(functionCodeNamespace);\n      onWriteFile({ includeFile: path, content: code });\n      const relativePath = path.replace(rootUrl, '');\n\n      return writeFileInNextBatch(relativePath, code);\n    },\n\n    writeBehaviorCode: (\n      behaviorCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      const path = getPathFor(behaviorCodeNamespace);\n      onWriteFile({ includeFile: path, content: code });\n      const relativePath = path.replace(rootUrl, '');\n\n      return writeFileInNextBatch(relativePath, code);\n    },\n\n    writeObjectCode: (\n      objectCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      const path = getPathFor(objectCodeNamespace);\n      onWriteFile({ includeFile: path, content: code });\n      const relativePath = path.replace(rootUrl, '');\n\n      return writeFileInNextBatch(relativePath, code);\n    },\n  };\n};\n","// @flow\nimport {\n  type EventsFunctionCodeWriter,\n  type EventsFunctionCodeWriterCallbacks,\n} from '..';\nimport {\n  uploadObjects,\n  getBaseUrl,\n  type UploadedObject,\n} from '../../Utils/GDevelopServices/Preview';\nimport { makeTimestampedId } from '../../Utils/TimestampedId';\nimport slugs from 'slugs';\nimport debounce from 'lodash/debounce';\n\nlet batchedUploads: Array<{\n  uploadedObject: UploadedObject,\n  onSuccess: () => void,\n  onError: (error: Error) => void,\n}> = [];\n\nconst flushBatchedUploads = debounce(async () => {\n  const uploads = [...batchedUploads];\n  console.info(\n    `Uploading a batch of ${uploads.length} extension generated files...`,\n    uploads\n  );\n\n  batchedUploads = [];\n\n  try {\n    await uploadObjects(uploads.map(upload => upload.uploadedObject));\n  } catch (error) {\n    uploads.forEach(upload => upload.onError(error));\n\n    return;\n  }\n\n  uploads.forEach(upload => upload.onSuccess());\n}, 10); // Wait for up to 10ms, to avoid adding more latency to extension generation.\n\n/**\n * Upload a file by batching it with other files that are being uploaded.\n *\n * Extension generated files are uploaded in batches to avoid making a *lot* of requests\n * (games can have from dozens to **hundreds** of extensions and generated files).\n */\nconst uploadObjectInNextBatch = (uploadedObject: UploadedObject) => {\n  return new Promise((resolve, reject) => {\n    batchedUploads.push({\n      uploadedObject,\n      onSuccess: resolve,\n      onError: reject,\n    });\n    flushBatchedUploads();\n  });\n};\n\n/**\n * Create the EventsFunctionCodeWriter that writes generated code for events functions\n * to temporary S3 files.\n */\nexport const makeBrowserS3EventsFunctionCodeWriter = ({\n  onWriteFile,\n}: EventsFunctionCodeWriterCallbacks): EventsFunctionCodeWriter => {\n  const prefix = makeTimestampedId();\n  const getPathFor = (codeNamespace: string) => {\n    return `${prefix}/${slugs(codeNamespace)}.js`;\n  };\n\n  return {\n    getIncludeFileFor: (codeNamespace: string) =>\n      getBaseUrl() + getPathFor(codeNamespace),\n    writeFunctionCode: (\n      functionCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      const key = getPathFor(functionCodeNamespace);\n      onWriteFile({ includeFile: key, content: code });\n      console.log(`Uploading function generated code to ${key}...`);\n      return uploadObjectInNextBatch({\n        Key: getPathFor(functionCodeNamespace),\n        Body: code,\n        ContentType: 'text/javascript',\n      });\n    },\n    writeBehaviorCode: (\n      behaviorCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      const key = getPathFor(behaviorCodeNamespace);\n      onWriteFile({ includeFile: key, content: code });\n      console.log(`Uploading behavior generated code to ${key}...`);\n      return uploadObjectInNextBatch({\n        Key: getPathFor(behaviorCodeNamespace),\n        Body: code,\n        ContentType: 'text/javascript',\n      });\n    },\n    writeObjectCode: (\n      objectCodeNamespace: string,\n      code: string\n    ): Promise<void> => {\n      const key = getPathFor(objectCodeNamespace);\n      onWriteFile({ includeFile: key, content: code });\n      console.log(`Uploading object generated code to ${key}...`);\n      return uploadObjectInNextBatch({\n        Key: getPathFor(objectCodeNamespace),\n        Body: code,\n        ContentType: 'text/javascript',\n      });\n    },\n  };\n};\n","// @flow\nimport { Trans } from '@lingui/macro';\nimport * as React from 'react';\nimport Dialog from '../../UI/Dialog';\nimport FlatButton from '../../UI/FlatButton';\nimport RaisedButton from '../../UI/RaisedButton';\nimport { Line } from '../../UI/Grid';\nimport { ColumnStackLayout } from '../../UI/Layout';\nimport Window from '../../Utils/Window';\nimport {\n  BlobDownloadUrlHolder,\n  openBlobDownloadUrl,\n} from '../../Utils/BlobDownloadUrlHolder';\nimport PlaceholderLoader from '../../UI/PlaceholderLoader';\nimport { serializeToJSObject } from '../../Utils/Serializer';\nimport { showErrorBox } from '../../UI/Messages/MessageBox';\nimport Text from '../../UI/Text';\nimport {\n  downloadUrlsToBlobs,\n  type ItemResult,\n} from '../../Utils/BlobDownloader';\nimport { useGenericRetryableProcessWithProgress } from '../../Utils/UseGenericRetryableProcessWithProgress';\nimport { checkIfIsGDevelopCloudBucketUrl } from '../../Utils/CrossOrigin';\nimport { extractDecodedFilenameFromProjectResourceUrl } from '../../Utils/GDevelopServices/Project';\nimport {\n  archiveFiles,\n  type BlobFileDescriptor,\n  type TextFileDescriptor,\n} from '../../Utils/BrowserArchiver';\nimport path from 'path-browserify';\nimport newNameGenerator from '../../Utils/NewNameGenerator';\nconst gd: libGDevelop = global.gd;\n\nconst PROJECT_JSON_FILENAME = 'game.json';\n\n// For some reason, `path.posix` is undefined when packaged\n// with webpack, so we're using `path` directly. As it's for the web-app,\n// it should always be the posix version. In tests on Windows,\n// it's necessary to use path.posix.\n// Search for \"pathPosix\" in the codebase for other places where this is used.\nconst pathPosix = path.posix || path;\n\nconst isURL = (filename: string) => {\n  return (\n    filename.startsWith('http://') ||\n    filename.startsWith('https://') ||\n    filename.startsWith('ftp://') ||\n    filename.startsWith('blob:') ||\n    filename.startsWith('data:')\n  );\n};\n\ntype DownloadResourcesAsBlobsOptionsWithoutProgress = {\n  project: gdProject,\n  onAddBlobFile: (blobFileDescriptor: BlobFileDescriptor) => void,\n};\n\ntype DownloadResourcesAsBlobsOptions = {\n  ...DownloadResourcesAsBlobsOptionsWithoutProgress,\n  onProgress: (count: number, total: number) => void,\n};\n\nexport const downloadResourcesAsBlobs = async ({\n  project,\n  onAddBlobFile,\n  onProgress,\n}: DownloadResourcesAsBlobsOptions) => {\n  const result = {\n    erroredResources: [],\n  };\n\n  type ResourceToFetch = {|\n    resource: gdResource,\n    url: string,\n    filename: string,\n  |};\n\n  const getResourcesToFetch = (project: gdProject): Array<ResourceToFetch> => {\n    const resourcesManager = project.getResourcesManager();\n    const allResourceNames = resourcesManager.getAllResourceNames().toJSArray();\n    return allResourceNames\n      .map(\n        (resourceName: string): ?ResourceToFetch => {\n          const resource = resourcesManager.getResource(resourceName);\n          const resourceFile = resource.getFile();\n\n          if (isURL(resourceFile)) {\n            if (checkIfIsGDevelopCloudBucketUrl(resourceFile)) {\n              return {\n                resource,\n                url: resourceFile,\n                filename: extractDecodedFilenameFromProjectResourceUrl(\n                  resourceFile\n                ),\n              };\n            } else {\n              // Public URL resource: nothing to do.\n              return null;\n            }\n          } else {\n            // Local resource: unsupported.\n            result.erroredResources.push({\n              resourceName: resource.getName(),\n              error: new Error(\n                'Unsupported relative file when downloading a copy.'\n              ),\n            });\n            return null;\n          }\n        }\n      )\n      .filter(Boolean);\n  };\n\n  const resourcesToFetchAndUpload = getResourcesToFetch(project);\n\n  // Download all the project resources as blob (much like what is done during an export).\n  const downloadedBlobsAndResources: Array<\n    ItemResult<ResourceToFetch>\n  > = await downloadUrlsToBlobs({\n    urlContainers: resourcesToFetchAndUpload,\n    onProgress: (count, total) => {\n      onProgress(count, total * 2);\n    },\n  });\n\n  const alreadyUsedFilenames = new Set([PROJECT_JSON_FILENAME]);\n\n  downloadedBlobsAndResources.forEach(({ item, error, blob }) => {\n    const { resource, filename } = item;\n    if (error || !blob) {\n      result.erroredResources.push({\n        resourceName: resource.getName(),\n        error: error || new Error('Unknown error during download.'),\n      });\n      return;\n    }\n\n    // Ensure each filename is unique, and sort resources in folder by types.\n    const extension = pathPosix.extname(filename);\n    const basename = pathPosix.basename(filename, extension);\n    const pathPrefix = 'assets/' + resource.getKind();\n    const newBasename = newNameGenerator(basename, tentativeBasename =>\n      alreadyUsedFilenames.has(\n        pathPosix.join(pathPrefix, tentativeBasename + extension)\n      )\n    );\n    const newResourcePath = pathPosix.join(pathPrefix, newBasename + extension);\n    alreadyUsedFilenames.add(newResourcePath);\n\n    resource.setFile(newResourcePath);\n    onAddBlobFile({ blob, filePath: newResourcePath });\n  });\n\n  return result;\n};\n\ntype Props = {|\n  project: gdProject,\n  onDone: () => void,\n|};\n\nexport default function DownloadFileSaveAsDialog({ project, onDone }: Props) {\n  const [zippedProjectBlob, setZippedProjectBlob] = React.useState<?Blob>(null);\n  const {\n    ensureProcessIsDone,\n    renderProcessDialog,\n  } = useGenericRetryableProcessWithProgress<DownloadResourcesAsBlobsOptionsWithoutProgress>(\n    {\n      onDoProcess: React.useCallback(\n        (options, onProgress) =>\n          downloadResourcesAsBlobs({ ...options, onProgress }),\n        []\n      ),\n    }\n  );\n  React.useEffect(\n    () => {\n      (async () => {\n        setZippedProjectBlob(null);\n        const newProject = gd.ProjectHelper.createNewGDJSProject();\n        try {\n          // Make a copy of the project, as it will be updated.\n          const serializedProject = new gd.SerializerElement();\n          project.serializeTo(serializedProject);\n          newProject.unserializeFrom(serializedProject);\n          serializedProject.delete();\n\n          // Download resources to blobs, and update the project resources.\n          const blobFiles: Array<BlobFileDescriptor> = [];\n          const textFiles: Array<TextFileDescriptor> = [];\n          await ensureProcessIsDone({\n            project: newProject,\n            onAddBlobFile: (blobFileDescriptor: BlobFileDescriptor) => {\n              blobFiles.push(blobFileDescriptor);\n            },\n          });\n\n          // Serialize the project.\n          textFiles.push({\n            text: JSON.stringify(serializeToJSObject(newProject)),\n            filePath: PROJECT_JSON_FILENAME,\n          });\n\n          // Archive the whole project.\n          const zippedProjectBlob = await archiveFiles({\n            textFiles,\n            blobFiles,\n            basePath: '/',\n            onProgress: (count: number, total: number) => {},\n          });\n          setZippedProjectBlob(zippedProjectBlob);\n        } catch (rawError) {\n          showErrorBox({\n            message:\n              'Unable to save your project because of an internal error.',\n            rawError,\n            errorId: 'download-file-save-as-dialog-error',\n          });\n          return;\n        } finally {\n          newProject.delete();\n        }\n      })();\n      return () => setZippedProjectBlob(null);\n    },\n    [project, ensureProcessIsDone]\n  );\n\n  return (\n    <Dialog\n      title={<Trans>Download a copy</Trans>}\n      actions={[\n        <FlatButton\n          key=\"download\"\n          label={<Trans>Download GDevelop desktop version</Trans>}\n          primary={false}\n          onClick={() => Window.openExternalURL('http://gdevelop.io')}\n        />,\n        <FlatButton\n          key=\"close\"\n          label={<Trans>Close</Trans>}\n          primary={false}\n          onClick={onDone}\n        />,\n      ]}\n      onRequestClose={onDone}\n      open\n      maxWidth=\"sm\"\n    >\n      <ColumnStackLayout noMargin>\n        <Text>\n          <Trans>\n            You can download the file of your game to continue working on it\n            using the full GDevelop version:\n          </Trans>\n        </Text>\n        <Line noMargin expand justifyContent=\"center\">\n          {zippedProjectBlob ? (\n            <BlobDownloadUrlHolder blob={zippedProjectBlob}>\n              {blobDownloadUrl => (\n                <RaisedButton\n                  primary\n                  onClick={() =>\n                    openBlobDownloadUrl(blobDownloadUrl, 'gdevelop-game.zip')\n                  }\n                  label={\n                    <Trans>Download the compressed game and resources</Trans>\n                  }\n                />\n              )}\n            </BlobDownloadUrlHolder>\n          ) : (\n            <PlaceholderLoader />\n          )}\n        </Line>\n      </ColumnStackLayout>\n      {renderProcessDialog()}\n    </Dialog>\n  );\n}\n","// @flow\nimport { t } from '@lingui/macro';\nimport * as React from 'react';\nimport Download from '../../UI/CustomSvgIcons/Download';\nimport { type StorageProvider, type SaveAsLocation } from '../index';\nimport DownloadFileSaveAsDialog from './DownloadFileSaveAsDialog';\n\n/**\n * \"Storage\" allowing to download a copy of the game.\n * Used for the web-app.\n */\nexport default ({\n  internalName: 'DownloadFile',\n  name: t`Download a copy`,\n  renderIcon: props => <Download fontSize={props.size} />,\n  hiddenInOpenDialog: true,\n  createOperations: ({ setDialog, closeDialog }) => ({\n    onSaveProjectAs: async (\n      project: gdProject,\n      saveAsLocation: ?SaveAsLocation, // Unused - everything is done in memory.\n      options\n    ) => {\n      options.onStartSaving();\n\n      return new Promise(resolve => {\n        setDialog(() => (\n          <DownloadFileSaveAsDialog\n            onDone={() => {\n              closeDialog();\n              resolve({ wasSaved: false, fileMetadata: null });\n            }}\n            project={project}\n          />\n        ));\n      });\n    },\n  }),\n}: StorageProvider);\n","// @flow\nimport {\n  type ResourceMover,\n  type MoveAllProjectResourcesOptions,\n  type MoveAllProjectResourcesResult,\n  type MoveAllProjectResourcesFunction,\n} from './index';\nimport CloudStorageProvider from '../CloudStorageProvider';\nimport UrlStorageProvider from '../UrlStorageProvider';\nimport DownloadFileStorageProvider from '../DownloadFileStorageProvider';\nimport { moveUrlResourcesToCloudProject } from '../CloudStorageProvider/CloudResourceMover';\n\nconst moveNothing = async () => {\n  return {\n    erroredResources: [],\n  };\n};\n\nconst movers: {\n  [string]: MoveAllProjectResourcesFunction,\n} = {\n  // Moving to GDevelop \"Cloud\" storage:\n\n  // From a Cloud project to another, resources need to be copied\n  // (unless they are public URLs).\n  [`${CloudStorageProvider.internalName}=>${\n    CloudStorageProvider.internalName\n  }`]: moveUrlResourcesToCloudProject,\n  // On the web-app, most resources are public URLs, so nothing to do.\n  // But if some resources are coming from a private game template,\n  // they need to be copied.\n  [`${UrlStorageProvider.internalName}=>${\n    CloudStorageProvider.internalName\n  }`]: moveUrlResourcesToCloudProject,\n\n  // Moving to \"DownloadFile\":\n\n  // Saving to \"DownloadFile\" will *not* change any resources, as it's a\n  // \"temporary save\" that is made and given to the user.\n  [`${CloudStorageProvider.internalName}=>${\n    DownloadFileStorageProvider.internalName\n  }`]: moveNothing,\n  [`${UrlStorageProvider.internalName}=>${\n    DownloadFileStorageProvider.internalName\n  }`]: moveNothing,\n};\n\nconst BrowserResourceMover: ResourceMover = {\n  moveAllProjectResources: async (\n    options: MoveAllProjectResourcesOptions\n  ): Promise<MoveAllProjectResourcesResult> => {\n    const { oldStorageProvider, newStorageProvider } = options;\n    const mover =\n      movers[\n        `${oldStorageProvider.internalName}=>${newStorageProvider.internalName}`\n      ];\n    if (!mover)\n      throw new Error(\n        `Can't find a ResourceMover for ${oldStorageProvider.internalName} to ${\n          newStorageProvider.internalName\n        }.`\n      );\n\n    return mover(options);\n  },\n};\n\nexport default BrowserResourceMover;\n","// @flow\nimport {\n  type ResourceFetcher,\n  type FetchAllProjectResourcesOptions,\n  type FetchAllProjectResourcesResult,\n  type FetchAllProjectResourcesFunction,\n} from './index';\nimport CloudStorageProvider from '../CloudStorageProvider';\nimport { moveUrlResourcesToCloudFilesIfPrivate } from '../CloudStorageProvider/CloudResourceFetcher';\nimport UrlStorageProvider from '../UrlStorageProvider';\nimport { fetchRelativeResourcesToFullUrls } from '../UrlStorageProvider/UrlResourceFetcher';\n\nconst fetchers: {\n  [string]: FetchAllProjectResourcesFunction,\n} = {\n  // The Cloud file storage provider fetches the resources that are\n  // private URLs by downloading them and reuploading them to the cloud.\n  [CloudStorageProvider.internalName]: moveUrlResourcesToCloudFilesIfPrivate,\n  // The URL storage consider relative resources to be relative to the project\n  // URL. This allows to open local projects uploaded to GitHub for example.\n  [UrlStorageProvider.internalName]: fetchRelativeResourcesToFullUrls,\n};\n\nconst BrowserResourceFetcher: ResourceFetcher = {\n  fetchAllProjectResources: async (\n    options: FetchAllProjectResourcesOptions\n  ): Promise<FetchAllProjectResourcesResult> => {\n    const { storageProvider } = options;\n    const fetcher = fetchers[storageProvider.internalName];\n    if (!fetcher)\n      throw new Error(\n        `Can't find a ResourceFetcher for ${\n          storageProvider.internalName\n        } - have you registered the storage provider here?`\n      );\n\n    return fetcher(options);\n  },\n};\n\nexport default BrowserResourceFetcher;\n","// @flow\nimport { type SerializedExtension } from '../../Utils/GDevelopServices/Extension';\n\nexport default class BrowserEventsFunctionsExtensionOpener {\n  static chooseEventsFunctionExtensionFile = (): Promise<Array<any>> => {\n    return new Promise(resolve => {\n      if (window.showOpenFilePicker) {\n        window\n          .showOpenFilePicker({\n            types: [\n              {\n                description: 'GDevelop Extension',\n                accept: {\n                  'application/json': ['.json'],\n                },\n              },\n            ],\n            excludeAcceptAllOption: true,\n            multiple: true,\n          })\n          .then(handles => {\n            if (!handles) return resolve([]);\n            resolve(Promise.all(handles.map(handle => handle.getFile())));\n          })\n          .catch(() => {\n            resolve([]);\n          });\n      } else {\n        const adhocInput = document.createElement('input');\n        adhocInput.type = 'file';\n        adhocInput.multiple = true;\n        adhocInput.accept = 'application/json,.json';\n        adhocInput.onchange = e => {\n          return resolve(e.target.files);\n        };\n\n        // There is no built-in way to know if the user closed the file picking dialog\n        // with the cancel button. What follows is an implementation that follows\n        // https://stackoverflow.com/questions/71435515/how-can-i-detect-that-the-cancel-button-has-been-clicked-on-a-input-type-file.\n        // TODO: Find a better way to detect this since it looks like the `change` event\n        // does not have enough time to propagate when the user selects a file from the dialog\n        // by double-clicking it.\n\n        const onFocusBackWindow = () => {\n          window.removeEventListener('focus', onFocusBackWindow);\n          if (document.body) {\n            document.body.addEventListener(\n              'pointermove',\n              onFilePickingDialogFinishedClosing\n            );\n          }\n        };\n\n        const onFilePickingDialogFinishedClosing = () => {\n          if (document.body) {\n            document.body.removeEventListener(\n              'pointermove',\n              onFilePickingDialogFinishedClosing\n            );\n          }\n          if (!adhocInput.files.length) {\n            resolve([]);\n          }\n        };\n\n        window.addEventListener('focus', onFocusBackWindow);\n        adhocInput.click();\n      }\n    });\n  };\n\n  static readEventsFunctionExtensionFile = async (\n    file: any\n  ): Promise<SerializedExtension> => {\n    if (!(file instanceof File)) {\n      console.error('Given file is not a JS File object. Instead it is:', {\n        file,\n      });\n      throw new Error('Given file is not a JS File object.');\n    }\n\n    try {\n      const content = await file.text();\n      return JSON.parse(content);\n    } catch (error) {\n      console.error('An error occurred when parsing the file content: ', {\n        error,\n      });\n      throw error;\n    }\n  };\n}\n","// @flow\n\nconst downloadStringContentAsFile = async (\n  filename: string,\n  content: string\n): Promise<void> => {\n  const blob = new Blob([content], { type: 'application/json' });\n  const blobUrl = URL.createObjectURL(blob);\n\n  const adhocLink = document.createElement('a');\n  adhocLink.href = blobUrl;\n  adhocLink.download = filename;\n  if (document.body) {\n    document.body.appendChild(adhocLink);\n    adhocLink.click();\n    adhocLink.remove();\n  } else {\n    throw new Error(\"Document body couldn't be found.\");\n  }\n  return;\n};\n\nexport default class BrowserEventsFunctionsExtensionWriter {\n  static chooseEventsFunctionExtensionFile = async (\n    extensionName?: string\n  ): Promise<?string> => {\n    return extensionName;\n  };\n\n  static writeSerializedObject = async (\n    serializedObject: Object,\n    filename: string\n  ): Promise<void> => {\n    try {\n      await downloadStringContentAsFile(\n        filename,\n        JSON.stringify(serializedObject, null, 2)\n      );\n    } catch (error) {\n      console.error('Unable to write the events function extension:', error);\n      throw error;\n    }\n  };\n}\n","// @flow\n\nimport {\n  signInWithEmailAndPassword,\n  type Auth,\n  GoogleAuthProvider,\n  GithubAuthProvider,\n  OAuthProvider,\n  signInWithCredential,\n} from 'firebase/auth';\nimport type { LoginProvider, FirebaseBasedLoginProvider } from '.';\nimport type { IdentityProvider } from '../Utils/GDevelopServices/Authentication';\nimport {\n  setupAuthenticationWebSocket,\n  terminateWebSocket,\n} from '../Utils/GDevelopServices/Authorization';\nimport Window from '../Utils/Window';\n\nconst isDev = Window.isDev();\n\nconst authenticationPortalUrl = 'https://auth.gdevelop.io';\n\nclass BrowserLoginProvider\n  implements LoginProvider, FirebaseBasedLoginProvider {\n  auth: Auth;\n  constructor(auth: Auth) {\n    this.auth = auth;\n  }\n\n  async loginWithEmailAndPassword({\n    email,\n    password,\n  }: {|\n    email: string,\n    password: string,\n  |}) {\n    try {\n      await signInWithEmailAndPassword(this.auth, email, password);\n      // The user is now stored in `this.auth`.\n    } catch (error) {\n      console.error('Error while login:', error);\n      throw error;\n    }\n  }\n\n  async loginOrSignupWithProvider({\n    provider,\n    signal,\n  }: {|\n    provider: IdentityProvider,\n    signal?: AbortSignal,\n  |}) {\n    if (signal && signal.aborted) {\n      return Promise.reject(\n        new Error('Login or Signup with provider already aborted.')\n      );\n    }\n    const promise = new Promise((resolve, reject) => {\n      // Listen for abort event on signal\n      if (signal) {\n        signal.addEventListener('abort', () => {\n          terminateWebSocket();\n          reject(new Error('Login or Signup with provider aborted.'));\n        });\n      }\n      const width = 400;\n      const height = 600;\n      const left = window.screenX + window.innerWidth / 2 - width / 2;\n      const top = window.screenY + window.innerHeight / 2 - height / 2;\n\n      const authWindow = window.open(\n        'about:blank',\n        null,\n        `width=${width},height=${height},left=${left},top=${top}`\n      );\n      authWindow.document.write(\n        `<style>body { margin: 0; }</style><div style=\"height: 100vh; display: flex; justify-content: center; align-items: center; color: #F5F5F7; background-color: #25252E; font-family: 'Verdana', 'Fira Sans', 'Open Sans', 'Lucida Sans'; font-size: 20px\">Loading</div>`\n      );\n      setupAuthenticationWebSocket({\n        onConnectionEstablished: connectionId => {\n          if (signal && signal.aborted) return;\n          const url = new URL(authenticationPortalUrl);\n          url.searchParams.set('connection-id', connectionId);\n          url.searchParams.set('provider', provider);\n          url.searchParams.set('env', isDev ? 'dev' : 'live');\n\n          if (!authWindow) throw new Error('Popup could not be found.');\n          authWindow.location = url.toString();\n        },\n        onTokenReceived: async ({\n          provider,\n          data,\n        }: {|\n          provider: 'apple' | 'google' | 'github',\n          data: any,\n        |}) => {\n          if (signal && signal.aborted) return;\n          try {\n            const credential =\n              provider === 'google'\n                ? GoogleAuthProvider.credential(data.credential)\n                : provider === 'github'\n                ? GithubAuthProvider.credential(data.accessToken)\n                : new OAuthProvider('apple.com').credential({\n                    idToken: data.id_token,\n                    // Typescript types declaration indicates the parameter `rawNonce` should be\n                    // set but it only works with `nonce`.\n                    nonce: data.raw_nonce,\n                  });\n            await signInWithCredential(this.auth, credential);\n            if (authWindow) {\n              authWindow.close();\n            }\n            resolve();\n            terminateWebSocket();\n          } catch (error) {\n            console.error(\n              `An error occurred while logging in with ${provider} token:`,\n              error\n            );\n            reject(error);\n          }\n        },\n        onError: error => {\n          if (signal && signal.aborted) return;\n          terminateWebSocket();\n          console.error(\n            'An error occurred while setting up authentication web socket:',\n            error\n          );\n          reject(\n            new Error(\n              'An error occurred while setting up authentication web socket.'\n            )\n          );\n        },\n        onTimeout: () => {\n          if (signal && signal.aborted) return;\n          terminateWebSocket();\n          console.error('Connection to authorization websocket timed out.');\n          reject(new Error('Connection to authorization websocket timed out.'));\n        },\n      });\n    });\n    return promise;\n  }\n}\n\nexport default BrowserLoginProvider;\n","// @flow\nimport * as React from 'react';\nimport MainFrame from './MainFrame';\nimport Window from './Utils/Window';\nimport ShareDialog from './ExportAndShare/ShareDialog';\nimport Authentication from './Utils/GDevelopServices/Authentication';\nimport './UI/icomoon-font.css'; // Styles for Icomoon font.\n\n// Import for browser only IDE\nimport browserResourceSources from './ResourcesList/BrowserResourceSources';\nimport browserResourceExternalEditors from './ResourcesList/BrowserResourceExternalEditors';\nimport BrowserSWPreviewLauncher from './ExportAndShare/BrowserExporters/BrowserSWPreviewLauncher';\nimport BrowserS3PreviewLauncher from './ExportAndShare/BrowserExporters/BrowserS3PreviewLauncher';\nimport {\n  browserAutomatedExporters,\n  browserManualExporters,\n  browserOnlineWebExporter,\n} from './ExportAndShare/BrowserExporters';\nimport makeExtensionsLoader from './JsExtensionsLoader/BrowserJsExtensionsLoader';\nimport ObjectsEditorService from './ObjectEditor/ObjectsEditorService';\nimport ObjectsRenderingService from './ObjectsRendering/ObjectsRenderingService';\nimport { makeBrowserSWEventsFunctionCodeWriter } from './EventsFunctionsExtensionsLoader/CodeWriters/BrowserSWEventsFunctionCodeWriter';\nimport { makeBrowserS3EventsFunctionCodeWriter } from './EventsFunctionsExtensionsLoader/CodeWriters/BrowserS3EventsFunctionCodeWriter';\nimport Providers from './MainFrame/Providers';\nimport ProjectStorageProviders from './ProjectsStorage/ProjectStorageProviders';\nimport UrlStorageProvider from './ProjectsStorage/UrlStorageProvider';\nimport DownloadFileStorageProvider from './ProjectsStorage/DownloadFileStorageProvider';\nimport CloudStorageProvider from './ProjectsStorage/CloudStorageProvider';\nimport BrowserResourceMover from './ProjectsStorage/ResourceMover/BrowserResourceMover';\nimport BrowserResourceFetcher from './ProjectsStorage/ResourceFetcher/BrowserResourceFetcher';\nimport BrowserEventsFunctionsExtensionOpener from './EventsFunctionsExtensionsLoader/Storage/BrowserEventsFunctionsExtensionOpener';\nimport BrowserEventsFunctionsExtensionWriter from './EventsFunctionsExtensionsLoader/Storage/BrowserEventsFunctionsExtensionWriter';\nimport BrowserLoginProvider from './LoginProvider/BrowserLoginProvider';\nimport { isServiceWorkerSupported } from './ServiceWorkerSetup';\nimport { ensureBrowserSWPreviewSession } from './ExportAndShare/BrowserExporters/BrowserSWPreviewLauncher/BrowserSWPreviewIndexedDB';\n\nexport const create = (authentication: Authentication) => {\n  Window.setUpContextMenu();\n  const loginProvider = new BrowserLoginProvider(authentication.auth);\n  authentication.setLoginProvider(loginProvider);\n\n  let app = null;\n  const appArguments = Window.getArguments();\n\n  // TODO: make a hook that allows this to change, so we can switch to S3\n  // (and log this into Posthog).\n  const canUseBrowserSW = isServiceWorkerSupported();\n  if (canUseBrowserSW) ensureBrowserSWPreviewSession();\n\n  app = (\n    <Providers\n      authentication={authentication}\n      disableCheckForUpdates={!!appArguments['disable-update-check']}\n      makeEventsFunctionCodeWriter={\n        canUseBrowserSW\n          ? makeBrowserSWEventsFunctionCodeWriter\n          : makeBrowserS3EventsFunctionCodeWriter\n      }\n      eventsFunctionsExtensionWriter={BrowserEventsFunctionsExtensionWriter}\n      eventsFunctionsExtensionOpener={BrowserEventsFunctionsExtensionOpener}\n    >\n      {({ i18n }) => (\n        <ProjectStorageProviders\n          appArguments={appArguments}\n          storageProviders={[\n            UrlStorageProvider,\n            CloudStorageProvider,\n            DownloadFileStorageProvider,\n          ]}\n          defaultStorageProvider={UrlStorageProvider}\n        >\n          {({\n            getStorageProviderOperations,\n            getStorageProviderResourceOperations,\n            storageProviders,\n            initialFileMetadataToOpen,\n            getStorageProvider,\n          }) => (\n            <MainFrame\n              i18n={i18n}\n              renderPreviewLauncher={(props, ref) =>\n                canUseBrowserSW ? (\n                  <BrowserSWPreviewLauncher {...props} ref={ref} />\n                ) : (\n                  <BrowserS3PreviewLauncher {...props} ref={ref} />\n                )\n              }\n              renderShareDialog={props => (\n                <ShareDialog\n                  project={props.project}\n                  onSaveProject={props.onSaveProject}\n                  isSavingProject={props.isSavingProject}\n                  onChangeSubscription={props.onChangeSubscription}\n                  onClose={props.onClose}\n                  automatedExporters={browserAutomatedExporters}\n                  manualExporters={browserManualExporters}\n                  onlineWebExporter={browserOnlineWebExporter}\n                  allExportersRequireOnline\n                  fileMetadata={props.fileMetadata}\n                  storageProvider={props.storageProvider}\n                  initialTab={props.initialTab}\n                  gamesList={props.gamesList}\n                />\n              )}\n              quickPublishOnlineWebExporter={browserOnlineWebExporter}\n              storageProviders={storageProviders}\n              resourceMover={BrowserResourceMover}\n              resourceFetcher={BrowserResourceFetcher}\n              getStorageProviderOperations={getStorageProviderOperations}\n              getStorageProviderResourceOperations={\n                getStorageProviderResourceOperations\n              }\n              getStorageProvider={getStorageProvider}\n              resourceSources={browserResourceSources}\n              resourceExternalEditors={browserResourceExternalEditors}\n              extensionsLoader={makeExtensionsLoader({\n                objectsEditorService: ObjectsEditorService,\n                objectsRenderingService: ObjectsRenderingService,\n                filterExamples: !Window.isDev(),\n              })}\n              initialFileMetadataToOpen={initialFileMetadataToOpen}\n              initialExampleSlugToOpen={\n                appArguments['create-from-example'] || null\n              }\n            />\n          )}\n        </ProjectStorageProviders>\n      )}\n    </Providers>\n  );\n\n  return app;\n};\n"],"names":["ResourceStoreChooser","_ref","options","selectedResourceIndex","onSelectResource","resourceKind","resourcesKindSupportedByResourceStore","includes","_jsx","ResourceStore","UrlChooser","_ref2","onChooseResources","createNewResource","_React$useState","React","_React$useState2","_slicedToArray","inputValue","setInputValue","_React$useState3","_React$useState4","error","setError","_React$useState5","_React$useState6","urlsErroredBooleanArray","setUrlsErroredBooleanArray","hasErroredUrls","filter","Boolean","length","validateInputValue","useDebounce","_ref3","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","urls","responses","wrap","_context2","prev","next","multiSelection","split","Promise","all","map","_ref4","_callee","url","_context","axios","timeout","validateStatus","status","abrupt","sent","stop","_x2","apply","arguments","response","t0","_x","_jsxs","ColumnStackLayout","noMargin","expand","children","Line","TextFieldWithButtonLayout","renderButton","style","RaisedButton","onClick","newResource","setFile","setName","path","setOrigin","primary","label","Trans","id","disabled","renderTextField","SemiControlledTextField","floatingLabelText","value","onChange","multiline","rows","rowsMax","fullWidth","errorText","values","isErrored","index","join","AlertMessage","kind","concat","_toConsumableArray","allResourceKindsAndMetadata","_ref5","sourceName","name","displayName","displayTab","shouldCreateResource","shouldGuessAnimationsFromName","renderComponent","props","FileToCloudProjectResourceUploader","resources","selectedResources","selectedSourceName","fileMetadata","getStorageProvider","automaticallyOpenInput","automaticallyOpenIfPossible","source","find","resourceSource","renderPrimaryAction","_ref6","resource","DialogPrimaryButton","chosenResourceUrl","resourceCleanedName","isPublicAssetResourceUrl","extractDecodedFilenameWithExtensionFromPublicAssetResourceUrl","_ref7","hideInResourceEditor","ProjectResourcesChooser","project","onResourcesSelected","_ref8","_ref9","displayBlackLoadingScreenOrThrow","externalWindow","document","write","nextExternalEditorWindowId","externalEditorIndexHtml","piskel","yarn","jfxr","openAndWaitForExternalEditorWindow","externalEditorWindow","externalEditorName","externalEditorInput","signal","aborted","reject","UserCancellationError","resolve","externalEditorLoaded","externalEditorClosed","externalEditorOutput","onMessageEvent","event","data","_event$data","payload","console","info","addEventListener","onExternalEditorWindowClosed","postMessage","window","location","origin","close","warn","removeEventListener","setTimeout","downloadAndPrepareExternalEditorBase64Resources","_callee3","resourceNames","urlsToDownload","resourcesManager","downloadedBlobs","resourcesToDataUrl","_context3","getResourcesManager","forEach","resourceName","hasResource","getResource","getFile","isURL","isBlobURL","push","downloadUrlsToBlobs","urlContainers","onProgress","count","total","Map","blob","item","t1","convertBlobToDataURL","t2","t3","dataUrl","set","call","t4","_x3","resourceData","get","localFilePath","editWithBrowserExternalEditor","_callee4","defaultName","metadataKey","resourceManagementProps","modifiedResources","_context4","singleFrame","extraOptions","externalEditorData","readMetadata","existingMetadata","fps","isLooping","sendExternalEditorOpened","saveBlobUrlsFromExternalEditorBase64Resources","baseNameForNewResources","onFetchNewlyAddedResources","freeBlobsAndUpdateMetadata","metadata","some","onNewResourcesAdded","patchExternalEditorMetadataWithResourcesNamesIfNecessary","getName","_ref10","originalIndex","newName","newMetadata","_defineProperty","_x4","cloudProjectWarning","immediatelyOpenLoadingWindowForExternalEditor","targetId","left","screenX","innerWidth","width","top","screenY","innerHeight","height","open","Error","editors","createDisplayName","editDisplayName","edit","_edit","_callee5","i18n","_context5","internalName","showWarningBox","_","delayToNextTick","_x5","_edit2","_callee6","_context6","_x6","_edit3","_callee7","_context7","_x7","BrowserPreviewErrorDialog","_Component","_inherits","_super","_createSuper","_classCallCheck","_createClass","key","_this$props","this","onClose","I18n","Dialog","title","actions","FlatButton","onRequestClose","Column","Text","code","message","Component","STORE_NAME","INSTANCES_STORE_NAME","dbInstance","currentInstanceId","initializationPromise","heartbeatIntervalId","requestToPromise","request","onsuccess","result","onerror","transactionToPromise","transaction","oncomplete","onabort","getBrowserSWPreviewRootUrl","getBrowserSWPreviewBaseUrl","openBrowserSWPreviewIndexedDB","version","indexedDB","log","onclose","onversionchange","onupgradeneeded","_event","db","objectStoreNames","contains","createObjectStore","onblocked","putFile","bytes","contentType","objectStore","record","put","deleteFilesWithPrefix","pathPrefix","deletedCount","openCursor","cursor","target","startsWith","delete","continue","findUnusedInstanceId","usedIds","usedIdsSet","Set","candidate","has","acquireInstanceIdAndCleanup","cleanInstanceRelatedFiles","now","expiredInstanceIds","acquiredInstanceId","store","_yield$Promise$all","_yield$Promise$all2","keys","records","newId","_i","_expiredInstanceIds","expiredId","cleanupTransaction","Date","getAllKeys","getAll","lastUsed","parsedId","parseInt","isNaN","String","updateInstanceLastUsed","instanceId","startHeartbeat","clearInterval","setInterval","ensureBrowserSWPreviewSession","finish","gd","global","filename","BrowserSWFileSystem","_this","filesContent","rootUrl","_pendingFiles","_pendingDeleteOperations","_allCopiedExternalUrls","applyPendingOperations","totalBytes","uploadPromises","file","fullPath","encoder","TextEncoder","encode","content","buffer","byteLength","Math","ceil","mkDir","dirExists","clearDir","relativePath","replace","normalizedPrefix","prefixWithTrailingSlash","endsWith","getTempDir","fileNameFrom","fullpath","dirNameFrom","makeAbsolute","baseDirectory","isAbsolute","makeRelative","charAt","copyFile","dest","add","writeToFile","contents","filePath","toLowerCase","readFile","_indexedFilesContent","text","readDir","ext","toUpperCase","output","VectorString","upperCaseUrl","indexOf","push_back","fileExists","textFileDescriptor","filesToDownload","preview","web","cordova","electron","findGDJS","fileSet","gdjsRoot","getIDEVersionWithHash","Window","isDev","relativeFilePath","fetch","then","ok","debuggerServerState","callbacksList","nextDebuggerId","responseCallbacks","nextMessageWithResponseId","existingPreviewWindows","embbededGameFrameWindow","getExistingDebuggerIds","getExistingEmbeddedGameFrameDebuggerIds","getExistingPreviewDebuggerIds","Object","getDebuggerIdForPreviewWindow","previewWindow","windowClosedPollingIntervalId","stopWindowClosedPolling","notifyConnectionClosed","onConnectionClosed","debuggerIds","setupWindowClosedPolling","closed","previewOrigin","BrowserPreviewDebuggerServer","_startServer","parsedMessage","JSON","parse","answerCallback","messageId","onHandleParsedMessage","onServerStateChanged","theWindow","_step","_iterator","_createForOfIteratorHelper","s","n","done","sendMessage","_objectSpread","err","e","f","callbacks","callbacksIndex","splice","clear","browserPreviewDebuggerServer","registerNewPreviewWindow","existingId","onConnectionOpened","nextPreviewWindowId","immediatelyOpenNewPreviewWindow","getGameResolutionWidth","getGameResolutionHeight","nextPreviewId","prepareExporter","isForInGameEdition","_yield$findGDJS","baseUrl","outputDir","browserSWFileSystem","fileSystem","exporter","assignIn","AbstractFileSystemJS","Exporter","setCodeOutputDirectory","BrowserSWPreviewLauncher","_React$Component","_len","args","Array","_key","canDoNetworkPreview","state","closeAllPreviews","closeAllConnections","immediatelyPreparePreviewWindows","getPreviewDebuggerServer","hotReload","from","numberOfWindows","launchPreview","previewOptions","sceneName","externalLayoutName","eventsBasedObjectType","eventsBasedObjectVariantName","previewWindows","previewStartTime","previewId","shouldHotReload","_yield$prepareExporte","previewExportOptions","includeFileHashs","includeFile","hash","gdevelopResourceToken","projectDataElement","projectData","runtimeGameOptionsElement","runtimeGameOptions","setState","startServer","URL","PreviewExportOptions","setLayoutName","setIsDevelopmentEnvironment","setIsInGameEdition","setEditorId","editorId","setExternalLayoutName","setEventsBasedObjectType","setEventsBasedObjectVariantName","useWindowMessageDebuggerClient","getIncludeFileHashs","setIncludeFileHash","setShouldClearExportFolder","shouldHardReload","setShouldReloadProjectData","setShouldReloadLibraries","shouldReloadLibraries","shouldGenerateScenesEventsCode","setShouldGenerateScenesEventsCode","setFullLoadingScreen","fullLoadingScreen","setNativeMobileApp","isNativeMobileApp","setGDevelopVersionWithHash","setCrashReportUploadLevel","crashReportUploadLevel","setPreviewContext","previewContext","setProjectTemplateSlug","getTemplateSlug","setSourceGameId","sourceGameId","inAppTutorialMessageInPreview","setInAppTutorialMessageInPreview","inAppTutorialMessagePositionInPreview","fallbackAuthor","setFallbackAuthor","username","authenticatedPlayer","setAuthenticatedPlayer","playerId","playerUsername","playerToken","captureOptions","screenshots","screenshot","addScreenshotCapture","delayTimeInSeconds","signedUrl","publicUrl","editorCameraState3D","setEditorCameraState3D","cameraMode","positionX","positionY","positionZ","rotationAngle","elevationAngle","distance","inGameEditorSettings","setInGameEditorSettingsJson","stringify","getGDevelopResourceJwtToken","setGDevelopResourceToken","exportProjectForPixiPreview","setEmbeddedGameFramePreviewLocation","previewIndexHtmlLocation","SerializerElement","serializeProjectData","Serializer","toJSON","serializeRuntimeGameOptions","debuggerId","command","shouldReloadResources","focus","registerCallbacks","onErrorReceived","_onConnectionClosed","onCaptureFinished","onConnectionErrored","_this2","uploadObjects","uploadedObjects","_yield$getSignedUrls","signedUrls","getSignedUrls","uploadType","files","params","Key","ContentType","Body","headers","getBaseUrl","GDevelopGamePreviews","BrowserS3FileSystem","prefix","bucketBaseUrl","_pendingUploadObjects","uploadPendingObjects","fileExtension","BrowserS3PreviewLauncher","_prepareExporter","makeTimestampedId","browserS3FileSystem","lastDebuggerId","existingPreviewWindow","_yield$_this$_prepare","useMinimalDebuggerClient","setNonRuntimeScriptsCacheBurst","pathPosix","BrowserFileSystem","textFiles","_textFiles","_filesToDownload","getAllTextFilesIn","getAllUrlFilesIn","basename","dirname","filePathOrURL","baseDirectoryOrURL","normalize","substring","relative","existingDestToDownload","existingSourceToDownload","upperCaseFilePath","normalizedFilePath","exportPipelineName","browserOnlineCordovaExportPipeline","onlineBuildType","limitedBuilds","packageNameWarningType","getInitialExportState","targets","keystore","signingDialogOpen","canLaunchBuild","exportState","errored","exportStep","isNavigationDisabled","renderHeader","SetupExportHeader","shouldSuggestBumpingVersionNumber","renderExportFlow","ExportFlow","context","abstractFileSystem","launchExport","exportOptions","ExportOptions","setTarget","exportWholePixiProject","urlFiles","launchResourcesDownload","downloadUrlFilesToBlobFiles","updateStepProgress","blobFiles","launchCompression","archiveFiles","basePath","launchUpload","blobFile","getBuildFileUploadOptions","uploadOptions","uploadBlobFile","launchOnlineBuild","authenticatedUser","uploadBucketKey","gameId","payWithCredits","getAuthorizationHeader","firebaseUser","buildCordovaAndroid","uid","browserOnlineCordovaIosExportPipeline","signing","profile","buildCordovaIos","browserOnlineElectronExportPipeline","buildElectron","browserOnlineWebExportPipeline","uiMode","ExplanationHeader","OnlineWebExportFlow","sizeLimit","buildWeb","browserHTML5ExportPipeline","renderDoneFooter","compressionOutput","DoneFooter","renderGameButton","BlobDownloadUrlHolder","blobDownloadUrl","openBlobDownloadUrl","browserCordovaExportPipeline","browserElectronExportPipeline","browserFacebookInstantGamesExportPipeline","browserOnlineWebExporter","onlineWebExporter","exportPipeline","browserAutomatedExporters","html5Exporter","onlineCordovaExporter","onlineCordovaIosExporter","onlineElectronExporter","facebookInstantGamesExporter","browserManualExporters","cordovaExporter","electronExporter","jsExtensions","extensionModule","require","objectsRenderingServiceModules","makeExtensionsLoader","objectsEditorService","objectsRenderingService","filterExamples","loadAllExtensions","results","registerEditorConfigurations","requirePath","registerModule","registerInstanceRenderers","registerClearCache","extensionModulePath","loadExtension","JsPlatform","expectedNumberOfJSExtensionModulesLoaded","getExpectedNumberOfJSExtensionModules","batchedWrites","flushBatchedWrites","debounce","writes","allSettled","onSuccess","reason","onError","writeFileInNextBatch","makeBrowserSWEventsFunctionCodeWriter","onWriteFile","getPathFor","codeNamespace","slugs","getIncludeFileFor","writeFunctionCode","functionCodeNamespace","writeBehaviorCode","behaviorCodeNamespace","writeObjectCode","objectCodeNamespace","batchedUploads","flushBatchedUploads","uploads","upload","uploadedObject","uploadObjectInNextBatch","makeBrowserS3EventsFunctionCodeWriter","PROJECT_JSON_FILENAME","downloadResourcesAsBlobs","onAddBlobFile","_onProgress","getResourcesToFetch","resourcesToFetchAndUpload","downloadedBlobsAndResources","alreadyUsedFilenames","erroredResources","getAllResourceNames","toJSArray","resourceFile","checkIfIsGDevelopCloudBucketUrl","extractDecodedFilenameFromProjectResourceUrl","extension","extname","getKind","newBasename","newNameGenerator","tentativeBasename","newResourcePath","DownloadFileSaveAsDialog","onDone","zippedProjectBlob","setZippedProjectBlob","_useGenericRetryableP","useGenericRetryableProcessWithProgress","onDoProcess","ensureProcessIsDone","renderProcessDialog","newProject","serializedProject","_zippedProjectBlob","ProjectHelper","createNewGDJSProject","serializeTo","unserializeFrom","blobFileDescriptor","serializeToJSObject","showErrorBox","rawError","errorId","openExternalURL","maxWidth","justifyContent","PlaceholderLoader","renderIcon","Download","fontSize","size","hiddenInOpenDialog","createOperations","setDialog","closeDialog","onSaveProjectAs","_onSaveProjectAs","saveAsLocation","onStartSaving","wasSaved","moveNothing","movers","_movers","CloudStorageProvider","moveUrlResourcesToCloudProject","UrlStorageProvider","DownloadFileStorageProvider","BrowserResourceMover","moveAllProjectResources","_moveAllProjectResources","oldStorageProvider","newStorageProvider","mover","fetchers","_fetchers","moveUrlResourcesToCloudFilesIfPrivate","fetchRelativeResourcesToFullUrls","BrowserResourceFetcher","fetchAllProjectResources","_fetchAllProjectResources","storageProvider","fetcher","BrowserEventsFunctionsExtensionOpener","chooseEventsFunctionExtensionFile","showOpenFilePicker","types","description","accept","excludeAcceptAllOption","multiple","handles","handle","catch","adhocInput","createElement","type","onchange","onFilePickingDialogFinishedClosing","body","onFocusBackWindow","click","readEventsFunctionExtensionFile","File","downloadStringContentAsFile","blobUrl","adhocLink","Blob","createObjectURL","href","download","appendChild","remove","BrowserEventsFunctionsExtensionWriter","extensionName","writeSerializedObject","serializedObject","BrowserLoginProvider","auth","_loginWithEmailAndPassword","email","password","signInWithEmailAndPassword","_loginOrSignupWithProvider","provider","promise","terminateWebSocket","authWindow","setupAuthenticationWebSocket","onConnectionEstablished","connectionId","searchParams","toString","onTokenReceived","_onTokenReceived","credential","GoogleAuthProvider","GithubAuthProvider","accessToken","OAuthProvider","idToken","id_token","nonce","raw_nonce","signInWithCredential","onTimeout","create","authentication","setUpContextMenu","loginProvider","setLoginProvider","appArguments","getArguments","canUseBrowserSW","isServiceWorkerSupported","Providers","disableCheckForUpdates","makeEventsFunctionCodeWriter","eventsFunctionsExtensionWriter","eventsFunctionsExtensionOpener","ProjectStorageProviders","storageProviders","defaultStorageProvider","getStorageProviderOperations","getStorageProviderResourceOperations","initialFileMetadataToOpen","MainFrame","renderPreviewLauncher","ref","renderShareDialog","ShareDialog","onSaveProject","isSavingProject","onChangeSubscription","automatedExporters","manualExporters","allExportersRequireOnline","initialTab","gamesList","quickPublishOnlineWebExporter","resourceMover","resourceFetcher","resourceSources","browserResourceSources","resourceExternalEditors","browserResourceExternalEditors","extensionsLoader","ObjectsEditorService","ObjectsRenderingService","initialExampleSlugToOpen"],"sourceRoot":""}