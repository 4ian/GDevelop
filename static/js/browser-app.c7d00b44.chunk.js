"use strict";(self.webpackChunkgdevelop_ide=self.webpackChunkgdevelop_ide||[]).push([[7237],{4638:function(e,r,n){n.r(r),n.d(r,{create:function(){return at}});var t=n(1413),o=n(28381),i=n(91808),a=n(2066),s=n(36043),c=(n(94492),n(13778),n(93433)),u=n(74165),l=n(15861),d=n(29439),p=n(36600),f=n(17037),h=n(7660),g=n(70983),m=n.n(g),v=n(40243),x=n(61325),w=n(60022),b=n(42986),S=n(68009),y=n(14446),F=n.n(y),j=n(38092),E=n(15684),P=n(84140),Z=n(1773),k=n(52716),D=n(29343),C=function(e){var r=e.options,n=e.selectedResourceIndex,t=e.onSelectResource;if(!t)return null;var o=r.resourceKind;return f.xz.includes(o)?(0,D.jsx)(h.L,{selectedResourceIndex:n,onSelectResource:t,resourceKind:o}):null},I=function(e){var r=e.options,n=e.onChooseResources,t=e.createNewResource,i=o.useState(""),a=(0,d.Z)(i,2),s=a[0],c=a[1],f=o.useState(null),h=(0,d.Z)(f,2),g=h[0],y=h[1],E=o.useState([]),P=(0,d.Z)(E,2),Z=P[0],k=P[1],C=!!Z.filter(Boolean).length,I=(0,S.N)(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(n){var t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.multiSelection?n.split("\n").filter(Boolean):[n],y(null),k([]),e.prev=3,e.next=6,Promise.all(t.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F().get(r,{timeout:1e3,validateStatus:function(e){return!0}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 6:o=e.sent,k(o.map((function(e){return!(e.status>=200&&e.status<400)}))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),y(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(r){return e.apply(this,arguments)}}(),500);return o.useEffect((function(){I(s)}),[s,I]),(0,D.jsxs)(x.ak,{noMargin:!0,expand:!0,children:[(0,D.jsx)(v.x1,{noMargin:!0,children:(0,D.jsx)(x.ad,{renderButton:function(e){return(0,D.jsx)(w.Z,{onClick:function(){if(n&&t){var e=r.multiSelection?s.split("\n").filter(Boolean):[s];n(e.map((function(e){var r=t();return r.setFile(e),r.setName(m().basename(e)),r.setOrigin("url",e),r})))}},primary:!0,label:(0,D.jsx)(p.Trans,{id:"Choose"}),style:e,disabled:!!g||C})},renderTextField:function(){return(0,D.jsx)(b.Z,{floatingLabelText:r.multiSelection?(0,D.jsx)(p.Trans,{id:"Resource(s) URL(s) (one per line)"}):(0,D.jsx)(p.Trans,{id:"Resource URL"}),value:s,onChange:c,multiline:r.multiSelection,rows:1,rowsMax:5,fullWidth:!0,errorText:g?(0,D.jsx)(p.Trans,{id:"There was an error verifying the URL(s). Please check they are correct."}):C?(0,D.jsx)(p.Trans,{id:"Unable to verify URLs {0} . Please check they are correct.",values:{0:Z.map((function(e,r){return e?"#"+(r+1):null})).filter(Boolean).join(", ")}}):null})}})}),(0,D.jsx)(j.Z,{kind:"warning",children:(0,D.jsx)(p.Trans,{id:"The URLs must be public and stay accessible while you work on this project - they won't be stored inside the project file. When exporting a game, the resources pointed by these URLs will be downloaded and stored inside the game."})})]})},R=[].concat((0,c.Z)(f.QP.map((function(e){var r=e.kind,n=e.createNewResource,t="upload-".concat(r);return{name:t,displayName:{id:"File(s) from your device"},displayTab:"import",shouldCreateResource:!0,shouldGuessAnimationsFromName:!0,kind:r,renderComponent:function(e){return(0,D.jsx)(E.V,{createNewResource:n,onChooseResources:function(r){return e.onChooseResources({selectedResources:r,selectedSourceName:t})},options:e.options,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,automaticallyOpenInput:!!e.automaticallyOpenIfPossible},"url-chooser-".concat(r))}}}))),(0,c.Z)(f.xz.map((function(e){var r=f.QP.find((function(r){return r.kind===e}));if(!r)return null;var n="resource-store-".concat(e);return{name:n,displayName:{id:"Choose from asset store"},displayTab:"standalone",shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,kind:e,renderComponent:function(r){return(0,D.jsx)(C,{selectedResourceIndex:r.selectedResourceIndex,onSelectResource:r.onSelectResource,options:r.options},"resource-store-".concat(e))},renderPrimaryAction:function(t){var o=t.resource,i=t.onChooseResources;return(0,D.jsx)(Z.vF,{primary:!0,label:"font"===e?(0,D.jsx)(p.Trans,{id:"Install font"}):(0,D.jsx)(p.Trans,{id:"Add to project"}),disabled:!o,onClick:function(){if(o){var e=o.url,t=r.createNewResource();t.setFile(e);var a=(0,P.d0)(e)?(0,P.Lj)(e):m().basename(e);t.setName(a),t.setOrigin("gdevelop-asset-store",e),i({selectedResources:[t],selectedSourceName:n})}}},"add-resource")}}})).filter(Boolean)),(0,c.Z)(f.QP.map((function(e){var r=e.kind,n=(e.createNewResource,"project-resources-".concat(r));return{name:n,displayName:{id:"Project resources"},displayTab:"standalone",shouldCreateResource:!1,shouldGuessAnimationsFromName:!1,hideInResourceEditor:!0,kind:r,renderComponent:function(e){return(0,D.jsx)(k.Z,{project:e.project,onResourcesSelected:e.onResourcesSelected,resourceKind:r,multiSelection:e.options.multiSelection},"project-resources-".concat(r))},renderPrimaryAction:function(e){var r=e.selectedResources,t=e.onChooseResources;return(0,D.jsx)(Z.vF,{primary:!0,label:r&&r.length&&1!==r.length?(0,D.jsx)(p.Trans,{id:"Select {0} resources",values:{0:r.length}}):(0,D.jsx)(p.Trans,{id:"Select resource"}),disabled:!r||!r.length,onClick:function(){r&&r.length&&t({selectedResources:r,selectedSourceName:n})}},"select-resources")}}}))),(0,c.Z)(f.QP.map((function(e){var r=e.kind,n=e.createNewResource,t="url-chooser-".concat(r);return{name:t,displayName:{id:"Use a public URL"},displayTab:"import-advanced",shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,kind:r,renderComponent:function(e){return(0,D.jsx)(I,{createNewResource:n,onChooseResources:function(r){return e.onChooseResources({selectedResources:r,selectedSourceName:t})},options:e.options},"url-chooser-".concat(r))}}})))),N=n(4942),T=n(32705),B=n(75333),M=n(57974),A=n(81303),O=n(30141),W=function(e){e.document.write('<html>\n  <head>\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n        background-color: #000000;\n        overflow: hidden;\n        height: 100vh;\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n      }\n      @keyframes spin {\n        100% {\n          transform:rotate(360deg);\n        }\n      }\n      .spinning-loader {\n        animation: spin 3s linear infinite;\n      }\n    </style>\n  </head>\n  <body>\n      <img class="spinning-loader" width="50" alt="Loading..." src="'.concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CjxjaXJjbGUgb3BhY2l0eT0nMC4yNScgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iNCI+PC9jaXJjbGU+CjxwYXRoIG9wYWNpdHk9JzAuNzUnIGZpbGw9IiNGRkZGRkYiIGQ9Ik00IDEyYTggOCAwIDAxOC04VjBDNS4zNzMgMCAwIDUuMzczIDAgMTJoNHptMiA1LjI5MUE3Ljk2MiA3Ljk2MiAwIDAxNCAxMkgwYzAgMy4wNDIgMS4xMzUgNS44MjQgMyA3LjkzOGwzLTIuNjQ3eiI+PC9wYXRoPgo8L3N2Zz4=",'">\n  </body>\n</html>'))},U=n(23236),L=0,G={piskel:"external/piskel/piskel-index.html",yarn:"external/yarn/yarn-index.html",jfxr:"external/jfxr/jfxr-index.html"},_=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.externalEditorWindow,t=r.externalEditorName,o=r.externalEditorInput,!(i=r.signal).aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new U.s("")));case 3:return e.abrupt("return",new Promise((function(e,r){var a=!1,s=!1,c=null,u=function(e){if(e.source===n)if(e.data&&"object"===typeof e.data){var r=e.data,i=r.id,s=r.payload;"external-editor-ready"===i?(console.info('External editor "'.concat(t,'" ready.')),a=!0,n.addEventListener("unload",(function(){l()})),n.postMessage({id:"open-external-editor-input",payload:o},window.location.origin)):"save-external-editor-output"===i?(console.info('Received data from external editor "'.concat(t,'."')),c=s):"close"===e.data.id&&(n.close(),l())}else console.warn("Ignoring malformed message data from the external editor window.")};window.addEventListener("message",u);var l=function(){s||(s=!0,console.info('External editor "'.concat(t,'" closed.')),window.removeEventListener("message",u),e(c))};i.addEventListener("abort",(function(){r(new U.s("")),s||(n.close(),l())})),n.addEventListener("load",(function(){console.info('External editor "'.concat(t,'" loaded.')),a=!0,n.addEventListener("unload",(function(){l()}))})),n.location=G[t],setTimeout((function(){a||s||(console.info('External editor "'.concat(t,' not loaded after 10 seconds - closing its window."')),n.close(),l())}),1e4)})));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),z=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.project,t=r.resourceNames,o=[],i=n.getResourcesManager(),t.forEach((function(e){if(i.hasResource(e)){var r=i.getResource(e).getFile();(0,M.PX)(r)?(0,M.Gu)(r)?console.error("Unsupported blob URL for a resource - ignoring it."):o.push({url:r,resourceName:e}):console.error("Unsupported local file for a resource - ignoring it.")}})),e.next=6,(0,A.R7)({urlContainers:o,onProgress:function(e,r){}});case 6:return a=e.sent,s=new Map,e.next=10,Promise.all(a.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.error,n=r.blob,t=r.item,!n){e.next=15;break}return e.prev=2,e.t0=s,e.t1=t.resourceName,e.next=7,(0,A.oT)(n);case 7:e.t2=e.sent,e.t3={dataUrl:e.t2},e.t0.set.call(e.t0,e.t1,e.t3),e.next=15;break;case 12:e.prev=12,e.t4=e.catch(2),console.error('Unable to read data from resource "'.concat(t.resourceName,'" - ignoring it.'),e.t4);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(r){return e.apply(this,arguments)}}()));case 10:return e.abrupt("return",t.map((function(e){var r=s.get(e);if(!r)return{name:e,dataUrl:""};var n=r.localFilePath;return{name:e,dataUrl:r.dataUrl,localFilePath:n}})));case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),J=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l,d,p,f,h,g,m;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.externalEditorName,t=r.externalEditorWindow,o=r.defaultName,i=r.metadataKey,a=r.resourceKind,s=r.options,c=s.project,l=s.resourceNames,d=s.resourceManagementProps,p=s.signal,e.next=4,z({project:c,resourceNames:l});case 4:return f=e.sent,h={singleFrame:s.extraOptions.singleFrame,externalEditorData:(0,T.Z2)(i,s.extraOptions.existingMetadata),fps:s.extraOptions.fps,isLooping:s.extraOptions.isLooping,name:s.extraOptions.name||l[0]||o,resources:f},(0,B.sY)(n),e.next=9,_({externalEditorWindow:t,externalEditorName:n,externalEditorInput:h,signal:p});case 9:if(g=e.sent){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,(0,T.Zv)({baseNameForNewResources:g.baseNameForNewResources,project:c,resources:g.resources,resourceKind:a});case 14:return m=e.sent,e.prev=15,e.next=18,d.onFetchNewlyAddedResources();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),console.error("An error happened while fetching the newly added resources:",e.t0);case 23:return(0,T.$N)({modifiedResources:m,metadataKey:i,metadata:s.extraOptions.singleFrame?g.externalEditorData:null}),g.resources.some((function(e){return!e.name}))&&d.onNewResourcesAdded(),(0,T.TD)(m.map((function(e){return e.resource.getName()})),g.externalEditorData),e.abrupt("return",{resources:m.map((function(e){var r=e.resource,n=e.originalIndex;return{name:r.getName(),originalIndex:n}})),newName:g.baseNameForNewResources,newMetadata:(0,N.Z)({},i,g.externalEditorData)});case 28:case"end":return e.stop()}}),e,null,[[15,20]])})));return function(r){return e.apply(this,arguments)}}(),H={id:"You need to save this project as a cloud project to install this asset. Please save your project and try again."},K=function(){var e="GDevelopExternalEditor"+L++,r=window.screenX+window.innerWidth/2-400,n=window.screenY+window.innerHeight/2-300,t=window.open("about:blank",e,"width=".concat(800,",height=").concat(600,",left=").concat(r,",top=").concat(n));if(!t)throw new Error("Can't open the external editor because of browser restrictions.");return W(t),t},Y=[{name:"piskel-app",createDisplayName:{id:"Create with Piskel"},editDisplayName:{id:"Edit with Piskel"},kind:"image",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===r.getStorageProvider().internalName){e.next=4;break}return n=r.i18n,(0,O.T4)(n._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return t=K(),e.next=7,J({options:r,externalEditorWindow:t,externalEditorName:"piskel",defaultName:"New image",metadataKey:"pskl",resourceKind:"image"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"jfxr-app",createDisplayName:{id:"Create with Jfxr"},editDisplayName:{id:"Edit with Jfxr"},kind:"audio",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===r.getStorageProvider().internalName){e.next=4;break}return n=r.i18n,(0,O.T4)(n._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return t=K(),e.next=7,J({options:r,externalEditorWindow:t,externalEditorName:"jfxr",defaultName:"New sound effect",metadataKey:"jfxr",resourceKind:"audio"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"yarn-app",createDisplayName:{id:"Create with Yarn"},editDisplayName:{id:"Edit with Yarn"},kind:"json",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===r.getStorageProvider().internalName){e.next=4;break}return n=r.i18n,(0,O.T4)(n._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return t=K(),e.next=7,J({options:r,externalEditorWindow:t,externalEditorName:"yarn",defaultName:"New dialogue tree",metadataKey:"yarn",resourceKind:"json"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}],V=Y,X=n(15671),q=n(43144),Q=n(60136),$=n(29388),ee=n(10888),re=n(86278),ne=function(e){(0,Q.Z)(n,e);var r=(0,$.Z)(n);function n(){return(0,X.Z)(this,n),r.apply(this,arguments)}return(0,q.Z)(n,[{key:"render",value:function(){var e=this.props,r=e.error,n=e.onClose;return(0,D.jsx)(p.I18n,{children:function(e){e.i18n;return(0,D.jsxs)(Z.ZP,{title:(0,D.jsx)(p.Trans,{id:"Could not launch the preview"}),actions:[(0,D.jsx)(ee.Z,{label:(0,D.jsx)(p.Trans,{id:"Close"}),onClick:n},"close")],onRequestClose:n,open:!0,children:[(0,D.jsx)(v.x1,{children:(0,D.jsx)(v.sg,{noMargin:!0,children:(0,D.jsx)(re.Z,{children:"NetworkingError"===r.code?(0,D.jsx)(p.Trans,{id:"The preview could not be launched because you're offline."}):(0,D.jsx)(p.Trans,{id:"The preview could not be launched because an error happened: {0}.",values:{0:r.message}})})})}),(0,D.jsx)(v.x1,{children:(0,D.jsx)(v.sg,{noMargin:!0,children:(0,D.jsx)(re.Z,{children:(0,D.jsx)(p.Trans,{id:"Make sure you're online, have a proper internet connection and try again. If you download and use GDevelop desktop application, you can also run previews without any internet connection."})})})})]})}})}}]),n}(o.Component),te="files",oe="instances",ie=null,ae=null,se=null,ce=null,ue=function(e){return new Promise((function(r,n){e.onsuccess=function(){return r(e.result)},e.onerror=function(){var r=e.error||new Error("Request failed");n(r)}}))},le=function(e){return new Promise((function(r,n){e.oncomplete=function(){return r()},e.onerror=function(){var r=e.error||new Error("Transaction failed");n(r)},e.onabort=function(){var r=e.error||new Error("Transaction aborted");n(r)}}))},de=function(){var e=window.location.origin;return"".concat(e,"/browser_sw_preview")},pe=function(){if(!ae)throw new Error("Browser SW preview instance not initialised. Call ensureBrowserSWPreviewSession() first.");return"".concat(de(),"/").concat(ae)},fe=function(){return ie&&2===ie.version?Promise.resolve(ie):new Promise((function(e,r){try{var n=indexedDB.open("gdevelop-browser-sw-preview",2);n.onerror=function(){var e=n.error||new Error("Failed to open IndexedDB");console.error("[BrowserSWIndexedDB] Error opening database:",e),r(e)},n.onsuccess=function(){ie=n.result,console.log("[BrowserSWIndexedDB] Database opened successfully"),ie.onclose=function(){console.warn("[BrowserSWIndexedDB] Database connection closed unexpectedly"),ie=null},ie.onversionchange=function(){console.warn("[BrowserSWIndexedDB] Database version changed, closing connection"),ie&&(ie.close(),ie=null)},e(ie)},n.onupgradeneeded=function(e){console.log("[BrowserSWIndexedDB] Upgrading database schema...");var r=n.result;r.objectStoreNames.contains(te)||(r.createObjectStore(te),console.log("[BrowserSWIndexedDB] Created object store:",te)),r.objectStoreNames.contains(oe)||(r.createObjectStore(oe),console.log("[BrowserSWIndexedDB] Created object store:",oe))},n.onblocked=function(){console.warn("[BrowserSWIndexedDB] Database upgrade blocked by another connection"),r(new Error("Database upgrade blocked. Please close other tabs using this application."))}}catch(t){console.error("[BrowserSWIndexedDB] Exception while opening database:",t),r(t)}}))},he=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,n,t){var o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe();case 3:return o=e.sent,e.abrupt("return",new Promise((function(e,i){try{var a=o.transaction(te,"readwrite");a.onerror=function(){var e=a.error||new Error("Transaction failed");console.error("[BrowserSWIndexedDB] Transaction error while putting file:",r,e),i(e)},a.onabort=function(){var e=a.error||new Error("Transaction aborted");console.error("[BrowserSWIndexedDB] Transaction aborted while putting file:",r,e),i(e)},a.oncomplete=function(){e()};var s=a.objectStore(te),c={bytes:n,contentType:t},u=s.put(c,r);u.onerror=function(){var e=u.error||new Error("Put operation failed");console.error("[BrowserSWIndexedDB] Error storing file:",r,e),i(e)}}catch(l){console.error("[BrowserSWIndexedDB] Exception during put operation:",r,l),i(l)}})));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("[BrowserSWIndexedDB] Failed to put file:",r,e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,n,t){return e.apply(this,arguments)}}(),ge=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe();case 3:return n=e.sent,e.abrupt("return",new Promise((function(e,t){try{var o=n.transaction(te,"readwrite"),i=0;o.onerror=function(){var e=o.error||new Error("Transaction failed");console.error("[BrowserSWIndexedDB] Transaction error while deleting files with prefix:",r,e),t(e)},o.oncomplete=function(){e(i)};var a=o.objectStore(te).openCursor();a.onsuccess=function(e){var n=e.target.result;if(n){var t=n.key;"string"===typeof t&&t.startsWith(r)&&(n.delete(),i++),n.continue()}},a.onerror=function(){var e=a.error||new Error("Cursor operation failed");console.error("[BrowserSWIndexedDB] Error during cursor operation:",e),t(e)}}catch(s){console.error("[BrowserSWIndexedDB] Exception during delete with prefix:",r,s),t(s)}})));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("[BrowserSWIndexedDB] Failed to delete files with prefix:",r,e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r){return e.apply(this,arguments)}}(),me=function(e){for(var r=new Set(e),n=1;r.has(n);)n++;return n},ve=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l,p,f,h,g,m,v,x,w;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe();case 2:return n=e.sent,t=Date.now(),o=[],i=null,a=n.transaction(oe,"readwrite"),s=a.objectStore(oe),e.next=10,Promise.all([ue(s.getAllKeys()),ue(s.getAll())]);case 10:return c=e.sent,l=(0,d.Z)(c,2),p=l[0],f=l[1],h=[],p.forEach((function(e,r){if("string"===typeof e){var n=f[r],i=n&&"number"===typeof n.lastUsed?n.lastUsed:0;if(t-i>216e5)o.push(e);else{var a=parseInt(e,10);isNaN(a)||h.push(a)}}})),g=me(h),i=String(g),s.put({lastUsed:t},i),e.next=21,le(a);case 21:m=0,v=o;case 22:if(!(m<v.length)){e.next=41;break}return x=v[m],e.prev=24,console.log("[BrowserSWIndexedDB] Cleaning up expired instance #".concat(x," files...")),e.next=28,r(x);case 28:return w=n.transaction(oe,"readwrite"),w.objectStore(oe).delete(x),e.next=33,le(w);case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(24),console.error("[BrowserSWIndexedDB] Failed to clean up expired instance, keeping instance record:",x,e.t0);case 38:m++,e.next=22;break;case 41:return e.abrupt("return",i);case 42:case"end":return e.stop()}}),e,null,[[24,35]])})));return function(r){return e.apply(this,arguments)}}(),xe=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe();case 3:return n=e.sent,t=n.transaction(oe,"readwrite"),t.objectStore(oe).put({lastUsed:Date.now()},r),e.next=9,le(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("[BrowserSWIndexedDB] Failed to update instance heartbeat:",r,e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(r){return e.apply(this,arguments)}}(),we=function(e){ce&&clearInterval(ce);ce=setInterval((function(){xe(e)}),6e4)},be=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae){e.next=2;break}return e.abrupt("return");case 2:if(!se){e.next=4;break}return e.abrupt("return",se);case 4:return console.info("[BrowserSWIndexedDB] Acquiring a Browser SW preview instance..."),se=(0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ve(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge("/".concat(r,"/"));case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());case 3:if(r=e.sent){e.next=6;break}throw new Error("Unable to acquire a Browser SW preview instance identifier");case 6:console.info("This session is now using the Browser SW preview instance #".concat(r,".")),ae=r,we(r),e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(0),ae=null,console.error("[BrowserSWIndexedDB] Failed to initialise Browser SW preview session:",e.t0),e.t0;case 16:return e.prev=16,se=null,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,11,16,19]])})))(),e.abrupt("return",se);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=n.g.gd,ye=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},Fe=(0,q.Z)((function e(r){var n=this,t=r.filesContent,o=r.rootUrl;(0,X.Z)(this,e),this._pendingFiles=[],this._pendingDeleteOperations=[],this._allCopiedExternalUrls=new Set,this.applyPendingOperations=(0,l.Z)((0,u.Z)().mark((function e(){var r,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(n._pendingDeleteOperations);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("[BrowserSWFileSystem] Error while deleting files in IndexedDB. Ignoring.",e.t0);case 8:return e.prev=8,console.log("[BrowserSWFileSystem] Storing ".concat(n._pendingFiles.length," files in IndexedDB for preview...")),r=0,t=n._pendingFiles.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(n){var t,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="/".concat(n.path),o=new TextEncoder,i=o.encode(n.content).buffer,r+=i.byteLength,e.next=6,he(t,i,n.contentType);case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),e.next=14,Promise.all(t);case 14:console.log("[BrowserSWFileSystem] Successfully stored all ".concat(n._pendingFiles.length," preview files in IndexedDB (").concat(Math.ceil(r/1e3)," kB).")),e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(8),console.error("[BrowserSWFileSystem] Can't store all files in IndexedDB:",e.t1),e.t1;case 21:case"end":return e.stop()}}),e,null,[[0,5],[8,17]])}))),this.mkDir=function(e){},this.dirExists=function(e){return!0},this.clearDir=function(e){console.info("[BrowserSWFileSystem] Clearing directory: ".concat(e,"..."));var r=e.replace(n.rootUrl,""),t=r.startsWith("/")?r:"/".concat(r),o=t.endsWith("/")?t:"".concat(t,"/");n._pendingDeleteOperations.push(ge(o))},this.getTempDir=function(){return"/virtual-unused-tmp-dir"},this.fileNameFrom=function(e){return ye(e)?e:m().basename(e)},this.dirNameFrom=function(e){return ye(e)?"":m().dirname(e)},this.makeAbsolute=function(e,r){return ye(e)?e:(n.isAbsolute(r)||(r=m().resolve(r)),ye(r)?r+"/"+e:m().resolve(r,m().normalize(e)))},this.makeRelative=function(e,r){return ye(e)?e:m().relative(r,m().normalize(e))},this.isAbsolute=function(e){return!!ye(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,r){return ye(e)?(n._allCopiedExternalUrls.add(e),!0):(console.warn("[BrowserSWFileSystem] Copy not done from",e,"to",r),!0)},this.writeToFile=function(e,r){var t,o=e.replace(n.rootUrl,""),i=(t=e,{".html":"text/html; charset=utf-8",".js":"text/javascript; charset=utf-8",".mjs":"text/javascript; charset=utf-8",".css":"text/css; charset=utf-8",".json":"application/json; charset=utf-8",".wasm":"application/wasm",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".svg":"image/svg+xml",".txt":"text/plain; charset=utf-8"}[m().extname(t).toLowerCase()]||"application/octet-stream");return n._pendingFiles.push({path:o,content:r,contentType:i}),!0},this.readFile=function(e){return n._indexedFilesContent[e]?n._indexedFilesContent[e].text:(console.error("[BrowserSWFileSystem] Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,r){r=r.toUpperCase();var t=new Se.VectorString;return n._allCopiedExternalUrls.forEach((function(e){var n=e.toUpperCase();n.indexOf(r)===n.length-r.length&&t.push_back(e)})),t},this.fileExists=function(e){return ye(e),!0},this.rootUrl=o,this._indexedFilesContent={},t.forEach((function(e){n._indexedFilesContent[e.filePath]=e}))})),je=n(52578),Ee={preview:["/Runtime/index.html"],web:["/Runtime/index.html","/Runtime/Electron/LICENSE.GDevelop.txt"],"cocos2d-js":["/Runtime/Cocos2d/cocos2d-js-v3.10.js","/Runtime/Cocos2d/index.html","/Runtime/Cocos2d/main.js","/Runtime/Cocos2d/project.json"],"facebook-instant-games":["/Runtime/FacebookInstantGames/fbapp-config.json","/Runtime/FacebookInstantGames/index.html"],cordova:["/Runtime/Cordova/www/index.html","/Runtime/Cordova/www/LICENSE.GDevelop.txt","/Runtime/Cordova/config.xml","/Runtime/Cordova/package.json"],electron:["/Runtime/index.html","/Runtime/Electron/main.js","/Runtime/Electron/package.json","/Runtime/Electron/LICENSE.GDevelop.txt"]},Pe=function(e){var r="https://resources.gdevelop-app.com/GDJS-".concat((0,je.Us)());return a.ZP.isDev()&&(r="http://localhost:5002"),Promise.all(Ee[e].map((function(e){var n=r+e;return fetch(n).then((function(e){if(!e.ok)throw console.error('Error while downloading "'.concat(n,'"'),e),new Error('Error while downloading "'.concat(n,'" (status: ').concat(e.status,")"));return e.text().then((function(e){return{filePath:n,text:e}}))}))}))).then((function(e){return{gdjsRoot:r,filesContent:e}}))},Ze=n(25842),ke=n.n(Ze),De=n(37762),Ce="stopped",Ie=[],Re=0,Ne=new Map,Te=1,Be={},Me=null,Ae=function(){return[].concat((0,c.Z)(Oe()),(0,c.Z)(We()))},Oe=function(){return Me?["embedded-game-frame"]:[]},We=function(){return Object.keys(Be).map((function(e){return e}))},Ue=function(e){if(Me&&Me===e)return"embedded-game-frame";for(var r in Be)if(Be[r]===e)return r;return null},Le=null,Ge=function(){null!==Le&&(clearInterval(Le),Le=null)},_e=function(e){Ie.forEach((function(r){return(0,r.onConnectionClosed)({id:e,debuggerIds:Ae()})}))},ze=function(){null===Le&&(Le=setInterval((function(){for(var e in Be){Be[e].closed&&(console.info("A preview window was closed, with debugger id:",e),delete Be[e],_e(e),Object.keys(Be).length||Ge())}}),1e3))},Je=null,He=function(){function e(){(0,X.Z)(this,e)}return(0,q.Z)(e,[{key:"startServer",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.origin,"started"!==Ce){e.next=3;break}return e.abrupt("return");case 3:Ce="started",Je=n,window.addEventListener("message",(function(e){if(e.origin===Je){var r=Ue(e.source);if(null!==r)try{var n=JSON.parse(e.data),t=Ne.get(n.messageId);t&&(t(n),Ne.delete(n.messageId)),Ie.forEach((function(e){return(0,e.onHandleParsedMessage)({id:r,parsedMessage:n})}))}catch(o){console.error("Error while parsing messages coming from a preview:",o)}}})),ze(),Ie.forEach((function(e){return(0,e.onServerStateChanged)()}));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,r){var n="embedded-game-frame"===e?Me:Be[e];if(n)try{n.postMessage(r,Je)}catch(t){console.error('Unable to send a message to the preview window with id "'.concat(e,'":'),t)}}},{key:"sendMessageWithResponse",value:function(e){var r=Te;Te++;var n,o=(0,De.Z)(Ae());try{for(o.s();!(n=o.n()).done;){var i=n.value;this.sendMessage(i,(0,t.Z)((0,t.Z)({},e),{},{messageId:r}))}}catch(a){o.e(a)}finally{o.f()}return new Promise((function(e,n){Ne.set(r,e),setTimeout((function(){n(new Error("Timeout while waiting for response from the debugger(s) for message with id ".concat(r,"."))),Ne.delete(r)}),1e3)}))}},{key:"getServerState",value:function(){return Ce}},{key:"getExistingDebuggerIds",value:function(){return Ae()}},{key:"getExistingEmbeddedGameFrameDebuggerIds",value:function(){return Oe()}},{key:"getExistingPreviewDebuggerIds",value:function(){return We()}},{key:"registerCallbacks",value:function(e){return Ie.push(e),function(){var r=Ie.indexOf(e);-1!==r&&Ie.splice(r,1)}}},{key:"registerEmbeddedGameFrame",value:function(e){e!==Me&&(console.info("Registered the embedded game frame window in the debugger server."),Me=e)}},{key:"unregisterEmbeddedGameFrame",value:function(e){Me===e?(console.info("Unregistered the embedded game frame window in the debugger server."),Me=null,_e("embedded-game-frame")):Me&&console.warn("The embedded game frame window to unregister is not the same as the one registered. Ignoring the unregistration.")}},{key:"closeAllConnections",value:function(){console.info("Closing all connections (i.e: windows and the embedded game frame) to the debugger server."),Object.keys(Be).forEach((function(e){var r=Be[e];delete Be[e];try{r&&!r.closed&&r.close()}catch(n){console.info("Unable to close a preview window - ignoring the error as the project is closing:",n)}_e(e)})),Ge(),Me&&(Me=null,_e("embedded-game-frame")),Ne.clear()}}]),e}(),Ke=new He,Ye=function(e){var r=Ue(e);if(r)return console.warn("A preview window was already registered. It has this id:",r),r;var n="preview-window-"+Re++;return Be[n]=e,ze(),Ie.forEach((function(e){return(0,e.onConnectionOpened)({id:n,debuggerIds:Ae()})})),n},Ve=n(34517),Xe=n(48409),qe=n(18870),Qe=0,$e=function(e){var r=e.getGameResolutionWidth(),n=e.getGameResolutionHeight(),t=window.screenX+window.innerWidth/2-r/2,o=window.screenY+window.innerHeight/2-n/2,i="GDevelopPreview"+Qe++,a=window.open("about:blank",i,"width=".concat(r,",height=").concat(n,",left=").concat(t,",top=").concat(o));if(!a)throw new Error("Can't open the preview window because of browser restrictions.");return W(a),a},er=n.g.gd,rr=1,nr=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l,d,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.isForInGameEdition,e.next=3,Pe("preview");case 3:return t=e.sent,o=t.gdjsRoot,i=t.filesContent,console.info("[BrowserSWPreviewLauncher] GDJS found in",o),a=pe(),s=de(),c="".concat(a,"/").concat(n?"in-game-editor-preview":"preview"),console.log("[BrowserSWPreviewLauncher] Preview will be served from:",c),l=new Fe({filesContent:i,rootUrl:"".concat(s,"/")}),d=ke()(new er.AbstractFileSystemJS,l),(p=new er.Exporter(d,o)).setCodeOutputDirectory(c),e.abrupt("return",{exporter:p,outputDir:c,browserSWFileSystem:l});case 16:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),tr=function(e){(0,Q.Z)(n,e);var r=(0,$.Z)(n);function n(){var e;(0,X.Z)(this,n);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).canDoNetworkPreview=function(){return!1},e.state={error:null},e.closeAllPreviews=function(){Ke.closeAllConnections()},e.immediatelyPreparePreviewWindows=function(r){var n=r.isForInGameEdition?e.getPreviewDebuggerServer().getExistingEmbeddedGameFrameDebuggerIds():e.getPreviewDebuggerServer().getExistingPreviewDebuggerIds();return r.hotReload&&!!n.length||r.isForInGameEdition?[]:Array.from({length:r.numberOfWindows},(function(){try{return $e(r.project)}catch(e){return console.error("[BrowserSWPreviewLauncher] Unable to open a new preview window - this window will be ignored:",e),null}})).filter(Boolean)},e.launchPreview=function(){var r=(0,l.Z)((0,u.Z)().mark((function r(n){var t,o,i,s,c,d,p,f,h,g,m,v,x,w,b,S,y,F,j,E,P,Z,k;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=n.project,o=n.sceneName,i=n.externalLayoutName,s=n.eventsBasedObjectType,c=n.eventsBasedObjectVariantName,d=n.previewWindows,p=Date.now(),e.setState({error:null}),f=rr++,console.log("[BrowserSWPreviewLauncher] Launching preview #".concat(f," with options:"),n),h=e.getPreviewDebuggerServer().getExistingDebuggerIds(),g=n.hotReload&&!!h.length,r.prev=7,r.next=10,e.getPreviewDebuggerServer().startServer({origin:new URL(pe()).origin});case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(7),console.error("[BrowserSWPreviewLauncher] Unable to start the Debugger Server for the preview:",r.t0);case 15:return r.prev=15,r.next=18,nr({isForInGameEdition:n.isForInGameEdition});case 18:for(y in m=r.sent,v=m.exporter,x=m.outputDir,w=m.browserSWFileSystem,(b=new er.PreviewExportOptions(t,x)).setLayoutName(o),b.setIsDevelopmentEnvironment(a.ZP.isDev()),b.setIsInGameEdition(n.isForInGameEdition),b.setEditorId(n.editorId||""),i&&b.setExternalLayoutName(i),s&&(b.setEventsBasedObjectType(s),b.setEventsBasedObjectVariantName(c||"")),b.useWindowMessageDebuggerClient(),S=e.props.getIncludeFileHashs())F=S[y],b.setIncludeFileHash(y,F);return g&&(b.setShouldClearExportFolder(n.shouldHardReload),b.setShouldReloadProjectData(!1),b.setShouldReloadLibraries(n.shouldReloadLibraries||n.shouldGenerateScenesEventsCode),b.setShouldGenerateScenesEventsCode(n.shouldGenerateScenesEventsCode)),b.setFullLoadingScreen(n.fullLoadingScreen),b.setNativeMobileApp((0,Xe._F)()),b.setGDevelopVersionWithHash((0,je.Us)()),b.setCrashReportUploadLevel(e.props.crashReportUploadLevel),b.setPreviewContext(e.props.previewContext),b.setProjectTemplateSlug(t.getTemplateSlug()),b.setSourceGameId(e.props.sourceGameId),n.inAppTutorialMessageInPreview&&b.setInAppTutorialMessageInPreview(n.inAppTutorialMessageInPreview,n.inAppTutorialMessagePositionInPreview),n.fallbackAuthor&&b.setFallbackAuthor(n.fallbackAuthor.id,n.fallbackAuthor.username),n.authenticatedPlayer&&b.setAuthenticatedPlayer(n.authenticatedPlayer.playerId,n.authenticatedPlayer.playerUsername,n.authenticatedPlayer.playerToken),n.captureOptions&&n.captureOptions.screenshots&&n.captureOptions.screenshots.forEach((function(e){b.addScreenshotCapture(e.delayTimeInSeconds,e.signedUrl,e.publicUrl)})),n.editorCameraState3D&&b.setEditorCameraState3D(n.editorCameraState3D.cameraMode,n.editorCameraState3D.positionX,n.editorCameraState3D.positionY,n.editorCameraState3D.positionZ,n.editorCameraState3D.rotationAngle,n.editorCameraState3D.elevationAngle,n.editorCameraState3D.distance),n.inGameEditorSettings&&b.setInGameEditorSettingsJson(JSON.stringify(n.inGameEditorSettings)),(j=(0,Ve.NC)())&&b.setGDevelopResourceToken(j),console.log("[BrowserSWPreviewLauncher] Exporting project for preview #".concat(f,"...")),v.exportProjectForPixiPreview(b),console.log("[BrowserSWPreviewLauncher] Storing preview files in IndexedDB for preview #".concat(f,"...")),r.next=53,w.applyPendingOperations();case 53:if(n.isForInGameEdition&&(0,qe.qP)({previewIndexHtmlLocation:x+"/index.html"}),!g){r.next=66;break}E=new er.SerializerElement,v.serializeProjectData(t,b,E),P=JSON.parse(er.Serializer.toJSON(E)),E.delete(),Z=new er.SerializerElement,v.serializeRuntimeGameOptions(b,Z),k=JSON.parse(er.Serializer.toJSON(Z)),Z.delete(),n.shouldHardReload?(console.log("[BrowserSWPreviewLauncher] Triggering hard reload for preview #".concat(f,"...")),h.forEach((function(r){e.getPreviewDebuggerServer().sendMessage(r,{command:"hardReload"})}))):(console.log("[BrowserSWPreviewLauncher] Triggering hot reload for preview #".concat(f,"...")),h.forEach((function(r){e.getPreviewDebuggerServer().sendMessage(r,{command:"hotReload",payload:{shouldReloadResources:n.shouldReloadResources,projectData:P,runtimeGameOptions:k}})}))),r.next=73;break;case 66:if(!d){r.next=72;break}n.isForInGameEdition&&(0,qe.qP)({previewIndexHtmlLocation:x+"/index.html"}),console.log("[BrowserSWPreviewLauncher] Opening new preview window(s)..."),d.forEach((function(r){r.location=x+"/index.html";try{r.focus()}catch(o){}var t=Ye(r);Ke.registerCallbacks({onErrorReceived:function(){},onServerStateChanged:function(){},onConnectionClosed:function(){var r=(0,l.Z)((0,u.Z)().mark((function r(o){return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o.id===t){r.next=3;break}return r.abrupt("return");case 3:if(!n.captureOptions){r.next=6;break}return r.next=6,e.props.onCaptureFinished(n.captureOptions);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),onConnectionOpened:function(){},onConnectionErrored:function(){},onHandleParsedMessage:function(){}})})),r.next=73;break;case 72:throw new Error("Internal error: no preview windows to open and no hot reload to trigger.");case 73:b.delete(),v.delete(),console.log("[BrowserSWPreviewLauncher] Preview ".concat(f," launched successfully in ").concat(Math.ceil(Date.now()-p),"ms.")),r.next=82;break;case 78:r.prev=78,r.t1=r.catch(15),console.error("[BrowserSWPreviewLauncher] Error launching preview ".concat(f,":"),r.t1),e.setState({error:r.t1});case 82:case"end":return r.stop()}}),r,null,[[7,12],[15,78]])})));return function(e){return r.apply(this,arguments)}}(),e}return(0,q.Z)(n,[{key:"getPreviewDebuggerServer",value:function(){return Ke}},{key:"render",value:function(){var e=this,r=this.state.error;return r?(0,D.jsx)(ne,{error:r,onClose:function(){return e.setState({error:null})}}):null}}]),n}(o.Component),or=n(45911),ir=n(68151),ar=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ir.SS)({uploadType:"preview",files:r.map((function(e){return{key:e.Key,contentType:e.ContentType}}))});case 2:if(n=e.sent,(t=n.signedUrls).length===r.length){e.next=6;break}throw new Error("Unexpected response from the API (signed urls count is not the same as uploaded objects count).");case 6:return e.next=8,Promise.all(r.map((function(e,r){return F().put(t[r],e.Body,{headers:{"Content-Type":e.ContentType}})})));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),sr=function(){return or.fm.baseUrl},cr=n.g.gd,ur=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},lr=(0,q.Z)((function e(r){var n=this,t=r.filesContent,o=r.prefix,i=r.bucketBaseUrl;(0,X.Z)(this,e),this._pendingUploadObjects=[],this._allCopiedExternalUrls=new Set,this.uploadPendingObjects=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Uploading ".concat(n._pendingUploadObjects.length," files for preview...")),e.next=4,ar(n._pendingUploadObjects);case 4:console.log("Uploaded all ".concat(n._pendingUploadObjects.length," preview files.")),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Can't upload all objects:",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),this.mkDir=function(e){},this.dirExists=function(e){return!0},this.clearDir=function(e){},this.getTempDir=function(){return"/virtual-unused-tmp-dir"},this.fileNameFrom=function(e){return ur(e)?e:m().basename(e)},this.dirNameFrom=function(e){return ur(e)?"":m().dirname(e)},this.makeAbsolute=function(e,r){return ur(e)?e:(n.isAbsolute(r)||(r=m().resolve(r)),ur(r)?r+"/"+e:m().resolve(r,m().normalize(e)))},this.makeRelative=function(e,r){return ur(e)?e:m().relative(r,m().normalize(e))},this.isAbsolute=function(e){return!!ur(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,r){return ur(e)?(n._allCopiedExternalUrls.add(e),!0):(console.warn("Copy not done from",e,"to",r),!0)},this.writeToFile=function(e,r){var t=e.replace(n.bucketBaseUrl,""),o=m().extname(e);return n._pendingUploadObjects.push({Key:t,Body:r,ContentType:{".js":"text/javascript",".html":"text/html"}[o]}),!0},this.readFile=function(e){return n._indexedFilesContent[e]?n._indexedFilesContent[e].text:(console.error("Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,r){r=r.toUpperCase();var t=new cr.VectorString;return n._allCopiedExternalUrls.forEach((function(e){var n=e.toUpperCase();n.indexOf(r)===n.length-r.length&&t.push_back(e)})),t},this.fileExists=function(e){return ur(e),!0},this.prefix=o,this.bucketBaseUrl=i,this._indexedFilesContent={},t.forEach((function(e){n._indexedFilesContent[e.filePath]=e}))})),dr=n(28842),pr=n.g.gd,fr=function(e){(0,Q.Z)(n,e);var r=(0,$.Z)(n);function n(){var e;(0,X.Z)(this,n);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).canDoNetworkPreview=function(){return!1},e.state={error:null},e._prepareExporter=function(){return Pe("preview").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=(0,dr._)(),o=sr()+t,i=new lr({filesContent:n,bucketBaseUrl:sr(),prefix:t}),a=ke()(new pr.AbstractFileSystemJS,i),s=new pr.Exporter(a,r);return s.setCodeOutputDirectory(o),{exporter:s,outputDir:o,browserS3FileSystem:i}}))},e.launchPreview=function(){var r=(0,l.Z)((0,u.Z)().mark((function r(n){var t,o,i,s,c,d,p,f,h,g,m,v,x,w,b,S,y;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=n.project,o=n.sceneName,i=n.externalLayoutName,s=n.eventsBasedObjectType,c=n.eventsBasedObjectVariantName,d=n.numberOfWindows,e.setState({error:null}),p=n.isForInGameEdition?e.getPreviewDebuggerServer().getExistingEmbeddedGameFrameDebuggerIds():e.getPreviewDebuggerServer().getExistingPreviewDebuggerIds(),f=p.length?p[p.length-1]:null,h=n.hotReload&&null!==f,g=h?null==(F=f)?null:Be[F]||null:null,m=g?[g]:Array.from({length:d},(function(){try{return $e(t)}catch(e){return console.error("Unable to open a new preview window - this window will be ignored:",e),null}})).filter(Boolean),r.prev=7,r.next=10,e.getPreviewDebuggerServer().startServer({origin:new URL(sr()).origin});case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(7),console.error("Unable to start the Debugger Server for the preview:",r.t0);case 15:return r.prev=15,r.next=18,e._prepareExporter();case 18:return v=r.sent,x=v.exporter,w=v.outputDir,b=v.browserS3FileSystem,(S=new pr.PreviewExportOptions(t,w)).setLayoutName(o),S.setIsDevelopmentEnvironment(a.ZP.isDev()),S.setIsInGameEdition(n.isForInGameEdition),S.setEditorId(n.editorId||""),i&&S.setExternalLayoutName(i),s&&(S.setEventsBasedObjectType(s),S.setEventsBasedObjectVariantName(c||"")),(0,Xe._F)()?S.useMinimalDebuggerClient():S.useWindowMessageDebuggerClient(),S.setNonRuntimeScriptsCacheBurst(Date.now()),S.setFullLoadingScreen(n.fullLoadingScreen),S.setNativeMobileApp((0,Xe._F)()),S.setGDevelopVersionWithHash((0,je.Us)()),S.setCrashReportUploadLevel(e.props.crashReportUploadLevel),S.setPreviewContext(e.props.previewContext),S.setProjectTemplateSlug(t.getTemplateSlug()),S.setSourceGameId(e.props.sourceGameId),n.inAppTutorialMessageInPreview&&S.setInAppTutorialMessageInPreview(n.inAppTutorialMessageInPreview,n.inAppTutorialMessagePositionInPreview),n.fallbackAuthor&&S.setFallbackAuthor(n.fallbackAuthor.id,n.fallbackAuthor.username),n.authenticatedPlayer&&S.setAuthenticatedPlayer(n.authenticatedPlayer.playerId,n.authenticatedPlayer.playerUsername,n.authenticatedPlayer.playerToken),n.captureOptions&&n.captureOptions.screenshots&&n.captureOptions.screenshots.forEach((function(e){S.addScreenshotCapture(e.delayTimeInSeconds,e.signedUrl,e.publicUrl)})),n.editorCameraState3D&&S.setEditorCameraState3D(n.editorCameraState3D.cameraMode,n.editorCameraState3D.positionX,n.editorCameraState3D.positionY,n.editorCameraState3D.positionZ,n.editorCameraState3D.rotationAngle,n.editorCameraState3D.elevationAngle,n.editorCameraState3D.distance),n.inGameEditorSettings&&S.setInGameEditorSettingsJson(JSON.stringify(n.inGameEditorSettings)),(y=(0,Ve.NC)())&&S.setGDevelopResourceToken(y),x.exportProjectForPixiPreview(S),S.delete(),x.delete(),r.next=51,b.uploadPendingObjects();case 51:n.isForInGameEdition&&(0,qe.qP)({previewIndexHtmlLocation:w+"/index.html"}),m.forEach((function(e){e.location=w+"/index.html";try{e.focus()}catch(r){}})),g||m.forEach((function(r){var t=Ye(r);Ke.registerCallbacks({onErrorReceived:function(){},onServerStateChanged:function(){},onConnectionClosed:function(){var r=(0,l.Z)((0,u.Z)().mark((function r(o){return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o.id===t){r.next=3;break}return r.abrupt("return");case 3:if(!n.captureOptions){r.next=6;break}return r.next=6,e.props.onCaptureFinished(n.captureOptions);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),onConnectionOpened:function(){},onConnectionErrored:function(){},onHandleParsedMessage:function(){}})})),r.next=59;break;case 56:r.prev=56,r.t1=r.catch(15),e.setState({error:r.t1});case 59:case"end":return r.stop()}var F}),r,null,[[7,12],[15,56]])})));return function(e){return r.apply(this,arguments)}}(),e}return(0,q.Z)(n,[{key:"getPreviewDebuggerServer",value:function(){return Ke}},{key:"render",value:function(){var e=this,r=this.state.error;return r?(0,D.jsx)(ne,{error:r,onClose:function(){return e.setState({error:null})}}):null}}]),n}(o.Component),hr=n(10959),gr=n(98775),mr=n.g.gd,vr=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},xr=m().posix||m(),wr=(0,q.Z)((function e(r){var n=this,t=r.textFiles;(0,X.Z)(this,e),this._textFiles={},this._filesToDownload={},this.getAllTextFilesIn=function(e){return Object.keys(n._textFiles).filter((function(r){return 0===r.indexOf(e)})).map((function(e){return{filePath:e,text:n._textFiles[e]}}))},this.getAllUrlFilesIn=function(e){return Object.keys(n._filesToDownload).filter((function(r){return 0===r.indexOf(e)})).map((function(e){return{filePath:e,url:n._filesToDownload[e]}}))},this.mkDir=function(e){return!0},this.dirExists=function(e){return!0},this.clearDir=function(e){return Object.keys(n._textFiles).forEach((function(r){0===r.indexOf(e)&&delete n._textFiles[r]})),!0},this.getTempDir=function(){return"/browser-file-system-tmp-dir"},this.fileNameFrom=function(e){return xr.basename(e)},this.dirNameFrom=function(e){return xr.dirname(e)},this.makeAbsolute=function(e,r){return vr(e)?e:(n.isAbsolute(r)||(r=xr.resolve(r)),vr(r)?r+"/"+e:xr.resolve(r,xr.normalize(e)))},this.makeRelative=function(e,r){return vr(e)?0===e.indexOf(r)?e.substring(r.length):(console.warn("".concat(e," cannot be made relative to ").concat(r,", please double check this behavior is correct.")),e):xr.relative(r,xr.normalize(e))},this.isAbsolute=function(e){return!!vr(e)||e.length>0&&"/"===e.charAt(0)},this.copyFile=function(e,r){if(vr(e))return vr(r)?(console.error("Destination can't be a URL in copyFile (from ".concat(e," to ").concat(r,").")),!1):(n._filesToDownload[xr.normalize(r)]=e,!0);if(n._textFiles[e])return n._textFiles[xr.normalize(r)]=n._textFiles[e],!0;var t=Object.keys(n._filesToDownload).find((function(r){return r===e}));if(t){var o=n._filesToDownload[t];return n._filesToDownload[xr.normalize(r)]=o,!0}return console.error("File not found in copyFile (from ".concat(e," to ").concat(r,").")),!1},this.writeToFile=function(e,r){return n._textFiles[xr.normalize(e)]=r,!0},this.readFile=function(e){return n._textFiles[e]?n._textFiles[e]:(console.error("Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,r){r=r.toUpperCase();var t=new mr.VectorString;return Object.keys(n._filesToDownload).forEach((function(e){var n=e.toUpperCase();n.indexOf(r)===n.length-r.length&&t.push_back(e)})),t},this.fileExists=function(e){if(vr(e))return!0;var r=xr.normalize(e);return!!n._textFiles[r]||!!n._filesToDownload[r]},t.forEach((function(e){n._textFiles[e.filePath]=e.text}))})),br=n(96826),Sr=n(61421),yr=n.g.gd,Fr="browser-online-cordova",jr={name:Fr,onlineBuildType:"cordova-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["androidApk"],keystore:"new",signingDialogOpen:!1}},canLaunchBuild:function(e,r,n){return r||""===n},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,D.jsx)(Sr.s_,(0,t.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,D.jsx)(Sr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Fr}))},prepareExporter:function(e){return Pe("cordova").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new yr.AbstractFileSystemJS,t);return{exporter:new yr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new yr.ExportOptions(a,o);return s.setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,r){return(0,hr.Zi)().then((function(n){return(0,gr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,hr.$C)(a,s.uid,n,e.targets,e.keystore,t,o,i):Promise.reject(new Error("User is not authenticated"))}},Er=n(90078),Pr=n.g.gd,Zr="browser-online-cordova-ios",kr={name:Zr,onlineBuildType:"cordova-ios-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["iosAppStore"],signing:null}},canLaunchBuild:function(e,r,n){return(r||""===n)&&!!e.signing},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,D.jsx)(Er.s_,(0,t.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,D.jsx)(Er.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Zr}))},prepareExporter:function(e){return Pe("cordova").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new Pr.AbstractFileSystemJS,t);return{exporter:new Pr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Pr.ExportOptions(a,o);return s.setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,r){return(0,hr.Zi)().then((function(n){return(0,gr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.profile;return s?e.signing?(0,hr.NZ)(a,s.id,n,e.targets,e.signing,t,o,i):Promise.reject(new Error("Signing options not set up")):Promise.reject(new Error("User is not authenticated"))}},Dr=n(87335),Cr=n.g.gd,Ir="browser-online-electron",Rr={name:Ir,onlineBuildType:"electron-build",limitedBuilds:!0,packageNameWarningType:"desktop",getInitialExportState:function(){return{targets:["winExe"]}},canLaunchBuild:function(e,r,n){return!!e.targets.length&&(r||""===n)},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,D.jsx)(Dr.s_,(0,t.Z)({},e))},renderExportFlow:function(e){return(0,D.jsx)(Dr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Ir}))},prepareExporter:function(e){return Pe("electron").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new Cr.AbstractFileSystemJS,t);return{exporter:new Cr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Cr.ExportOptions(a,o);return s.setTarget("electron"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,r){return(0,hr.Zi)().then((function(n){return(0,gr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,hr.ch)(a,s.uid,n,e.targets,t,o,i):Promise.reject(new Error("User is not authenticated"))}},Nr=n(96516),Tr=n(4615),Br=n.g.gd,Mr="browser-online-web",Ar={name:Mr,onlineBuildType:"web-build",getInitialExportState:function(){return null},canLaunchBuild:function(e,r,n){return r||""===n||"done"===n},isNavigationDisabled:function(e,r){return!r&&!["","done"].includes(e)},renderHeader:function(e){var r=e.uiMode;return(0,D.jsx)(Nr.if,{uiMode:r})},renderExportFlow:function(e){return(0,D.jsx)(Tr.Z,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Mr}))},prepareExporter:function(e){return Pe("web").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new Br.AbstractFileSystemJS,t);return{exporter:new Br.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Br.ExportOptions(a,o);return n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress,sizeLimit:25e7})},launchUpload:function(e,r){return(0,hr.Zi)().then((function(n){return(0,gr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,hr.Bc)(a,s.uid,n,t,o,i):Promise.reject(new Error("User is not authenticated"))}},Or=n(37054),Wr=n(39935),Ur=n.g.gd,Lr="browser-html5",Gr={name:Lr,getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,D.jsx)(Wr.if,{})},renderExportFlow:function(e){return(0,D.jsx)(Wr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Lr}))},prepareExporter:function(e){return Pe("web").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new Ur.AbstractFileSystemJS,t);return{exporter:new Ur.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Ur.ExportOptions(a,o);return n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,D.jsx)(Wr.Eg,{renderGameButton:function(){return(0,D.jsx)(Or.j,{blob:r,children:function(e){return(0,D.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Or.z)(e,"game.zip")},label:(0,D.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},_r=n(76349),zr=n.g.gd,Jr="browser-cordova",Hr={name:Jr,packageNameWarningType:"mobile",getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,D.jsx)(_r.if,{})},renderExportFlow:function(e){return(0,D.jsx)(_r.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Jr}))},prepareExporter:function(e){return Pe("cordova").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new zr.AbstractFileSystemJS,t);return{exporter:new zr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new zr.ExportOptions(a,o);return s.setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,D.jsx)(_r.Eg,{renderGameButton:function(){return(0,D.jsx)(Or.j,{blob:r,children:function(e){return(0,D.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Or.z)(e,"game.zip")},label:(0,D.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},Kr=n(41426),Yr=n.g.gd,Vr="browser-electron",Xr={name:Vr,packageNameWarningType:"desktop",getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,D.jsx)(Kr.if,{})},renderExportFlow:function(e){return(0,D.jsx)(Kr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Vr}))},prepareExporter:function(e){return Pe("electron").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new Yr.AbstractFileSystemJS,t);return{exporter:new Yr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Yr.ExportOptions(a,o);return s.setTarget("electron"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,D.jsx)(Kr.Eg,{renderGameButton:function(){return(0,D.jsx)(Or.j,{blob:r,children:function(e){return(0,D.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Or.z)(e,"game.zip")},label:(0,D.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},qr=n(15745),Qr=n.g.gd,$r="browser-facebook-instant-games",en={name:$r,getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,D.jsx)(qr.if,{})},renderExportFlow:function(e){return(0,D.jsx)(qr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:$r}))},prepareExporter:function(e){return Pe("facebook-instant-games").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new wr({textFiles:n}),o=ke()(new Qr.AbstractFileSystemJS,t);return{exporter:new Qr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Qr.ExportOptions(a,o);return s.setTarget("facebookInstantGames"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,br.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,br.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,D.jsx)(qr.Eg,{renderGameButton:function(){return(0,D.jsx)(Or.j,{blob:r,children:function(e){return(0,D.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Or.z)(e,"fb-instant-game.zip")},label:(0,D.jsx)(p.Trans,{id:"Download the Instant Game archive"})})}})}})}},rn=(0,t.Z)((0,t.Z)({},Nr.O1),{},{exportPipeline:Ar}),nn=[(0,t.Z)((0,t.Z)({},Wr.BN),{},{exportPipeline:Gr}),(0,t.Z)((0,t.Z)({},Sr.Vf),{},{exportPipeline:jr}),(0,t.Z)((0,t.Z)({},Er.Y$),{},{exportPipeline:kr}),(0,t.Z)((0,t.Z)({},Dr.OL),{},{exportPipeline:Rr}),(0,t.Z)((0,t.Z)({},qr.xu),{},{exportPipeline:en})],tn=[(0,t.Z)((0,t.Z)({},Wr.BN),{},{exportPipeline:Gr}),(0,t.Z)((0,t.Z)({},_r.VU),{},{exportPipeline:Hr}),(0,t.Z)((0,t.Z)({},Kr.c8),{},{exportPipeline:Xr})],on=n(23570),an=n(92666),sn=n(29571),cn=n.g.gd,un=[{name:"AdMob",extensionModule:n(94550),objectsRenderingServiceModules:{}},{name:"AdvancedWindow",extensionModule:n(19910),objectsRenderingServiceModules:{}},{name:"FacebookInstantGames",extensionModule:n(64579),objectsRenderingServiceModules:{}},{name:"DeviceSensors",extensionModule:n(89493),objectsRenderingServiceModules:{}},{name:"DeviceVibration",extensionModule:n(27272),objectsRenderingServiceModules:{}},{name:"SaveState",extensionModule:n(51678),objectsRenderingServiceModules:{}},{name:"DebuggerTools",extensionModule:n(37515),objectsRenderingServiceModules:{}},{name:"Physics2",extensionModule:n(30269),objectsRenderingServiceModules:{}},{name:"Physics3D",extensionModule:n(87963),objectsRenderingServiceModules:{}},{name:"ExampleJsExtension",extensionModule:n(97854),objectsRenderingServiceModules:{}},{name:"Tween",extensionModule:n(43386),objectsRenderingServiceModules:{}},{name:"Video",extensionModule:n(24895),objectsRenderingServiceModules:{}},{name:"FileSystem",extensionModule:n(98261),objectsRenderingServiceModules:{}},{name:"Firebase",extensionModule:n(81386),objectsRenderingServiceModules:{}},{name:"Leaderboards",extensionModule:n(92268),objectsRenderingServiceModules:{}},{name:"PlayerAuthentication",extensionModule:n(17681),objectsRenderingServiceModules:{}},{name:"Multiplayer",extensionModule:n(93498),objectsRenderingServiceModules:{}},{name:"DialogueTree",extensionModule:n(99548),objectsRenderingServiceModules:{}},{name:"BBText",extensionModule:n(73118),objectsRenderingServiceModules:{"pixi-multistyle-text/dist/pixi-multistyle-text.umd":n(54505)}},{name:"TileMap",extensionModule:n(24767),objectsRenderingServiceModules:{"pixi-tilemap/dist/pixi-tilemap.umd":n(19477),"helper/TileMapHelper":n(69835),"pako/dist/pako.min":n(53663)}},{name:"Effects",extensionModule:n(44344),objectsRenderingServiceModules:{}},{name:"P2P",extensionModule:n(82240),objectsRenderingServiceModules:{}},{name:"Lighting",extensionModule:n(72025),objectsRenderingServiceModules:{}},{name:"SpatialSound",extensionModule:n(83915),objectsRenderingServiceModules:{}},{name:"BitmapText",extensionModule:n(68722),objectsRenderingServiceModules:{}},{name:"Screenshot",extensionModule:n(93905),objectsRenderingServiceModules:{}},{name:"TextInput",extensionModule:n(88306),objectsRenderingServiceModules:{}},{name:"Scene3D",extensionModule:n(11050),objectsRenderingServiceModules:{}},{name:"SpineObject",extensionModule:n(68708),objectsRenderingServiceModules:{}}];function ln(e){var r=e.objectsEditorService,n=e.objectsRenderingService,t=e.filterExamples;return{loadAllExtensions:function(e){var o=un.filter((function(e){var r=e.name;return!t||!r.includes("Example")})).map((function(t){var o=t.name,i=t.extensionModule,a=t.objectsRenderingServiceModules;if(r&&i.registerEditorConfigurations&&i.registerEditorConfigurations(r),n){if(a)for(var s in a)n.registerModule(s,a[s]);i.registerInstanceRenderers&&i.registerInstanceRenderers(n),i.registerClearCache&&i.registerClearCache(n)}return{extensionModulePath:"internal-extension://"+o,result:(0,on.loadExtension)(e,cn,cn.JsPlatform.get(),i)}})),i=function(e){var r=e.filterExamples;return un.filter((function(e){var n=e.name;return!r||!n.includes("Example")})).length}({filterExamples:t});return Promise.resolve({results:o,expectedNumberOfJSExtensionModulesLoaded:i})}}}var dn=n(91479),pn=n.n(dn),fn=n(71046),hn=n.n(fn),gn=[],mn=hn()((0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,c.Z)(gn),console.info("[BrowserSWEventsFunctionCodeWriter] Storing a batch of ".concat(r.length," extension generated files in IndexedDB...")),gn=[],e.next=5,Promise.allSettled(r.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextEncoder,t=n.encode(r.content).buffer,e.next=4,he(r.path,t,"text/javascript; charset=utf-8");case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 5:e.sent.forEach((function(e,n){var t=r[n];"fulfilled"===e.status?t.onSuccess():(console.error("[BrowserSWEventsFunctionCodeWriter] Failed to store: ".concat(t.path),e.reason),t.onError(e.reason))}));case 7:case"end":return e.stop()}}),e)}))),10),vn=function(e,r){return new Promise((function(n,t){gn.push({path:e,content:r,onSuccess:n,onError:t}),mn()}))},xn=function(e){var r=e.onWriteFile,n=de(),t=function(e){var r=pe();return"".concat(r+"/extensions-code","/").concat(pn()(e),".js")};return{getIncludeFileFor:function(e){return t(e)},writeFunctionCode:function(e,o){var i=t(e);r({includeFile:i,content:o});var a=i.replace(n,"");return vn(a,o)},writeBehaviorCode:function(e,o){var i=t(e);r({includeFile:i,content:o});var a=i.replace(n,"");return vn(a,o)},writeObjectCode:function(e,o){var i=t(e);r({includeFile:i,content:o});var a=i.replace(n,"");return vn(a,o)}}},wn=[],bn=hn()((0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,c.Z)(wn),console.info("Uploading a batch of ".concat(r.length," extension generated files..."),r),wn=[],e.prev=3,e.next=6,ar(r.map((function(e){return e.uploadedObject})));case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),r.forEach((function(r){return r.onError(e.t0)})),e.abrupt("return");case 12:r.forEach((function(e){return e.onSuccess()}));case 13:case"end":return e.stop()}}),e,null,[[3,8]])}))),10),Sn=function(e){return new Promise((function(r,n){wn.push({uploadedObject:e,onSuccess:r,onError:n}),bn()}))},yn=function(e){var r=e.onWriteFile,n=(0,dr._)(),t=function(e){return"".concat(n,"/").concat(pn()(e),".js")};return{getIncludeFileFor:function(e){return sr()+t(e)},writeFunctionCode:function(e,n){var o=t(e);return r({includeFile:o,content:n}),console.log("Uploading function generated code to ".concat(o,"...")),Sn({Key:t(e),Body:n,ContentType:"text/javascript"})},writeBehaviorCode:function(e,n){var o=t(e);return r({includeFile:o,content:n}),console.log("Uploading behavior generated code to ".concat(o,"...")),Sn({Key:t(e),Body:n,ContentType:"text/javascript"})},writeObjectCode:function(e,n){var o=t(e);return r({includeFile:o,content:n}),console.log("Uploading object generated code to ".concat(o,"...")),Sn({Key:t(e),Body:n,ContentType:"text/javascript"})}}},Fn=n(26244),jn=n(56924),En=n(8018),Pn=n(17361),Zn=n(78081),kn=n(41006),Dn=n(51063),Cn=n(85919),In=n(79431),Rn=n.g.gd,Nn="game.json",Tn=m().posix||m(),Bn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.project,t=r.onAddBlobFile,o=r.onProgress,i={erroredResources:[]},a=function(e){var r=e.getResourcesManager();return r.getAllResourceNames().toJSArray().map((function(e){var n,t=r.getResource(e),o=t.getFile();return(n=o).startsWith("http://")||n.startsWith("https://")||n.startsWith("ftp://")||n.startsWith("blob:")||n.startsWith("data:")?(0,Cn.yk)(o)?{resource:t,url:o,filename:(0,Ve.dh)(o)}:null:(i.erroredResources.push({resourceName:t.getName(),error:new Error("Unsupported relative file when downloading a copy.")}),null)})).filter(Boolean)},s=a(n),e.next=6,(0,A.R7)({urlContainers:s,onProgress:function(e,r){o(e,2*r)}});case 6:return c=e.sent,l=new Set([Nn]),c.forEach((function(e){var r=e.item,n=e.error,o=e.blob,a=r.resource,s=r.filename;if(!n&&o){var c=Tn.extname(s),u=Tn.basename(s,c),d="assets/"+a.getKind(),p=(0,In.Z)(u,(function(e){return l.has(Tn.join(d,e+c))})),f=Tn.join(d,p+c);l.add(f),a.setFile(f),t({blob:o,filePath:f})}else i.erroredResources.push({resourceName:a.getName(),error:n||new Error("Unknown error during download.")})})),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();function Mn(e){var r=e.project,n=e.onDone,i=o.useState(null),s=(0,d.Z)(i,2),c=s[0],f=s[1],h=(0,Dn.s)({onDoProcess:o.useCallback((function(e,r){return Bn((0,t.Z)((0,t.Z)({},e),{},{onProgress:r}))}),[])}),g=h.ensureProcessIsDone,m=h.renderProcessDialog;return o.useEffect((function(){return(0,l.Z)((0,u.Z)().mark((function e(){var n,t,o,i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(null),n=Rn.ProjectHelper.createNewGDJSProject(),e.prev=2,t=new Rn.SerializerElement,r.serializeTo(t),n.unserializeFrom(t),t.delete(),o=[],i=[],e.next=11,g({project:n,onAddBlobFile:function(e){o.push(e)}});case 11:return i.push({text:JSON.stringify((0,kn.XH)(n)),filePath:Nn}),e.next=14,(0,br.f)({textFiles:i,blobFiles:o,basePath:"/",onProgress:function(e,r){}});case 14:a=e.sent,f(a),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(2),(0,O.gR)({message:"Unable to save your project because of an internal error.",rawError:e.t0,errorId:"download-file-save-as-dialog-error"}),e.abrupt("return");case 22:return e.prev=22,n.delete(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,18,22,25]])})))(),function(){return f(null)}}),[r,g]),(0,D.jsxs)(Z.ZP,{title:(0,D.jsx)(p.Trans,{id:"Download a copy"}),actions:[(0,D.jsx)(ee.Z,{label:(0,D.jsx)(p.Trans,{id:"Download GDevelop desktop version"}),primary:!1,onClick:function(){return a.ZP.openExternalURL("http://gdevelop.io")}},"download"),(0,D.jsx)(ee.Z,{label:(0,D.jsx)(p.Trans,{id:"Close"}),primary:!1,onClick:n},"close")],onRequestClose:n,open:!0,maxWidth:"sm",children:[(0,D.jsxs)(x.ak,{noMargin:!0,children:[(0,D.jsx)(re.Z,{children:(0,D.jsx)(p.Trans,{id:"You can download the file of your game to continue working on it using the full GDevelop version:"})}),(0,D.jsx)(v.x1,{noMargin:!0,expand:!0,justifyContent:"center",children:c?(0,D.jsx)(Or.j,{blob:c,children:function(e){return(0,D.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Or.z)(e,"gdevelop-game.zip")},label:(0,D.jsx)(p.Trans,{id:"Download the compressed game and resources"})})}}):(0,D.jsx)(Zn.Z,{})})]}),m()]})}var An,On,Wn={internalName:"DownloadFile",name:{id:"Download a copy"},renderIcon:function(e){return(0,D.jsx)(Pn.Z,{fontSize:e.size})},hiddenInOpenDialog:!0,createOperations:function(e){var r=e.setDialog,n=e.closeDialog;return{onSaveProjectAs:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,o,i){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.onStartSaving(),e.abrupt("return",new Promise((function(e){r((function(){return(0,D.jsx)(Mn,{onDone:function(){n(),e({wasSaved:!1,fileMetadata:null})},project:t})}))})));case 2:case"end":return e.stop()}}),e)})));return function(r,n,t){return e.apply(this,arguments)}}()}}},Un=n(71799),Ln=n(10822),Gn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{erroredResources:[]});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_n=(An={},(0,N.Z)(An,"".concat(Un.Z.internalName,"=>").concat(Un.Z.internalName),Ln.G),(0,N.Z)(An,"".concat(En.Z.internalName,"=>").concat(Un.Z.internalName),Ln.G),(0,N.Z)(An,"".concat(Un.Z.internalName,"=>").concat(Wn.internalName),Gn),(0,N.Z)(An,"".concat(En.Z.internalName,"=>").concat(Wn.internalName),Gn),An),zn={moveAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.oldStorageProvider,t=r.newStorageProvider,o=_n["".concat(n.internalName,"=>").concat(t.internalName)]){e.next=4;break}throw new Error("Can't find a ResourceMover for ".concat(n.internalName," to ").concat(t.internalName,"."));case 4:return e.abrupt("return",o(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},Jn=zn,Hn=n(527),Kn=n(58271),Yn=(On={},(0,N.Z)(On,Un.Z.internalName,Hn.f),(0,N.Z)(On,En.Z.internalName,Kn.j),On),Vn={fetchAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.storageProvider,t=Yn[n.internalName]){e.next=4;break}throw new Error("Can't find a ResourceFetcher for ".concat(n.internalName," - have you registered the storage provider here?"));case 4:return e.abrupt("return",t(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},Xn=Vn,qn=(0,q.Z)((function e(){(0,X.Z)(this,e)}));qn.chooseEventsFunctionExtensionFile=function(){return new Promise((function(e){if(window.showOpenFilePicker)window.showOpenFilePicker({types:[{description:"GDevelop Extension",accept:{"application/json":[".json"]}}],excludeAcceptAllOption:!0,multiple:!0}).then((function(r){if(!r)return e([]);e(Promise.all(r.map((function(e){return e.getFile()}))))})).catch((function(){e([])}));else{var r=document.createElement("input");r.type="file",r.multiple=!0,r.accept="application/json,.json",r.onchange=function(r){return e(r.target.files)};var n=function n(){document.body&&document.body.removeEventListener("pointermove",n),r.files.length||e([])};window.addEventListener("focus",(function e(){window.removeEventListener("focus",e),document.body&&document.body.addEventListener("pointermove",n)})),r.click()}}))},qn.readEventsFunctionExtensionFile=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r instanceof File){e.next=3;break}throw console.error("Given file is not a JS File object. Instead it is:",{file:r}),new Error("Given file is not a JS File object.");case 3:return e.prev=3,e.next=6,r.text();case 6:return n=e.sent,e.abrupt("return",JSON.parse(n));case 10:throw e.prev=10,e.t0=e.catch(3),console.error("An error occurred when parsing the file content: ",{error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(r){return e.apply(this,arguments)}}();var Qn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,n){var t,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),(i=document.createElement("a")).href=o,i.download=r,!document.body){e.next=11;break}document.body.appendChild(i),i.click(),i.remove(),e.next=12;break;case 11:throw new Error("Document body couldn't be found.");case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}(),$n=(0,q.Z)((function e(){(0,X.Z)(this,e)}));$n.chooseEventsFunctionExtensionFile=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r);case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),$n.writeSerializedObject=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Qn(n,JSON.stringify(r,null,2));case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),console.error("Unable to write the events function extension:",e.t0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(r,n){return e.apply(this,arguments)}}();var et=n(71445),rt=n(1333),nt=a.ZP.isDev(),tt=function(){function e(r){(0,X.Z)(this,e),this.auth=r}return(0,q.Z)(e,[{key:"loginWithEmailAndPassword",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.email,t=r.password,e.prev=1,e.next=4,(0,et.e5)(this.auth,n,t);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Error while login:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(r){return e.apply(this,arguments)}}()},{key:"loginOrSignupWithProvider",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.provider,!(t=r.signal)||!t.aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Login or Signup with provider already aborted.")));case 3:return o=new Promise((function(e,r){t&&t.addEventListener("abort",(function(){(0,rt.g)(),r(new Error("Login or Signup with provider aborted."))}));var o=window.screenX+window.innerWidth/2-200,a=window.screenY+window.innerHeight/2-300,s=window.open("about:blank",null,"width=".concat(400,",height=").concat(600,",left=").concat(o,",top=").concat(a));s.document.write("<style>body { margin: 0; }</style><div style=\"height: 100vh; display: flex; justify-content: center; align-items: center; color: #F5F5F7; background-color: #25252E; font-family: 'Verdana', 'Fira Sans', 'Open Sans', 'Lucida Sans'; font-size: 20px\">Loading</div>"),(0,rt.T)({onConnectionEstablished:function(e){if(!t||!t.aborted){var r=new URL("https://auth.gdevelop.io");if(r.searchParams.set("connection-id",e),r.searchParams.set("provider",n),r.searchParams.set("env",nt?"dev":"live"),!s)throw new Error("Popup could not be found.");s.location=r.toString()}},onTokenReceived:function(){var n=(0,l.Z)((0,u.Z)().mark((function n(o){var a,c,l;return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=o.provider,c=o.data,!t||!t.aborted){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,l="google"===a?et.hJ.credential(c.credential):"github"===a?et.GH.credential(c.accessToken):new et.O4("apple.com").credential({idToken:c.id_token,nonce:c.raw_nonce}),n.next=7,(0,et.sB)(i.auth,l);case 7:s&&s.close(),e(),(0,rt.g)(),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(3),console.error("An error occurred while logging in with ".concat(a," token:"),n.t0),r(n.t0);case 16:case"end":return n.stop()}}),n,null,[[3,12]])})));return function(e){return n.apply(this,arguments)}}(),onError:function(e){t&&t.aborted||((0,rt.g)(),console.error("An error occurred while setting up authentication web socket:",e),r(new Error("An error occurred while setting up authentication web socket.")))},onTimeout:function(){t&&t.aborted||((0,rt.g)(),console.error("Connection to authorization websocket timed out."),r(new Error("Connection to authorization websocket timed out.")))}})})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}]),e}(),ot=tt,it=n(96106),at=function(e){a.ZP.setUpContextMenu();var r=new ot(e.auth);e.setLoginProvider(r);var n=a.ZP.getArguments(),o=(0,it.P)();return o&&be(),(0,D.jsx)(Fn.Z,{authentication:e,disableCheckForUpdates:!!n["disable-update-check"],makeEventsFunctionCodeWriter:o?xn:yn,eventsFunctionsExtensionWriter:$n,eventsFunctionsExtensionOpener:qn,children:function(e){var r=e.i18n;return(0,D.jsx)(jn.Z,{appArguments:n,storageProviders:[En.Z,Un.Z,Wn],defaultStorageProvider:En.Z,children:function(e){var c=e.getStorageProviderOperations,u=e.getStorageProviderResourceOperations,l=e.storageProviders,d=e.initialFileMetadataToOpen,p=e.getStorageProvider;return(0,D.jsx)(i.Z,{i18n:r,renderPreviewLauncher:function(e,r){return o?(0,D.jsx)(tr,(0,t.Z)((0,t.Z)({},e),{},{ref:r})):(0,D.jsx)(fr,(0,t.Z)((0,t.Z)({},e),{},{ref:r}))},renderShareDialog:function(e){return(0,D.jsx)(s.Z,{project:e.project,onSaveProject:e.onSaveProject,isSavingProject:e.isSavingProject,onChangeSubscription:e.onChangeSubscription,onClose:e.onClose,automatedExporters:nn,manualExporters:tn,onlineWebExporter:rn,allExportersRequireOnline:!0,fileMetadata:e.fileMetadata,storageProvider:e.storageProvider,initialTab:e.initialTab,gamesList:e.gamesList})},quickPublishOnlineWebExporter:rn,storageProviders:l,resourceMover:Jn,resourceFetcher:Xn,getStorageProviderOperations:c,getStorageProviderResourceOperations:u,getStorageProvider:p,resourceSources:R,resourceExternalEditors:V,extensionsLoader:ln({objectsEditorService:an.Z,objectsRenderingService:sn.Z,filterExamples:!a.ZP.isDev()}),initialFileMetadataToOpen:d,initialExampleSlugToOpen:n["create-from-example"]||null})}})}})}}}]);
//# sourceMappingURL=browser-app.c7d00b44.chunk.js.map