"use strict";(self.webpackChunkgdevelop_ide=self.webpackChunkgdevelop_ide||[]).push([[7237],{4638:function(e,r,n){n.r(r),n.d(r,{create:function(){return Yn}});var t=n(1413),o=n(28381),i=n(63330),a=n(2066),s=n(36043),c=(n(94492),n(13778),n(93433)),u=n(74165),l=n(15861),d=n(29439),p=n(36600),f=n(17037),h=n(7660),x=n(70983),g=n.n(x),v=n(40243),m=n(61325),w=n(60022),b=n(42986),S=n(68009),y=n(14446),j=n.n(y),F=n(38092),P=n(15684),Z=n(84140),E=n(1773),k=n(52716),C=n(29343),D=function(e){var r=e.options,n=e.selectedResourceIndex,t=e.onSelectResource;if(!t)return null;var o=r.resourceKind;return f.xz.includes(o)?(0,C.jsx)(h.L,{selectedResourceIndex:n,onSelectResource:t,resourceKind:o}):null},R=function(e){var r=e.options,n=e.onChooseResources,t=e.createNewResource,i=o.useState(""),a=(0,d.Z)(i,2),s=a[0],c=a[1],f=o.useState(null),h=(0,d.Z)(f,2),x=h[0],y=h[1],P=o.useState([]),Z=(0,d.Z)(P,2),E=Z[0],k=Z[1],D=!!E.filter(Boolean).length,R=(0,S.N)(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(n){var t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.multiSelection?n.split("\n").filter(Boolean):[n],y(null),k([]),e.prev=3,e.next=6,Promise.all(t.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j().get(r,{timeout:1e3,validateStatus:function(e){return!0}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 6:o=e.sent,k(o.map((function(e){return!(e.status>=200&&e.status<400)}))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),y(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(r){return e.apply(this,arguments)}}(),500);return o.useEffect((function(){R(s)}),[s,R]),(0,C.jsxs)(m.ak,{noMargin:!0,expand:!0,children:[(0,C.jsx)(v.x1,{noMargin:!0,children:(0,C.jsx)(m.ad,{renderButton:function(e){return(0,C.jsx)(w.Z,{onClick:function(){if(n&&t){var e=r.multiSelection?s.split("\n").filter(Boolean):[s];n(e.map((function(e){var r=t();return r.setFile(e),r.setName(g().basename(e)),r.setOrigin("url",e),r})))}},primary:!0,label:(0,C.jsx)(p.Trans,{id:"Choose"}),style:e,disabled:!!x||D})},renderTextField:function(){return(0,C.jsx)(b.Z,{floatingLabelText:r.multiSelection?(0,C.jsx)(p.Trans,{id:"Resource(s) URL(s) (one per line)"}):(0,C.jsx)(p.Trans,{id:"Resource URL"}),value:s,onChange:c,multiline:r.multiSelection,rows:1,rowsMax:5,fullWidth:!0,errorText:x?(0,C.jsx)(p.Trans,{id:"There was an error verifying the URL(s). Please check they are correct."}):D?(0,C.jsx)(p.Trans,{id:"Unable to verify URLs {0} . Please check they are correct.",values:{0:E.map((function(e,r){return e?"#"+(r+1):null})).filter(Boolean).join(", ")}}):null})}})}),(0,C.jsx)(F.Z,{kind:"warning",children:(0,C.jsx)(p.Trans,{id:"The URLs must be public and stay accessible while you work on this project - they won't be stored inside the project file. When exporting a game, the resources pointed by these URLs will be downloaded and stored inside the game."})})]})},N=[].concat((0,c.Z)(f.QP.map((function(e){var r=e.kind,n=e.createNewResource,t="upload-".concat(r);return{name:t,displayName:{id:"File(s) from your device"},displayTab:"import",shouldCreateResource:!0,shouldGuessAnimationsFromName:!0,kind:r,renderComponent:function(e){return(0,C.jsx)(P.V,{createNewResource:n,onChooseResources:function(r){return e.onChooseResources({selectedResources:r,selectedSourceName:t})},options:e.options,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,automaticallyOpenInput:!!e.automaticallyOpenIfPossible},"url-chooser-".concat(r))}}}))),(0,c.Z)(f.xz.map((function(e){var r=f.QP.find((function(r){return r.kind===e}));if(!r)return null;var n="resource-store-".concat(e);return{name:n,displayName:{id:"Choose from asset store"},displayTab:"standalone",shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,kind:e,renderComponent:function(r){return(0,C.jsx)(D,{selectedResourceIndex:r.selectedResourceIndex,onSelectResource:r.onSelectResource,options:r.options},"resource-store-".concat(e))},renderPrimaryAction:function(t){var o=t.resource,i=t.onChooseResources;return(0,C.jsx)(E.v,{primary:!0,label:"font"===e?(0,C.jsx)(p.Trans,{id:"Install font"}):(0,C.jsx)(p.Trans,{id:"Add to project"}),disabled:!o,onClick:function(){if(o){var e=o.url,t=r.createNewResource();t.setFile(e);var a=(0,Z.d0)(e)?(0,Z.Lj)(e):g().basename(e);t.setName(a),t.setOrigin("gdevelop-asset-store",e),i({selectedResources:[t],selectedSourceName:n})}}},"add-resource")}}})).filter(Boolean)),(0,c.Z)(f.QP.map((function(e){var r=e.kind,n=(e.createNewResource,"project-resources-".concat(r));return{name:n,displayName:{id:"Project resources"},displayTab:"standalone",shouldCreateResource:!1,shouldGuessAnimationsFromName:!1,hideInResourceEditor:!0,kind:r,renderComponent:function(e){return(0,C.jsx)(k.Z,{project:e.project,onResourcesSelected:e.onResourcesSelected,resourceKind:r,multiSelection:e.options.multiSelection},"project-resources-".concat(r))},renderPrimaryAction:function(e){var r=e.selectedResources,t=e.onChooseResources;return(0,C.jsx)(E.v,{primary:!0,label:r&&r.length&&1!==r.length?(0,C.jsx)(p.Trans,{id:"Select {0} resources",values:{0:r.length}}):(0,C.jsx)(p.Trans,{id:"Select resource"}),disabled:!r||!r.length,onClick:function(){r&&r.length&&t({selectedResources:r,selectedSourceName:n})}},"select-resources")}}}))),(0,c.Z)(f.QP.map((function(e){var r=e.kind,n=e.createNewResource,t="url-chooser-".concat(r);return{name:t,displayName:{id:"Use a public URL"},displayTab:"import-advanced",shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,kind:r,renderComponent:function(e){return(0,C.jsx)(R,{createNewResource:n,onChooseResources:function(r){return e.onChooseResources({selectedResources:r,selectedSourceName:t})},options:e.options},"url-chooser-".concat(r))}}})))),I=n(4942),T=n(32705),B=n(75333),M=n(57974),A=n(81303),U=n(30141),W=function(e){e.document.write('<html>\n  <head>\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n        background-color: #000000;\n        overflow: hidden;\n        height: 100vh;\n        width: 100%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n      }\n      @keyframes spin {\n        100% {\n          transform:rotate(360deg);\n        }\n      }\n      .spinning-loader {\n        animation: spin 3s linear infinite;\n      }\n    </style>\n  </head>\n  <body>\n      <img class="spinning-loader" width="50" alt="Loading..." src="'.concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CjxjaXJjbGUgb3BhY2l0eT0nMC4yNScgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iNCI+PC9jaXJjbGU+CjxwYXRoIG9wYWNpdHk9JzAuNzUnIGZpbGw9IiNGRkZGRkYiIGQ9Ik00IDEyYTggOCAwIDAxOC04VjBDNS4zNzMgMCAwIDUuMzczIDAgMTJoNHptMiA1LjI5MUE3Ljk2MiA3Ljk2MiAwIDAxNCAxMkgwYzAgMy4wNDIgMS4xMzUgNS44MjQgMyA3LjkzOGwzLTIuNjQ3eiI+PC9wYXRoPgo8L3N2Zz4=",'">\n  </body>\n</html>'))},O=n(23236),L=0,_={piskel:"external/piskel/piskel-index.html",yarn:"external/yarn/yarn-index.html",jfxr:"external/jfxr/jfxr-index.html"},G=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.externalEditorWindow,t=r.externalEditorName,o=r.externalEditorInput,!(i=r.signal).aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new O.s("")));case 3:return e.abrupt("return",new Promise((function(e,r){var a=!1,s=!1,c=null,u=function(e){if(e.source===n)if(e.data&&"object"===typeof e.data){var r=e.data,i=r.id,s=r.payload;"external-editor-ready"===i?(console.info('External editor "'.concat(t,'" ready.')),a=!0,n.addEventListener("unload",(function(){l()})),n.postMessage({id:"open-external-editor-input",payload:o},window.location.origin)):"save-external-editor-output"===i?(console.info('Received data from external editor "'.concat(t,'."')),c=s):"close"===e.data.id&&(n.close(),l())}else console.warn("Ignoring malformed message data from the external editor window.")};window.addEventListener("message",u);var l=function(){s||(s=!0,console.info('External editor "'.concat(t,'" closed.')),window.removeEventListener("message",u),e(c))};i.addEventListener("abort",(function(){r(new O.s("")),s||(n.close(),l())})),n.addEventListener("load",(function(){console.info('External editor "'.concat(t,'" loaded.')),a=!0,n.addEventListener("unload",(function(){l()}))})),n.location=_[t],setTimeout((function(){a||s||(console.info('External editor "'.concat(t,' not loaded after 10 seconds - closing its window."')),n.close(),l())}),1e4)})));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),z=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.project,t=r.resourceNames,o=[],i=n.getResourcesManager(),t.forEach((function(e){if(i.hasResource(e)){var r=i.getResource(e).getFile();(0,M.PX)(r)?(0,M.Gu)(r)?console.error("Unsupported blob URL for a resource - ignoring it."):o.push({url:r,resourceName:e}):console.error("Unsupported local file for a resource - ignoring it.")}})),e.next=6,(0,A.R7)({urlContainers:o,onProgress:function(e,r){}});case 6:return a=e.sent,s=new Map,e.next=10,Promise.all(a.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.error,n=r.blob,t=r.item,!n){e.next=15;break}return e.prev=2,e.t0=s,e.t1=t.resourceName,e.next=7,(0,A.oT)(n);case 7:e.t2=e.sent,e.t3={dataUrl:e.t2},e.t0.set.call(e.t0,e.t1,e.t3),e.next=15;break;case 12:e.prev=12,e.t4=e.catch(2),console.error('Unable to read data from resource "'.concat(t.resourceName,'" - ignoring it.'),e.t4);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(r){return e.apply(this,arguments)}}()));case 10:return e.abrupt("return",t.map((function(e){var r=s.get(e);if(!r)return{name:e,dataUrl:""};var n=r.localFilePath;return{name:e,dataUrl:r.dataUrl,localFilePath:n}})));case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),J=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l,d,p,f,h,x,g;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.externalEditorName,t=r.externalEditorWindow,o=r.defaultName,i=r.metadataKey,a=r.resourceKind,s=r.options,c=s.project,l=s.resourceNames,d=s.resourceManagementProps,p=s.signal,e.next=4,z({project:c,resourceNames:l});case 4:return f=e.sent,h={singleFrame:s.extraOptions.singleFrame,externalEditorData:(0,T.Z2)(i,s.extraOptions.existingMetadata),fps:s.extraOptions.fps,isLooping:s.extraOptions.isLooping,name:s.extraOptions.name||l[0]||o,resources:f},(0,B.sY)(n),e.next=9,G({externalEditorWindow:t,externalEditorName:n,externalEditorInput:h,signal:p});case 9:if(x=e.sent){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,(0,T.Zv)({baseNameForNewResources:x.baseNameForNewResources,project:c,resources:x.resources,resourceKind:a});case 14:return g=e.sent,e.prev=15,e.next=18,d.onFetchNewlyAddedResources();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),console.error("An error happened while fetching the newly added resources:",e.t0);case 23:return(0,T.$N)({modifiedResources:g,metadataKey:i,metadata:s.extraOptions.singleFrame?x.externalEditorData:null}),(0,T.TD)(g.map((function(e){return e.resource.getName()})),x.externalEditorData),e.abrupt("return",{resources:g.map((function(e){var r=e.resource,n=e.originalIndex;return{name:r.getName(),originalIndex:n}})),newName:x.baseNameForNewResources,newMetadata:(0,I.Z)({},i,x.externalEditorData)});case 26:case"end":return e.stop()}}),e,null,[[15,20]])})));return function(r){return e.apply(this,arguments)}}(),H={id:"You need to save this project as a cloud project to install this asset. Please save your project and try again."},K=function(){var e="GDevelopExternalEditor"+L++,r=window.screenX+window.innerWidth/2-400,n=window.screenY+window.innerHeight/2-300,t=window.open("about:blank",e,"width=".concat(800,",height=").concat(600,",left=").concat(r,",top=").concat(n));if(!t)throw new Error("Can't open the external editor because of browser restrictions.");return W(t),t},Y=[{name:"piskel-app",createDisplayName:{id:"Create with Piskel"},editDisplayName:{id:"Edit with Piskel"},kind:"image",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===r.getStorageProvider().internalName){e.next=4;break}return n=r.i18n,(0,U.T4)(n._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return t=K(),e.next=7,J({options:r,externalEditorWindow:t,externalEditorName:"piskel",defaultName:"New image",metadataKey:"pskl",resourceKind:"image"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"jfxr-app",createDisplayName:{id:"Create with Jfxr"},editDisplayName:{id:"Edit with Jfxr"},kind:"audio",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===r.getStorageProvider().internalName){e.next=4;break}return n=r.i18n,(0,U.T4)(n._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return t=K(),e.next=7,J({options:r,externalEditorWindow:t,externalEditorName:"jfxr",defaultName:"New sound effect",metadataKey:"jfxr",resourceKind:"audio"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"yarn-app",createDisplayName:{id:"Create with Yarn"},editDisplayName:{id:"Edit with Yarn"},kind:"json",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Cloud"===r.getStorageProvider().internalName){e.next=4;break}return n=r.i18n,(0,U.T4)(n._(H),{delayToNextTick:!0}),e.abrupt("return",null);case 4:return t=K(),e.next=7,J({options:r,externalEditorWindow:t,externalEditorName:"yarn",defaultName:"New dialogue tree",metadataKey:"yarn",resourceKind:"json"});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}],V=Y,X=n(15671),q=n(43144),Q=n(60136),$=n(29388),ee=n(67835),re=n(86278),ne=function(e){(0,Q.Z)(n,e);var r=(0,$.Z)(n);function n(){return(0,X.Z)(this,n),r.apply(this,arguments)}return(0,q.Z)(n,[{key:"render",value:function(){var e=this.props,r=e.error,n=e.onClose;return(0,C.jsx)(p.I18n,{children:function(e){e.i18n;return(0,C.jsxs)(E.Z,{title:(0,C.jsx)(p.Trans,{id:"Could not launch the preview"}),actions:[(0,C.jsx)(ee.Z,{label:(0,C.jsx)(p.Trans,{id:"Close"}),onClick:n},"close")],onRequestClose:n,open:!0,children:[(0,C.jsx)(v.x1,{children:(0,C.jsx)(v.sg,{noMargin:!0,children:(0,C.jsx)(re.Z,{children:"NetworkingError"===r.code?(0,C.jsx)(p.Trans,{id:"The preview could not be launched because you're offline."}):(0,C.jsx)(p.Trans,{id:"The preview could not be launched because an error happened: {0}.",values:{0:r.message}})})})}),(0,C.jsx)(v.x1,{children:(0,C.jsx)(v.sg,{noMargin:!0,children:(0,C.jsx)(re.Z,{children:(0,C.jsx)(p.Trans,{id:"Make sure you're online, have a proper internet connection and try again. If you download and use GDevelop desktop application, you can also run previews without any internet connection."})})})})]})}})}}]),n}(o.Component),te="files",oe="instances",ie=null,ae=null,se=null,ce=null,ue=function(e){return new Promise((function(r,n){e.onsuccess=function(){return r(e.result)},e.onerror=function(){var r=e.error||new Error("Request failed");n(r)}}))},le=function(e){return new Promise((function(r,n){e.oncomplete=function(){return r()},e.onerror=function(){var r=e.error||new Error("Transaction failed");n(r)},e.onabort=function(){var r=e.error||new Error("Transaction aborted");n(r)}}))},de=function(){var e=window.location.origin;return"".concat(e,"/browser_sw_preview")},pe=function(){if(!ae)throw new Error("Browser SW preview instance not initialised. Call ensureBrowserSWPreviewSession() first.");return"".concat(de(),"/").concat(ae)},fe=function(){return ie&&2===ie.version?Promise.resolve(ie):new Promise((function(e,r){try{var n=indexedDB.open("gdevelop-browser-sw-preview",2);n.onerror=function(){var e=n.error||new Error("Failed to open IndexedDB");console.error("[BrowserSWIndexedDB] Error opening database:",e),r(e)},n.onsuccess=function(){ie=n.result,console.log("[BrowserSWIndexedDB] Database opened successfully"),ie.onclose=function(){console.warn("[BrowserSWIndexedDB] Database connection closed unexpectedly"),ie=null},ie.onversionchange=function(){console.warn("[BrowserSWIndexedDB] Database version changed, closing connection"),ie&&(ie.close(),ie=null)},e(ie)},n.onupgradeneeded=function(e){console.log("[BrowserSWIndexedDB] Upgrading database schema...");var r=n.result;r.objectStoreNames.contains(te)||(r.createObjectStore(te),console.log("[BrowserSWIndexedDB] Created object store:",te)),r.objectStoreNames.contains(oe)||(r.createObjectStore(oe),console.log("[BrowserSWIndexedDB] Created object store:",oe))},n.onblocked=function(){console.warn("[BrowserSWIndexedDB] Database upgrade blocked by another connection"),r(new Error("Database upgrade blocked. Please close other tabs using this application."))}}catch(t){console.error("[BrowserSWIndexedDB] Exception while opening database:",t),r(t)}}))},he=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,n,t){var o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe();case 3:return o=e.sent,e.abrupt("return",new Promise((function(e,i){try{var a=o.transaction(te,"readwrite");a.onerror=function(){var e=a.error||new Error("Transaction failed");console.error("[BrowserSWIndexedDB] Transaction error while putting file:",r,e),i(e)},a.onabort=function(){var e=a.error||new Error("Transaction aborted");console.error("[BrowserSWIndexedDB] Transaction aborted while putting file:",r,e),i(e)},a.oncomplete=function(){e()};var s=a.objectStore(te),c={bytes:n,contentType:t},u=s.put(c,r);u.onerror=function(){var e=u.error||new Error("Put operation failed");console.error("[BrowserSWIndexedDB] Error storing file:",r,e),i(e)}}catch(l){console.error("[BrowserSWIndexedDB] Exception during put operation:",r,l),i(l)}})));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("[BrowserSWIndexedDB] Failed to put file:",r,e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,n,t){return e.apply(this,arguments)}}(),xe=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe();case 3:return n=e.sent,e.abrupt("return",new Promise((function(e,t){try{var o=n.transaction(te,"readwrite"),i=0;o.onerror=function(){var e=o.error||new Error("Transaction failed");console.error("[BrowserSWIndexedDB] Transaction error while deleting files with prefix:",r,e),t(e)},o.oncomplete=function(){e(i)};var a=o.objectStore(te).openCursor();a.onsuccess=function(e){var n=e.target.result;if(n){var t=n.key;"string"===typeof t&&t.startsWith(r)&&(n.delete(),i++),n.continue()}},a.onerror=function(){var e=a.error||new Error("Cursor operation failed");console.error("[BrowserSWIndexedDB] Error during cursor operation:",e),t(e)}}catch(s){console.error("[BrowserSWIndexedDB] Exception during delete with prefix:",r,s),t(s)}})));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("[BrowserSWIndexedDB] Failed to delete files with prefix:",r,e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r){return e.apply(this,arguments)}}(),ge=function(e){for(var r=new Set(e),n=1;r.has(n);)n++;return n},ve=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l,p,f,h,x,g,v,m,w;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe();case 2:return n=e.sent,t=Date.now(),o=[],i=null,a=n.transaction(oe,"readwrite"),s=a.objectStore(oe),e.next=10,Promise.all([ue(s.getAllKeys()),ue(s.getAll())]);case 10:return c=e.sent,l=(0,d.Z)(c,2),p=l[0],f=l[1],h=[],p.forEach((function(e,r){if("string"===typeof e){var n=f[r],i=n&&"number"===typeof n.lastUsed?n.lastUsed:0;if(t-i>216e5)o.push(e);else{var a=parseInt(e,10);isNaN(a)||h.push(a)}}})),x=ge(h),i=String(x),s.put({lastUsed:t},i),e.next=21,le(a);case 21:g=0,v=o;case 22:if(!(g<v.length)){e.next=41;break}return m=v[g],e.prev=24,console.log("[BrowserSWIndexedDB] Cleaning up expired instance #".concat(m," files...")),e.next=28,r(m);case 28:return w=n.transaction(oe,"readwrite"),w.objectStore(oe).delete(m),e.next=33,le(w);case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(24),console.error("[BrowserSWIndexedDB] Failed to clean up expired instance, keeping instance record:",m,e.t0);case 38:g++,e.next=22;break;case 41:return e.abrupt("return",i);case 42:case"end":return e.stop()}}),e,null,[[24,35]])})));return function(r){return e.apply(this,arguments)}}(),me=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fe();case 3:return n=e.sent,t=n.transaction(oe,"readwrite"),t.objectStore(oe).put({lastUsed:Date.now()},r),e.next=9,le(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("[BrowserSWIndexedDB] Failed to update instance heartbeat:",r,e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(r){return e.apply(this,arguments)}}(),we=function(e){ce&&clearInterval(ce);ce=setInterval((function(){me(e)}),6e4)},be=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae){e.next=2;break}return e.abrupt("return");case 2:if(!se){e.next=4;break}return e.abrupt("return",se);case 4:return console.info("[BrowserSWIndexedDB] Acquiring a Browser SW preview instance..."),se=(0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ve(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe("/".concat(r,"/"));case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());case 3:if(r=e.sent){e.next=6;break}throw new Error("Unable to acquire a Browser SW preview instance identifier");case 6:console.info("This session is now using the Browser SW preview instance #".concat(r,".")),ae=r,we(r),e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(0),ae=null,console.error("[BrowserSWIndexedDB] Failed to initialise Browser SW preview session:",e.t0),e.t0;case 16:return e.prev=16,se=null,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,11,16,19]])})))(),e.abrupt("return",se);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Se=n.g.gd,ye=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},je=(0,q.Z)((function e(r){var n=this,t=r.filesContent,o=r.rootUrl;(0,X.Z)(this,e),this._pendingFiles=[],this._pendingDeleteOperations=[],this._allCopiedExternalUrls=new Set,this.applyPendingOperations=(0,l.Z)((0,u.Z)().mark((function e(){var r,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(n._pendingDeleteOperations);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("[BrowserSWFileSystem] Error while deleting files in IndexedDB. Ignoring.",e.t0);case 8:return e.prev=8,console.log("[BrowserSWFileSystem] Storing ".concat(n._pendingFiles.length," files in IndexedDB for preview...")),r=0,t=n._pendingFiles.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(n){var t,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="/".concat(n.path),o=new TextEncoder,i=o.encode(n.content).buffer,r+=i.byteLength,e.next=6,he(t,i,n.contentType);case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),e.next=14,Promise.all(t);case 14:console.log("[BrowserSWFileSystem] Successfully stored all ".concat(n._pendingFiles.length," preview files in IndexedDB (").concat(Math.ceil(r/1e3)," kB).")),e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(8),console.error("[BrowserSWFileSystem] Can't store all files in IndexedDB:",e.t1),e.t1;case 21:case"end":return e.stop()}}),e,null,[[0,5],[8,17]])}))),this.mkDir=function(e){},this.dirExists=function(e){return!0},this.clearDir=function(e){console.info("[BrowserSWFileSystem] Clearing directory: ".concat(e,"..."));var r=e.replace(n.rootUrl,""),t=r.startsWith("/")?r:"/".concat(r),o=t.endsWith("/")?t:"".concat(t,"/");n._pendingDeleteOperations.push(xe(o))},this.getTempDir=function(){return"/virtual-unused-tmp-dir"},this.fileNameFrom=function(e){return ye(e)?e:g().basename(e)},this.dirNameFrom=function(e){return ye(e)?"":g().dirname(e)},this.makeAbsolute=function(e,r){return ye(e)?e:(n.isAbsolute(r)||(r=g().resolve(r)),g().resolve(r,g().normalize(e)))},this.makeRelative=function(e,r){return ye(e)?e:g().relative(r,g().normalize(e))},this.isAbsolute=function(e){return!!ye(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,r){return ye(e)?(n._allCopiedExternalUrls.add(e),!0):(console.warn("[BrowserSWFileSystem] Copy not done from",e,"to",r),!0)},this.writeToFile=function(e,r){var t,o=e.replace(n.rootUrl,""),i=(t=e,{".html":"text/html; charset=utf-8",".js":"text/javascript; charset=utf-8",".mjs":"text/javascript; charset=utf-8",".css":"text/css; charset=utf-8",".json":"application/json; charset=utf-8",".wasm":"application/wasm",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".svg":"image/svg+xml",".txt":"text/plain; charset=utf-8"}[g().extname(t).toLowerCase()]||"application/octet-stream");return n._pendingFiles.push({path:o,content:r,contentType:i}),!0},this.readFile=function(e){return n._indexedFilesContent[e]?n._indexedFilesContent[e].text:(console.error("[BrowserSWFileSystem] Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,r){r=r.toUpperCase();var t=new Se.VectorString;return n._allCopiedExternalUrls.forEach((function(e){var n=e.toUpperCase();n.indexOf(r)===n.length-r.length&&t.push_back(e)})),t},this.fileExists=function(e){return ye(e),!0},this.rootUrl=o,this._indexedFilesContent={},t.forEach((function(e){n._indexedFilesContent[e.filePath]=e}))})),Fe=n(52578),Pe={preview:["/Runtime/index.html"],web:["/Runtime/index.html","/Runtime/Electron/LICENSE.GDevelop.txt"],"cocos2d-js":["/Runtime/Cocos2d/cocos2d-js-v3.10.js","/Runtime/Cocos2d/index.html","/Runtime/Cocos2d/main.js","/Runtime/Cocos2d/project.json"],"facebook-instant-games":["/Runtime/FacebookInstantGames/fbapp-config.json","/Runtime/FacebookInstantGames/index.html"],cordova:["/Runtime/Cordova/www/index.html","/Runtime/Cordova/www/LICENSE.GDevelop.txt","/Runtime/Cordova/config.xml","/Runtime/Cordova/package.json"],electron:["/Runtime/index.html","/Runtime/Electron/main.js","/Runtime/Electron/package.json","/Runtime/Electron/LICENSE.GDevelop.txt"]},Ze=function(e){var r="https://resources.gdevelop-app.com/GDJS-".concat((0,Fe.Us)());return a.ZP.isDev()&&(r="http://localhost:5002"),Promise.all(Pe[e].map((function(e){var n=r+e;return fetch(n).then((function(e){if(!e.ok)throw console.error('Error while downloading "'.concat(n,'"'),e),new Error('Error while downloading "'.concat(n,'" (status: ').concat(e.status,")"));return e.text().then((function(e){return{filePath:n,text:e}}))}))}))).then((function(e){return{gdjsRoot:r,filesContent:e}}))},Ee=n(25842),ke=n.n(Ee),Ce="stopped",De=[],Re=0,Ne={},Ie=function(){return Object.keys(Ne).map((function(e){return Number(e)}))},Te=function(e){for(var r in Ne){var n=Number(r);if(Ne[n]===e)return n}return null},Be=null,Me=function(){null===Be&&(Be=setInterval((function(){var e=function(){var e=Number(r);Ne[e].closed&&(console.info("A preview window was closed, with debugger id:",e),delete Ne[e],De.forEach((function(r){return(0,r.onConnectionClosed)({id:e,debuggerIds:Ie()})})),Object.keys(Ne).length||(clearInterval(Be),Be=null))};for(var r in Ne)e()}),1e3))},Ae=null,Ue={startServer:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.origin,"started"!==Ce){e.next=3;break}return e.abrupt("return");case 3:Ce="started",Ae=n,window.addEventListener("message",(function(e){if(e.origin===Ae){var r=Te(e.source);if(null!==r)try{var n=JSON.parse(e.data);De.forEach((function(e){return(0,e.onHandleParsedMessage)({id:r,parsedMessage:n})}))}catch(t){console.error("Error while parsing messages coming from a preview:",t)}}})),Me(),De.forEach((function(e){return(0,e.onServerStateChanged)()}));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),sendMessage:function(e,r){var n=Ne[e];if(n)try{n.postMessage(r,Ae)}catch(t){console.error("Unable to send a message to the preview window:",t)}},getServerState:function(){return Ce},getExistingDebuggerIds:Ie,registerCallbacks:function(e){return De.push(e),function(){var r=De.indexOf(e);-1!==r&&De.splice(r,1)}}},We=function(e){var r=Re++;return Ne[r]=e,Me(),De.forEach((function(e){return(0,e.onConnectionOpened)({id:r,debuggerIds:Ie()})})),r},Oe=n(34517),Le=n(48409),_e=0,Ge=function(e){var r=e.getGameResolutionWidth(),n=e.getGameResolutionHeight(),t=window.screenX+window.innerWidth/2-r/2,o=window.screenY+window.innerHeight/2-n/2,i="GDevelopPreview"+_e++,a=window.open("about:blank",i,"width=".concat(r,",height=").concat(n,",left=").concat(t,",top=").concat(o));if(!a)throw new Error("Can't open the preview window because of browser restrictions.");return W(a),a},ze=n.g.gd,Je=function(e){(0,Q.Z)(n,e);var r=(0,$.Z)(n);function n(){var e;(0,X.Z)(this,n);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).canDoNetworkPreview=function(){return!1},e.state={error:null},e._prepareExporter=function(){return Ze("preview").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("[BrowserSWPreviewLauncher] GDJS found in",r);var t=pe(),o=de(),i="".concat(t,"/").concat("preview");console.log("[BrowserSWPreviewLauncher] Preview will be served from:",i);var a=new je({filesContent:n,rootUrl:"".concat(o,"/")}),s=ke()(new ze.AbstractFileSystemJS,a),c=new ze.Exporter(s,r);return c.setCodeOutputDirectory(i),{exporter:c,outputDir:i,browserSWFileSystem:a}}))},e.immediatelyPreparePreviewWindows=function(r){var n=e.getPreviewDebuggerServer().getExistingDebuggerIds();return r.hotReload&&!!n.length?[]:Array.from({length:r.numberOfWindows},(function(){try{return Ge(r.project)}catch(e){return console.error("[BrowserSWPreviewLauncher] Unable to open a new preview window - this window will be ignored:",e),null}})).filter(Boolean)},e.launchPreview=function(){var r=(0,l.Z)((0,u.Z)().mark((function r(n){var t,o,i,s,c,d,p,f,h,x,g,v,m,w,b;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=n.project,o=n.layout,i=n.externalLayout,s=n.previewWindows,e.setState({error:null}),c=e.getPreviewDebuggerServer().getExistingDebuggerIds(),d=n.hotReload&&!!c.length,r.prev=4,r.next=7,e.getPreviewDebuggerServer().startServer({origin:new URL(pe()).origin});case 7:r.next=12;break;case 9:r.prev=9,r.t0=r.catch(4),console.error("[BrowserSWPreviewLauncher] Unable to start the Debugger Server for the preview:",r.t0);case 12:return r.prev=12,r.next=15,e._prepareExporter();case 15:for(m in p=r.sent,f=p.exporter,h=p.outputDir,x=p.browserSWFileSystem,(g=new ze.PreviewExportOptions(t,h)).setLayoutName(o.getName()),g.setIsDevelopmentEnvironment(a.ZP.isDev()),i&&g.setExternalLayoutName(i.getName()),g.useWindowMessageDebuggerClient(),v=e.props.getIncludeFileHashs())w=v[m],g.setIncludeFileHash(m,w);return g.setProjectDataOnlyExport(d&&n.projectDataOnlyExport),g.setFullLoadingScreen(n.fullLoadingScreen),g.setNativeMobileApp((0,Le._F)()),g.setGDevelopVersionWithHash((0,Fe.Us)()),g.setCrashReportUploadLevel(e.props.crashReportUploadLevel),g.setPreviewContext(e.props.previewContext),g.setProjectTemplateSlug(t.getTemplateSlug()),g.setSourceGameId(e.props.sourceGameId),n.inAppTutorialMessageInPreview&&g.setInAppTutorialMessageInPreview(n.inAppTutorialMessageInPreview,n.inAppTutorialMessagePositionInPreview),n.fallbackAuthor&&g.setFallbackAuthor(n.fallbackAuthor.id,n.fallbackAuthor.username),n.authenticatedPlayer&&g.setAuthenticatedPlayer(n.authenticatedPlayer.playerId,n.authenticatedPlayer.playerUsername,n.authenticatedPlayer.playerToken),n.captureOptions.screenshots&&n.captureOptions.screenshots.forEach((function(e){g.addScreenshotCapture(e.delayTimeInSeconds,e.signedUrl,e.publicUrl)})),(b=(0,Oe.NC)())&&g.setGDevelopResourceToken(b),console.log("[BrowserSWPreviewLauncher] Exporting project for preview..."),f.exportProjectForPixiPreview(g),g.delete(),f.delete(),console.log("[BrowserSWPreviewLauncher] Storing preview files in IndexedDB..."),r.next=47,x.applyPendingOperations();case 47:if(!d){r.next=52;break}console.log("[BrowserSWPreviewLauncher] Triggering hot reload..."),c.forEach((function(r){e.getPreviewDebuggerServer().sendMessage(r,{command:"hotReload"})})),r.next=58;break;case 52:if(!s){r.next=57;break}console.log("[BrowserSWPreviewLauncher] Opening new preview window(s)..."),s.forEach((function(r){r.location=h+"/index.html";try{r.focus()}catch(o){}var t=We(r);Ue.registerCallbacks({onErrorReceived:function(){},onServerStateChanged:function(){},onConnectionClosed:function(){var r=(0,l.Z)((0,u.Z)().mark((function r(o){return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o.id===t){r.next=3;break}return r.abrupt("return");case 3:if(!n.captureOptions){r.next=6;break}return r.next=6,e.props.onCaptureFinished(n.captureOptions);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),onConnectionOpened:function(){},onConnectionErrored:function(){},onHandleParsedMessage:function(){}})})),r.next=58;break;case 57:throw new Error("Internal error: no preview windows to open and no hot reload to trigger.");case 58:console.log("[BrowserSWPreviewLauncher] Preview launched successfully!"),r.next=65;break;case 61:r.prev=61,r.t1=r.catch(12),console.error("[BrowserSWPreviewLauncher] Error launching preview:",r.t1),e.setState({error:r.t1});case 65:case"end":return r.stop()}}),r,null,[[4,9],[12,61]])})));return function(e){return r.apply(this,arguments)}}(),e}return(0,q.Z)(n,[{key:"getPreviewDebuggerServer",value:function(){return Ue}},{key:"render",value:function(){var e=this,r=this.state.error;return r?(0,C.jsx)(ne,{error:r,onClose:function(){return e.setState({error:null})}}):null}}]),n}(o.Component),He=n(45911),Ke=n(68151),Ye=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Ke.SS)({uploadType:"preview",files:r.map((function(e){return{key:e.Key,contentType:e.ContentType}}))});case 2:if(n=e.sent,(t=n.signedUrls).length===r.length){e.next=6;break}throw new Error("Unexpected response from the API (signed urls count is not the same as uploaded objects count).");case 6:return e.next=8,Promise.all(r.map((function(e,r){return j().put(t[r],e.Body,{headers:{"Content-Type":e.ContentType}})})));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ve=function(){return He.fm.baseUrl},Xe=n.g.gd,qe=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},Qe=(0,q.Z)((function e(r){var n=this,t=r.filesContent,o=r.prefix,i=r.bucketBaseUrl;(0,X.Z)(this,e),this._pendingUploadObjects=[],this._allCopiedExternalUrls=new Set,this.uploadPendingObjects=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Uploading ".concat(n._pendingUploadObjects.length," files for preview...")),e.next=4,Ye(n._pendingUploadObjects);case 4:console.log("Uploaded all ".concat(n._pendingUploadObjects.length," preview files.")),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Can't upload all objects:",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),this.mkDir=function(e){},this.dirExists=function(e){return!0},this.clearDir=function(e){},this.getTempDir=function(){return"/virtual-unused-tmp-dir"},this.fileNameFrom=function(e){return qe(e)?e:g().basename(e)},this.dirNameFrom=function(e){return qe(e)?"":g().dirname(e)},this.makeAbsolute=function(e,r){return qe(e)?e:(n.isAbsolute(r)||(r=g().resolve(r)),g().resolve(r,g().normalize(e)))},this.makeRelative=function(e,r){return qe(e)?e:g().relative(r,g().normalize(e))},this.isAbsolute=function(e){return!!qe(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,r){return qe(e)?(n._allCopiedExternalUrls.add(e),!0):(console.warn("Copy not done from",e,"to",r),!0)},this.writeToFile=function(e,r){var t=e.replace(n.bucketBaseUrl,""),o=g().extname(e);return n._pendingUploadObjects.push({Key:t,Body:r,ContentType:{".js":"text/javascript",".html":"text/html"}[o]}),!0},this.readFile=function(e){return n._indexedFilesContent[e]?n._indexedFilesContent[e].text:(console.error("Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,r){r=r.toUpperCase();var t=new Xe.VectorString;return n._allCopiedExternalUrls.forEach((function(e){var n=e.toUpperCase();n.indexOf(r)===n.length-r.length&&t.push_back(e)})),t},this.fileExists=function(e){return qe(e),!0},this.prefix=o,this.bucketBaseUrl=i,this._indexedFilesContent={},t.forEach((function(e){n._indexedFilesContent[e.filePath]=e}))})),$e=n(28842),er=n.g.gd,rr=function(e){(0,Q.Z)(n,e);var r=(0,$.Z)(n);function n(){var e;(0,X.Z)(this,n);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return(e=r.call.apply(r,[this].concat(o))).canDoNetworkPreview=function(){return!1},e.state={error:null},e._prepareExporter=function(){return Ze("preview").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=(0,$e._)(),o=Ve()+t,i=new Qe({filesContent:n,bucketBaseUrl:Ve(),prefix:t}),a=ke()(new er.AbstractFileSystemJS,i),s=new er.Exporter(a,r);return s.setCodeOutputDirectory(o),{exporter:s,outputDir:o,browserS3FileSystem:i}}))},e.launchPreview=function(){var r=(0,l.Z)((0,u.Z)().mark((function r(n){var t,o,i,s,c,d,p,f,h,x,g,v,m,w,b;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=n.project,o=n.layout,i=n.externalLayout,s=n.numberOfWindows,e.setState({error:null}),c=e.getPreviewDebuggerServer().getExistingDebuggerIds(),d=c.length?c[c.length-1]:null,p=n.hotReload&&null!==d,f=p?null==(S=d)?null:Ne[S]||null:null,h=f?[f]:Array.from({length:s},(function(){try{return Ge(t)}catch(e){return console.error("Unable to open a new preview window - this window will be ignored:",e),null}})).filter(Boolean),r.prev=7,r.next=10,e.getPreviewDebuggerServer().startServer({origin:new URL(Ve()).origin});case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(7),console.error("Unable to start the Debugger Server for the preview:",r.t0);case 15:return r.prev=15,r.next=18,e._prepareExporter();case 18:return x=r.sent,g=x.exporter,v=x.outputDir,m=x.browserS3FileSystem,(w=new er.PreviewExportOptions(t,v)).setLayoutName(o.getName()),w.setIsDevelopmentEnvironment(a.ZP.isDev()),i&&w.setExternalLayoutName(i.getName()),(0,Le._F)()?w.useMinimalDebuggerClient():w.useWindowMessageDebuggerClient(),w.setNonRuntimeScriptsCacheBurst(Date.now()),w.setFullLoadingScreen(n.fullLoadingScreen),w.setNativeMobileApp((0,Le._F)()),w.setGDevelopVersionWithHash((0,Fe.Us)()),w.setCrashReportUploadLevel(e.props.crashReportUploadLevel),w.setPreviewContext(e.props.previewContext),w.setProjectTemplateSlug(t.getTemplateSlug()),w.setSourceGameId(e.props.sourceGameId),n.inAppTutorialMessageInPreview&&w.setInAppTutorialMessageInPreview(n.inAppTutorialMessageInPreview,n.inAppTutorialMessagePositionInPreview),n.fallbackAuthor&&w.setFallbackAuthor(n.fallbackAuthor.id,n.fallbackAuthor.username),n.authenticatedPlayer&&w.setAuthenticatedPlayer(n.authenticatedPlayer.playerId,n.authenticatedPlayer.playerUsername,n.authenticatedPlayer.playerToken),n.captureOptions.screenshots&&n.captureOptions.screenshots.forEach((function(e){w.addScreenshotCapture(e.delayTimeInSeconds,e.signedUrl,e.publicUrl)})),(b=(0,Oe.NC)())&&w.setGDevelopResourceToken(b),g.exportProjectForPixiPreview(w),w.delete(),g.delete(),r.next=46,m.uploadPendingObjects();case 46:h.forEach((function(e){e.location=v+"/index.html";try{e.focus()}catch(r){}})),f||h.forEach((function(r){var t=We(r);Ue.registerCallbacks({onErrorReceived:function(){},onServerStateChanged:function(){},onConnectionClosed:function(){var r=(0,l.Z)((0,u.Z)().mark((function r(o){return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o.id===t){r.next=3;break}return r.abrupt("return");case 3:if(!n.captureOptions){r.next=6;break}return r.next=6,e.props.onCaptureFinished(n.captureOptions);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),onConnectionOpened:function(){},onConnectionErrored:function(){},onHandleParsedMessage:function(){}})})),r.next=53;break;case 50:r.prev=50,r.t1=r.catch(15),e.setState({error:r.t1});case 53:case"end":return r.stop()}var S}),r,null,[[7,12],[15,50]])})));return function(e){return r.apply(this,arguments)}}(),e}return(0,q.Z)(n,[{key:"getPreviewDebuggerServer",value:function(){return Ue}},{key:"render",value:function(){var e=this,r=this.state.error;return r?(0,C.jsx)(ne,{error:r,onClose:function(){return e.setState({error:null})}}):null}}]),n}(o.Component),nr=n(10959),tr=n(98775),or=n.g.gd,ir=function(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("blob:")||e.startsWith("data:")},ar=g().posix||g(),sr=(0,q.Z)((function e(r){var n=this,t=r.textFiles;(0,X.Z)(this,e),this._textFiles={},this._filesToDownload={},this.getAllTextFilesIn=function(e){return Object.keys(n._textFiles).filter((function(r){return 0===r.indexOf(e)})).map((function(e){return{filePath:e,text:n._textFiles[e]}}))},this.getAllUrlFilesIn=function(e){return Object.keys(n._filesToDownload).filter((function(r){return 0===r.indexOf(e)})).map((function(e){return{filePath:e,url:n._filesToDownload[e]}}))},this.mkDir=function(e){return!0},this.dirExists=function(e){return!0},this.clearDir=function(e){return Object.keys(n._textFiles).forEach((function(r){0===r.indexOf(e)&&delete n._textFiles[r]})),!0},this.getTempDir=function(){return"/browser-file-system-tmp-dir"},this.fileNameFrom=function(e){return ar.basename(e)},this.dirNameFrom=function(e){return ar.dirname(e)},this.makeAbsolute=function(e,r){return ir(e)?e:(n.isAbsolute(r)||(r=ar.resolve(r)),ar.resolve(r,ar.normalize(e)))},this.makeRelative=function(e,r){return ir(e)?0===e.indexOf(r)?e.substring(r.length):(console.warn("".concat(e," cannot be made relative to ").concat(r,", please double check this behavior is correct.")),e):ar.relative(r,ar.normalize(e))},this.isAbsolute=function(e){return!!ir(e)||e.length>0&&"/"===e.charAt(0)},this.copyFile=function(e,r){if(ir(e))return ir(r)?(console.error("Destination can't be a URL in copyFile (from ".concat(e," to ").concat(r,").")),!1):(n._filesToDownload[ar.normalize(r)]=e,!0);if(n._textFiles[e])return n._textFiles[ar.normalize(r)]=n._textFiles[e],!0;var t=Object.keys(n._filesToDownload).find((function(r){return r===e}));if(t){var o=n._filesToDownload[t];return n._filesToDownload[ar.normalize(r)]=o,!0}return console.error("File not found in copyFile (from ".concat(e," to ").concat(r,").")),!1},this.writeToFile=function(e,r){return n._textFiles[ar.normalize(e)]=r,!0},this.readFile=function(e){return n._textFiles[e]?n._textFiles[e]:(console.error("Unknown file ".concat(e,", returning an empty string")),"")},this.readDir=function(e,r){r=r.toUpperCase();var t=new or.VectorString;return Object.keys(n._filesToDownload).forEach((function(e){var n=e.toUpperCase();n.indexOf(r)===n.length-r.length&&t.push_back(e)})),t},this.fileExists=function(e){if(ir(e))return!0;var r=ar.normalize(e);return!!n._textFiles[r]||!!n._filesToDownload[r]},t.forEach((function(e){n._textFiles[e.filePath]=e.text}))})),cr=n(96826),ur=n(61421),lr=n.g.gd,dr="browser-online-cordova",pr={name:dr,onlineBuildType:"cordova-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["androidApk"],keystore:"new",signingDialogOpen:!1}},canLaunchBuild:function(e,r,n){return r||""===n},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,C.jsx)(ur.s_,(0,t.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,C.jsx)(ur.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:dr}))},prepareExporter:function(e){return Ze("cordova").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new lr.AbstractFileSystemJS,t);return{exporter:new lr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new lr.ExportOptions(a,o);return s.setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,r){return(0,nr.Zi)().then((function(n){return(0,tr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,nr.$C)(a,s.uid,n,e.targets,e.keystore,t,o,i):Promise.reject(new Error("User is not authenticated"))}},fr=n(90078),hr=n.g.gd,xr="browser-online-cordova-ios",gr={name:xr,onlineBuildType:"cordova-ios-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["iosAppStore"],signing:null}},canLaunchBuild:function(e,r,n){return(r||""===n)&&!!e.signing},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,C.jsx)(fr.s_,(0,t.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,C.jsx)(fr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:xr}))},prepareExporter:function(e){return Ze("cordova").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new hr.AbstractFileSystemJS,t);return{exporter:new hr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new hr.ExportOptions(a,o);return s.setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,r){return(0,nr.Zi)().then((function(n){return(0,tr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.profile;return s?e.signing?(0,nr.NZ)(a,s.id,n,e.targets,e.signing,t,o,i):Promise.reject(new Error("Signing options not set up")):Promise.reject(new Error("User is not authenticated"))}},vr=n(87335),mr=n.g.gd,wr="browser-online-electron",br={name:wr,onlineBuildType:"electron-build",limitedBuilds:!0,packageNameWarningType:"desktop",getInitialExportState:function(){return{targets:["winExe"]}},canLaunchBuild:function(e,r,n){return!!e.targets.length&&(r||""===n)},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,C.jsx)(vr.s_,(0,t.Z)({},e))},renderExportFlow:function(e){return(0,C.jsx)(vr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:wr}))},prepareExporter:function(e){return Ze("electron").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new mr.AbstractFileSystemJS,t);return{exporter:new mr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new mr.ExportOptions(a,o);return s.setTarget("electron"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},launchUpload:function(e,r){return(0,nr.Zi)().then((function(n){return(0,tr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,nr.ch)(a,s.uid,n,e.targets,t,o,i):Promise.reject(new Error("User is not authenticated"))}},Sr=n(96516),yr=n(4615),jr=n.g.gd,Fr="browser-online-web",Pr={name:Fr,onlineBuildType:"web-build",getInitialExportState:function(){return null},canLaunchBuild:function(e,r,n){return r||""===n||"done"===n},isNavigationDisabled:function(e,r){return!r&&!["","done"].includes(e)},renderHeader:function(e){var r=e.uiMode;return(0,C.jsx)(Sr.if,{uiMode:r})},renderExportFlow:function(e){return(0,C.jsx)(yr.Z,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Fr}))},prepareExporter:function(e){return Ze("web").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new jr.AbstractFileSystemJS,t);return{exporter:new jr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new jr.ExportOptions(a,o);return n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress,sizeLimit:25e7})},launchUpload:function(e,r){return(0,nr.Zi)().then((function(n){return(0,tr.n)(r,n,e.updateStepProgress).then((function(){return n.key}))}))},launchOnlineBuild:function(e,r,n,t,o,i){var a=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,nr.Bc)(a,s.uid,n,t,o,i):Promise.reject(new Error("User is not authenticated"))}},Zr=n(37054),Er=n(39935),kr=n.g.gd,Cr="browser-html5",Dr={name:Cr,getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,C.jsx)(Er.if,{})},renderExportFlow:function(e){return(0,C.jsx)(Er.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Cr}))},prepareExporter:function(e){return Ze("web").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new kr.AbstractFileSystemJS,t);return{exporter:new kr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new kr.ExportOptions(a,o);return n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,C.jsx)(Er.Eg,{renderGameButton:function(){return(0,C.jsx)(Zr.j,{blob:r,children:function(e){return(0,C.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Zr.z)(e,"game.zip")},label:(0,C.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},Rr=n(76349),Nr=n.g.gd,Ir="browser-cordova",Tr={name:Ir,packageNameWarningType:"mobile",getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,C.jsx)(Rr.if,{})},renderExportFlow:function(e){return(0,C.jsx)(Rr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Ir}))},prepareExporter:function(e){return Ze("cordova").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new Nr.AbstractFileSystemJS,t);return{exporter:new Nr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Nr.ExportOptions(a,o);return s.setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,C.jsx)(Rr.Eg,{renderGameButton:function(){return(0,C.jsx)(Zr.j,{blob:r,children:function(e){return(0,C.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Zr.z)(e,"game.zip")},label:(0,C.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},Br=n(41426),Mr=n.g.gd,Ar="browser-electron",Ur={name:Ar,packageNameWarningType:"desktop",getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,C.jsx)(Br.if,{})},renderExportFlow:function(e){return(0,C.jsx)(Br.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Ar}))},prepareExporter:function(e){return Ze("electron").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new Mr.AbstractFileSystemJS,t);return{exporter:new Mr.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Mr.ExportOptions(a,o);return s.setTarget("electron"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,C.jsx)(Br.Eg,{renderGameButton:function(){return(0,C.jsx)(Zr.j,{blob:r,children:function(e){return(0,C.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Zr.z)(e,"game.zip")},label:(0,C.jsx)(p.Trans,{id:"Download the exported game"})})}})}})}},Wr=n(15745),Or=n.g.gd,Lr="browser-facebook-instant-games",_r={name:Lr,getInitialExportState:function(){return null},canLaunchBuild:function(){return!0},isNavigationDisabled:function(){return!1},renderHeader:function(){return(0,C.jsx)(Wr.if,{})},renderExportFlow:function(e){return(0,C.jsx)(Wr.yg,(0,t.Z)((0,t.Z)({},e),{},{exportPipelineName:Lr}))},prepareExporter:function(e){return Ze("facebook-instant-games").then((function(e){var r=e.gdjsRoot,n=e.filesContent;console.info("GDJS found in ",r);var t=new sr({textFiles:n}),o=ke()(new Or.AbstractFileSystemJS,t);return{exporter:new Or.Exporter(o,r),outputDir:"/export/",abstractFileSystem:t}}))},launchExport:function(e,r,n){var t=r.exporter,o=r.outputDir,i=r.abstractFileSystem,a=e.project,s=new Or.ExportOptions(a,o);return s.setTarget("facebookInstantGames"),n&&s.setFallbackAuthor(n.id,n.username),t.exportWholePixiProject(s),s.delete(),t.delete(),Promise.resolve({textFiles:i.getAllTextFilesIn(o),urlFiles:i.getAllUrlFilesIn(o)})},launchResourcesDownload:function(e,r){var n=r.textFiles,t=r.urlFiles;return(0,cr.I)({urlFiles:t,onProgress:e.updateStepProgress}).then((function(e){return{blobFiles:e,textFiles:n}}))},launchCompression:function(e,r){var n=r.textFiles,t=r.blobFiles;return(0,cr.f)({blobFiles:t,textFiles:n,basePath:"/export/",onProgress:e.updateStepProgress})},renderDoneFooter:function(e){var r=e.compressionOutput;e.exportState;return(0,C.jsx)(Wr.Eg,{renderGameButton:function(){return(0,C.jsx)(Zr.j,{blob:r,children:function(e){return(0,C.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Zr.z)(e,"fb-instant-game.zip")},label:(0,C.jsx)(p.Trans,{id:"Download the Instant Game archive"})})}})}})}},Gr=(0,t.Z)((0,t.Z)({},Sr.O1),{},{exportPipeline:Pr}),zr=[(0,t.Z)((0,t.Z)({},Er.BN),{},{exportPipeline:Dr}),(0,t.Z)((0,t.Z)({},ur.Vf),{},{exportPipeline:pr}),(0,t.Z)((0,t.Z)({},fr.Y$),{},{exportPipeline:gr}),(0,t.Z)((0,t.Z)({},vr.OL),{},{exportPipeline:br}),(0,t.Z)((0,t.Z)({},Wr.xu),{},{exportPipeline:_r})],Jr=[(0,t.Z)((0,t.Z)({},Er.BN),{},{exportPipeline:Dr}),(0,t.Z)((0,t.Z)({},Rr.VU),{},{exportPipeline:Tr}),(0,t.Z)((0,t.Z)({},Br.c8),{},{exportPipeline:Ur})],Hr=n(23570),Kr=n(92666),Yr=n(29571),Vr=n.g.gd,Xr=[{name:"AdMob",extensionModule:n(94550),objectsRenderingServiceModules:{}},{name:"AdvancedWindow",extensionModule:n(19910),objectsRenderingServiceModules:{}},{name:"FacebookInstantGames",extensionModule:n(64579),objectsRenderingServiceModules:{}},{name:"DeviceSensors",extensionModule:n(89493),objectsRenderingServiceModules:{}},{name:"DeviceVibration",extensionModule:n(27272),objectsRenderingServiceModules:{}},{name:"SaveState",extensionModule:n(51678),objectsRenderingServiceModules:{}},{name:"DebuggerTools",extensionModule:n(37515),objectsRenderingServiceModules:{}},{name:"Physics2",extensionModule:n(30269),objectsRenderingServiceModules:{}},{name:"Physics3D",extensionModule:n(87963),objectsRenderingServiceModules:{}},{name:"ExampleJsExtension",extensionModule:n(97854),objectsRenderingServiceModules:{}},{name:"Tween",extensionModule:n(43386),objectsRenderingServiceModules:{}},{name:"Video",extensionModule:n(24895),objectsRenderingServiceModules:{}},{name:"FileSystem",extensionModule:n(98261),objectsRenderingServiceModules:{}},{name:"Firebase",extensionModule:n(81386),objectsRenderingServiceModules:{}},{name:"Leaderboards",extensionModule:n(92268),objectsRenderingServiceModules:{}},{name:"PlayerAuthentication",extensionModule:n(17681),objectsRenderingServiceModules:{}},{name:"Multiplayer",extensionModule:n(93498),objectsRenderingServiceModules:{}},{name:"DialogueTree",extensionModule:n(99548),objectsRenderingServiceModules:{}},{name:"BBText",extensionModule:n(73118),objectsRenderingServiceModules:{"pixi-multistyle-text/dist/pixi-multistyle-text.umd":n(54505)}},{name:"TileMap",extensionModule:n(24767),objectsRenderingServiceModules:{"pixi-tilemap/dist/pixi-tilemap.umd":n(19477),"helper/TileMapHelper":n(69835),"pako/dist/pako.min":n(53663)}},{name:"Effects",extensionModule:n(44344),objectsRenderingServiceModules:{}},{name:"P2P",extensionModule:n(82240),objectsRenderingServiceModules:{}},{name:"Lighting",extensionModule:n(72025),objectsRenderingServiceModules:{}},{name:"SpatialSound",extensionModule:n(83915),objectsRenderingServiceModules:{}},{name:"BitmapText",extensionModule:n(68722),objectsRenderingServiceModules:{}},{name:"Screenshot",extensionModule:n(93905),objectsRenderingServiceModules:{}},{name:"TextInput",extensionModule:n(88306),objectsRenderingServiceModules:{}},{name:"Scene3D",extensionModule:n(11050),objectsRenderingServiceModules:{}},{name:"SpineObject",extensionModule:n(68708),objectsRenderingServiceModules:{}}];function qr(e){var r=e.objectsEditorService,n=e.objectsRenderingService,t=e.filterExamples;return{loadAllExtensions:function(e){var o=Xr.filter((function(e){var r=e.name;return!t||!r.includes("Example")})).map((function(t){var o=t.name,i=t.extensionModule,a=t.objectsRenderingServiceModules;if(r&&i.registerEditorConfigurations&&i.registerEditorConfigurations(r),n){if(a)for(var s in a)n.registerModule(s,a[s]);i.registerInstanceRenderers&&i.registerInstanceRenderers(n),i.registerClearCache&&i.registerClearCache(n)}return{extensionModulePath:"internal-extension://"+o,result:(0,Hr.loadExtension)(e,Vr,Vr.JsPlatform.get(),i)}})),i=function(e){var r=e.filterExamples;return Xr.filter((function(e){var n=e.name;return!r||!n.includes("Example")})).length}({filterExamples:t});return Promise.resolve({results:o,expectedNumberOfJSExtensionModulesLoaded:i})}}}var Qr=n(91479),$r=n.n(Qr),en=n(71046),rn=n.n(en),nn=[],tn=rn()((0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,c.Z)(nn),console.info("[BrowserSWEventsFunctionCodeWriter] Storing a batch of ".concat(r.length," extension generated files in IndexedDB...")),nn=[],e.next=5,Promise.allSettled(r.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextEncoder,t=n.encode(r.content).buffer,e.next=4,he(r.path,t,"text/javascript; charset=utf-8");case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 5:e.sent.forEach((function(e,n){var t=r[n];"fulfilled"===e.status?t.onSuccess():(console.error("[BrowserSWEventsFunctionCodeWriter] Failed to store: ".concat(t.path),e.reason),t.onError(e.reason))}));case 7:case"end":return e.stop()}}),e)}))),10),on=function(e,r){return new Promise((function(n,t){nn.push({path:e,content:r,onSuccess:n,onError:t}),tn()}))},an=function(e){var r=e.onWriteFile,n=de(),t=function(e){var r=pe();return"".concat(r+"/extensions-code","/").concat($r()(e),".js")};return{getIncludeFileFor:function(e){return t(e)},writeFunctionCode:function(e,o){var i=t(e);r({includeFile:i,content:o});var a=i.replace(n,"");return on(a,o)},writeBehaviorCode:function(e,o){var i=t(e);r({includeFile:i,content:o});var a=i.replace(n,"");return on(a,o)},writeObjectCode:function(e,o){var i=t(e);r({includeFile:i,content:o});var a=i.replace(n,"");return on(a,o)}}},sn=[],cn=rn()((0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,c.Z)(sn),console.info("Uploading a batch of ".concat(r.length," extension generated files..."),r),sn=[],e.prev=3,e.next=6,Ye(r.map((function(e){return e.uploadedObject})));case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),r.forEach((function(r){return r.onError(e.t0)})),e.abrupt("return");case 12:r.forEach((function(e){return e.onSuccess()}));case 13:case"end":return e.stop()}}),e,null,[[3,8]])}))),10),un=function(e){return new Promise((function(r,n){sn.push({uploadedObject:e,onSuccess:r,onError:n}),cn()}))},ln=function(e){var r=e.onWriteFile,n=(0,$e._)(),t=function(e){return"".concat(n,"/").concat($r()(e),".js")};return{getIncludeFileFor:function(e){return Ve()+t(e)},writeFunctionCode:function(e,n){var o=t(e);return r({includeFile:o,content:n}),console.log("Uploading function generated code to ".concat(o,"...")),un({Key:t(e),Body:n,ContentType:"text/javascript"})},writeBehaviorCode:function(e,n){var o=t(e);return r({includeFile:o,content:n}),console.log("Uploading behavior generated code to ".concat(o,"...")),un({Key:t(e),Body:n,ContentType:"text/javascript"})},writeObjectCode:function(e,n){var o=t(e);return r({includeFile:o,content:n}),console.log("Uploading object generated code to ".concat(o,"...")),un({Key:t(e),Body:n,ContentType:"text/javascript"})}}},dn=n(26244),pn=n(56924),fn=n(8018),hn=n(17361),xn=n(78081),gn=n(41006),vn=n(51063),mn=n(85919),wn=n(79431),bn=n.g.gd,Sn="game.json",yn=g().posix||g(),jn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i,a,s,c,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.project,t=r.onAddBlobFile,o=r.onProgress,i={erroredResources:[]},a=function(e){var r=e.getResourcesManager();return r.getAllResourceNames().toJSArray().map((function(e){var n,t=r.getResource(e),o=t.getFile();return(n=o).startsWith("http://")||n.startsWith("https://")||n.startsWith("ftp://")||n.startsWith("blob:")||n.startsWith("data:")?(0,mn.yk)(o)?{resource:t,url:o,filename:(0,Oe.dh)(o)}:null:(i.erroredResources.push({resourceName:t.getName(),error:new Error("Unsupported relative file when downloading a copy.")}),null)})).filter(Boolean)},s=a(n),e.next=6,(0,A.R7)({urlContainers:s,onProgress:function(e,r){o(e,2*r)}});case 6:return c=e.sent,l=new Set([Sn]),c.forEach((function(e){var r=e.item,n=e.error,o=e.blob,a=r.resource,s=r.filename;if(!n&&o){var c=yn.extname(s),u=yn.basename(s,c),d="assets/"+a.getKind(),p=(0,wn.Z)(u,(function(e){return l.has(yn.join(d,e+c))})),f=yn.join(d,p+c);l.add(f),a.setFile(f),t({blob:o,filePath:f})}else i.erroredResources.push({resourceName:a.getName(),error:n||new Error("Unknown error during download.")})})),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();function Fn(e){var r=e.project,n=e.onDone,i=o.useState(null),s=(0,d.Z)(i,2),c=s[0],f=s[1],h=(0,vn.s)({onDoProcess:o.useCallback((function(e,r){return jn((0,t.Z)((0,t.Z)({},e),{},{onProgress:r}))}),[])}),x=h.ensureProcessIsDone,g=h.renderProcessDialog;return o.useEffect((function(){return(0,l.Z)((0,u.Z)().mark((function e(){var n,t,o,i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(null),n=bn.ProjectHelper.createNewGDJSProject(),e.prev=2,t=new bn.SerializerElement,r.serializeTo(t),n.unserializeFrom(t),t.delete(),o=[],i=[],e.next=11,x({project:n,onAddBlobFile:function(e){o.push(e)}});case 11:return i.push({text:JSON.stringify((0,gn.XH)(n)),filePath:Sn}),e.next=14,(0,cr.f)({textFiles:i,blobFiles:o,basePath:"/",onProgress:function(e,r){}});case 14:a=e.sent,f(a),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(2),(0,U.gR)({message:"Unable to save your project because of an internal error.",rawError:e.t0,errorId:"download-file-save-as-dialog-error"}),e.abrupt("return");case 22:return e.prev=22,n.delete(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,18,22,25]])})))(),function(){return f(null)}}),[r,x]),(0,C.jsxs)(E.Z,{title:(0,C.jsx)(p.Trans,{id:"Download a copy"}),actions:[(0,C.jsx)(ee.Z,{label:(0,C.jsx)(p.Trans,{id:"Download GDevelop desktop version"}),primary:!1,onClick:function(){return a.ZP.openExternalURL("http://gdevelop.io")}},"download"),(0,C.jsx)(ee.Z,{label:(0,C.jsx)(p.Trans,{id:"Close"}),primary:!1,onClick:n},"close")],onRequestClose:n,open:!0,maxWidth:"sm",children:[(0,C.jsxs)(m.ak,{noMargin:!0,children:[(0,C.jsx)(re.Z,{children:(0,C.jsx)(p.Trans,{id:"You can download the file of your game to continue working on it using the full GDevelop version:"})}),(0,C.jsx)(v.x1,{noMargin:!0,expand:!0,justifyContent:"center",children:c?(0,C.jsx)(Zr.j,{blob:c,children:function(e){return(0,C.jsx)(w.Z,{primary:!0,onClick:function(){return(0,Zr.z)(e,"gdevelop-game.zip")},label:(0,C.jsx)(p.Trans,{id:"Download the compressed game and resources"})})}}):(0,C.jsx)(xn.Z,{})})]}),g()]})}var Pn,Zn,En={internalName:"DownloadFile",name:{id:"Download a copy"},renderIcon:function(e){return(0,C.jsx)(hn.Z,{fontSize:e.size})},hiddenInOpenDialog:!0,createOperations:function(e){var r=e.setDialog,n=e.closeDialog;return{onSaveProjectAs:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,o,i){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.onStartSaving(),e.abrupt("return",new Promise((function(e){r((function(){return(0,C.jsx)(Fn,{onDone:function(){n(),e({wasSaved:!1,fileMetadata:null})},project:t})}))})));case 2:case"end":return e.stop()}}),e)})));return function(r,n,t){return e.apply(this,arguments)}}()}}},kn=n(71799),Cn=n(10822),Dn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{erroredResources:[]});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Rn=(Pn={},(0,I.Z)(Pn,"".concat(kn.Z.internalName,"=>").concat(kn.Z.internalName),Cn.G),(0,I.Z)(Pn,"".concat(fn.Z.internalName,"=>").concat(kn.Z.internalName),Cn.G),(0,I.Z)(Pn,"".concat(kn.Z.internalName,"=>").concat(En.internalName),Dn),(0,I.Z)(Pn,"".concat(fn.Z.internalName,"=>").concat(En.internalName),Dn),Pn),Nn={moveAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.oldStorageProvider,t=r.newStorageProvider,o=Rn["".concat(n.internalName,"=>").concat(t.internalName)]){e.next=4;break}throw new Error("Can't find a ResourceMover for ".concat(n.internalName," to ").concat(t.internalName,"."));case 4:return e.abrupt("return",o(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},In=Nn,Tn=n(527),Bn=n(58271),Mn=(Zn={},(0,I.Z)(Zn,kn.Z.internalName,Tn.f),(0,I.Z)(Zn,fn.Z.internalName,Bn.j),Zn),An={fetchAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.storageProvider,t=Mn[n.internalName]){e.next=4;break}throw new Error("Can't find a ResourceFetcher for ".concat(n.internalName," - have you registered the storage provider here?"));case 4:return e.abrupt("return",t(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},Un=An,Wn=(0,q.Z)((function e(){(0,X.Z)(this,e)}));Wn.chooseEventsFunctionExtensionFile=function(){return new Promise((function(e){if(window.showOpenFilePicker)window.showOpenFilePicker({types:[{description:"GDevelop Extension",accept:{"application/json":[".json"]}}],excludeAcceptAllOption:!0,multiple:!1}).then((function(r){var n=(0,d.Z)(r,1)[0];if(!n)return e(null);e(n.getFile())})).catch((function(){e(null)}));else{var r=document.createElement("input");r.type="file",r.multiple=!1,r.accept="application/json,.json",r.onchange=function(r){var n=r.target.files[0];return e(n)};var n=function n(){document.body&&document.body.removeEventListener("pointermove",n),r.files.length||e(null)};window.addEventListener("focus",(function e(){window.removeEventListener("focus",e),document.body&&document.body.addEventListener("pointermove",n)})),r.click()}}))},Wn.readEventsFunctionExtensionFile=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r instanceof File){e.next=3;break}throw console.error("Given file is not a JS File object. Instead it is:",{file:r}),new Error("Given file is not a JS File object.");case 3:return e.prev=3,e.next=6,r.text();case 6:return n=e.sent,e.abrupt("return",JSON.parse(n));case 10:throw e.prev=10,e.t0=e.catch(3),console.error("An error occurred when parsing the file content: ",{error:e.t0}),e.t0;case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(r){return e.apply(this,arguments)}}();var On=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,n){var t,o,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(t),(i=document.createElement("a")).href=o,i.download=r,!document.body){e.next=11;break}document.body.appendChild(i),i.click(),i.remove(),e.next=12;break;case 11:throw new Error("Document body couldn't be found.");case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}(),Ln=(0,q.Z)((function e(){(0,X.Z)(this,e)}));Ln.chooseEventsFunctionExtensionFile=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r);case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ln.writeEventsFunctionsExtension=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,n){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,gn.XH)(r,"serializeToExternal"),e.prev=1,e.next=4,On(n,JSON.stringify(t,null,2));case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Unable to write the events function extension:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(r,n){return e.apply(this,arguments)}}();var _n=n(71445),Gn=n(1333),zn=a.ZP.isDev(),Jn=function(){function e(r){(0,X.Z)(this,e),this.auth=r}return(0,q.Z)(e,[{key:"loginWithEmailAndPassword",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.email,t=r.password,e.prev=1,e.next=4,(0,_n.e5)(this.auth,n,t);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Error while login:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(r){return e.apply(this,arguments)}}()},{key:"loginOrSignupWithProvider",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,t,o,i=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.provider,!(t=r.signal)||!t.aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Login or Signup with provider already aborted.")));case 3:return o=new Promise((function(e,r){t&&t.addEventListener("abort",(function(){(0,Gn.g)(),r(new Error("Login or Signup with provider aborted."))}));var o=window.screenX+window.innerWidth/2-200,a=window.screenY+window.innerHeight/2-300,s=window.open("about:blank",null,"width=".concat(400,",height=").concat(600,",left=").concat(o,",top=").concat(a));s.document.write("<style>body { margin: 0; }</style><div style=\"height: 100vh; display: flex; justify-content: center; align-items: center; color: #F5F5F7; background-color: #25252E; font-family: 'Verdana', 'Fira Sans', 'Open Sans', 'Lucida Sans'; font-size: 20px\">Loading</div>"),(0,Gn.T)({onConnectionEstablished:function(e){if(!t||!t.aborted){var r=new URL("https://auth.gdevelop.io");if(r.searchParams.set("connection-id",e),r.searchParams.set("provider",n),r.searchParams.set("env",zn?"dev":"live"),!s)throw new Error("Popup could not be found.");s.location=r.toString()}},onTokenReceived:function(){var n=(0,l.Z)((0,u.Z)().mark((function n(o){var a,c,l;return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=o.provider,c=o.data,!t||!t.aborted){n.next=3;break}return n.abrupt("return");case 3:return n.prev=3,l="google"===a?_n.hJ.credential(c.credential):"github"===a?_n.GH.credential(c.accessToken):new _n.O4("apple.com").credential({idToken:c.id_token,nonce:c.raw_nonce}),n.next=7,(0,_n.sB)(i.auth,l);case 7:s&&s.close(),e(),(0,Gn.g)(),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(3),console.error("An error occurred while logging in with ".concat(a," token:"),n.t0),r(n.t0);case 16:case"end":return n.stop()}}),n,null,[[3,12]])})));return function(e){return n.apply(this,arguments)}}(),onError:function(e){t&&t.aborted||((0,Gn.g)(),console.error("An error occurred while setting up authentication web socket:",e),r(new Error("An error occurred while setting up authentication web socket.")))},onTimeout:function(){t&&t.aborted||((0,Gn.g)(),console.error("Connection to authorization websocket timed out."),r(new Error("Connection to authorization websocket timed out.")))}})})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}]),e}(),Hn=Jn,Kn=n(96106),Yn=function(e){a.ZP.setUpContextMenu();var r=new Hn(e.auth);e.setLoginProvider(r);var n=a.ZP.getArguments(),o=(0,Kn.P)();return o&&be(),(0,C.jsx)(dn.Z,{authentication:e,disableCheckForUpdates:!!n["disable-update-check"],makeEventsFunctionCodeWriter:o?an:ln,eventsFunctionsExtensionWriter:Ln,eventsFunctionsExtensionOpener:Wn,children:function(e){var r=e.i18n;return(0,C.jsx)(pn.Z,{appArguments:n,storageProviders:[fn.Z,kn.Z,En],defaultStorageProvider:fn.Z,children:function(e){var c=e.getStorageProviderOperations,u=e.getStorageProviderResourceOperations,l=e.storageProviders,d=e.initialFileMetadataToOpen,p=e.getStorageProvider;return(0,C.jsx)(i.Z,{i18n:r,renderPreviewLauncher:function(e,r){return o?(0,C.jsx)(Je,(0,t.Z)((0,t.Z)({},e),{},{ref:r})):(0,C.jsx)(rr,(0,t.Z)((0,t.Z)({},e),{},{ref:r}))},renderShareDialog:function(e){return(0,C.jsx)(s.Z,{project:e.project,onSaveProject:e.onSaveProject,isSavingProject:e.isSavingProject,onChangeSubscription:e.onChangeSubscription,onClose:e.onClose,automatedExporters:zr,manualExporters:Jr,onlineWebExporter:Gr,allExportersRequireOnline:!0,fileMetadata:e.fileMetadata,storageProvider:e.storageProvider,initialTab:e.initialTab,gamesList:e.gamesList})},quickPublishOnlineWebExporter:Gr,storageProviders:l,resourceMover:In,resourceFetcher:Un,getStorageProviderOperations:c,getStorageProviderResourceOperations:u,getStorageProvider:p,resourceSources:N,resourceExternalEditors:V,extensionsLoader:qr({objectsEditorService:Kr.Z,objectsRenderingService:Yr.Z,filterExamples:!a.ZP.isDev()}),initialFileMetadataToOpen:d,initialExampleSlugToOpen:n["create-from-example"]||null})}})}})}}}]);
//# sourceMappingURL=browser-app.f876b783.chunk.js.map