(self.webpackChunkgdevelop_ide=self.webpackChunkgdevelop_ide||[]).push([[712],{80530:function(e,r,t){var n=t(74149).findGDJS,o=t(50057),a=o("path"),i=o("fs");e.exports={findJsExtensionModules:function(e){var r=e.filterExamples,t=e.onFindGDJS;return(t?t():n()).then((function(e){var t=e.gdjsRoot,n=a.join(t,"Runtime","Extensions");return console.info("Searching for JS extensions (file called JsExtension.js) in ".concat(n,"...")),new Promise((function(e,t){i.readdir(n,(function(o,s){if(o)return t(o);var u=s.filter((function(e){return!r||-1===e.indexOf("Example")}));Promise.all(u.map((function(e){return r=a.join(n,e),new Promise((function(e){var t=a.join(r,"JsExtension.js");i.stat(t,(function(r,n){return e(r?null:n.isFile()?t:null)}))}));var r}))).then((function(r){e(r.filter((function(e){return!!e})))}),t)}))}))}))}}},50790:function(e,r,t){var n=t(23570).loadExtension,o=t(50057),a=t(80530).findJsExtensionModules;e.exports=function(e){var r=e.gd,t=e.objectsEditorService,i=e.objectsRenderingService,s=e.filterExamples,u=e.onFindGDJS;return{loadAllExtensions:function(e){return a({filterExamples:s,onFindGDJS:u}).then((function(a){return Promise.all(a.map((function(a){var s=null;try{s=o(a,{rethrowException:!0})}catch(u){return{extensionModulePath:a,result:{message:"Unable to import extension. Please check for any syntax error or error that would prevent it from being run.",error:!0,rawError:u}}}return s?(t&&s.registerEditorConfigurations&&s.registerEditorConfigurations(t),i&&(s.registerInstanceRenderers&&s.registerInstanceRenderers(i),s.registerClearCache&&s.registerClearCache(i)),{extensionModulePath:a,result:n(e,r,r.JsPlatform.get(),s)}):{extensionModulePath:a,result:{error:!0,message:"Unknown error. Please check for any syntax error or error that would prevent it from being run."}}}))).then((function(e){return{results:e,expectedNumberOfJSExtensionModulesLoaded:(r={filterExamples:s},29+(r.filterExamples?0:1))};var r}))}),(function(e){throw console.error("Unable to find JS extensions modules"),e}))}}}},55653:function(e,r,t){"use strict";t.r(r),t.d(r,{create:function(){return Io}});var n=t(1413),o=t(28381),a=t(91808),i=t(2066),s=t(36043),u=(t(94492),t(13778),t(74165)),c=t(37762),l=t(15861),p=t(93433),d=t(36600),f=t(17037),h=t(84140),m=t(7660),v=t(57974),g=t(50057),w=t.n(g),x=t(29439),b=t(79431),y=w()("fs"),P=w()("path");function j(e,r){return k.apply(this,arguments)}function k(){return(k=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,l,p,d,f,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y&&P){e.next=2;break}return e.abrupt("return");case 2:n=P.dirname(r.getProjectFile()),o=[],a=(0,c.Z)(t.values()),e.prev=5,a.s();case 7:if((i=a.n()).done){e.next=31;break}if(s=i.value,l=s.hasAnyEmbeddedResourceOutsideProjectFolder,p=s.embeddedResources,l){e.next=11;break}return e.abrupt("continue",29);case 11:d=(0,c.Z)(p.values()),e.prev=12,h=(0,u.Z)().mark((function e(){var r,t,a,i,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=f.value).isOutsideProjectFolder){e.next=3;break}return e.abrupt("return",1);case 3:t=P.basename(r.fullPath),a=P.extname(t),i=P.basename(t,a),s=(0,b.Z)(i,(function(e){var r=P.join(n,e)+a;return y.existsSync(r)})),c=P.join(n,s+a),r.resourceName=s+a,o.push(y.promises.copyFile(r.fullPath,c));case 10:case"end":return e.stop()}}),e)})),d.s();case 15:if((f=d.n()).done){e.next=21;break}return e.delegateYield(h(),"t0",17);case 17:if(!e.t0){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(12),d.e(e.t1);case 26:return e.prev=26,d.f(),e.finish(26);case 29:e.next=7;break;case 31:e.next=36;break;case 33:e.prev=33,e.t2=e.catch(5),a.e(e.t2);case 36:return e.prev=36,a.f(),e.finish(36);case 39:return e.abrupt("return",Promise.all(o));case 40:case"end":return e.stop()}}),e,null,[[5,33,36,39],[12,23,26,29]])})))).apply(this,arguments)}function Z(e,r){var t,n=P.dirname(e.getProjectFile()),o=new Map,a=(0,c.Z)(r);try{for(a.s();!(t=a.n()).done;){var i,s=(0,x.Z)(t.value,2),u=s[0],l=s[1].embeddedResources,p={},d=(0,c.Z)(l.values());try{for(d.s();!(i=d.n()).done;){var h=i.value,m=h.resourceKind,v=h.resourceName,g=h.relPath,w=h.fullPath;v||(v=P.relative(n,w));var b=(0,f.hh)(m);if(b){if(b.setName(v),b.setFile(v),p[g]=v,o.has(w)){var y=o.get(w);y&&y.mapping&&(b.setMetadata(JSON.stringify({embeddedResourcesMapping:y.mapping})),o.delete(w))}e.getResourcesManager().addResource(b)}}}catch(j){d.e(j)}finally{d.f()}o.set(u,{mapping:p})}}catch(j){a.e(j)}finally{a.f()}return o}function S(e,r){return E.apply(this,arguments)}function E(){return(E=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,l,p,d,f,h,m,g,w,x,b,j,k,Z,S;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y&&P){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,y.promises.readFile(t,"utf8");case 4:if(n=e.sent,e.prev=5,!(o=JSON.parse(n))||!o.__header__||"LDtk"!==o.__header__.app){e.next=16;break}a=P.dirname(t),i=new Map,s=!1,l=(0,c.Z)(o.defs.tilesets);try{for(l.s();!(p=l.n()).done;)(d=p.value).relPath&&(f=d.relPath,h=P.resolve(a,f),m=!(0,v.Te)(r,h),g={resourceKind:"image",relPath:f,fullPath:h,isOutsideProjectFolder:m},i.set(f,g),m&&(s=!0))}catch(u){l.e(u)}finally{l.f()}w=(0,c.Z)(o.levels);try{for(w.s();!(x=w.n()).done;)(b=x.value).bgRelPath&&(j=b.bgRelPath,k=P.resolve(a,j),Z=!(0,v.Te)(r,k),S={resourceKind:"image",relPath:j,fullPath:k,isOutsideProjectFolder:Z},i.set(b.bgRelPath,S),Z&&(s=!0))}catch(u){w.e(u)}finally{w.f()}return e.abrupt("return",{hasAnyEmbeddedResourceOutsideProjectFolder:s,embeddedResources:i});case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(5),console.error("Unable to read properly the data from file ".concat(t," for use as a tilemap - ignoring any potentially embedded resources.")),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[5,18]])})))).apply(this,arguments)}function F(){return(F=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y&&P){e.next=2;break}return e.abrupt("return",null);case 2:return n=t.replace(".json",".atlas"),e.next=5,new Promise((function(e){y.promises.access(n,y.constants.F_OK).then((function(){return e(!0)})).catch((function(){return e(!1)}))}));case 5:if(e.sent){e.next=9;break}return console.error("Could not find an atlas file for Spine file ".concat(t,".")),e.abrupt("return",null);case 9:return o=P.basename(n),a=new Map,i=!(0,v.Te)(r,n),s={resourceKind:"atlas",relPath:o,fullPath:n,isOutsideProjectFolder:i},a.set(o,s),e.abrupt("return",{embeddedResources:a,hasAnyEmbeddedResourceOutsideProjectFolder:i});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,l,p,d,f,h,m,g;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y&&P){e.next=2;break}return e.abrupt("return",null);case 2:return n=null,e.prev=3,e.next=6,y.promises.readFile(t,"utf8");case 6:n=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Unable to read Spine Atlas file at path ".concat(t,":"),e.t0);case 12:if(n){e.next=14;break}return e.abrupt("return",null);case 14:if(o=/.*\.(png|jpeg|jpg)$/gm,a=n.match(o)){e.next=18;break}return e.abrupt("return",null);case 18:i=P.dirname(t),s=new Map,l=!1,p=(0,c.Z)(a);try{for(p.s();!(d=p.n()).done;)f=d.value,h=P.resolve(i,f),m=!(0,v.Te)(r,h),g={resourceKind:"image",relPath:f,fullPath:h,isOutsideProjectFolder:m},s.set(f,g),m&&(l=!0)}catch(u){p.e(u)}finally{p.f()}return e.abrupt("return",{embeddedResources:s,hasAnyEmbeddedResourceOutsideProjectFolder:l});case 24:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var C={tilemap:S,json:S,spine:function(e,r){return F.apply(this,arguments)},atlas:function(e,r){return D.apply(this,arguments)}},O=t(40243),R=t(60022),N=t(15684),A=t(1773),I=t(52716),T=t(29343),L=w()("@electron/remote"),U=L?L.dialog:null,M=w()("path"),G=function(e){var r=e.options,t=e.selectedResourceIndex,n=e.onSelectResource;if(!n)return null;var o=r.resourceKind;return f.xz.includes(o)?(0,T.jsx)(m.L,{selectedResourceIndex:t,onSelectResource:n,resourceKind:o}):null},_=[].concat((0,p.Z)(f.QP.map((function(e){var r=e.kind,t=(e.displayName,e.fileExtensions),n=e.createNewResource,o=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(o){var a,s,p,d,f,h,m,g,w,x,b,y,P,k,S,E,F,D,O,R,N,A,I;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.i18n,s=o.getLastUsedPath,p=o.setLastUsedPath,d=o.project,f=o.options,h=o.resourcesImporationBehavior,U){e.next=3;break}throw new Error("Electron dialog not supported in this environment.");case 3:return m=["openFile"],f.multiSelection&&m.push("multiSelections"),g=M.dirname(d.getProjectFile()),w=s(d,r)||g,x=L.getCurrentWindow(),e.next=10,U.showOpenDialog(x,{title:a._({id:"Choose a file"}),properties:m,filters:[{name:a._({id:"Supported files"}),extensions:t}],defaultPath:w});case 10:if(b=e.sent,(y=b.filePaths)&&y.length){e.next=14;break}return e.abrupt("return",[]);case 14:if(P=M.parse(y[0]).dir,p(d,r,P),k=y.some((function(e){return!(0,v.Te)(d,e)})),S=new Map,E=C[r],F=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,c.Z)(r.embeddedResources.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=18;break}if(o=n.value,a=C[o.resourceKind]){e.next=8;break}return e.abrupt("continue",16);case 8:return i=o.fullPath,e.next=11,a(d,i);case 11:if(!(s=e.sent)){e.next=16;break}return S.set(i,s),e.next=16,F(s);case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),t.e(e.t0);case 23:return e.prev=23,t.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,20,23,26]])})));return function(r){return e.apply(this,arguments)}}(),!E){e.next=44;break}D=(0,c.Z)(y),e.prev=22,D.s();case 24:if((O=D.n()).done){e.next=36;break}return R=O.value,e.next=28,E(d,R);case 28:if(!(N=e.sent)){e.next=34;break}return e.next=32,F(N);case 32:S.set(R,N),N.hasAnyEmbeddedResourceOutsideProjectFolder&&(k=!0);case 34:e.next=24;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(22),D.e(e.t0);case 41:return e.prev=41,D.f(),e.finish(41);case 44:if(A=new Map,I=new Map,!k){e.next=54;break}if(!("relative"!==h&&("import"===h||i.ZP.showConfirmDialog(a._({id:"This/these file(s) are outside the project folder. Would you like to make a copy of them in your project folder first (recommended)?"}))))){e.next=54;break}return e.next=51,(0,v.ZC)(d,y,A);case 51:return y=e.sent,e.next=54,j(d,S);case 54:return I=Z(d,S),e.abrupt("return",y.map((function(e){var r=n();r.setFile(M.relative(g,e)),r.setName(M.relative(g,e));var t=A.has(e)?A.get(e):e;if(t){var o=I.get(t);o&&o.mapping&&r.setMetadata(JSON.stringify({embeddedResourcesMapping:o.mapping}))}return r})));case 56:case"end":return e.stop()}}),e,null,[[22,38,41,44]])})));return function(r){return e.apply(this,arguments)}}(),a="local-file-opener-"+r;return{name:a,displayName:{id:"File(s) from your device"},displayTab:"import",onlyForStorageProvider:"LocalFile",shouldCreateResource:!0,shouldGuessAnimationsFromName:!0,kind:r,selectResourcesHeadless:o,renderComponent:function(e){return(0,T.jsx)(O.x1,{justifyContent:"center",children:(0,T.jsx)(R.Z,{primary:!0,label:e.options.multiSelection?(0,T.jsx)(d.Trans,{id:"Choose one or more files"}):(0,T.jsx)(d.Trans,{id:"Choose a file"}),onClick:(0,l.Z)((0,u.Z)().mark((function r(){var t;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o({i18n:e.i18n,project:e.project,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,getLastUsedPath:e.getLastUsedPath,setLastUsedPath:e.setLastUsedPath,options:e.options,resourcesImporationBehavior:e.resourcesImporationBehavior});case 2:t=r.sent,e.onChooseResources({selectedResources:t,selectedSourceName:a});case 4:case"end":return r.stop()}}),r)})))})})}}}))),(0,p.Z)(f.QP.map((function(e){var r=e.kind,t=e.createNewResource,n="upload-".concat(r);return{name:n,displayName:{id:"File(s) from your device"},shouldCreateResource:!0,shouldGuessAnimationsFromName:!0,displayTab:"import",onlyForStorageProvider:"Cloud",kind:r,renderComponent:function(e){return(0,T.jsx)(N.V,{createNewResource:t,onChooseResources:function(r){return e.onChooseResources({selectedResources:r,selectedSourceName:n})},options:e.options,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,automaticallyOpenInput:!!e.automaticallyOpenIfPossible},"url-chooser-".concat(r))}}}))),(0,p.Z)(f.xz.map((function(e){var r=f.QP.find((function(r){return r.kind===e}));if(!r)return null;var t="resource-store-"+e;return{name:t,displayName:{id:"Choose from asset store"},displayTab:"standalone",kind:e,shouldCreateResource:!0,shouldGuessAnimationsFromName:!1,renderComponent:function(r){return(0,T.jsx)(G,{selectedResourceIndex:r.selectedResourceIndex,onSelectResource:r.onSelectResource,options:r.options},"resource-store-".concat(e))},renderPrimaryAction:function(n){var o=n.resource,a=n.onChooseResources;return(0,T.jsx)(A.vF,{primary:!0,label:"font"===e?(0,T.jsx)(d.Trans,{id:"Install font"}):(0,T.jsx)(d.Trans,{id:"Add to project"}),disabled:!o,onClick:function(){if(o){var e=o.url,n=r.createNewResource();n.setFile(e),n.setName(M.basename(e)),n.setOrigin("gdevelop-asset-store",e),a({selectedResources:[n],selectedSourceName:t})}}},"add-resource")}}})).filter(Boolean)),(0,p.Z)(f.QP.map((function(e){var r=e.kind,t=(e.createNewResource,"project-resources-".concat(r));return{name:t,displayName:{id:"Project resources"},displayTab:"standalone",shouldCreateResource:!1,shouldGuessAnimationsFromName:!1,hideInResourceEditor:!0,kind:r,renderComponent:function(e){return(0,T.jsx)(I.Z,{project:e.project,onResourcesSelected:e.onResourcesSelected,resourceKind:r,multiSelection:e.options.multiSelection},"project-resources-".concat(r))},renderPrimaryAction:function(e){var r=e.selectedResources,n=e.onChooseResources;return(0,T.jsx)(A.vF,{primary:!0,label:r&&r.length&&1!==r.length?(0,T.jsx)(d.Trans,{id:"Select {0} resources",values:{0:r.length}}):(0,T.jsx)(d.Trans,{id:"Select resource"}),disabled:!r||!r.length,onClick:function(){r&&r.length&&n({selectedResources:r,selectedSourceName:t})}},"select-resources")}}})))),J=_,W=t(4942),B=t(32705),z=t(75333),H=t(81303),K=w()("path"),X=w()("fs"),V=w()("electron"),Y=V?V.ipcRenderer:null,Q=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y){e.next=2;break}throw new Error("Not supported.");case 2:return e.next=4,Y.invoke("".concat(r,"-load"),t);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),q=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.project,n=r.resourceNames,o=K.dirname(t.getProjectFile()),a=[],i=[],s=t.getResourcesManager(),n.forEach((function(e){if(s.hasResource(e)){var r=s.getResource(e).getFile();(0,v.PX)(r)?(0,v.Gu)(r)?console.error("Unsupported blob URL for a resource - ignoring it."):a.push({url:r,resourceName:e}):i.push({localFilePath:r,resourceName:e})}})),e.next=8,(0,H.R7)({urlContainers:a,onProgress:function(e,r){}});case 8:return c=e.sent,p=new Map,e.next=12,Promise.all(c.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.error,t=r.blob,n=r.item,!t){e.next=15;break}return e.prev=2,e.t0=p,e.t1=n.resourceName,e.next=7,(0,H.oT)(t);case 7:e.t2=e.sent,e.t3={dataUrl:e.t2},e.t0.set.call(e.t0,e.t1,e.t3),e.next=15;break;case 12:e.prev=12,e.t4=e.catch(2),console.error('Unable to read data from resource "'.concat(n.resourceName,'" - ignoring it.'),e.t4);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(r){return e.apply(this,arguments)}}()));case 12:return e.next=14,Promise.all(i.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.localFilePath,n=r.resourceName,e.prev=1,e.next=4,X.promises.readFile(K.resolve(o,t));case 4:a=e.sent,p.set(n,{localFilePath:t,dataUrl:"data:text/plain;base64,"+a.toString("base64")}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error('Unable to read local file "'.concat(t,'" - ignoring it.'),e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(r){return e.apply(this,arguments)}}()));case 14:return e.abrupt("return",n.map((function(e){var r=p.get(e);if(!r)return{name:e,dataUrl:""};var t=r.localFilePath;return{name:e,dataUrl:r.dataUrl,localFilePath:t}})));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),$=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,l,p,d,f,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.externalEditorName,n=r.defaultName,o=r.metadataKey,a=r.resourceKind,i=r.options,s=i.project,c=i.resourceNames,l=i.resourceManagementProps,e.next=4,q({project:s,resourceNames:c});case 4:return p=e.sent,d={singleFrame:i.extraOptions.singleFrame,externalEditorData:(0,B.Z2)(o,i.extraOptions.existingMetadata),fps:i.extraOptions.fps,isLooping:i.extraOptions.isLooping,name:i.extraOptions.name||c[0]||n,resources:p},(0,z.sY)(t),e.next=9,Q(t,d);case 9:if(f=e.sent){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,(0,B.Zv)({baseNameForNewResources:f.baseNameForNewResources,project:s,resources:f.resources,resourceKind:a});case 14:return h=e.sent,e.prev=15,e.next=18,l.onFetchNewlyAddedResources();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),console.error("An error happened while fetching the newly added resources:",e.t0);case 23:return(0,B.$N)({modifiedResources:h,metadataKey:o,metadata:i.extraOptions.singleFrame?f.externalEditorData:null}),f.resources.some((function(e){return!e.name}))&&l.onNewResourcesAdded(),(0,B.TD)(h.map((function(e){return e.resource.getName()})),f.externalEditorData),e.abrupt("return",{resources:h.map((function(e){var r=e.resource,t=e.originalIndex;return{name:r.getName(),originalIndex:t}})),newName:f.baseNameForNewResources,newMetadata:(0,W.Z)({},o,f.externalEditorData)});case 28:case"end":return e.stop()}}),e,null,[[15,20]])})));return function(r){return e.apply(this,arguments)}}(),ee=[{name:"piskel-app",createDisplayName:{id:"Create with Piskel"},editDisplayName:{id:"Edit with Piskel"},kind:"image",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$({options:r,externalEditorName:"piskel",defaultName:"New image",metadataKey:"pskl",resourceKind:"image"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"Jfxr",createDisplayName:{id:"Create with Jfxr"},editDisplayName:{id:"Edit with Jfxr"},kind:"audio",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$({options:r,externalEditorName:"jfxr",defaultName:"New sound effect",metadataKey:"jfxr",resourceKind:"audio"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"Yarn",createDisplayName:{id:"Create with Yarn"},editDisplayName:{id:"Edit with Yarn"},kind:"json",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$({options:r,externalEditorName:"yarn",defaultName:"New dialogue tree",metadataKey:"yarn",resourceKind:"json"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}],re=ee,te=t(15671),ne=t(43144),oe=t(60136),ae=t(29388),ie=w()("os"),se=function(){try{return ie.userInfo().uid}catch(e){return""}},ue=w()("fs-extra"),ce=w()("path"),le=w()("os"),pe=t.g.gd,de=ce.posix||ce,fe=(0,ne.Z)((function e(r){var t=this;(0,te.Z)(this,e),this._filesToDownload={},this.getAllUrlFilesIn=function(e){var r=de.normalize(e).replace(/\\/g,"/");return Object.keys(t._filesToDownload).filter((function(e){return 0===e.indexOf(r)})).map((function(e){return{filePath:e,url:t._filesToDownload[e]}}))},this.mkDir=function(e){if(!(0,v.PX)(e)){try{ue.mkdirsSync(e)}catch(r){return console.error("mkDir("+e+") failed: "+r),!1}return!0}},this.dirExists=function(e){return!!(0,v.PX)(e)||ue.existsSync(e)},this.clearDir=function(e){try{ue.emptyDirSync(e)}catch(r){console.error("clearDir("+e+") failed: "+r)}},this.getTempDir=function(){return ce.join(le.tmpdir(),"GDTMP-".concat(se()))},this.fileNameFrom=function(e){return!t._downloadUrlsToLocalFiles&&(0,v.PX)(e)?e:ce.basename(e)},this.dirNameFrom=function(e){return ce.dirname(e).replace(/\\/g,"/")},this.makeAbsolute=function(e,r){return(0,v.PX)(e)?e:(t.isAbsolute(r)||(r=ce.resolve(r)),(0,v.PX)(r)?r+"/"+e:ce.resolve(r,ce.normalize(e)).replace(/\\/g,"/"))},this.makeRelative=function(e,r){return(0,v.PX)(e)?e:ce.relative(r,ce.normalize(e)).replace(/\\/g,"/")},this.isAbsolute=function(e){return!!(0,v.PX)(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,r){if((0,v.PX)(e))return!t._downloadUrlsToLocalFiles||((0,v.PX)(r)?(console.error("Destination can't be a URL in copyFile (from ".concat(e," to ").concat(r,").")),!1):(t._filesToDownload[de.normalize(r)]=e,!0));try{e!==r&&ue.copySync(e,r)}catch(a){if("ENOENT"===a.code){var n=Object.keys(t._filesToDownload).find((function(r){return r===e}));if(n){var o=t._filesToDownload[n];return t._filesToDownload[de.normalize(r)]=o,!0}}return console.error("copyFile("+e+", "+r+") failed: "+a),!1}return!0},this.writeToFile=function(e,r){try{ue.outputFileSync(e,r)}catch(t){return console.error("writeToFile("+e+", ...) failed: "+t),!1}return!0},this.readFile=function(e){try{return ue.readFileSync(e).toString()}catch(r){return console.error("readFile("+e+") failed: "+r),""}},this.readDir=function(e,r){r=r.toUpperCase();var t=new pe.VectorString;try{ue.existsSync(e)&&ue.readdirSync(e).forEach((function(n){0!==r.length&&-1===n.toUpperCase().indexOf(r,n.length-r.length)||t.push_back(e+"/"+n)}))}catch(n){console.error("readDir("+e+","+r+") failed: "+n)}return t},this.fileExists=function(e){var r=de.normalize(e);if(!!t._filesToDownload[r])return!0;try{return ue.statSync(e).isFile()}catch(n){return!1}},this._downloadUrlsToLocalFiles=!!r&&r.downloadUrlsToLocalFiles})),he=fe,me=t(74149),ve=t(10888),ge=t(86278),we=t(78081),xe=t(75087),be=t(94553),ye=t(6996),Pe=function(e){var r=e.url,t=e.open,n=e.error,o=e.onExport,a=e.onClose,i=e.onRunPreviewLocally,s=(0,ye.UQ)().isMobile;if(!t)return null;var u=r?"http://".concat(r):null;return(0,T.jsxs)(A.ZP,{title:(0,T.jsx)(d.Trans,{id:"Preview"}),actions:[(0,T.jsx)(ve.Z,{label:(0,T.jsx)(d.Trans,{id:"Close"}),primary:!0,onClick:a},"close")],secondaryActions:[o&&(0,T.jsx)(ve.Z,{label:(0,T.jsx)(d.Trans,{id:"Export game"}),onClick:o},"export"),(0,T.jsx)(ve.Z,{label:(0,T.jsx)(d.Trans,{id:"Run on this computer"}),onClick:i},"run-preview-locally")],open:t,onRequestClose:a,maxWidth:"sm",children:[n&&(0,T.jsx)(O.x1,{children:(0,T.jsx)(ge.Z,{children:(0,T.jsx)(d.Trans,{id:"Unable to start the server for the preview! Make sure that you are authorized to run servers on this computer. Otherwise, use classic preview to test your game."})})}),!n&&!u&&(0,T.jsx)(we.Z,{}),!n&&u&&(0,T.jsxs)("div",{children:[(0,T.jsx)(O.x1,{children:(0,T.jsx)(ge.Z,{children:(0,T.jsx)(d.Trans,{id:"Your preview is ready! On your mobile or tablet, open your browser and enter in the address bar:"})})}),(0,T.jsx)(xe.Z,{url:u}),u&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(O.x1,{children:(0,T.jsx)(ge.Z,{children:(0,T.jsx)(d.Trans,{id:"Or flash this QR code:"})})}),(0,T.jsx)(O.x1,{justifyContent:"center",children:(0,T.jsx)(be.Z,{url:u,size:s?100:150})})]}),(0,T.jsx)(O.x1,{children:(0,T.jsx)(ge.Z,{children:(0,T.jsx)(d.Trans,{id:"Please note that your device should be connected on the same network as this computer."})})})]})]})},je=t(25842),ke=t.n(je),Ze=t(79987),Se=w()("electron"),Ee=Se?Se.ipcRenderer:null,Fe="stopped",De=null,Ce=[],Oe=[],Re=new Map,Ne=1,Ae=null,Ie=!1,Te=function(){return[].concat((0,p.Z)(Le()),(0,p.Z)(Ue()))},Le=function(){return Ae?["embedded-game-frame"]:[]},Ue=function(){return Oe},Me=function(e,r){if(r){if(r.messageId){var t=Re.get(r.messageId);t?(t(r),Re.delete(r.messageId)):console.warn("Discarding response for messageId=".concat(r.messageId," - already handled or invalid id."))}Ce.forEach((function(t){return(0,t.onHandleParsedMessage)({id:e,parsedMessage:r})}))}},Ge=function(e){Ce.forEach((function(r){return(0,r.onConnectionClosed)({id:e,debuggerIds:Te()})}))},_e=new(function(){function e(){(0,te.Z)(this,e)}return(0,ne.Z)(e,[{key:"startServer",value:function(){if(!Ee)return Promise.reject();if("started"===Fe)return Promise.resolve();Ie||(window.addEventListener("message",(function(e){if(Ae&&e.source===Ae){var r=null;try{r=JSON.parse(e.data)}catch(t){console.warn("Error while parsing a message received from the embedded game frame:",t)}Me("embedded-game-frame",r)}})),Ie=!0);var e=new Promise((function(e,r){var t=!1;Fe="stopped",De=null,Ee&&(Ee.removeAllListeners("debugger-send-message-done"),Ee.removeAllListeners("debugger-error-received"),Ee.removeAllListeners("debugger-connection-closed"),Ee.removeAllListeners("debugger-connection-opened"),Ee.removeAllListeners("debugger-connection-errored"),Ee.removeAllListeners("debugger-start-server-done"),Ee.removeAllListeners("debugger-message-received")),Ee.on("debugger-error-received",(function(e,n){t||(r(n),t=!0),Ce.forEach((function(e){return(0,e.onErrorReceived)(n)}))})),Ee.on("debugger-connection-closed",(function(e,r){var t=r.id,n=Oe.indexOf(t);-1!==n&&Oe.splice(n,1),Ge(t)})),Ee.on("debugger-connection-opened",(function(e,r){var t=r.id;Oe.push(t),Ce.forEach((function(e){return(0,e.onConnectionOpened)({id:t,debuggerIds:Te()})}))})),Ee.on("debugger-connection-errored",(function(e,r){var t=r.id,n=r.errorMessage;Ce.forEach((function(e){return(0,e.onConnectionErrored)({id:t,errorMessage:n})}))})),Ee.on("debugger-start-server-done",(function(r,n){var o=n.address;console.info("Local preview debugger started"),Fe="started",De=o,t||(e(),t=!0),Ce.forEach((function(e){return(0,e.onServerStateChanged)()}))})),Ee.on("debugger-message-received",(function(e,r){var t=r.id,n=r.message,o=null;try{o=JSON.parse(n)}catch(a){console.warn("Error while parsing message received from debugger client:",a)}Me(t,o)})),Ee.send("debugger-start-server")})),r=new Promise((function(e,r){setTimeout((function(){r(new Error("Debugger server not started or errored after 5s - aborting."))}),5e3)}));return Promise.race([e,r])}},{key:"sendMessage",value:function(e,r){if("embedded-game-frame"===e)return Ae?void Ae.postMessage(r,"*"):void console.error("Cannot send message to the embedded game frame as it is not registered.");Ee&&("stopped"!==Fe?Ee.send("debugger-send-message",{id:e,message:JSON.stringify(r)}):console.error("Cannot send message when debugger server is stopped."))}},{key:"sendMessageWithResponse",value:function(e){var r=Ne;Ne++;var t,o=(0,c.Z)(Te());try{for(o.s();!(t=o.n()).done;){var a=t.value;this.sendMessage(a,(0,n.Z)((0,n.Z)({},e),{},{messageId:r}))}}catch(i){o.e(i)}finally{o.f()}return new Promise((function(e,t){Re.set(r,e),setTimeout((function(){t(new Error("Timeout while waiting for response from the debugger(s) for message with id ".concat(r,"."))),Re.delete(r)}),1e3)}))}},{key:"getServerState",value:function(){return Fe}},{key:"getExistingDebuggerIds",value:function(){return Te()}},{key:"getExistingEmbeddedGameFrameDebuggerIds",value:function(){return Le()}},{key:"getExistingPreviewDebuggerIds",value:function(){return Ue()}},{key:"registerCallbacks",value:function(e){return Ce.push(e),function(){var r=Ce.indexOf(e);-1!==r&&Ce.splice(r,1)}}},{key:"registerEmbeddedGameFrame",value:function(e){e!==Ae&&(Ae&&console.warn("An embedded game frame window was already registered. It will be replaced by the new one."),Ae=e,Ce.forEach((function(e){return(0,e.onConnectionOpened)({id:"embedded-game-frame",debuggerIds:Te()})})))}},{key:"unregisterEmbeddedGameFrame",value:function(e){Ae===e?(Ae=null,Ge("embedded-game-frame")):Ae&&console.warn("The embedded game frame window to unregister is not the same as the one registered. Ignoring the unregistration.")}},{key:"closeAllConnections",value:function(){var e=[].concat(Oe);Oe.length=0,e.forEach((function(e){Ge(e)})),Re.clear(),Ee&&e.length&&Ee.send("debugger-close-all-connections"),Ae&&(Ae=null,Ge("embedded-game-frame"))}}]),e}()),Je=t(52578),We=t(18870),Be=w()("electron"),ze=w()("path"),He=Be?Be.ipcRenderer:null,Ke=t.g.gd,Xe=1,Ve=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.isForInGameEdition,e.next=3,(0,me.findGDJS)();case 3:return n=e.sent,o=n.gdjsRoot,console.info("GDJS found in ",o),a=new he({downloadUrlsToLocalFiles:!1}),i=ke()(new Ke.AbstractFileSystemJS,a),s=ze.join(i.getTempDir(),t?"in-game-editor-preview":"preview"),c=new Ke.Exporter(i,o),e.abrupt("return",{outputDir:s,exporter:c,gdjsRoot:o});case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ye=function(e){(0,oe.Z)(t,e);var r=(0,ae.Z)(t);function t(){var e;(0,te.Z)(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=r.call.apply(r,[this].concat(o))).canDoNetworkPreview=function(){return!0},e.state={networkPreviewDialogOpen:!1,networkPreviewHost:null,networkPreviewPort:null,networkPreviewError:null,previewGamePath:null,previewBrowserWindowOptions:null,hotReloadsCount:0,hideMenuBar:!0,alwaysOnTop:!0,numberOfWindows:1,captureOptions:null},e._networkPreviewSubscriptionChecker=null,e._hotReloadSubscriptionChecker=null,e._openPreviewBrowserWindow=function(){var r=e.state,t=r.previewGamePath,n=r.previewBrowserWindowOptions,o=r.captureOptions,a=r.alwaysOnTop,i=r.hideMenuBar,s=r.numberOfWindows;n&&t&&He&&(He.invoke("preview-open",{previewBrowserWindowOptions:n,previewGameIndexHtmlPath:"file://".concat(t,"/index.html"),alwaysOnTop:a,hideMenuBar:i,numberOfWindows:s,captureOptions:o}),He.removeAllListeners("preview-window-closed"),He.on("preview-window-closed",function(){var r=(0,l.Z)((0,u.Z)().mark((function r(t){return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!o){r.next=3;break}return r.next=3,e.props.onCaptureFinished(o);case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()))},e.closePreview=function(e){He&&He.invoke("preview-close",{windowId:e})},e.closeAllPreviews=function(){He&&He.invoke("preview-close-all").catch((function(e){console.info("Unable to close all preview windows - ignoring.",e)}));var r=e.getPreviewDebuggerServer();r&&r.closeAllConnections()},e._openPreviewWindow=function(r,t,n){e.setState({previewBrowserWindowOptions:{width:r.getGameResolutionWidth(),height:r.getGameResolutionHeight(),useContentSize:!0,title:"Preview of ".concat(r.getName()),backgroundColor:"#000000",webPreferences:{webSecurity:!1,nodeIntegration:!0,contextIsolation:!1}},previewGamePath:t,hideMenuBar:!n.getIsMenuBarHiddenInPreview(),alwaysOnTop:n.getIsAlwaysOnTopInPreview(),numberOfWindows:n.numberOfWindows,captureOptions:n.captureOptions},(function(){if(n.networkPreview){if(!He)return;He.removeAllListeners("serve-folder-done"),He.removeAllListeners("local-network-ips"),He.on("serve-folder-done",(function(r,t,n){t?e.setState({networkPreviewDialogOpen:!0,networkPreviewPort:null,networkPreviewHost:null,networkPreviewError:t}):e.setState({networkPreviewDialogOpen:!0,networkPreviewPort:n.port}),setTimeout((function(){return e._checkSubscriptionForNetworkPreview()}))})),He.on("local-network-ip",(function(r,t){e.setState({networkPreviewHost:t})})),He.send("serve-folder",{root:t}),He.send("get-local-network-ip")}else e._openPreviewBrowserWindow()}))},e.launchPreview=function(){var r=(0,l.Z)((0,u.Z)().mark((function r(t){var n,o,a,s,c,l,p,d,f,h,m,v,g,w,x,b,y,P,j,k,Z,S,E;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.project,o=t.sceneName,a=t.externalLayoutName,s=t.eventsBasedObjectType,c=t.eventsBasedObjectVariantName,l=Xe++,console.log("[LocalPreviewLauncher] Launching preview #".concat(l," with options:"),t),r.prev=3,r.next=6,e.getPreviewDebuggerServer().startServer({});case 6:r.next=11;break;case 8:r.prev=8,r.t0=r.catch(3),console.error("Unable to start the Debugger Server for the preview:",r.t0);case 11:return r.next=13,Ve({isForInGameEdition:t.isForInGameEdition});case 13:for(x in p=r.sent,d=p.outputDir,f=p.exporter,h=p.gdjsRoot,m=performance.now(),(v=new Ke.PreviewExportOptions(n,d)).setIsDevelopmentEnvironment(i.ZP.isDev()),v.setLayoutName(o),v.setIsInGameEdition(t.isForInGameEdition),v.setEditorId(t.editorId||""),a&&v.setExternalLayoutName(a),s&&(v.setEventsBasedObjectType(s),v.setEventsBasedObjectVariantName(c||"")),t.isForInGameEdition?v.useWindowMessageDebuggerClient():(g=De)&&v.useWebsocketDebuggerClientWithServerAddress(g.address,""+g.port),w=e.props.getIncludeFileHashs())b=w[x],v.setIncludeFileHash(x,b);v.setElectronRemoteRequirePath(ze.join(h,"../preview_node_modules","@electron/remote","renderer/index.js")),y=t.isForInGameEdition?e.getPreviewDebuggerServer().getExistingEmbeddedGameFrameDebuggerIds():e.getPreviewDebuggerServer().getExistingPreviewDebuggerIds(),(P=t.hotReload&&!!y.length)&&(v.setShouldClearExportFolder(t.shouldHardReload),v.setShouldReloadProjectData(!1),v.setShouldReloadLibraries(t.shouldReloadLibraries||t.shouldGenerateScenesEventsCode),v.setShouldGenerateScenesEventsCode(t.shouldGenerateScenesEventsCode)),v.setFullLoadingScreen(t.fullLoadingScreen),v.setGDevelopVersionWithHash((0,Je.Us)()),v.setCrashReportUploadLevel(e.props.crashReportUploadLevel),v.setPreviewContext(e.props.previewContext),v.setProjectTemplateSlug(n.getTemplateSlug()),v.setSourceGameId(e.props.sourceGameId),t.inAppTutorialMessageInPreview&&v.setInAppTutorialMessageInPreview(t.inAppTutorialMessageInPreview,t.inAppTutorialMessagePositionInPreview),t.fallbackAuthor&&v.setFallbackAuthor(t.fallbackAuthor.id,t.fallbackAuthor.username),t.authenticatedPlayer&&v.setAuthenticatedPlayer(t.authenticatedPlayer.playerId,t.authenticatedPlayer.playerUsername,t.authenticatedPlayer.playerToken),t.captureOptions&&t.captureOptions.screenshots&&t.captureOptions.screenshots.forEach((function(e){v.addScreenshotCapture(e.delayTimeInSeconds,e.signedUrl,e.publicUrl)})),t.editorCameraState3D&&v.setEditorCameraState3D(t.editorCameraState3D.cameraMode,t.editorCameraState3D.positionX,t.editorCameraState3D.positionY,t.editorCameraState3D.positionZ,t.editorCameraState3D.rotationAngle,t.editorCameraState3D.elevationAngle,t.editorCameraState3D.distance),t.inGameEditorSettings&&v.setInGameEditorSettingsJson(JSON.stringify(t.inGameEditorSettings)),f.exportProjectForPixiPreview(v),P?(j=new Ke.SerializerElement,f.serializeProjectData(n,v,j),k=JSON.parse(Ke.Serializer.toJSON(j)),j.delete(),Z=new Ke.SerializerElement,f.serializeRuntimeGameOptions(v,Z),S=JSON.parse(Ke.Serializer.toJSON(Z)),Z.delete(),t.shouldHardReload?(console.log("[LocalPreviewLauncher] Triggering hard reload for preview #".concat(l,"...")),y.forEach((function(r){e.getPreviewDebuggerServer().sendMessage(r,{command:"hardReload"})}))):y.forEach((function(r){console.log("[LocalPreviewLauncher] Triggering hot reload for preview #".concat(l,"...")),e.getPreviewDebuggerServer().sendMessage(r,{command:"hotReload",payload:{shouldReloadResources:t.shouldReloadResources,projectData:k,runtimeGameOptions:S}})})),t.isForInGameEdition||(e.state.hotReloadsCount%16===0&&e._hotReloadSubscriptionChecker&&e._hotReloadSubscriptionChecker.checkUserHasSubscription(),e.setState((function(e){return{hotReloadsCount:e.hotReloadsCount+1}})))):(t.isForInGameEdition&&(0,We.qP)({previewIndexHtmlLocation:"file://".concat(d,"/index.html")}),t.numberOfWindows>=1&&e._openPreviewWindow(n,d,t)),f.delete(),v.delete(),E=performance.now(),console.info("[LocalPreviewLauncher] Preview #".concat(l," took ").concat(E-m,"ms"));case 50:case"end":return r.stop()}}),r,null,[[3,8]])})));return function(e){return r.apply(this,arguments)}}(),e._checkSubscriptionForNetworkPreview=function(){return!e._networkPreviewSubscriptionChecker||e._networkPreviewSubscriptionChecker.checkUserHasSubscription()},e}return(0,ne.Z)(t,[{key:"getPreviewDebuggerServer",value:function(){return _e}},{key:"render",value:function(){var e=this,r=this.state,t=r.networkPreviewDialogOpen,n=r.networkPreviewHost,a=r.networkPreviewPort,i=r.networkPreviewError;return(0,T.jsxs)(o.Fragment,{children:[(0,T.jsx)(Ze.Z,{ref:function(r){return e._networkPreviewSubscriptionChecker=r},onChangeSubscription:function(){return e.setState({networkPreviewDialogOpen:!1})},id:"Preview over wifi",title:(0,T.jsx)(d.Trans,{id:"Preview over wifi"}),placementId:"preview-wifi",mode:"try",isNotShownDuringInAppTutorial:!0}),(0,T.jsx)(Ze.Z,{ref:function(r){return e._hotReloadSubscriptionChecker=r},id:"Hot reloading",title:(0,T.jsx)(d.Trans,{id:"Live preview (apply changes to the running preview)"}),placementId:"hot-reloading",mode:"try",isNotShownDuringInAppTutorial:!0}),(0,T.jsx)(Pe,{open:t,url:n&&a?"".concat(n,":").concat(a):null,error:i,onClose:function(){return e.setState({networkPreviewDialogOpen:!1})},onExport:this.props.onExport,onRunPreviewLocally:this._openPreviewBrowserWindow})]})}}]),t}(o.Component),Qe=t(73818),qe=t(76349),$e=t(19431),er=w()("@electron/remote"),rr=er?er.shell:null,tr=t.g.gd,nr="local-cordova",or={name:nr,packageNameWarningType:"mobile",getInitialExportState:function(e){return{outputDir:e.getLastCompilationDirectory()}},canLaunchBuild:function(e){return!!e.outputDir},isNavigationDisabled:function(){return!1},renderHeader:function(e){var r=e.project,t=e.exportState,n=e.updateExportState;return"done"!==e.exportStep?(0,T.jsxs)(O.sg,{noMargin:!0,children:[(0,T.jsx)(O.x1,{children:(0,T.jsx)(O.sg,{noMargin:!0,children:(0,T.jsx)(qe.if,{})})}),(0,T.jsx)(O.x1,{children:(0,T.jsx)(Qe.Z,{type:"export",value:t.outputDir,defaultPath:r.getLastCompilationDirectory(),onChange:function(e){n((function(){return{outputDir:e}})),r.setLastCompilationDirectory(e)},fullWidth:!0})})]}):null},renderExportFlow:function(e){return(0,T.jsx)(qe.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:nr}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new tr.AbstractFileSystemJS,t);return{exporter:new tr.Exporter(n,r),localFileSystem:t}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,(i=new tr.ExportOptions(r.project,r.exportState.outputDir)).setTarget("cordova"),n&&i.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(i),i.delete(),o.delete(),e.abrupt("return",{urlFiles:a.getAllUrlFilesIn(r.exportState.outputDir)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:n,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){return Promise.resolve(null)},renderDoneFooter:function(e){var r=e.exportState,t=function(){rr&&rr.openPath(r.outputDir)};return(0,T.jsx)(qe.Eg,{renderGameButton:function(){return(0,T.jsx)(R.Z,{label:(0,T.jsx)(d.Trans,{id:"Open folder"}),primary:!0,onClick:t},"open")}})}},ar=t(41426),ir=w()("@electron/remote"),sr=ir?ir.shell:null,ur=t.g.gd,cr="local-electron",lr={name:cr,packageNameWarningType:"desktop",getInitialExportState:function(e){return{outputDir:e.getLastCompilationDirectory()}},canLaunchBuild:function(e){return!!e.outputDir},isNavigationDisabled:function(){return!1},renderHeader:function(e){var r=e.project,t=e.exportState,n=e.updateExportState;return"done"!==e.exportStep?(0,T.jsxs)(O.sg,{noMargin:!0,expand:!0,children:[(0,T.jsx)(O.x1,{children:(0,T.jsx)(O.sg,{noMargin:!0,children:(0,T.jsx)(ar.if,{})})}),(0,T.jsx)(O.x1,{children:(0,T.jsx)(Qe.Z,{type:"export",value:t.outputDir,defaultPath:r.getLastCompilationDirectory(),onChange:function(e){n((function(){return{outputDir:e}})),r.setLastCompilationDirectory(e)},fullWidth:!0})})]}):null},renderExportFlow:function(e){return(0,T.jsx)(ar.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:cr}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new ur.AbstractFileSystemJS,t);return{exporter:new ur.Exporter(n,r),localFileSystem:t}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,(i=new ur.ExportOptions(r.project,r.exportState.outputDir)).setTarget("electron"),n&&i.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(i),i.delete(),o.delete(),e.abrupt("return",{urlFiles:a.getAllUrlFilesIn(r.exportState.outputDir)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:n,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){return Promise.resolve(null)},renderDoneFooter:function(e){var r=e.exportState,t=function(){sr&&sr.openPath(r.outputDir)};return(0,T.jsx)(ar.Eg,{renderGameButton:function(){return(0,T.jsx)(R.Z,{label:(0,T.jsx)(d.Trans,{id:"Open folder"}),primary:!0,onClick:t},"open")}})}},pr=t(39935),dr=t(95644),fr=w()("@electron/remote"),hr=fr?fr.shell:null,mr=t.g.gd,vr="local-html5",gr={name:vr,getInitialExportState:function(e){return{outputDir:e.getLastCompilationDirectory()}},canLaunchBuild:function(e){return!!e.outputDir},isNavigationDisabled:function(){return!1},renderTutorial:function(){return(0,T.jsx)(dr.Z,{tutorialId:"export-to-itch"})},renderHeader:function(e){var r=e.project,t=e.exportState,n=e.updateExportState;return"done"!==e.exportStep?(0,T.jsxs)(O.sg,{noMargin:!0,expand:!0,children:[(0,T.jsx)(O.x1,{children:(0,T.jsx)(pr.if,{})}),(0,T.jsx)(O.x1,{children:(0,T.jsx)(Qe.Z,{type:"export",value:t.outputDir,defaultPath:r.getLastCompilationDirectory(),onChange:function(e){n((function(){return{outputDir:e}})),r.setLastCompilationDirectory(e)},fullWidth:!0})})]}):null},renderExportFlow:function(e){return(0,T.jsx)(pr.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:vr}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new mr.AbstractFileSystemJS,t);return{exporter:new mr.Exporter(n,r),localFileSystem:t}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=new mr.ExportOptions(r.project,r.exportState.outputDir),n&&i.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(i),i.delete(),o.delete(),e.abrupt("return",{urlFiles:a.getAllUrlFilesIn(r.exportState.outputDir)});case 7:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:n,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){return Promise.resolve(null)},renderDoneFooter:function(e){var r=e.exportState;return(0,T.jsx)(pr.Eg,{renderGameButton:function(){return(0,T.jsx)(R.Z,{primary:!0,onClick:function(){hr&&hr.openPath(r.outputDir)},label:(0,T.jsx)(d.Trans,{id:"Open the exported game folder"})})}})}},wr=t(29277),xr=w()("electron"),br=w()("@electron/remote"),yr=br?br.dialog:null,Pr={container:{position:"relative",display:"flex",alignItems:"baseline"},button:{marginLeft:10},textField:{flex:1}},jr=function(e){var r=e.value,t=e.onChange,o=e.title,a=e.message,i=e.defaultPath,s=e.fullWidth,c=e.filters,p=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var r,n,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yr&&xr){e.next=2;break}return e.abrupt("return");case 2:return r=br.getCurrentWindow(),e.next=5,yr.showSaveDialog(r,{title:o,filters:c,message:a,defaultPath:i});case 5:n=e.sent,s=n.filePath,t(s||"");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,T.jsxs)("div",{style:(0,n.Z)((0,n.Z)({},Pr.container),{},{width:s?"100%":void 0}),children:[(0,T.jsx)(wr.ZP,{margin:"dense",style:Pr.textField,type:"text",translatableHintText:{id:"Choose a file"},value:r,onChange:function(e,r){return t(r)}}),(0,T.jsx)(ve.Z,{label:(0,T.jsx)(d.Trans,{id:"Choose"}),style:Pr.button,onClick:p})]})};function kr(e){var r=!1,t=void 0;return function(){return r||(console.info("Lazy loading ".concat(e,"...")),t=w()(e),r=!0),t}}var Zr=w()("fs"),Sr=kr("archiver"),Er=function(e){var r=e.path,t=e.outputFilename,n=e.sizeLimit,o=Sr();return new Promise((function(e,a){if(!Zr||!o)return a(new Error("Archiver unavailable"));var i=Zr.createWriteStream(t),s=o("zip",{zlib:{level:9}});i.on("close",(function(){var r=s.pointer();if(console.log("Archive written at ".concat(t,", ").concat(r," total bytes.")),n&&r>n){var o=Math.round(r/1e6);a(new Error("Archive is of size ".concat(o," MB, which is above the limit allowed of ").concat(n/1e6," MB.")))}e(t)})),s.on("error",(function(e){a(e)})),s.pipe(i),s.directory(r,!1),s.finalize()}))},Fr=t(15745),Dr=w()("path"),Cr=w()("@electron/remote"),Or=Cr?Cr.app:null,Rr=Cr?Cr.shell:null,Nr=t.g.gd,Ar="local-facebook-instant-games",Ir={name:Ar,getInitialExportState:function(e){return{archiveOutputFilename:Or?Dr.join(Or.getPath("documents"),"fb-instant-game.zip"):""}},canLaunchBuild:function(e){return!!e.archiveOutputFilename},isNavigationDisabled:function(){return!1},renderHeader:function(e){e.project;var r=e.exportState,t=e.updateExportState;return"done"!==e.exportStep?(0,T.jsxs)(O.sg,{noMargin:!0,expand:!0,children:[(0,T.jsx)(O.x1,{children:(0,T.jsx)(Fr.if,{})}),(0,T.jsx)(O.x1,{children:(0,T.jsx)(jr,{title:"Facebook Instant Games export zip file",message:"Choose where to save the exported file for Facebook Instant Games",filters:[{name:"Compressed file for Facebook Instant Games",extensions:["zip"]}],value:r.archiveOutputFilename,defaultPath:Or?Or.getPath("documents"):"",onChange:function(e){return t((function(){return{archiveOutputFilename:e}}))},fullWidth:!0})})]}):null},renderExportFlow:function(e){return(0,T.jsx)(Fr.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:Ar}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new Nr.AbstractFileSystemJS,t),o=new Nr.Exporter(n,r),a=Dr.join(n.getTempDir(),"FacebookInstantGamesExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new Nr.ExportOptions(r.project,i)).setTarget("facebookInstantGames"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir;return Er({path:t,outputFilename:e.exportState.archiveOutputFilename})},renderDoneFooter:function(e){var r=e.exportState,t=function(){Rr&&Dr&&Rr.openPath(Dr.dirname(r.archiveOutputFilename))};return(0,T.jsx)(Fr.Eg,{renderGameButton:function(){return(0,T.jsx)(R.Z,{label:(0,T.jsx)(d.Trans,{id:"Open folder"}),primary:!0,onClick:t},"open")}})}},Tr=t(10959),Lr=w()("electron"),Ur=Lr?Lr.ipcRenderer:null,Mr=function(e,r,t){return Ur?(Ur.removeAllListeners("local-file-upload-progress"),Ur.removeAllListeners("local-file-upload-done"),new Promise((function(n,o){Ur.on("local-file-upload-progress",(function(e,r,n){t(r,n)})),Ur.on("local-file-upload-done",(function(e,r){if(r)return o(r);n()})),Ur.send("local-file-upload",e,r)}))):Promise.reject("No support for local file upload")},Gr=t(61421),_r=w()("path"),Jr=w()("os"),Wr=t.g.gd,Br="local-online-cordova",zr={name:Br,onlineBuildType:"cordova-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["androidApk"],keystore:"new",signingDialogOpen:!1}},canLaunchBuild:function(e,r,t){return r||""===t},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,T.jsx)(Gr.s_,(0,n.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,T.jsx)(Gr.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:Br}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new Wr.AbstractFileSystemJS,t),o=new Wr.Exporter(n,r),a=_r.join(n.getTempDir(),"OnlineCordovaExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new Wr.ExportOptions(r.project,i)).setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=Jr.tmpdir();return Er({path:t,outputFilename:_r.join(n,"game-archive.zip")})},launchUpload:function(e,r){return(0,Tr.Zi)().then((function(t){return Mr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o,a){var i=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,Tr.$C)(i,s.uid,t,e.targets,e.keystore,n,o,a):Promise.reject(new Error("User is not authenticated"))}},Hr=t(90078),Kr=w()("path"),Xr=w()("os"),Vr=t.g.gd,Yr="local-online-cordova-ios",Qr={name:Yr,onlineBuildType:"cordova-ios-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["iosAppStore"],signing:null}},canLaunchBuild:function(e,r,t){return(r||""===t)&&!!e.signing},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,T.jsx)(Hr.s_,(0,n.Z)({},e))},shouldSuggestBumpingVersionNumber:function(){return!0},renderExportFlow:function(e){return(0,T.jsx)(Hr.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:Yr}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new Vr.AbstractFileSystemJS,t),o=new Vr.Exporter(n,r),a=Kr.join(n.getTempDir(),"OnlineCordovaExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new Vr.ExportOptions(r.project,i)).setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=Xr.tmpdir();return Er({path:t,outputFilename:Kr.join(n,"game-archive.zip")})},launchUpload:function(e,r){return(0,Tr.Zi)().then((function(t){return Mr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o,a){var i=r.getAuthorizationHeader,s=r.profile;return s?e.signing?(0,Tr.NZ)(i,s.id,t,e.targets,e.signing,n,o,a):Promise.reject(new Error("Signing options not set up")):Promise.reject(new Error("User is not authenticated"))}},qr=t(87335),$r=w()("path"),et=w()("os"),rt=t.g.gd,tt="local-online-electron",nt={name:tt,onlineBuildType:"electron-build",limitedBuilds:!0,packageNameWarningType:"desktop",getInitialExportState:function(){return{targets:["winExe"]}},canLaunchBuild:function(e,r,t){return!!e.targets.length&&(r||""===t)},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,T.jsx)(qr.s_,(0,n.Z)({},e))},renderExportFlow:function(e){return(0,T.jsx)(qr.yg,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:tt}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new rt.AbstractFileSystemJS,t),o=new rt.Exporter(n,r),a=$r.join(n.getTempDir(),"OnlineElectronExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new rt.ExportOptions(r.project,i)).setTarget("electron"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=et.tmpdir();return Er({path:t,outputFilename:$r.join(n,"game-archive.zip")})},launchUpload:function(e,r){return(0,Tr.Zi)().then((function(t){return Mr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o,a){var i=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,Tr.ch)(i,s.uid,t,e.targets,n,o,a):Promise.reject(new Error("User is not authenticated"))}},ot=t(96516),at=t(4615),it=w()("path"),st=w()("os"),ut=t.g.gd,ct="local-online-web",lt={name:ct,onlineBuildType:"web-build",getInitialExportState:function(){return null},canLaunchBuild:function(e,r,t){return r||""===t||"done"===t},isNavigationDisabled:function(e,r){return!r&&!["","done"].includes(e)},renderHeader:function(e){var r=e.uiMode;return(0,T.jsx)(ot.if,{uiMode:r})},renderExportFlow:function(e){return(0,T.jsx)(at.Z,(0,n.Z)((0,n.Z)({},e),{},{exportPipelineName:ct}))},prepareExporter:function(e){return(0,me.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new he({downloadUrlsToLocalFiles:!0}),n=ke()(new ut.AbstractFileSystemJS,t),o=new ut.Exporter(n,r),a=it.join(n.getTempDir(),"OnlineWebExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,s=new ut.ExportOptions(r.project,i),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 7:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,$e.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=st.tmpdir();return Er({path:t,outputFilename:it.join(n,"game-archive.zip"),sizeLimit:25e7})},launchUpload:function(e,r){return(0,Tr.Zi)().then((function(t){return Mr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o,a){var i=r.getAuthorizationHeader,s=r.firebaseUser;return s?(0,Tr.Bc)(i,s.uid,t,n,o,a):Promise.reject(new Error("User is not authenticated"))}},pt=(0,n.Z)((0,n.Z)({},ot.O1),{},{exportPipeline:lt}),dt=[(0,n.Z)((0,n.Z)({},pr.BN),{},{exportPipeline:gr}),(0,n.Z)((0,n.Z)({},Gr.Vf),{},{exportPipeline:zr}),(0,n.Z)((0,n.Z)({},Hr.Y$),{},{exportPipeline:Qr}),(0,n.Z)((0,n.Z)({},qr.OL),{},{exportPipeline:nt}),(0,n.Z)((0,n.Z)({},Fr.xu),{},{exportPipeline:Ir})],ft=[(0,n.Z)((0,n.Z)({},pr.BN),{},{exportPipeline:gr}),(0,n.Z)((0,n.Z)({},qe.VU),{},{exportPipeline:or}),(0,n.Z)((0,n.Z)({},ar.c8),{},{exportPipeline:lr})],ht=t(76288),mt=t(36559),vt=t(36262),gt=t(71106),wt=w()("electron"),xt=w()("@electron/remote"),bt=xt?xt.app:null,yt=wt?wt.ipcRenderer:null,Pt=function(e){var r=e.ipcEvent,t=e.callback,n=e.shouldApply;o.useEffect((function(){if(yt&&n){var e=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return t.apply(void 0,n)};return yt.on(r,e),function(){return yt.removeListener(r,e)}}}),[r,t,n])},jt=function(e){var r=e.event,t=e.callback;o.useEffect((function(){if(bt){var e=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return t.apply(void 0,n)};return bt.on(r,e),function(){return bt.removeListener(r,e)}}}),[r,t])},kt=function(e){if(!e)return!1;var r=e.toLowerCase();return r.startsWith("gdevelop")&&"gdevelop dialogue tree editor (yarn)"!==r&&"gdevelop sound effects editor (jfxr)"!==r&&"gdevelop image editor (piskel)"!==r},Zt=function(e){var r=e.props,t=e.callbacks,n=e.extraCallbacks,a=r.i18n,i=r.project,s=r.canSaveProjectAs,u=r.recentProjectFiles,c=r.shortcutMap,l=r.isApplicationTopLevelMenu,p=n.onClosePreview,d=a.language,f=o.useState(!0),h=(0,x.Z)(f,2),m=h[0],v=h[1],g=o.useState(xt.getCurrentWindow().id),w=(0,x.Z)(g,2),b=w[0],y=w[1],P=!m&&p?function(){return p(b)}:null,j=o.useContext(vt.ZP).values.useShortcutToClosePreviewWindow,k=o.useContext(gt.ZP).limits,Z=!!k&&!!k.capabilities.classrooms&&k.capabilities.classrooms.hideAskAi;jt({event:"browser-window-focus",callback:function(e){y(e.id),v(kt(e.title))}}),jt({event:"browser-window-blur",callback:function(e){v(!kt(e.title))}}),Pt({ipcEvent:"main-menu-open",callback:t.onChooseProject,shouldApply:m}),Pt({ipcEvent:"main-menu-open-recent",callback:t.onOpenRecentFile,shouldApply:m}),Pt({ipcEvent:"main-menu-save",callback:t.onSaveProject,shouldApply:m}),Pt({ipcEvent:"main-menu-save-as",callback:t.onSaveProjectAs,shouldApply:m}),Pt({ipcEvent:"main-menu-show-version-history",callback:t.onShowVersionHistory,shouldApply:m}),Pt({ipcEvent:"main-menu-close",callback:j&&P?P:t.onCloseProject,shouldApply:!(!j||!P)||m}),Pt({ipcEvent:"main-menu-close-app",callback:t.onCloseApp,shouldApply:m}),Pt({ipcEvent:"main-menu-export",callback:t.onExportProject,shouldApply:m}),Pt({ipcEvent:"main-menu-invite-collaborators",callback:t.onInviteCollaborators,shouldApply:m}),Pt({ipcEvent:"main-menu-create-project",callback:t.onCreateProject,shouldApply:m}),Pt({ipcEvent:"main-menu-open-project-manager",callback:t.onOpenProjectManager,shouldApply:m}),Pt({ipcEvent:"main-menu-open-home-page",callback:t.onOpenHomePage,shouldApply:m}),Pt({ipcEvent:"main-menu-open-debugger",callback:t.onOpenDebugger,shouldApply:m}),Pt({ipcEvent:"main-menu-open-about",callback:t.onOpenAbout,shouldApply:m}),Pt({ipcEvent:"main-menu-open-preferences",callback:t.onOpenPreferences,shouldApply:m}),Pt({ipcEvent:"main-menu-open-language",callback:t.onOpenLanguage,shouldApply:m}),Pt({ipcEvent:"main-menu-open-profile",callback:t.onOpenProfile,shouldApply:m}),Pt({ipcEvent:"main-menu-open-ask-ai",callback:t.onOpenAskAi,shouldApply:m}),Pt({ipcEvent:"update-status",callback:t.setElectronUpdateStatus,shouldApply:!0}),o.useEffect((function(){yt&&yt.send("set-main-menu",(0,mt.c)({project:i,canSaveProjectAs:s,i18n:a,recentProjectFiles:u,shortcutMap:c,isApplicationTopLevelMenu:l,hideAskAi:Z}))}),[a,d,i,s,u,c,l,Z]);var S=t.onOpenRecentFile;return(0,ht.gT)("OPEN_RECENT_PROJECT",!0,{generateOptions:o.useCallback((function(){return u.map((function(e){return{text:e.fileMetadata.fileIdentifier,handler:function(){return S(e)}}}))}),[S,u])}),null},St=t(50790),Et=t.n(St),Ft=t(91479),Dt=t.n(Ft),Ct=w()("path"),Ot=w()("os"),Rt=w()("fs"),Nt=function(e){var r=e.onWriteFile,t=Ct.join(Ot.tmpdir(),"GDGeneratedEventsFunctions-"+se());Rt.mkdir(t,(function(e){e&&"EEXIST"!==e.code&&console.error("Unable to create the directory where to output events functions generated code: ",e)}));var n=function(e){return"".concat(t,"/").concat(Dt()(e),".js")};return{getIncludeFileFor:function(e){return n(e)},writeFunctionCode:function(e,t){return new Promise((function(o,a){var i=n(e);r({includeFile:i,content:t}),Rt.writeFile(i,t,(function(e){if(e)return a(e);o()}))}))},writeBehaviorCode:function(e,t){return new Promise((function(o,a){var i=n(e);r({includeFile:i,content:t}),Rt.writeFile(i,t,(function(e){if(e)return a(e);o()}))}))},writeObjectCode:function(e,t){return new Promise((function(o,a){var i=n(e);r({includeFile:i,content:t}),Rt.writeFile(i,t,(function(e){if(e)return a(e);o()}))}))}}},At=t(92666),It=t(29571),Tt=t(26244),Lt=w()("fs-extra"),Ut=w()("path"),Mt=w()("@electron/remote"),Gt=Mt?Mt.dialog:null,_t=(0,ne.Z)((function e(){(0,te.Z)(this,e)}));_t.chooseEventsFunctionExtensionFile=function(e){if(!Gt)return Promise.reject("Not supported");var r=Mt.getCurrentWindow();return Gt.showSaveDialog(r,{title:"Export an extension of the project",filters:[{name:'GDevelop 5 "events based" extension',extensions:["json"]}],defaultPath:(e||"Extension")+".json"}).then((function(e){var r=e.filePath;return r||null}))},_t.writeSerializedObject=function(e,r){return function(e,r){if(!Lt)return Promise.reject(new Error("Filesystem is not supported."));try{var t=JSON.stringify(e,null,2);return Lt.ensureDir(Ut.dirname(r)).then((function(){return new Promise((function(e,n){Lt.writeFile(r,t,(function(r){return r?n(r):e()}))}))}))}catch(n){return Promise.reject(n)}}(e,r).catch((function(e){throw console.error("Unable to write the events function extension:",e),e}))};var Jt=t(4217),Wt=(0,ne.Z)((function e(){(0,te.Z)(this,e)}));Wt.chooseEventsFunctionExtensionFile=function(){return(0,Jt.fZ)({title:"Import extensions into the project",properties:["openFile","multiSelections"],message:"Choose extension files to import (.json file)",filters:[{name:'GDevelop 5 "events based" extension',extensions:["json"]}]}).then((function(e){return e}))},Wt.readEventsFunctionExtensionFile=function(e){return(0,Jt.zn)(e)};var Bt,zt,Ht=t(56924),Kt=function(e,r){var t=r.isReferenceMagicPropertyName,n=r.getReferencePartialObject,o=r.maxUnsplitDepth;return function e(r,a){if(void 0!==o&&a>=o)return Promise.resolve();if(null!==r&&"object"===typeof r){var i=Object.keys(r);if(i)return Promise.all(i.map((function(o){var i=function(e){return!0===e[t]?e:null}(r[o]);return i?n(i.referenceTo).then((function(t){return r[o]=t,e(r[o],a+1)})):e(r[o],a+1)}))).then((function(){}))}return Promise.resolve()}(e,0)},Xt=function(e){var r={};return function(t,n){var o=t[e];if("string"!==typeof o)throw new Error("Property ".concat(e," is not a string"));r[n]=r[n]||{};var a=(0,b.Z)(Dt()(o),(function(e){return!!r[n][e]}));return r[n][a]=!0,a}},Vt=w()("fs"),Yt=w()("path"),Qt=function(){return(0,Jt.y)({title:"Open a project",properties:["openFile"],message:"If you want to open your GDevelop 4 project, be sure to save it as a .json file",filters:[{name:"GDevelop 5 project",extensions:["json"]}]}).then((function(e){return e?{fileIdentifier:e}:null}))},qt=function(e){var r=e.fileIdentifier,t=Yt.dirname(r);return(0,Jt.zn)(r).then((function(e){return Kt(e,{getReferencePartialObject:function(e){return(0,Jt.zn)(Yt.join(t,e)+".json")},isReferenceMagicPropertyName:"__REFERENCE_TO_SPLIT_OBJECT",maxUnsplitDepth:3}).then((function(){return{content:e}}))}))},$t=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.fileIdentifier,o=n+".autosave",!Vt.existsSync(o)){e.next=15;break}if(a=Vt.statSync(o).mtime.getTime(),t){e.next=6;break}return e.abrupt("return",a);case 6:return e.prev=6,i=Vt.statSync(n).mtime.getTime(),e.abrupt("return",a>i+5e3?a:null);case 11:return e.prev=11,e.t0=e.catch(6),console.error("Unable to compare *.autosave to project",e.t0),e.abrupt("return",null);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(r,t){return e.apply(this,arguments)}}(),en=function(e){return Promise.resolve((0,n.Z)((0,n.Z)({},e),{},{fileIdentifier:e.fileIdentifier+".autosave"}))},rn=t(41006),tn=t(61785),nn=w()("fs-extra"),on=w()("path"),an=w()("@electron/remote"),sn=an?an.dialog:null,un=["layouts","externalLayouts","externalEvents","eventsFunctionsExtensions"],cn=function(e,r){e.isFolderProject()&&nn.readdirSync(r).forEach((function(e){if(un.includes(e)){var t=on.join(r,e);if(nn.statSync(t).isDirectory())nn.readdirSync(t).forEach((function(e){var r=on.join(t,e);try{nn.unlinkSync(r)}catch(n){throw new Error("Unable to remove file ".concat(e,": ").concat(n.message))}}))}}))},ln=function(e,r){var t=performance.now();return new Promise((function(n,o){nn.readFile(e,{encoding:"utf8"},(function(a,i){if(a)return o(a);""===i&&o(new Error("Written file is empty, did the write fail?")),i!==r&&o(new Error("Written file is not containing the expected content, did the write fail?"));var s=performance.now()-t;console.info("Verified ".concat(e," content in ").concat(s.toFixed(),"ms.")),n()}))}))},pn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(nn){e.next=2;break}throw new Error("Filesystem is not supported.");case 2:if(""!==r){e.next=4;break}throw new Error("The content to save on disk is empty. Aborting.");case 4:return e.next=6,nn.ensureDir(on.dirname(t));case 6:return e.next=8,nn.writeFile(t,r);case 8:return e.next=10,ln(t,r);case 10:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),dn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify(r,null,2),e.next=3,pn(n,t);case 3:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),fn=function(e,r,t){var n,o=(0,rn.XH)(e);if(e.isFolderProject()){var a=function(e,r){var t=r.pathSeparator,n=r.getArrayItemReferenceName,o=r.shouldSplit,a=r.isReferenceMagicPropertyName,i=[],s=function(e,r){var t;return i.push({reference:e,object:r}),t={},(0,W.Z)(t,a,!0),(0,W.Z)(t,"referenceTo",e),t};return function e(r,a,i){if(null!==r&&"object"===typeof r)if(Array.isArray(r))for(var u in r){var c=a+t+"*";if(o(c)){var l=r[u],p=n(l,i),d=i+t+p;r[u]=s(d,l),e(l,c,d)}else{var f=i+t+u;e(r[u],c,f)}}else for(var h in r){var m=a+t+h,v=i+t+h;if(o(m)){var g=r[h];r[h]=s(v,g),e(g,m,v)}else e(r[h],m,v)}}(e,"",""),i}(o,{pathSeparator:"/",getArrayItemReferenceName:Xt("name"),shouldSplit:(n=new Set(un.map((function(e){return"/".concat(e,"/*")}))),function(e){return n.has(e)}),isReferenceMagicPropertyName:"__REFERENCE_TO_SPLIT_OBJECT"});return Promise.all(a.map((function(e){return dn(e.object,on.join(t,e.reference)+".json").catch((function(e){throw console.error("Unable to write a partial file:",e),e}))}))).then((function(){return dn(o,r).catch((function(e){throw console.error("Unable to write the split project:",e),e}))}))}return dn(o,r).catch((function(e){throw console.error("Unable to write the project:",e),e}))},hn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.fileIdentifier,a=Date.now(),o){e.next=4;break}throw new Error("Unable to find file path before saving.");case 4:i=(0,n.Z)((0,n.Z)({},t),{},{name:r.getName(),gameId:r.getProjectUuid(),lastModifiedDate:a}),s=on.dirname(o);try{cn(r,s)}catch(u){console.warn("Unable to clean project folder before saving project: ",u)}return e.next=9,fn(r,o,s);case 9:return e.abrupt("return",{wasSaved:!0,fileMetadata:i});case 10:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),mn=function(e){var r=e.setDialog,t=e.closeDialog;return function(){var e=(0,l.Z)((0,u.Z)().mark((function e(n){var o,a,i,s,c,l,p,f,h,m;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.project,a=n.fileMetadata,i=n.displayOptionToGenerateNewProjectUuid,e.next=3,new Promise((function(e){r((function(){return(0,T.jsx)(tn.Z,{onCancel:function(){t(),e(null)},nameSuggestion:a?"".concat(o.getName()," - Copy"):o.getName(),mainActionLabel:(0,T.jsx)(d.Trans,{id:"Continue"}),displayOptionToGenerateNewProjectUuid:i,onSave:function(r){t(),e(r)}})}))}));case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return",{saveAsLocation:null,saveAsOptions:null});case 6:if(c=a?a.fileIdentifier:"",l=s.name,on&&c&&l&&(p=l.replace(/[<>:"/\\|?*]/g,"_"),c=on.join(on.dirname(c),"".concat(p,".json"))),f=an.getCurrentWindow(),h={defaultPath:c,filters:[{name:"GDevelop 5 project",extensions:["json"]}]},sn){e.next=13;break}throw new Error("Unsupported");case 13:if(m=sn.showSaveDialogSync(f,h)){e.next=16;break}return e.abrupt("return",{saveAsLocation:null,saveAsOptions:null});case 16:return e.abrupt("return",{saveAsLocation:{name:s.name,fileIdentifier:m},saveAsOptions:{generateNewProjectUuid:s.generateNewProjectUuid}});case 17:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},vn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("A location was not chosen before saving as.");case 2:if(o=t.fileIdentifier){e.next=5;break}throw new Error("A file path was not chosen before saving as.");case 5:return n.onStartSaving(),a={fileIdentifier:o,name:r.getName(),gameId:r.getProjectUuid(),lastModifiedDate:Date.now()},e.next=9,n.onMoveResources({newFileMetadata:a});case 9:return i=on.dirname(o),r.setProjectFile(o),e.next=13,fn(r,o,i);case 13:return e.abrupt("return",{wasSaved:!0,fileMetadata:a});case 14:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),gn=function(e,r){var t=r.fileIdentifier+".autosave";return pn((0,rn.h_)(e),t).catch((function(e){throw console.error("Unable to write ".concat(t,":"),e),e}))},wn=function(e){return{id:"An error occurred when saving the project. Please try again by choosing another location."}},xn=/\\ | \/ | : | \* | \? | " | < | > | \|/g,bn=/\s+/g,yn=function(e){var r=e.projectName,t=e.saveAsLocation,n=e.newProjectsDefaultFolder,o=t?on.dirname(t.fileIdentifier):n||"",a=r?function(e){return(e.length>200?e.substring(0,200):e).replace(xn," ").replace(bn," ").trim()}(r)+".json":"game.json";return{fileIdentifier:on.join(o,a)}},Pn=function(e){if(!an)return!1;var r=an.app.getPath("exe");if(!r)return!1;var t=on.dirname(r);return e.startsWith(t)},jn=t(44032),kn=t(18455),Zn=t.g.gd,Sn=kr("glob"),En=w()("path"),Fn=w()("@electron/remote"),Dn=Fn?Fn.shell:null,Cn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,l,d,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.project,n=r.extensions,o=r.createResource,a=Sn()){e.next=4;break}return e.abrupt("return");case 4:return i=t.getResourcesManager(),s=En.dirname(t.getProjectFile()),c=[].concat((0,p.Z)(n),(0,p.Z)(n.map((function(e){return e.toUpperCase()})))),e.prev=7,e.next=10,new Promise((function(e,r){a(s+"/**/*.{"+c.join(",")+"}",(function(t,n){t?r(t):e(n)}))}));case 10:l=e.sent,d=new Zn.VectorString,l.forEach((function(e){return d.push_back(En.relative(s,e))})),f=t.getResourcesManager().findFilesNotInResources(d),d.delete(),(0,kn.mapVector)(f,(function(e){var r=(0,b.Z)(e,(function(e){return i.hasResource(e)})),n=o();n.setFile(e),n.setName(r),(0,v.r3)(t,n),i.addResource(n),n.delete(),console.info('"'.concat(e,'" added to project as resource named "').concat(r,'".'))})),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(7),console.error("Error finding files inside ".concat(s,":"),e.t0),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(r){return e.apply(this,arguments)}}(),On=t(71046),Rn=t.n(On),Nn=t(85166),An=t.n(Nn),In=t(43734),Tn=t.n(In),Ln=w()("path"),Un=w()("electron"),Mn=Un?Un.ipcRenderer:null,Gn=Mn&&Ln?function(e){var r=e.fileIdentifier,t=e.callback,n=e.options,o=An()(Tn()((function(){return Rn()((function(e){var r=Ln.relative(a,e).replace(/\\/g,"/");t({identifier:r})}),200,{leading:!1,trailing:!0})})),(function(e,r){return e(r)(r)})),a=Ln.dirname(r),i=Ln.basename(r),s=i+".autosave";Mn.on("project-file-changed",(function(e,r){o(r)}));var u=[Ln.sep+".DS_Store",Ln.sep+".git",Ln.sep+"node_modules",Ln.join(a,i),Ln.join(a,s)];n&&n.isProjectSplitInMultipleFiles&&u.push.apply(u,(0,p.Z)(un.map((function(e){return Ln.join(a,e)}))));var c=Mn.invoke("local-filesystem-watcher-setup",a,JSON.stringify({ignore:u}));return function(){Mn.removeAllListeners("project-file-changed"),c.then((function(e){Mn.invoke("local-filesystem-watcher-disable",e)}))}}:void 0,_n={internalName:"LocalFile",name:{id:"Your computer"},renderIcon:function(e){return(0,T.jsx)(jn.Z,{fontSize:e.size})},getFileMetadataFromAppArguments:function(e){return e[i.rM]&&e[i.rM].length?{fileIdentifier:e[i.rM][0]}:null},getProjectLocation:yn,renderNewProjectSaveAsLocationChooser:function(e){var r=e.projectName,t=e.saveAsLocation,n=e.setSaveAsLocation,o=e.newProjectsDefaultFolder,a=yn({projectName:r,saveAsLocation:t,newProjectsDefaultFolder:o});return(0,T.jsx)(Qe.Z,{fullWidth:!0,value:on.dirname(a.fileIdentifier),onChange:function(e){var t=on.join(e,on.basename(a.fileIdentifier));n(yn({projectName:r,saveAsLocation:{fileIdentifier:t},newProjectsDefaultFolder:o}))},type:"create-game"})},setupResourcesWatcher:Gn,createOperations:function(e){var r=e.setDialog,t=e.closeDialog;return{onOpenWithPicker:Qt,onOpen:qt,getAutoSaveCreationDate:$t,onSaveProject:hn,onChooseSaveProjectAsLocation:mn({setDialog:r,closeDialog:t}),onSaveProjectAs:vn,onAutoSaveProject:gn,onGetAutoSave:en,getOpenErrorMessage:function(e){return{id:"Check that the file exists, that this file is a proper game created with GDevelop and that you have the authorization to open it."}},getWriteErrorMessage:wn,canFileMetadataBeSafelySaved:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.fileIdentifier,!Pn(n)){e.next=4;break}return e.next=4,t.showAlert({title:{id:"Choose another location"},message:{id:"Your project is saved in the same folder as the application. This folder will be deleted when the application is updated. Please choose another location if you don't want to lose your project."}});case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),canFileMetadataBeSafelySavedAs:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.fileIdentifier,!Pn(n)){e.next=5;break}return e.next=4,t.showAlert({title:{id:"Choose another location"},message:{id:"Your project is saved in the same folder as the application. This folder will be deleted when the application is updated. Please choose another location if you don't want to lose your project."}});case 4:return e.abrupt("return",!1);case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()}},createResourceOperations:function(){return function(e){var r=e.project,t=e.resource,n=e.i18n,o=e.updateInterface,a=e.cleanUserSelectionOfResources,i=e.informUser;return[{label:n._({id:"Locate file"}),click:function(){return function(e){var r=e.project,t=e.resource,n=(0,v.U3)(r,t.getName());Dn&&Dn.showItemInFolder(En.resolve(n))}({project:r,resource:t})}},{label:n._({id:"Open file"}),click:function(){return function(e){var r=e.project,t=e.resource,n=(0,v.U3)(r,t.getName());Dn&&Dn.openPath(En.resolve(n))}({project:r,resource:t})}},{label:n._({id:"Copy file path"}),click:function(){!function(e){var r=e.project,t=e.resource,n=(0,v.U3)(r,t.getName());Fn.clipboard.writeText(En.resolve(n))}({project:r,resource:t}),i({message:(0,T.jsx)(d.Trans,{id:"Resource file path copied to clipboard"})})}},{type:"separator"},{label:n._({id:"Scan in the project folder for..."}),submenu:f.QP.map((function(e){var t=e.displayName,a=e.fileExtensions,i=e.createNewResource;return{label:n._(t),click:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cn({project:r,extensions:a,createResource:i});case 2:o();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}))},{label:n._({id:"Remove resources with invalid path"}),click:function(){!function(e){var r=e.project,t=r.getResourcesManager();t.getAllResourceNames().toJSArray().filter((function(e){return"error"===(0,v.iz)(r,e)})).forEach((function(e){t.removeResource(e),console.info("Removed due to invalid path: "+e)}))}({project:r}),a(),o()}}]}}},Jn=w()("electron"),Wn=Jn?Jn.ipcRenderer:null,Bn=function(e){var r=e.onGDJSUpdated,t=o.useContext(vt.ZP).values.useGDJSDevelopmentWatcher;return o.useEffect((function(){if(t){if(Wn)return Wn.send("setup-local-gdjs-development-watcher"),function(){Wn.send("close-local-gdjs-development-watcher")};console.error("Unable to find ipcRenderer to set up GDJS development watchers")}}),[t]),o.useEffect((function(){if(t&&Wn)return Wn.removeAllListeners("local-gdjs-development-watcher-runtime-updated"),Wn.on("local-gdjs-development-watcher-runtime-updated",(function(e,t){r()})),function(){Wn.removeAllListeners("local-gdjs-development-watcher-runtime-updated")}}),[t,r]),null},zn=t(71799),Hn=t(8018),Kn=t(38428),Xn=t.n(Kn),Vn=t(997),Yn=t(36465),Qn=t(72702),qn=t(34517),$n=t(14446),eo=t.n($n),ro=w()("electron"),to=ro?ro.ipcRenderer:null,no=w()("fs-extra"),oo=w()("path"),ao=function(e,r,t){var n=oo.extname(t),o=oo.basename(t,n),a=(0,b.Z)(o,(function(t){var o=oo.join(e,t)+n;return no.existsSync(o)||r.has(o)}));return oo.join(e,a)+n},io=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(to){e.next=2;break}throw new Error("Not supported");case 2:return e.next=4,eo().get(r,{responseType:"arraybuffer"});case 4:return n=e.sent,o=n.data,e.next=8,to.invoke("local-file-save-from-arraybuffer",o,t);case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),so=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,p,d,f,m,g,w;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.project,n=r.fileMetadata,o=r.onProgress,a=r.authenticatedUser,no&&to){e.next=3;break}throw new Error("Unsupported");case 3:return i=t.getResourcesManager(),s=i.getAllResourceNames().toJSArray(),c=s.filter((function(e){var r=i.getResource(e).getFile();return(0,v.PX)(r)})),e.next=8,(0,Yn._w)({authenticatedUser:a,allResourcePaths:c.map((function(e){return i.getResource(e).getFile()}))});case 8:return p=e.sent,d=oo.dirname(n.fileIdentifier),f=oo.join(d,"assets"),m=new Set,g=[],w=0,e.next=16,Xn().withConcurrency(50).for(c).process(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,a,s,x,b,y,P;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.getResource(r),n=t.getFile(),!(0,v.PX)(n)){e.next=30;break}if(!(0,v.Gu)(n)){e.next=19;break}return e.prev=4,a=(0,v.OI)(t),s=a.localFilePath,x=a.extension,b=s?oo.resolve(d,s):ao(f,m,(0,Qn.B)(t.getName()+(x||""))),e.next=9,no.ensureDir(f);case 9:return e.next=11,io(n,b);case 11:t.setFile(oo.relative(d,b).replace(/\\/g,"/")),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),g.push({resourceName:r,error:e.t0});case 17:e.next=30;break;case 19:return y=(0,Yn.bW)(n)?(0,Yn.jV)(n):(0,h.d0)(n)?(0,h.Lj)(n):(0,qn.dh)(n),P=ao(f,m,y),m.add(P),e.prev=22,e.next=25,(0,Vn.x)({times:2},(0,l.Z)((0,u.Z)().mark((function e(){var r,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,no.ensureDir(f);case 2:return r=new URL(n),(0,Yn.uG)(r.href)&&p&&r.searchParams.set("token",p),o=r.href,e.next=7,to.invoke("local-file-download",o,P);case 7:t.setFile(oo.relative(d,P).replace(/\\/g,"/"));case 8:case"end":return e.stop()}}),e)}))));case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(22),g.push({resourceName:r,error:e.t1});case 30:o(w++,c.length);case 31:case"end":return e.stop()}}),e,null,[[4,14],[22,27]])})));return function(r){return e.apply(this,arguments)}}());case 16:return e.abrupt("return",{erroredResources:g});case 17:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),uo=t(10822),co=t(85919),lo=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.transformItem,o=t.isChunkTooBig,a=t.processChunk,i=0,s=[];case 3:if(!(i<r.length)){e.next=20;break}return e.next=6,n(r[i]);case 6:if(c=e.sent,s.length){e.next=10;break}e.next=16;break;case 10:if(o([].concat(s,[c]))){e.next=13;break}e.next=16;break;case 13:return e.next=15,a(s);case 15:s.length=0;case 16:s.push(c),i++,e.next=3;break;case 20:if(!s.length){e.next=24;break}return e.next=23,a(s);case 23:s.length=0;case 24:return e.abrupt("return");case 25:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),po=w()("path"),fo=w()("fs"),ho=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){fo.readFile(r,(function(r,n){r?t(r):e(n)}))}));case 2:return t=e.sent,n=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),mo={aac:"audio/aac",wav:"audio/wav",mp3:"audio/mp3",ogg:"audio/ogg",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",ttf:"font/ttf",otf:"font/otf",mp4:"video/mp4",webm:"video/webm",json:"application/json",xml:"application/xml",gz:"application/gzip",js:"application/javascript"},vo=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ho(r);case 2:return t=e.sent,n=po.extname(r).replace(/^\./,""),e.abrupt("return",new File([t],po.basename(r),{type:mo[n]||"application/octet-stream"}));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),go=w()("path"),wo=t.g.gd,xo=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,p,d,f,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.project,n=r.authenticatedUser,o=r.oldFileMetadata,a=r.newFileMetadata,i=r.onProgress,s={erroredResources:[]},c=a.fileIdentifier,p=t.getResourcesManager(),d=function(e){return p.getAllResourceNames().toJSArray().map((function(e){var r=p.getResource(e),t=r.getFile();return(0,v.PX)(t)?(0,co.yk)(t)?null:(0,v.Gu)(t)?(s.erroredResources.push({resourceName:r.getName(),error:new Error("Unsupported blob URL.")}),null):null:r})).filter(Boolean)}(),f=go.dirname(o.fileIdentifier),h=0,e.next=10,lo(d,{transformItem:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=go.resolve(f,r.getFile()),e.prev=1,e.next=4,vo(t);case 4:return n=e.sent,e.abrupt("return",{resource:r,file:n});case 8:return e.prev=8,e.t0=e.catch(1),s.erroredResources.push({resourceName:r.getName(),error:new Error("Unable to open the file (".concat(t,")."))}),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(r){return e.apply(this,arguments)}}(),isChunkTooBig:function(e){return e.length>70||e.filter(Boolean).reduce((function(e,r){return e+r.file.size}),0)>15e7},processChunk:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.filter(Boolean),e.next=3,(0,qn.LG)(n,c);case 3:return e.next=5,(0,qn.ll)(n,c,t.map((function(e){return e.file})),(function(e,r){i(h+e,d.length)}));case 5:o=e.sent,h+=r.length,o.forEach((function(e,r){var n=e.url,o=e.error,a=t[r].resource;!o&&n?a.setFile(n):s.erroredResources.push({resourceName:a.getName(),error:o||new Error("Unknown error during upload.")})}));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()});case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),bo=(Bt={},(0,W.Z)(Bt,"".concat(_n.internalName,"=>").concat(_n.internalName),function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.project,n=r.newFileMetadata,o=go.dirname(n.fileIdentifier),a=ke()(new wo.AbstractFileSystemJS,new he),wo.ProjectResourcesCopier.copyAllResourcesTo(t,a,o,!0,!1,!0),e.abrupt("return",{erroredResources:[]});case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),(0,W.Z)(Bt,"".concat(zn.Z.internalName,"=>").concat(_n.internalName),(function(e){var r=e.project,t=e.newFileMetadata,n=e.onProgress,o=e.authenticatedUser;return so({project:r,fileMetadata:t,onProgress:n,authenticatedUser:o})})),(0,W.Z)(Bt,"".concat(Hn.Z.internalName,"=>").concat(_n.internalName),(function(e){var r=e.project,t=e.newFileMetadata,n=e.onProgress,o=e.authenticatedUser;return so({project:r,fileMetadata:t,onProgress:n,authenticatedUser:o})})),(0,W.Z)(Bt,"".concat(_n.internalName,"=>").concat(zn.Z.internalName),xo),(0,W.Z)(Bt,"".concat(zn.Z.internalName,"=>").concat(zn.Z.internalName),uo.G),(0,W.Z)(Bt,"".concat(Hn.Z.internalName,"=>").concat(zn.Z.internalName),uo.G),Bt),yo={moveAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.oldStorageProvider,n=r.newStorageProvider,o=bo["".concat(t.internalName,"=>").concat(n.internalName)]){e.next=4;break}throw new Error("Can't find a ResourceMover for ".concat(t.internalName," to ").concat(n.internalName,"."));case 4:return e.abrupt("return",o(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},Po=yo,jo=t(58271),ko=t(527),Zo=(zt={},(0,W.Z)(zt,zn.Z.internalName,ko.f),(0,W.Z)(zt,_n.internalName,so),(0,W.Z)(zt,Hn.Z.internalName,jo.j),zt),So={fetchAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.storageProvider,n=Zo[t.internalName]){e.next=4;break}throw new Error("Can't find a ResourceFetcher for ".concat(t.internalName," - have you registered the storage provider here?"));case 4:return e.abrupt("return",n(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},Eo=So,Fo=t(71445),Do=t(1333),Co=t(23236),Oo=i.ZP.isDev(),Ro=function(){function e(r){(0,te.Z)(this,e),this.auth=r}return(0,ne.Z)(e,[{key:"loginWithEmailAndPassword",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.email,n=r.password,e.prev=1,e.next=4,(0,Fo.e5)(this.auth,t,n);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Error while login:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(r){return e.apply(this,arguments)}}()},{key:"loginOrSignupWithProvider",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.provider,!(n=r.signal)||!n.aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new Co.s("Login or Signup with provider already aborted.")));case 3:return o=new Promise((function(e,r){n&&n.addEventListener("abort",(function(){(0,Do.g)(),r(new Co.s("Login or Signup with provider already aborted."))})),(0,Do.T)({onConnectionEstablished:function(e){if(!n||!n.aborted){var r=new URL("https://auth.gdevelop.io");r.searchParams.set("connection-id",e),r.searchParams.set("provider",t),r.searchParams.set("env",Oo?"dev":"live"),i.ZP.openExternalURL(r.toString())}},onTokenReceived:function(){var t=(0,l.Z)((0,u.Z)().mark((function t(o){var i,s,c;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=o.provider,s=o.data,!n||!n.aborted){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,c="google"===i?Fo.hJ.credential(s.credential):"github"===i?Fo.GH.credential(s.accessToken):new Fo.O4("apple.com").credential({idToken:s.id_token,nonce:s.raw_nonce}),t.next=7,(0,Fo.sB)(a.auth,c);case 7:e(),(0,Do.g)(),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(3),console.error("An error occurred while logging in with ".concat(i," token:"),t.t0),r(t.t0);case 15:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e){return t.apply(this,arguments)}}(),onError:function(e){n&&n.aborted||((0,Do.g)(),console.error("An error occurred while setting up authentication web socket:",e),r(new Error("An error occurred while setting up authentication web socket.")))},onTimeout:function(){n&&n.aborted||((0,Do.g)(),console.error("Connection to authorization websocket timed out."),r(new Error("Connection to authorization websocket timed out.")))}})})),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}]),e}(),No=Ro,Ao=t.g.gd,Io=function(e){i.ZP.setUpContextMenu();var r=new No(e.auth);e.setLoginProvider(r);var t=i.ZP.getArguments(),o=i.ZP.isDev();return(0,T.jsx)(Tt.Z,{authentication:e,disableCheckForUpdates:!!t["disable-update-check"],makeEventsFunctionCodeWriter:Nt,eventsFunctionsExtensionWriter:_t,eventsFunctionsExtensionOpener:Wt,children:function(e){var r=e.i18n;return(0,T.jsx)(Ht.Z,{appArguments:t,storageProviders:[_n,Hn.Z,zn.Z],defaultStorageProvider:_n,children:function(e){var i=e.getStorageProviderOperations,u=e.getStorageProviderResourceOperations,c=e.storageProviders,l=e.initialFileMetadataToOpen,p=e.getStorageProvider;return(0,T.jsx)(a.Z,{i18n:r,renderMainMenu:function(e,r,t){return(0,T.jsx)(Zt,{props:e,callbacks:r,extraCallbacks:t})},renderPreviewLauncher:function(e,r){return(0,T.jsx)(Ye,(0,n.Z)((0,n.Z)({},e),{},{ref:r}))},renderShareDialog:function(e){return(0,T.jsx)(s.Z,{project:e.project,onSaveProject:e.onSaveProject,isSavingProject:e.isSavingProject,onChangeSubscription:e.onChangeSubscription,onClose:e.onClose,automatedExporters:dt,manualExporters:ft,onlineWebExporter:pt,fileMetadata:e.fileMetadata,storageProvider:e.storageProvider,initialTab:e.initialTab,gamesList:e.gamesList})},quickPublishOnlineWebExporter:pt,renderGDJSDevelopmentWatcher:o?function(e){var r=e.onGDJSUpdated;return(0,T.jsx)(Bn,{onGDJSUpdated:r})}:null,storageProviders:c,resourceMover:Po,resourceFetcher:Eo,getStorageProviderOperations:i,getStorageProviderResourceOperations:u,getStorageProvider:p,resourceSources:J,resourceExternalEditors:re,extensionsLoader:Et()({gd:Ao,objectsEditorService:At.Z,objectsRenderingService:It.Z,filterExamples:!o}),initialFileMetadataToOpen:l,initialExampleSlugToOpen:t["create-from-example"]||null})}})}})}}}]);
//# sourceMappingURL=local-app.ee668734.chunk.js.map